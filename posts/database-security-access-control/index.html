<!DOCTYPE html>
<html lang="zh" class="scroll-smooth">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    
    <title>Database Security and Access Control: A Comprehensive Guide to Protecting Your Data | æ»´æ°´æ’å¿ƒ</title>
    


<meta name="description" content="Complete guide to database security, covering authentication, authorization, encryption, auditing, and compliance strategies for protecting sensitive data.">
<meta name="keywords" content="Database, Security, Access Control, Authentication, Authorization, Encryption, technology, programming, web development, hugo, æŠ€æœ¯, ç¼–ç¨‹, ç½‘ç«™å¼€å‘">
<meta name="author" content="Database Security Team">


<meta property="og:title" content="Database Security and Access Control: A Comprehensive Guide to Protecting Your Data">
<meta property="og:description" content="Complete guide to database security, covering authentication, authorization, encryption, auditing, and compliance strategies for protecting sensitive data.">
<meta property="og:type" content="article">
<meta property="og:url" content="https://www.dishuihengxin.com/posts/database-security-access-control/">
<meta property="og:site_name" content="æ»´æ°´æ’å¿ƒ">
<meta property="og:locale" content="zh">




    



<meta property="og:image" content="https://www.dishuihengxin.com/images/logo.png">
<meta property="og:image:alt" content="Database Security and Access Control: A Comprehensive Guide to Protecting Your Data">



<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:title" content="Database Security and Access Control: A Comprehensive Guide to Protecting Your Data">
<meta name="twitter:description" content="Complete guide to database security, covering authentication, authorization, encryption, auditing, and compliance strategies for protecting sensitive data.">

<meta name="twitter:site" content="@dishuihengxin">
<meta name="twitter:creator" content="@dishuihengxin">


<meta name="twitter:image" content="https://www.dishuihengxin.com/images/logo.png">




<meta property="article:published_time" content="2025-12-31T22:00:00&#43;08:00">

<meta property="article:modified_time" content="2025-12-31T22:00:00&#43;08:00">


<meta property="article:author" content="Database Security Team">


<meta property="article:section" content="Database">


<meta property="article:tag" content="Database">

<meta property="article:tag" content="Security">

<meta property="article:tag" content="Access Control">

<meta property="article:tag" content="Authentication">

<meta property="article:tag" content="Authorization">

<meta property="article:tag" content="Encryption">




<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "Article",
  "name": "Database Security and Access Control: A Comprehensive Guide to Protecting Your Data",
  "headline": "Database Security and Access Control: A Comprehensive Guide to Protecting Your Data",
  "description": "Complete guide to database security, covering authentication, authorization, encryption, auditing, and compliance strategies for protecting sensitive data.",
  "url": "https:\/\/www.dishuihengxin.com\/posts\/database-security-access-control\/",
  
  "datePublished": "2025-12-31T22:00:00\u002b08:00",
  
  "dateModified": "2025-12-31T22:00:00\u002b08:00",
  
  "author": {
    "@type": "Person",
    "name": "Database Security Team"
  },
  "publisher": {
    "@type": "Organization",
    "name": "æ»´æ°´æ’å¿ƒ",
    "logo": {
      "@type": "ImageObject",
      "url": "https:\/\/www.dishuihengxin.com\/images\/logo.png"
    }
  },
  
  "image": {
    "@type": "ImageObject",
    "url": "https:\/\/www.dishuihengxin.com\/images\/logo.png"
  },
  
  
  "articleSection": ["Database"],
  
  
  "keywords": ["Database", "Security", "Access Control", "Authentication", "Authorization", "Encryption"],
  
  "wordCount":  8974 ,
  "timeRequired": "PT43M",
  
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https:\/\/www.dishuihengxin.com\/posts\/database-security-access-control\/"
  }
}
</script>






<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position": 1,
      "name": "é¦–é¡µ",
      "item": "https:\/\/www.dishuihengxin.com\/"
    }
    
    ,{
      "@type": "ListItem",
      "position": 2,
      "name": "Posts",
      "item": "https:\/\/www.dishuihengxin.com\//posts/"
    }
    
    
    ,{
      "@type": "ListItem",
      "position": 3,
      "name": "Database Security and Access Control: A Comprehensive Guide to Protecting Your Data",
      "item": "https:\/\/www.dishuihengxin.com\/posts\/database-security-access-control\/"
    }
    
  ]
}
</script>



<link rel="canonical" href="https://www.dishuihengxin.com/posts/database-security-access-control/">






<meta name="robots" content="index, follow">



<meta name="theme-color" content="#3B82F6">
<meta name="msapplication-TileColor" content="#3B82F6">











<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>



<meta http-equiv="X-Content-Type-Options" content="nosniff">
<meta http-equiv="X-XSS-Protection" content="1; mode=block">
<meta http-equiv="Referrer-Policy" content="strict-origin-when-cross-origin">


<link rel="dns-prefetch" href="//fonts.googleapis.com">
<link rel="dns-prefetch" href="//cdnjs.cloudflare.com">


    
    
    <link rel="alternate" hreflang="zh" href="https://www.dishuihengxin.com/posts/database-security-access-control/">
    
    <link rel="alternate" hreflang="x-default" href="https://www.dishuihengxin.com/posts/database-security-access-control/">

    
    <link rel="icon" type="image/x-icon" href="/favicon.ico">

    
    <link rel="manifest" href="/manifest.json">
    <meta name="theme-color" content="#667eea">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="æ»´æ°´æ’å¿ƒ">
    <link rel="apple-touch-icon" href="/icons/icon-192x192.png">

    
    

    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&amp;display=swap"
        rel="stylesheet">

    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
        integrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw=="
        crossorigin="anonymous" referrerpolicy="no-referrer">

    
    <script>
        (function () {
            const savedTheme = localStorage.getItem('theme');
            const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;

            if (savedTheme === 'dark' || (!savedTheme && prefersDark)) {
                document.documentElement.classList.add('dark');
            } else {
                document.documentElement.classList.remove('dark');
            }
        })();
    </script>

    
    <script src="https://cdn.tailwindcss.com?plugins=typography,forms,aspect-ratio"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'system-ui', 'sans-serif']
                    },
                    colors: {
                        primary: {
                            50: '#f0f4ff',
                            500: '#667eea',
                            600: '#5a67d8',
                            700: '#4c51bf'
                        }
                    },
                    animation: {
                        'gradient-shift': 'gradient-shift 3s ease infinite',
                        'float': 'float 6s ease-in-out infinite',
                        'circuit-flow': 'circuit-flow 3s ease-in-out infinite'
                    },
                    keyframes: {
                        'gradient-shift': {
                            '0%, 100%': { 'background-position': '0% 50%' },
                            '50%': { 'background-position': '100% 50%' }
                        },
                        'float': {
                            '0%, 100%': { transform: 'translateY(0px)' },
                            '33%': { transform: 'translateY(-10px)' },
                            '66%': { transform: 'translateY(-5px)' }
                        },
                        'circuit-flow': {
                            '0%': { opacity: '0.3' },
                            '50%': { opacity: '0.8' },
                            '100%': { opacity: '0.3' }
                        }
                    }
                }
            }
        }
    </script>

    
    <style>
         
        [x-cloak] {
            display: none !important;
        }

         
        .tech-hero-title {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            background-size: 200% 200%;
            animation: gradient-shift 3s ease infinite;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-shadow: 0 4px 8px rgba(102, 126, 234, 0.3);
        }

        .tech-expertise-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 1.5rem;
        }

         
        .bg-gradient-to-r.bg-clip-text.text-transparent {
            background-size: 200% 200% !important;
            animation: gradient-shift 3s ease infinite !important;
            -webkit-background-clip: text !important;
            -webkit-text-fill-color: transparent !important;
            background-clip: text !important;
        }

         
        @keyframes gradientShift {

            0%,
            100% {
                background-position: 0% 50%;
            }

            50% {
                background-position: 100% 50%;
            }
        }

         
        @keyframes gradient-shift {

            0%,
            100% {
                background-position: 0% 50%;
            }

            50% {
                background-position: 100% 50%;
            }
        }

         
        .gradient-text-primary {
            background: linear-gradient(135deg, #3b82f6 0%, #8b5cf6 50%, #ec4899 100%) !important;
            background-size: 200% 200% !important;
            -webkit-background-clip: text !important;
            -webkit-text-fill-color: transparent !important;
            background-clip: text !important;
            animation: gradientShift 4s ease infinite !important;
        }

         
        @supports not ((-webkit-background-clip: text) or (background-clip: text)) {
            .gradient-text-primary {
                color: #3b82f6 !important;
                -webkit-text-fill-color: initial !important;
            }
        }

        .expertise-card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 1rem;
            padding: 1.5rem;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .expertise-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 40px rgba(102, 126, 234, 0.3);
            border-color: rgba(102, 126, 234, 0.5);
        }

        .hero-container {
            min-height: 100vh;
            display: flex;
            align-items: center;
            position: relative;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            overflow: hidden;
        }

        .dark .hero-container {
            background: linear-gradient(135deg, #1f2937 0%, #111827 100%);
        }

        .hero-content {
            position: relative;
            z-index: 10;
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 2rem;
        }

        .hero-background {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            opacity: 0.1;
            background-image:
                radial-gradient(circle at 20% 50%, #667eea 2px, transparent 2px),
                radial-gradient(circle at 80% 50%, #764ba2 2px, transparent 2px);
            background-size: 50px 50px;
            animation: circuit-flow 3s ease-in-out infinite;
        }

        .floating-element {
            animation: float 6s ease-in-out infinite;
        }

        .floating-element:nth-child(2) {
            animation-delay: -2s;
        }

        .floating-element:nth-child(3) {
            animation-delay: -4s;
        }

        .scroll-reveal {
            opacity: 0;
            transform: translateY(30px);
            transition: all 0.6s ease;
        }

        .scroll-reveal.revealed {
            opacity: 1;
            transform: translateY(0);
        }

        .heading-hero {
            font-size: clamp(2.5rem, 8vw, 4.5rem);
            font-weight: 900;
            line-height: 1.1;
            letter-spacing: -0.02em;
        }

        .text-gradient {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 0.75rem;
            padding: 1rem 2rem;
            font-weight: 600;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            cursor: pointer;
            text-decoration: none;
            display: inline-block;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary {
            background: transparent;
            color: #667eea;
            border: 2px solid #667eea;
            border-radius: 0.75rem;
            padding: 1rem 2rem;
            font-weight: 600;
            transition: all 0.3s ease;
            cursor: pointer;
            text-decoration: none;
            display: inline-block;
        }

        .btn-secondary:hover {
            background: #667eea;
            color: white;
            transform: translateY(-2px);
        }

        .dark .expertise-card {
            background: rgba(17, 24, 39, 0.8);
            border-color: rgba(75, 85, 99, 0.3);
        }

         
        .theme-toggle {
            width: 3rem;
            height: 3rem;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .theme-toggle:hover {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
    </style>

    
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>

    
    <script>
        
        setTimeout(function () {
            if (typeof Alpine === 'undefined') {
                console.warn('Alpine.js failed to load, removing x-cloak attributes');
                document.querySelectorAll('[x-cloak]').forEach(function (el) {
                    el.removeAttribute('x-cloak');
                });
            }
        }, 3000);

        
        document.addEventListener('DOMContentLoaded', function () {
            setTimeout(function () {
                if (typeof Alpine !== 'undefined' && Alpine.version) {
                    console.log('Alpine.js loaded successfully:', Alpine.version);
                } else {
                    console.warn('Alpine.js not detected, removing x-cloak attributes');
                    document.querySelectorAll('[x-cloak]').forEach(function (el) {
                        el.removeAttribute('x-cloak');
                    });
                }
            }, 1000);
        });
    </script>

    
    
    
    
    
    
    <link rel="stylesheet" href="/css/main.min.9e2f71f12a5e62a0c84d9750953f69eacbfe1a3439469ecc789c6c2d905dd251.css" 
        integrity="sha256-ni9x8SpeYqDITZdQlT9p6sv&#43;GjQ5Rp7MeJxsLZBd0lE=" crossorigin="anonymous" >
    

    
    
    
    
    
    
    <link rel="stylesheet" href="/css/code.min.d8113910e55a8bf3c2b00bff6664d767b1326c723f610ffdbb17db29b550c869.css" 
        integrity="sha256-2BE5EOVai/PCsAv/ZmTXZ7EybHI/YQ/9uxfbKbVQyGk=" crossorigin="anonymous" >
    



    
    
    
    
    
    
    <link rel="stylesheet" href="/css/article-content.min.1e7243d4c68581aed5ac49dbf65270186efd57f979274513bfe8e9b07aca9106.css" 
        integrity="sha256-HnJD1MaFga7VrEnb9lJwGG79V/l5J0UTv&#43;jpsHrKkQY=" crossorigin="anonymous" >
    

    
    
    
    
    
    
    <script src="/js/code.min.e908b2b60c4f45e49eac078432e3caeb2f68cd90bacf6655e1e2daeb7c033a61.js"  integrity="sha256-6QiytgxPReSerAeEMuPK6y9ozZC6z2ZV4eLa63wDOmE="
        crossorigin="anonymous"  defer></script>
    

    
    
    
    
    
    
    <link rel="stylesheet" href="/css/theme.min.dd2785de1340fb42994644dc99d93edb890756750d7144ab9b7aadaacbb01150.css" 
        integrity="sha256-3SeF3hNA&#43;0KZRkTcmdk&#43;24kHVnUNcUSrm3qtqsuwEVA=" crossorigin="anonymous" >
    

    
    
    
    
    
    <link rel="stylesheet" href="/css/responsive.min.f144a503e14c68cbc38822196c7658af9ab370ed84cae94de772479879f32f16.css" 
        integrity="sha256-8USlA&#43;FMaMvDiCIZbHZYr5qzcO2EyulN53JHmHnzLxY=" crossorigin="anonymous" >
    

    
    
    
    
    
    
    <link rel="stylesheet" href="/css/view-toggle.min.1a3ade9d6e3626af96631334fe0e34633672c976cdac345380fe83b1cf365d03.css" 
        integrity="sha256-GjrenW42Jq&#43;WYxM0/g40YzZyyXbNrDRTgP6Dsc82XQM=" crossorigin="anonymous" >
    

    
    
    
    
    
    
    <link rel="stylesheet" href="/css/hero-effects.min.cae12dabb387339d39793c685980b23d5568e5a2bad8336dcfacc86a4c84147b.css" 
        integrity="sha256-yuEtq7OHM505eTxoWYCyPVVo5aK62DNtz6zIakyEFHs=" crossorigin="anonymous" >
    

</head>

<body class="font-sans antialiased transition-all duration-500 overflow-x-hidden body-gradient-light">

    
    <div class="fixed inset-0 pointer-events-none z-0">
        <div
            class="absolute inset-0 bg-gradient-to-br from-blue-50/50 via-purple-50/30 to-pink-50/50 dark:from-gray-900/90 dark:via-blue-900/50 dark:to-purple-900/30">
        </div>
        <div
            class="absolute top-1/4 left-1/4 w-96 h-96 bg-gradient-to-r from-blue-400/20 to-purple-500/20 rounded-full blur-3xl animate-float">
        </div>
        <div
            class="absolute bottom-1/4 right-1/4 w-80 h-80 bg-gradient-to-r from-purple-400/20 to-pink-500/20 rounded-full blur-3xl animate-pulse">
        </div>
        <div
            class="absolute top-3/4 left-1/2 w-64 h-64 bg-gradient-to-r from-cyan-400/15 to-blue-500/15 rounded-full blur-2xl animate-float animation-delay-2000">
        </div>
    </div>

    
    <div class="relative z-50">
        
<section x-data="{ 
            showNotification: false,
            notificationVersion: '2024-01-20', // Update this when notification content changes
            dismissDuration: 24 * 60 * 60 * 1000, // 24 hours in milliseconds
            
            init() {
                this.checkNotificationStatus();
            },
            
            checkNotificationStatus() {
                const dismissedData = localStorage.getItem('notification-dismissed');
                
                if (!dismissedData) {
                    // Never dismissed, show notification
                    this.showNotification = true;
                    return;
                }
                
                try {
                    const data = JSON.parse(dismissedData);
                    const currentTime = Date.now();
                    
                    // Check if notification version has changed (new content)
                    if (data.version !== this.notificationVersion) {
                        this.showNotification = true;
                        return;
                    }
                    
                    // Check if enough time has passed since dismissal
                    if (currentTime - data.timestamp > this.dismissDuration) {
                        this.showNotification = true;
                        return;
                    }
                    
                    // Still within dismiss period
                    this.showNotification = false;
                } catch (e) {
                    // Invalid data format, show notification
                    this.showNotification = true;
                }
            },
            
            dismissNotification() {
                this.showNotification = false;
                const dismissData = {
                    timestamp: Date.now(),
                    version: this.notificationVersion
                };
                localStorage.setItem('notification-dismissed', JSON.stringify(dismissData));
            }
         }" 
         x-show="showNotification" 
         x-transition:enter="transition ease-out duration-300"
         x-transition:enter-start="opacity-0 transform -translate-y-full"
         x-transition:enter-end="opacity-100 transform translate-y-0"
         x-transition:leave="transition ease-in duration-200"
         x-transition:leave-start="opacity-100 transform translate-y-0"
         x-transition:leave-end="opacity-0 transform -translate-y-full"
         x-cloak
         class="fixed top-0 left-0 right-0 z-60 bg-gradient-to-r from-blue-600 to-purple-600 text-white shadow-lg"
         id="notification-section"
         role="banner"
         aria-label="é€šçŸ¥æ ">
    
    <div class="w-full max-w-7xl mx-auto px-3 sm:px-4 lg:px-8 py-2 overflow-hidden">
        <div class="flex items-center justify-between gap-2">
            
            <div class="flex items-center gap-2 flex-1 min-w-0 overflow-hidden">
                
                <div class="flex-shrink-0">
                    <svg class="w-4 h-4 sm:w-5 sm:h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5.882V19.24a1.76 1.76 0 01-3.417.592l-2.147-6.15M18 13a3 3 0 100-6M5.436 13.683A4.001 4.001 0 017 6h1.832c4.1 0 7.625-1.234 9.168-3v14c-1.543-1.766-5.067-3-9.168-3H7a3.988 3.988 0 01-1.564-.317z"></path>
                    </svg>
                </div>
                
                
                <div class="flex-1 min-w-0 overflow-hidden">
                    <p class="text-xs sm:text-sm font-medium text-white truncate">
                        
                            ğŸ‰ æ¬¢è¿è®¿é—®æˆ‘ä»¬çš„æŠ€æœ¯åšå®¢ï¼è·å–æœ€æ–°çš„æŠ€æœ¯æ–‡ç« å’Œå¼€å‘èµ„æº
                        
                    </p>
                </div>
                
                
                <div class="hidden sm:block flex-shrink-0">
                    <a href="/about" 
                       class="inline-flex items-center px-2 sm:px-3 py-1 bg-white bg-opacity-20 hover:bg-opacity-30 rounded-md text-xs sm:text-sm font-medium text-white transition-all duration-200 hover:scale-105 whitespace-nowrap">
                        
                            äº†è§£æ›´å¤š
                        
                        <svg class="ml-1 w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                        </svg>
                    </a>
                </div>
            </div>
            
            
            <div class="flex-shrink-0">
                <button @click="dismissNotification()" 
                        class="inline-flex items-center justify-center w-6 h-6 bg-white bg-opacity-20 hover:bg-opacity-30 rounded-md transition-all duration-200 hover:scale-105"
                        aria-label="å…³é—­é€šçŸ¥"
                        title="å…³é—­é€šçŸ¥ï¼ˆ24å°æ—¶åé‡æ–°æ˜¾ç¤ºï¼‰">
                    <svg class="w-3 h-3 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>
</section>


<script>
    
    
</script>
    </div>

    
    <a href="#main-content"
        class="sr-only focus:not-sr-only focus:absolute focus:top-4 focus:left-4 glass-card px-4 py-2 rounded-xl z-50 text-primary-600 dark:text-primary-400 font-medium">
        è·³è½¬åˆ°ä¸»è¦å†…å®¹
    </a>

    

    
    <div class="relative z-40">
        <section class="fixed left-0 right-0 z-55 transition-all duration-500" 
         x-data="{ 
             mobileMenuOpen: false, 
             searchOpen: false,
             scrolled: false,
             themeMenuOpen: false,
             notificationVisible: false,
             notificationVersion: '2024-01-20', // Must match notification-bar.html
             dismissDuration: 24 * 60 * 60 * 1000, // 24 hours in milliseconds
             
             checkNotificationStatus() {
                 const dismissedData = localStorage.getItem('notification-dismissed');
                 
                 if (!dismissedData) {
                     this.notificationVisible = true;
                     return;
                 }
                 
                 try {
                     const data = JSON.parse(dismissedData);
                     const currentTime = Date.now();
                     
                     // Check if notification version has changed
                     if (data.version !== this.notificationVersion) {
                         this.notificationVisible = true;
                         return;
                     }
                     
                     // Check if enough time has passed since dismissal
                     if (currentTime - data.timestamp > this.dismissDuration) {
                         this.notificationVisible = true;
                         return;
                     }
                     
                     this.notificationVisible = false;
                 } catch (e) {
                     this.notificationVisible = true;
                 }
             }
         }"
         x-init="
             // Force search to be closed immediately
             $nextTick(() => {
                 searchOpen = false;
             });
             
             // Check notification status on init
             checkNotificationStatus();
             
             window.addEventListener('scroll', () => {
                 scrolled = window.pageYOffset > 50;
             });
             
             // Watch for notification bar changes
             window.addEventListener('storage', () => {
                 checkNotificationStatus();
             });
         "
         :class="{
             'glass-nav shadow-2xl shadow-primary-500/20 border-b border-white/20 dark:border-gray-700/30': scrolled,
             'bg-transparent': !scrolled,
             'top-11': notificationVisible,
             'top-0': !notificationVisible
         }"
         role="navigation"
         aria-label="ä¸»å¯¼èˆª">
    <nav>
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="flex justify-between items-center h-16">
            
            <div class="flex items-center">
                <a href="/" class="site-logo-container group flex items-center space-x-3">
                    
                    <div class="relative">
                        <div class="w-12 h-12 flex items-center justify-center transform group-hover:scale-110 transition-all duration-300">
                            <img src="/images/logo.png" 
                                 alt="æ»´æ°´æ’å¿ƒ Logo" 
                                 class="w-10 h-10 object-contain"
                                 loading="eager">
                        </div>
                    </div>
                    <div class="hidden sm:block">
                        <span class="site-title">
                            æ»´æ°´æ’å¿ƒ
                        </span>
                        <div class="site-subtitle">
                            æŠ€æœ¯åˆ†äº«
                        </div>
                    </div>
                </a>
            </div>
            
            
            <div class="hidden md:flex items-center space-x-1 flex-1 justify-end mr-4">
                
                    
                        
                        <a href="/" 
                           class="nav-menu-item  text-gray-700 dark:text-gray-300 text-base">
                            <span class="relative z-10">é¦–é¡µ</span>
                        </a>
                    
                
                    
                        
                        <a href="/posts/" 
                           class="nav-menu-item  text-gray-700 dark:text-gray-300 text-base">
                            <span class="relative z-10">åšæ–‡</span>
                        </a>
                    
                
                    
                        
                        <div class="relative group" x-data="{ open: false }" @mouseenter="open = true" @mouseleave="open = false">
                            <button class="nav-menu-item dropdown-trigger  text-gray-700 dark:text-gray-300 text-base flex items-center gap-1"
                                    @click="open = !open">
                                <span class="relative z-10">DBA</span>
                                <svg class="w-4 h-4 transition-transform duration-200" :class="{ 'rotate-180': open }" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                                </svg>
                            </button>
                            
                            
                            <div x-show="open"
                                 x-transition:enter="transition ease-out duration-200"
                                 x-transition:enter-start="opacity-0 scale-95 translate-y-2"
                                 x-transition:enter-end="opacity-100 scale-100 translate-y-0"
                                 x-transition:leave="transition ease-in duration-150"
                                 x-transition:leave-start="opacity-100 scale-100 translate-y-0"
                                 x-transition:leave-end="opacity-0 scale-95 translate-y-2"
                                 class="absolute left-0 mt-2 w-56 rounded-xl shadow-2xl backdrop-blur-xl bg-white/95 dark:bg-gray-800/95 border border-gray-200/50 dark:border-gray-700/50 overflow-hidden z-50"
                                 style="display: none;">
                                <div class="py-2">
                                    
                                        <a href="/tags/mysql/" 
                                           class="dropdown-item block px-4 py-3 text-sm text-gray-700 dark:text-gray-300 hover:bg-gradient-to-r hover:from-indigo-50 hover:to-purple-50 dark:hover:from-indigo-900/30 dark:hover:to-purple-900/30 transition-all duration-200 ">
                                            <div class="flex items-center gap-3">
                                                
                                                    <span class="text-lg">ğŸ¬</span>
                                                
                                                <div>
                                                    <div class="font-medium">MySQL</div>
                                                    
                                                        <div class="text-xs text-gray-500 dark:text-gray-400 mt-0.5">é«˜å¯ç”¨æ¶æ„ Â· ä¸»ä»å¤åˆ¶ Â· æ€§èƒ½è°ƒä¼˜</div>
                                                    
                                                </div>
                                            </div>
                                        </a>
                                    
                                        <a href="/tags/postgresql/" 
                                           class="dropdown-item block px-4 py-3 text-sm text-gray-700 dark:text-gray-300 hover:bg-gradient-to-r hover:from-indigo-50 hover:to-purple-50 dark:hover:from-indigo-900/30 dark:hover:to-purple-900/30 transition-all duration-200 ">
                                            <div class="flex items-center gap-3">
                                                
                                                    <span class="text-lg">ğŸ˜</span>
                                                
                                                <div>
                                                    <div class="font-medium">PostgreSQL</div>
                                                    
                                                        <div class="text-xs text-gray-500 dark:text-gray-400 mt-0.5">æµå¤åˆ¶ Â· é€»è¾‘å¤åˆ¶ Â· æŸ¥è¯¢ä¼˜åŒ–</div>
                                                    
                                                </div>
                                            </div>
                                        </a>
                                    
                                        <a href="/tags/oracle/" 
                                           class="dropdown-item block px-4 py-3 text-sm text-gray-700 dark:text-gray-300 hover:bg-gradient-to-r hover:from-indigo-50 hover:to-purple-50 dark:hover:from-indigo-900/30 dark:hover:to-purple-900/30 transition-all duration-200 ">
                                            <div class="flex items-center gap-3">
                                                
                                                    <span class="text-lg">ğŸ”´</span>
                                                
                                                <div>
                                                    <div class="font-medium">Oracle</div>
                                                    
                                                        <div class="text-xs text-gray-500 dark:text-gray-400 mt-0.5">RAC Â· DataGuard Â· RMAN å¤‡ä»½</div>
                                                    
                                                </div>
                                            </div>
                                        </a>
                                    
                                        <a href="/tags/tuning/" 
                                           class="dropdown-item block px-4 py-3 text-sm text-gray-700 dark:text-gray-300 hover:bg-gradient-to-r hover:from-indigo-50 hover:to-purple-50 dark:hover:from-indigo-900/30 dark:hover:to-purple-900/30 transition-all duration-200 ">
                                            <div class="flex items-center gap-3">
                                                
                                                    <span class="text-lg">âš¡</span>
                                                
                                                <div>
                                                    <div class="font-medium">æ€§èƒ½è°ƒä¼˜</div>
                                                    
                                                        <div class="text-xs text-gray-500 dark:text-gray-400 mt-0.5">SQL ä¼˜åŒ– Â· ç´¢å¼•è®¾è®¡ Â· æ‰§è¡Œè®¡åˆ’</div>
                                                    
                                                </div>
                                            </div>
                                        </a>
                                    
                                        <a href="/tags/backup/" 
                                           class="dropdown-item block px-4 py-3 text-sm text-gray-700 dark:text-gray-300 hover:bg-gradient-to-r hover:from-indigo-50 hover:to-purple-50 dark:hover:from-indigo-900/30 dark:hover:to-purple-900/30 transition-all duration-200 ">
                                            <div class="flex items-center gap-3">
                                                
                                                    <span class="text-lg">ğŸ’¾</span>
                                                
                                                <div>
                                                    <div class="font-medium">å¤‡ä»½æ¢å¤</div>
                                                    
                                                        <div class="text-xs text-gray-500 dark:text-gray-400 mt-0.5">å¤‡ä»½ç­–ç•¥ Â· PITR Â· ç¾éš¾æ¢å¤</div>
                                                    
                                                </div>
                                            </div>
                                        </a>
                                    
                                </div>
                            </div>
                        </div>
                    
                
                    
                        
                        <div class="relative group" x-data="{ open: false }" @mouseenter="open = true" @mouseleave="open = false">
                            <button class="nav-menu-item dropdown-trigger  text-gray-700 dark:text-gray-300 text-base flex items-center gap-1"
                                    @click="open = !open">
                                <span class="relative z-10">è¿ç»´</span>
                                <svg class="w-4 h-4 transition-transform duration-200" :class="{ 'rotate-180': open }" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                                </svg>
                            </button>
                            
                            
                            <div x-show="open"
                                 x-transition:enter="transition ease-out duration-200"
                                 x-transition:enter-start="opacity-0 scale-95 translate-y-2"
                                 x-transition:enter-end="opacity-100 scale-100 translate-y-0"
                                 x-transition:leave="transition ease-in duration-150"
                                 x-transition:leave-start="opacity-100 scale-100 translate-y-0"
                                 x-transition:leave-end="opacity-0 scale-95 translate-y-2"
                                 class="absolute left-0 mt-2 w-56 rounded-xl shadow-2xl backdrop-blur-xl bg-white/95 dark:bg-gray-800/95 border border-gray-200/50 dark:border-gray-700/50 overflow-hidden z-50"
                                 style="display: none;">
                                <div class="py-2">
                                    
                                        <a href="/tags/linux/" 
                                           class="dropdown-item block px-4 py-3 text-sm text-gray-700 dark:text-gray-300 hover:bg-gradient-to-r hover:from-indigo-50 hover:to-purple-50 dark:hover:from-indigo-900/30 dark:hover:to-purple-900/30 transition-all duration-200 ">
                                            <div class="flex items-center gap-3">
                                                
                                                    <span class="text-lg">ğŸ§</span>
                                                
                                                <div>
                                                    <div class="font-medium">Linux è¿ç»´</div>
                                                    
                                                        <div class="text-xs text-gray-500 dark:text-gray-400 mt-0.5">å†…æ ¸è°ƒä¼˜ Â· ç³»ç»Ÿç®¡ç† Â· Shell è„šæœ¬</div>
                                                    
                                                </div>
                                            </div>
                                        </a>
                                    
                                        <a href="/tags/monitoring/" 
                                           class="dropdown-item block px-4 py-3 text-sm text-gray-700 dark:text-gray-300 hover:bg-gradient-to-r hover:from-indigo-50 hover:to-purple-50 dark:hover:from-indigo-900/30 dark:hover:to-purple-900/30 transition-all duration-200 ">
                                            <div class="flex items-center gap-3">
                                                
                                                    <span class="text-lg">ğŸ“Š</span>
                                                
                                                <div>
                                                    <div class="font-medium">ç›‘æ§ä½“ç³»</div>
                                                    
                                                        <div class="text-xs text-gray-500 dark:text-gray-400 mt-0.5">Prometheus Â· Grafana Â· å‘Šè­¦è§„åˆ™</div>
                                                    
                                                </div>
                                            </div>
                                        </a>
                                    
                                        <a href="/tags/automation/" 
                                           class="dropdown-item block px-4 py-3 text-sm text-gray-700 dark:text-gray-300 hover:bg-gradient-to-r hover:from-indigo-50 hover:to-purple-50 dark:hover:from-indigo-900/30 dark:hover:to-purple-900/30 transition-all duration-200 ">
                                            <div class="flex items-center gap-3">
                                                
                                                    <span class="text-lg">ğŸ¤–</span>
                                                
                                                <div>
                                                    <div class="font-medium">è‡ªåŠ¨åŒ–è¿ç»´</div>
                                                    
                                                        <div class="text-xs text-gray-500 dark:text-gray-400 mt-0.5">Ansible Â· Terraform Â· IaC</div>
                                                    
                                                </div>
                                            </div>
                                        </a>
                                    
                                        <a href="/tags/network/" 
                                           class="dropdown-item block px-4 py-3 text-sm text-gray-700 dark:text-gray-300 hover:bg-gradient-to-r hover:from-indigo-50 hover:to-purple-50 dark:hover:from-indigo-900/30 dark:hover:to-purple-900/30 transition-all duration-200 ">
                                            <div class="flex items-center gap-3">
                                                
                                                    <span class="text-lg">ğŸŒ</span>
                                                
                                                <div>
                                                    <div class="font-medium">ç½‘ç»œè¿ç»´</div>
                                                    
                                                        <div class="text-xs text-gray-500 dark:text-gray-400 mt-0.5">TCP/IP Â· è´Ÿè½½å‡è¡¡ Â· ç½‘ç»œæ’éšœ</div>
                                                    
                                                </div>
                                            </div>
                                        </a>
                                    
                                        <a href="/tags/security/" 
                                           class="dropdown-item block px-4 py-3 text-sm text-gray-700 dark:text-gray-300 hover:bg-gradient-to-r hover:from-indigo-50 hover:to-purple-50 dark:hover:from-indigo-900/30 dark:hover:to-purple-900/30 transition-all duration-200 ">
                                            <div class="flex items-center gap-3">
                                                
                                                    <span class="text-lg">ğŸ”’</span>
                                                
                                                <div>
                                                    <div class="font-medium">å®‰å…¨åŠ å›º</div>
                                                    
                                                        <div class="text-xs text-gray-500 dark:text-gray-400 mt-0.5">æƒé™ç®¡ç† Â· é˜²ç«å¢™ Â· å®‰å…¨å®¡è®¡</div>
                                                    
                                                </div>
                                            </div>
                                        </a>
                                    
                                </div>
                            </div>
                        </div>
                    
                
                    
                        
                        <div class="relative group" x-data="{ open: false }" @mouseenter="open = true" @mouseleave="open = false">
                            <button class="nav-menu-item dropdown-trigger  text-gray-700 dark:text-gray-300 text-base flex items-center gap-1"
                                    @click="open = !open">
                                <span class="relative z-10">äº‘æ¶æ„</span>
                                <svg class="w-4 h-4 transition-transform duration-200" :class="{ 'rotate-180': open }" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                                </svg>
                            </button>
                            
                            
                            <div x-show="open"
                                 x-transition:enter="transition ease-out duration-200"
                                 x-transition:enter-start="opacity-0 scale-95 translate-y-2"
                                 x-transition:enter-end="opacity-100 scale-100 translate-y-0"
                                 x-transition:leave="transition ease-in duration-150"
                                 x-transition:leave-start="opacity-100 scale-100 translate-y-0"
                                 x-transition:leave-end="opacity-0 scale-95 translate-y-2"
                                 class="absolute left-0 mt-2 w-56 rounded-xl shadow-2xl backdrop-blur-xl bg-white/95 dark:bg-gray-800/95 border border-gray-200/50 dark:border-gray-700/50 overflow-hidden z-50"
                                 style="display: none;">
                                <div class="py-2">
                                    
                                        <a href="/tags/aws/" 
                                           class="dropdown-item block px-4 py-3 text-sm text-gray-700 dark:text-gray-300 hover:bg-gradient-to-r hover:from-indigo-50 hover:to-purple-50 dark:hover:from-indigo-900/30 dark:hover:to-purple-900/30 transition-all duration-200 ">
                                            <div class="flex items-center gap-3">
                                                
                                                    <span class="text-lg">â˜ï¸</span>
                                                
                                                <div>
                                                    <div class="font-medium">AWS</div>
                                                    
                                                        <div class="text-xs text-gray-500 dark:text-gray-400 mt-0.5">EC2 Â· RDS Â· S3 Â· Lambda</div>
                                                    
                                                </div>
                                            </div>
                                        </a>
                                    
                                        <a href="/tags/azure/" 
                                           class="dropdown-item block px-4 py-3 text-sm text-gray-700 dark:text-gray-300 hover:bg-gradient-to-r hover:from-indigo-50 hover:to-purple-50 dark:hover:from-indigo-900/30 dark:hover:to-purple-900/30 transition-all duration-200 ">
                                            <div class="flex items-center gap-3">
                                                
                                                    <span class="text-lg">ğŸŒ</span>
                                                
                                                <div>
                                                    <div class="font-medium">Azure</div>
                                                    
                                                        <div class="text-xs text-gray-500 dark:text-gray-400 mt-0.5">VM Â· SQL Database Â· Blob Storage</div>
                                                    
                                                </div>
                                            </div>
                                        </a>
                                    
                                        <a href="/tags/aliyun/" 
                                           class="dropdown-item block px-4 py-3 text-sm text-gray-700 dark:text-gray-300 hover:bg-gradient-to-r hover:from-indigo-50 hover:to-purple-50 dark:hover:from-indigo-900/30 dark:hover:to-purple-900/30 transition-all duration-200 ">
                                            <div class="flex items-center gap-3">
                                                
                                                    <span class="text-lg">â˜ï¸</span>
                                                
                                                <div>
                                                    <div class="font-medium">é˜¿é‡Œäº‘</div>
                                                    
                                                        <div class="text-xs text-gray-500 dark:text-gray-400 mt-0.5">ECS Â· RDS Â· OSS Â· å‡½æ•°è®¡ç®—</div>
                                                    
                                                </div>
                                            </div>
                                        </a>
                                    
                                        <a href="/tags/architecture/" 
                                           class="dropdown-item block px-4 py-3 text-sm text-gray-700 dark:text-gray-300 hover:bg-gradient-to-r hover:from-indigo-50 hover:to-purple-50 dark:hover:from-indigo-900/30 dark:hover:to-purple-900/30 transition-all duration-200 ">
                                            <div class="flex items-center gap-3">
                                                
                                                    <span class="text-lg">ğŸ—ï¸</span>
                                                
                                                <div>
                                                    <div class="font-medium">æ¶æ„è®¾è®¡</div>
                                                    
                                                        <div class="text-xs text-gray-500 dark:text-gray-400 mt-0.5">å¾®æœåŠ¡ Â· é«˜å¯ç”¨ Â· å¼¹æ€§ä¼¸ç¼©</div>
                                                    
                                                </div>
                                            </div>
                                        </a>
                                    
                                        <a href="/tags/cloud-native/" 
                                           class="dropdown-item block px-4 py-3 text-sm text-gray-700 dark:text-gray-300 hover:bg-gradient-to-r hover:from-indigo-50 hover:to-purple-50 dark:hover:from-indigo-900/30 dark:hover:to-purple-900/30 transition-all duration-200 ">
                                            <div class="flex items-center gap-3">
                                                
                                                    <span class="text-lg">ğŸš€</span>
                                                
                                                <div>
                                                    <div class="font-medium">äº‘åŸç”Ÿ</div>
                                                    
                                                        <div class="text-xs text-gray-500 dark:text-gray-400 mt-0.5">Serverless Â· Service Mesh Â· äº‘åŸç”Ÿåº”ç”¨</div>
                                                    
                                                </div>
                                            </div>
                                        </a>
                                    
                                </div>
                            </div>
                        </div>
                    
                
                    
                        
                        <div class="relative group" x-data="{ open: false }" @mouseenter="open = true" @mouseleave="open = false">
                            <button class="nav-menu-item dropdown-trigger  text-gray-700 dark:text-gray-300 text-base flex items-center gap-1"
                                    @click="open = !open">
                                <span class="relative z-10">DevOps</span>
                                <svg class="w-4 h-4 transition-transform duration-200" :class="{ 'rotate-180': open }" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                                </svg>
                            </button>
                            
                            
                            <div x-show="open"
                                 x-transition:enter="transition ease-out duration-200"
                                 x-transition:enter-start="opacity-0 scale-95 translate-y-2"
                                 x-transition:enter-end="opacity-100 scale-100 translate-y-0"
                                 x-transition:leave="transition ease-in duration-150"
                                 x-transition:leave-start="opacity-100 scale-100 translate-y-0"
                                 x-transition:leave-end="opacity-0 scale-95 translate-y-2"
                                 class="absolute left-0 mt-2 w-56 rounded-xl shadow-2xl backdrop-blur-xl bg-white/95 dark:bg-gray-800/95 border border-gray-200/50 dark:border-gray-700/50 overflow-hidden z-50"
                                 style="display: none;">
                                <div class="py-2">
                                    
                                        <a href="/tags/cicd/" 
                                           class="dropdown-item block px-4 py-3 text-sm text-gray-700 dark:text-gray-300 hover:bg-gradient-to-r hover:from-indigo-50 hover:to-purple-50 dark:hover:from-indigo-900/30 dark:hover:to-purple-900/30 transition-all duration-200 ">
                                            <div class="flex items-center gap-3">
                                                
                                                    <span class="text-lg">ğŸ”„</span>
                                                
                                                <div>
                                                    <div class="font-medium">CI/CD</div>
                                                    
                                                        <div class="text-xs text-gray-500 dark:text-gray-400 mt-0.5">Jenkins Â· GitLab CI Â· GitHub Actions</div>
                                                    
                                                </div>
                                            </div>
                                        </a>
                                    
                                        <a href="/tags/docker/" 
                                           class="dropdown-item block px-4 py-3 text-sm text-gray-700 dark:text-gray-300 hover:bg-gradient-to-r hover:from-indigo-50 hover:to-purple-50 dark:hover:from-indigo-900/30 dark:hover:to-purple-900/30 transition-all duration-200 ">
                                            <div class="flex items-center gap-3">
                                                
                                                    <span class="text-lg">ğŸ³</span>
                                                
                                                <div>
                                                    <div class="font-medium">Docker</div>
                                                    
                                                        <div class="text-xs text-gray-500 dark:text-gray-400 mt-0.5">é•œåƒæ„å»º Â· å®¹å™¨ç¼–æ’ Â· æœ€ä½³å®è·µ</div>
                                                    
                                                </div>
                                            </div>
                                        </a>
                                    
                                        <a href="/tags/kubernetes/" 
                                           class="dropdown-item block px-4 py-3 text-sm text-gray-700 dark:text-gray-300 hover:bg-gradient-to-r hover:from-indigo-50 hover:to-purple-50 dark:hover:from-indigo-900/30 dark:hover:to-purple-900/30 transition-all duration-200 ">
                                            <div class="flex items-center gap-3">
                                                
                                                    <span class="text-lg">â˜¸ï¸</span>
                                                
                                                <div>
                                                    <div class="font-medium">Kubernetes</div>
                                                    
                                                        <div class="text-xs text-gray-500 dark:text-gray-400 mt-0.5">Pod Â· Service Â· Ingress Â· Helm</div>
                                                    
                                                </div>
                                            </div>
                                        </a>
                                    
                                        <a href="/tags/gitops/" 
                                           class="dropdown-item block px-4 py-3 text-sm text-gray-700 dark:text-gray-300 hover:bg-gradient-to-r hover:from-indigo-50 hover:to-purple-50 dark:hover:from-indigo-900/30 dark:hover:to-purple-900/30 transition-all duration-200 ">
                                            <div class="flex items-center gap-3">
                                                
                                                    <span class="text-lg">ğŸ”€</span>
                                                
                                                <div>
                                                    <div class="font-medium">GitOps</div>
                                                    
                                                        <div class="text-xs text-gray-500 dark:text-gray-400 mt-0.5">ArgoCD Â· Flux Â· å£°æ˜å¼éƒ¨ç½²</div>
                                                    
                                                </div>
                                            </div>
                                        </a>
                                    
                                        <a href="/tags/observability/" 
                                           class="dropdown-item block px-4 py-3 text-sm text-gray-700 dark:text-gray-300 hover:bg-gradient-to-r hover:from-indigo-50 hover:to-purple-50 dark:hover:from-indigo-900/30 dark:hover:to-purple-900/30 transition-all duration-200 ">
                                            <div class="flex items-center gap-3">
                                                
                                                    <span class="text-lg">ğŸ‘ï¸</span>
                                                
                                                <div>
                                                    <div class="font-medium">å¯è§‚æµ‹æ€§</div>
                                                    
                                                        <div class="text-xs text-gray-500 dark:text-gray-400 mt-0.5">æ—¥å¿— Â· æŒ‡æ ‡ Â· é“¾è·¯è¿½è¸ª</div>
                                                    
                                                </div>
                                            </div>
                                        </a>
                                    
                                </div>
                            </div>
                        </div>
                    
                
                    
                        
                        <a href="/about/" 
                           class="nav-menu-item  text-gray-700 dark:text-gray-300 text-base">
                            <span class="relative z-10">å…³äº</span>
                        </a>
                    
                
            </div>
            
            
            <div class="flex items-center space-x-3">
                
                <button @click="toggleTheme()" 
                         @keydown.enter="toggleTheme()"
                         @keydown.space.prevent="toggleTheme()"
                         class="nav-action-btn group focus:outline-none"
                         data-toggle="dark-mode"
                         type="button"
                         role="switch"
                         :aria-checked="document.documentElement.classList.contains('dark') ? 'true' : 'false'"
                         aria-label="åˆ‡æ¢ä¸»é¢˜"
                         :aria-describedby="document.documentElement.classList.contains('dark') ? 'theme-dark' : 'theme-light'">
                    <svg class="text-gray-600 dark:text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true" focusable="false">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"></path>
                    </svg>
                </button>
                
                
                <a href="/search/" 
                   class="nav-action-btn group focus:outline-none"
                   aria-label="æœç´¢">
                    <svg class="text-gray-600 dark:text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                    </svg>
                </a>
                
                
                
                
                    
                
                    
                    
                    
                    
                    
                        
                        
                            
                        
                    
                    
                    <a href="/en/posts/database-security-access-control/" 
                       hreflang="en"
                       class="lang-switcher flex items-center space-x-2 text-gray-600 dark:text-gray-400 group"
                       aria-label="Switch to English">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5h12M9 3v2m1.048 9.5A18.022 18.022 0 016.412 9m6.088 9h7M11 21l5-10 5 10M12.751 5C11.783 10.77 8.07 15.61 3 18.129"></path>
                        </svg>
                        <span>EN</span>
                    </a>
                    
                
                
                
                
                <button @click="mobileMenuOpen = !mobileMenuOpen" 
                         @keydown.enter="mobileMenuOpen = !mobileMenuOpen"
                         @keydown.space.prevent="mobileMenuOpen = !mobileMenuOpen"
                         class="mobile-menu-toggle md:hidden p-2 rounded-md transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:ring-offset-2"
                         type="button"
                         :aria-label="mobileMenuOpen ? 'å…³é—­èœå•' : 'æ‰“å¼€èœå•'"
                         :aria-expanded="mobileMenuOpen ? 'true' : 'false'"
                         aria-controls="mobile-menu">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" focusable="false">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
                    </svg>
                </button>
            </div>
        </div>
        
        
        <div x-show="mobileMenuOpen" 
             x-transition:enter="transition ease-out duration-300"
             x-transition:enter-start="transform opacity-0 scale-95 translate-y-2"
             x-transition:enter-end="transform opacity-100 scale-100 translate-y-0"
             x-transition:leave="transition ease-in duration-200"
             x-transition:leave-start="transform opacity-100 scale-100 translate-y-0"
             x-transition:leave-end="transform opacity-0 scale-95 translate-y-2"
             id="mobile-menu"
             class="mobile-menu-container md:hidden"
             role="menu"
             aria-label="ç§»åŠ¨ç«¯å¯¼èˆªèœå•">
            <div class="px-4 pt-4 pb-6 space-y-2">
                
                    
                        
                        <a href="/" 
                           class="mobile-nav-item block text-gray-700 dark:text-gray-300 ">
                            é¦–é¡µ
                        </a>
                    
                
                    
                        
                        <a href="/posts/" 
                           class="mobile-nav-item block text-gray-700 dark:text-gray-300 ">
                            åšæ–‡
                        </a>
                    
                
                    
                        
                        <div x-data="{ mobileSubOpen: false }" class="space-y-1">
                            <button @click="mobileSubOpen = !mobileSubOpen"
                                    class="mobile-nav-item w-full flex items-center justify-between text-gray-700 dark:text-gray-300 ">
                                <span>DBA</span>
                                <svg class="w-4 h-4 transition-transform duration-200" :class="{ 'rotate-180': mobileSubOpen }" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                                </svg>
                            </button>
                            <div x-show="mobileSubOpen" 
                                 x-transition:enter="transition ease-out duration-200"
                                 x-transition:enter-start="opacity-0 -translate-y-1"
                                 x-transition:enter-end="opacity-100 translate-y-0"
                                 class="pl-4 space-y-1"
                                 style="display: none;">
                                
                                    <a href="/tags/mysql/" 
                                       class="mobile-nav-subitem block py-2 px-3 text-sm text-gray-600 dark:text-gray-400 hover:text-indigo-600 dark:hover:text-indigo-400 rounded-lg hover:bg-indigo-50 dark:hover:bg-indigo-900/20 transition-colors ">
                                        <span class="mr-2">ğŸ¬</span>MySQL
                                    </a>
                                
                                    <a href="/tags/postgresql/" 
                                       class="mobile-nav-subitem block py-2 px-3 text-sm text-gray-600 dark:text-gray-400 hover:text-indigo-600 dark:hover:text-indigo-400 rounded-lg hover:bg-indigo-50 dark:hover:bg-indigo-900/20 transition-colors ">
                                        <span class="mr-2">ğŸ˜</span>PostgreSQL
                                    </a>
                                
                                    <a href="/tags/oracle/" 
                                       class="mobile-nav-subitem block py-2 px-3 text-sm text-gray-600 dark:text-gray-400 hover:text-indigo-600 dark:hover:text-indigo-400 rounded-lg hover:bg-indigo-50 dark:hover:bg-indigo-900/20 transition-colors ">
                                        <span class="mr-2">ğŸ”´</span>Oracle
                                    </a>
                                
                                    <a href="/tags/tuning/" 
                                       class="mobile-nav-subitem block py-2 px-3 text-sm text-gray-600 dark:text-gray-400 hover:text-indigo-600 dark:hover:text-indigo-400 rounded-lg hover:bg-indigo-50 dark:hover:bg-indigo-900/20 transition-colors ">
                                        <span class="mr-2">âš¡</span>æ€§èƒ½è°ƒä¼˜
                                    </a>
                                
                                    <a href="/tags/backup/" 
                                       class="mobile-nav-subitem block py-2 px-3 text-sm text-gray-600 dark:text-gray-400 hover:text-indigo-600 dark:hover:text-indigo-400 rounded-lg hover:bg-indigo-50 dark:hover:bg-indigo-900/20 transition-colors ">
                                        <span class="mr-2">ğŸ’¾</span>å¤‡ä»½æ¢å¤
                                    </a>
                                
                            </div>
                        </div>
                    
                
                    
                        
                        <div x-data="{ mobileSubOpen: false }" class="space-y-1">
                            <button @click="mobileSubOpen = !mobileSubOpen"
                                    class="mobile-nav-item w-full flex items-center justify-between text-gray-700 dark:text-gray-300 ">
                                <span>è¿ç»´</span>
                                <svg class="w-4 h-4 transition-transform duration-200" :class="{ 'rotate-180': mobileSubOpen }" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                                </svg>
                            </button>
                            <div x-show="mobileSubOpen" 
                                 x-transition:enter="transition ease-out duration-200"
                                 x-transition:enter-start="opacity-0 -translate-y-1"
                                 x-transition:enter-end="opacity-100 translate-y-0"
                                 class="pl-4 space-y-1"
                                 style="display: none;">
                                
                                    <a href="/tags/linux/" 
                                       class="mobile-nav-subitem block py-2 px-3 text-sm text-gray-600 dark:text-gray-400 hover:text-indigo-600 dark:hover:text-indigo-400 rounded-lg hover:bg-indigo-50 dark:hover:bg-indigo-900/20 transition-colors ">
                                        <span class="mr-2">ğŸ§</span>Linux è¿ç»´
                                    </a>
                                
                                    <a href="/tags/monitoring/" 
                                       class="mobile-nav-subitem block py-2 px-3 text-sm text-gray-600 dark:text-gray-400 hover:text-indigo-600 dark:hover:text-indigo-400 rounded-lg hover:bg-indigo-50 dark:hover:bg-indigo-900/20 transition-colors ">
                                        <span class="mr-2">ğŸ“Š</span>ç›‘æ§ä½“ç³»
                                    </a>
                                
                                    <a href="/tags/automation/" 
                                       class="mobile-nav-subitem block py-2 px-3 text-sm text-gray-600 dark:text-gray-400 hover:text-indigo-600 dark:hover:text-indigo-400 rounded-lg hover:bg-indigo-50 dark:hover:bg-indigo-900/20 transition-colors ">
                                        <span class="mr-2">ğŸ¤–</span>è‡ªåŠ¨åŒ–è¿ç»´
                                    </a>
                                
                                    <a href="/tags/network/" 
                                       class="mobile-nav-subitem block py-2 px-3 text-sm text-gray-600 dark:text-gray-400 hover:text-indigo-600 dark:hover:text-indigo-400 rounded-lg hover:bg-indigo-50 dark:hover:bg-indigo-900/20 transition-colors ">
                                        <span class="mr-2">ğŸŒ</span>ç½‘ç»œè¿ç»´
                                    </a>
                                
                                    <a href="/tags/security/" 
                                       class="mobile-nav-subitem block py-2 px-3 text-sm text-gray-600 dark:text-gray-400 hover:text-indigo-600 dark:hover:text-indigo-400 rounded-lg hover:bg-indigo-50 dark:hover:bg-indigo-900/20 transition-colors ">
                                        <span class="mr-2">ğŸ”’</span>å®‰å…¨åŠ å›º
                                    </a>
                                
                            </div>
                        </div>
                    
                
                    
                        
                        <div x-data="{ mobileSubOpen: false }" class="space-y-1">
                            <button @click="mobileSubOpen = !mobileSubOpen"
                                    class="mobile-nav-item w-full flex items-center justify-between text-gray-700 dark:text-gray-300 ">
                                <span>äº‘æ¶æ„</span>
                                <svg class="w-4 h-4 transition-transform duration-200" :class="{ 'rotate-180': mobileSubOpen }" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                                </svg>
                            </button>
                            <div x-show="mobileSubOpen" 
                                 x-transition:enter="transition ease-out duration-200"
                                 x-transition:enter-start="opacity-0 -translate-y-1"
                                 x-transition:enter-end="opacity-100 translate-y-0"
                                 class="pl-4 space-y-1"
                                 style="display: none;">
                                
                                    <a href="/tags/aws/" 
                                       class="mobile-nav-subitem block py-2 px-3 text-sm text-gray-600 dark:text-gray-400 hover:text-indigo-600 dark:hover:text-indigo-400 rounded-lg hover:bg-indigo-50 dark:hover:bg-indigo-900/20 transition-colors ">
                                        <span class="mr-2">â˜ï¸</span>AWS
                                    </a>
                                
                                    <a href="/tags/azure/" 
                                       class="mobile-nav-subitem block py-2 px-3 text-sm text-gray-600 dark:text-gray-400 hover:text-indigo-600 dark:hover:text-indigo-400 rounded-lg hover:bg-indigo-50 dark:hover:bg-indigo-900/20 transition-colors ">
                                        <span class="mr-2">ğŸŒ</span>Azure
                                    </a>
                                
                                    <a href="/tags/aliyun/" 
                                       class="mobile-nav-subitem block py-2 px-3 text-sm text-gray-600 dark:text-gray-400 hover:text-indigo-600 dark:hover:text-indigo-400 rounded-lg hover:bg-indigo-50 dark:hover:bg-indigo-900/20 transition-colors ">
                                        <span class="mr-2">â˜ï¸</span>é˜¿é‡Œäº‘
                                    </a>
                                
                                    <a href="/tags/architecture/" 
                                       class="mobile-nav-subitem block py-2 px-3 text-sm text-gray-600 dark:text-gray-400 hover:text-indigo-600 dark:hover:text-indigo-400 rounded-lg hover:bg-indigo-50 dark:hover:bg-indigo-900/20 transition-colors ">
                                        <span class="mr-2">ğŸ—ï¸</span>æ¶æ„è®¾è®¡
                                    </a>
                                
                                    <a href="/tags/cloud-native/" 
                                       class="mobile-nav-subitem block py-2 px-3 text-sm text-gray-600 dark:text-gray-400 hover:text-indigo-600 dark:hover:text-indigo-400 rounded-lg hover:bg-indigo-50 dark:hover:bg-indigo-900/20 transition-colors ">
                                        <span class="mr-2">ğŸš€</span>äº‘åŸç”Ÿ
                                    </a>
                                
                            </div>
                        </div>
                    
                
                    
                        
                        <div x-data="{ mobileSubOpen: false }" class="space-y-1">
                            <button @click="mobileSubOpen = !mobileSubOpen"
                                    class="mobile-nav-item w-full flex items-center justify-between text-gray-700 dark:text-gray-300 ">
                                <span>DevOps</span>
                                <svg class="w-4 h-4 transition-transform duration-200" :class="{ 'rotate-180': mobileSubOpen }" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                                </svg>
                            </button>
                            <div x-show="mobileSubOpen" 
                                 x-transition:enter="transition ease-out duration-200"
                                 x-transition:enter-start="opacity-0 -translate-y-1"
                                 x-transition:enter-end="opacity-100 translate-y-0"
                                 class="pl-4 space-y-1"
                                 style="display: none;">
                                
                                    <a href="/tags/cicd/" 
                                       class="mobile-nav-subitem block py-2 px-3 text-sm text-gray-600 dark:text-gray-400 hover:text-indigo-600 dark:hover:text-indigo-400 rounded-lg hover:bg-indigo-50 dark:hover:bg-indigo-900/20 transition-colors ">
                                        <span class="mr-2">ğŸ”„</span>CI/CD
                                    </a>
                                
                                    <a href="/tags/docker/" 
                                       class="mobile-nav-subitem block py-2 px-3 text-sm text-gray-600 dark:text-gray-400 hover:text-indigo-600 dark:hover:text-indigo-400 rounded-lg hover:bg-indigo-50 dark:hover:bg-indigo-900/20 transition-colors ">
                                        <span class="mr-2">ğŸ³</span>Docker
                                    </a>
                                
                                    <a href="/tags/kubernetes/" 
                                       class="mobile-nav-subitem block py-2 px-3 text-sm text-gray-600 dark:text-gray-400 hover:text-indigo-600 dark:hover:text-indigo-400 rounded-lg hover:bg-indigo-50 dark:hover:bg-indigo-900/20 transition-colors ">
                                        <span class="mr-2">â˜¸ï¸</span>Kubernetes
                                    </a>
                                
                                    <a href="/tags/gitops/" 
                                       class="mobile-nav-subitem block py-2 px-3 text-sm text-gray-600 dark:text-gray-400 hover:text-indigo-600 dark:hover:text-indigo-400 rounded-lg hover:bg-indigo-50 dark:hover:bg-indigo-900/20 transition-colors ">
                                        <span class="mr-2">ğŸ”€</span>GitOps
                                    </a>
                                
                                    <a href="/tags/observability/" 
                                       class="mobile-nav-subitem block py-2 px-3 text-sm text-gray-600 dark:text-gray-400 hover:text-indigo-600 dark:hover:text-indigo-400 rounded-lg hover:bg-indigo-50 dark:hover:bg-indigo-900/20 transition-colors ">
                                        <span class="mr-2">ğŸ‘ï¸</span>å¯è§‚æµ‹æ€§
                                    </a>
                                
                            </div>
                        </div>
                    
                
                    
                        
                        <a href="/about/" 
                           class="mobile-nav-item block text-gray-700 dark:text-gray-300 ">
                            å…³äº
                        </a>
                    
                
            </div>
        </div>
    </div>
    

    </nav>
</section>


<script>

function toggleTheme() {
    if (window.themeManager) {
        window.themeManager.toggleTheme();
    } else {
        
        const html = document.documentElement;
        const currentTheme = html.classList.contains('dark') ? 'dark' : 'light';
        const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
        
        if (newTheme === 'dark') {
            html.classList.add('dark');
        } else {
            html.classList.remove('dark');
        }
        
        localStorage.setItem('theme', newTheme);
        updateThemeIcon(newTheme);
    }
}


function updateThemeIcon(theme) {
    const button = document.querySelector('[data-toggle="dark-mode"]');
    if (button) {
        const svg = button.querySelector('svg path');
        if (svg) {
            if (theme === 'dark') {
                
                svg.setAttribute('d', 'M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z');
            } else {
                
                svg.setAttribute('d', 'M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z');
            }
        }
    }
}


document.addEventListener('alpine:init', () => {
    Alpine.data('nav', () => ({
        init() {
            
            const savedTheme = localStorage.getItem('theme');
            const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
            const theme = savedTheme || (prefersDark ? 'dark' : 'light');
            
            if (theme === 'dark') {
                document.documentElement.classList.add('dark');
            }

            
            if (window.location.pathname.includes('/search')) {
                window['searchManager'] = new SearchManager();
            }
        }
    }));
});


document.addEventListener('DOMContentLoaded', function() {
    
    setTimeout(() => {
        if (!window.themeManager) {
            const savedTheme = localStorage.getItem('theme');
            const systemPrefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
            const theme = savedTheme || (systemPrefersDark ? 'dark' : 'light');
            
            const html = document.documentElement;
            if (theme === 'dark') {
                html.classList.add('dark');
            } else {
                html.classList.remove('dark');
            }
            
            updateThemeIcon(theme);
        }
    }, 100);
    
    
    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener('click', function (e) {
            e.preventDefault();
            const target = document.querySelector(this.getAttribute('href'));
            if (target) {
                target.scrollIntoView({
                    behavior: 'smooth',
                    block: 'start'
                });
            }
        });
    });
});
</script>
    </div>

    
    <main id="main-content" class="relative z-10 min-h-screen transition-all duration-500"
        x-data="{ notificationVisible: !localStorage.getItem('notification-dismissed') }" x-init="
              window.addEventListener('storage', () => {
                  notificationVisible = !localStorage.getItem('notification-dismissed');
              });
          " :class="{
              'pt-28': notificationVisible,
              'pt-16': !notificationVisible
          }">
        

<div
    class="relative bg-gradient-to-br from-indigo-50 via-purple-50 to-pink-50 dark:from-gray-900 dark:via-indigo-900 dark:to-purple-900 py-12 mb-8">
    <div class="absolute inset-0 opacity-10">
        <div class="absolute inset-0 bg-pattern-dots">
        </div>
    </div>
    <div class="relative max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="max-w-4xl">
            
            <nav class="flex items-center space-x-2 text-sm text-gray-600 dark:text-gray-400 mb-4">
                <a href="/"
                    class="hover:text-purple-600 dark:hover:text-purple-400 transition-colors duration-200">
                    é¦–é¡µ
                </a>
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                </svg>
                
                
                <a href="/categories/database"
                    class="hover:text-purple-600 dark:hover:text-purple-400 transition-colors duration-200">
                    Database
                </a>
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                </svg>
                
                
                <span class="text-gray-500 dark:text-gray-500">Database Security and Access Control: A Comprehensive Guide to Protecting Your Data</span>
            </nav>

            
            
            <div class="flex flex-wrap gap-2 mb-4">
                
                <a href="/categories/database"
                    class="inline-block px-3 py-1 text-sm font-medium text-purple-600 dark:text-purple-400 bg-purple-100 dark:bg-purple-900/30 rounded-full hover:bg-purple-200 dark:hover:bg-purple-900/50 transition-colors duration-200">
                    Database
                </a>
                
            </div>
            

            
            <h1 class="text-3xl md:text-4xl lg:text-5xl font-bold text-gray-900 dark:text-white mb-6 leading-tight">
                Database Security and Access Control: A Comprehensive Guide to Protecting Your Data
            </h1>

            
            <div class="flex flex-wrap items-center gap-6 text-sm text-gray-600 dark:text-gray-400">
                
                <div class="flex items-center">
                    <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                    </svg>
                    <span>åšä¸»</span>
                </div>

                
                <div class="flex items-center">
                    <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z">
                        </path>
                    </svg>
                    <time datetime="2025-12-31">
                        2025-12-31
                    </time>
                </div>

                
                <div class="flex items-center">
                    <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                    </svg>
                    <span>43 åˆ†é’Ÿ</span>
                </div>

                
                <div class="flex items-center">
                    <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z">
                        </path>
                    </svg>
                    <span>8974 å­—</span>
                </div>

                
                <div class="flex items-center">
                    <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z">
                        </path>
                    </svg>
                    <span id="view-count">--</span>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="relative max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 pb-12">
    <div class="grid grid-cols-1 lg:grid-cols-[1fr_320px] gap-8">
        
        <article class="min-w-0 overflow-hidden">
            
            

            
            
            
            
            
            

            <div
                class="ai-summary bg-gradient-to-r from-blue-50 to-indigo-50 dark:from-blue-900/20 dark:to-indigo-900/20 rounded-xl p-6 mb-8 border border-blue-200 dark:border-blue-700/50 shadow-sm">
                
                <div class="flex items-center mb-4">
                    <div
                        class="flex-shrink-0 w-8 h-8 bg-gradient-to-r from-blue-500 to-indigo-600 rounded-lg flex items-center justify-center mr-3">
                        <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"
                            aria-hidden="true">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z">
                            </path>
                        </svg>
                    </div>
                    <h3 class="text-lg font-semibold text-gray-900 dark:text-gray-100">
                        AI å¯¼è¯»
                    </h3>
                </div>

                
                <div class="prose prose-blue max-w-none dark:prose-invert">
                    
                    <p class="text-gray-600 dark:text-gray-300">
                        
                        æ·±åˆ»ç†è§£å’Œå‡†ç¡®æŠŠæ¡"Database Security and Access Control: A Comprehensive Guide to Protecting Your Data"è¿™ä¸€é‡è¦æ¦‚å¿µçš„æ ¸å¿ƒè¦ä¹‰ï¼Œæœ¬æ–‡ä»ç†è®ºåŸºç¡€ã€å®è·µåº”ç”¨å’Œå‘å±•å‰æ™¯ç­‰å¤šä¸ªç»´åº¦è¿›è¡Œäº†ç³»ç»Ÿæ€§é˜è¿°ï¼Œä¸ºè¯»è€…æä¾›äº†å…¨é¢è€Œæ·±å…¥çš„åˆ†æè§†è§’ã€‚
                        
                    </p>
                    
                </div>

                
                <div class="mt-4 pt-3 border-t border-blue-200 dark:border-blue-700/50">
                    <p class="text-xs text-gray-500 dark:text-gray-400 flex items-center">
                        <svg class="w-3 h-3 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24"
                            aria-hidden="true">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                        </svg>
                        å†…å®¹ç”±AIæ™ºèƒ½ç”Ÿæˆ
                    </p>
                </div>
            </div>
            

            
            <div class="article-content prose prose-lg max-w-none overflow-hidden">
                <h1 id="database-security-and-access-control-a-comprehensive-guide-to-protecting-your-data">Database Security and Access Control: A Comprehensive Guide to Protecting Your Data</h1>
<p>Database security is a critical aspect of modern data management, encompassing multiple layers of protection to safeguard sensitive information from unauthorized access, data breaches, and malicious attacks. This comprehensive guide explores essential security strategies, implementation techniques, and best practices for securing database systems.</p>
<h2 id="table-of-contents">Table of Contents</h2>
<ol>
<li><a href="/posts/database-security-access-control/#security-architecture-overview">Security Architecture Overview</a></li>
<li><a href="/posts/database-security-access-control/#authentication-and-authorization">Authentication and Authorization</a></li>
<li><a href="/posts/database-security-access-control/#data-encryption">Data Encryption</a></li>
<li><a href="/posts/database-security-access-control/#access-control-implementation">Access Control Implementation</a></li>
<li><a href="/posts/database-security-access-control/#auditing-and-monitoring">Auditing and Monitoring</a></li>
<li><a href="/posts/database-security-access-control/#compliance-and-governance">Compliance and Governance</a></li>
<li><a href="/posts/database-security-access-control/#security-testing-and-validation">Security Testing and Validation</a></li>
</ol>
<h2 id="security-architecture-overview">Security Architecture Overview</h2>
<h3 id="1-multi-layer-security-model">1. Multi-Layer Security Model</h3>
<pre tabindex="0"><code class="language-mermaid" data-lang="mermaid">graph TB
    A[Application Layer] --&gt; B[Authentication Layer]
    B --&gt; C[Authorization Layer]
    C --&gt; D[Network Security Layer]
    D --&gt; E[Database Security Layer]
    E --&gt; F[Storage Encryption Layer]
    F --&gt; G[Physical Security Layer]
    
    subgraph &#34;Security Controls&#34;
        H[Access Control]
        I[Encryption]
        J[Auditing]
        K[Monitoring]
    end
    
    B -.-&gt; H
    C -.-&gt; H
    E -.-&gt; I
    F -.-&gt; I
    D -.-&gt; J
    E -.-&gt; J
    A -.-&gt; K
    E -.-&gt; K
</code></pre><h3 id="2-security-configuration-framework">2. Security Configuration Framework</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="c"># Database Security Configuration</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">database_security</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">global_settings</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">security_level</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;high&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">compliance_standards</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&#34;SOX&#34;</span><span class="p">,</span><span class="w"> </span><span class="s2">&#34;GDPR&#34;</span><span class="p">,</span><span class="w"> </span><span class="s2">&#34;HIPAA&#34;</span><span class="p">,</span><span class="w"> </span><span class="s2">&#34;PCI-DSS&#34;</span><span class="p">]</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">audit_enabled</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">encryption_required</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">authentication</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">methods</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;multi_factor&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">providers</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&#34;ldap&#34;</span><span class="p">,</span><span class="w"> </span><span class="s2">&#34;oauth2&#34;</span><span class="p">,</span><span class="w"> </span><span class="s2">&#34;saml&#34;</span><span class="p">]</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;certificate&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">ca_validation</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;kerberos&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">realm</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;COMPANY.COM&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">password_policy</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">min_length</span><span class="p">:</span><span class="w"> </span><span class="m">12</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">complexity_required</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">expiration_days</span><span class="p">:</span><span class="w"> </span><span class="m">90</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">history_count</span><span class="p">:</span><span class="w"> </span><span class="m">12</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">lockout_attempts</span><span class="p">:</span><span class="w"> </span><span class="m">3</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">lockout_duration</span><span class="p">:</span><span class="w"> </span><span class="m">30</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">authorization</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">rbac_enabled</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">principle_of_least_privilege</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">role_hierarchy</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">dynamic_permissions</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">encryption</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">at_rest</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">algorithm</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;AES-256&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">key_management</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;external_hsm&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">transparent_encryption</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">in_transit</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">tls_version</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;1.3&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">certificate_validation</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">cipher_suites</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&#34;ECDHE-RSA-AES256-GCM-SHA384&#34;</span><span class="p">]</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">column_level</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">sensitive_data_types</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&#34;ssn&#34;</span><span class="p">,</span><span class="w"> </span><span class="s2">&#34;credit_card&#34;</span><span class="p">,</span><span class="w"> </span><span class="s2">&#34;email&#34;</span><span class="p">,</span><span class="w"> </span><span class="s2">&#34;phone&#34;</span><span class="p">]</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">format_preserving</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">network_security</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">firewall_rules</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="nt">source</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;application_tier&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">destination</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;database_tier&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">ports</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="m">3306</span><span class="p">,</span><span class="w"> </span><span class="m">5432</span><span class="p">,</span><span class="w"> </span><span class="m">1521</span><span class="p">]</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;tcp&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">vpc_isolation</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">private_subnets</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">bastion_host_required</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">monitoring</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">real_time_alerts</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">anomaly_detection</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">failed_login_tracking</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">privilege_escalation_detection</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">retention</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">audit_logs</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;7_years&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">security_events</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;2_years&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">access_logs</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;1_year&#34;</span><span class="w">
</span></span></span></code></pre></div><h2 id="authentication-and-authorization">Authentication and Authorization</h2>
<h3 id="1-multi-factor-authentication-system">1. Multi-Factor Authentication System</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="ch">#!/usr/bin/env python3</span>
</span></span><span class="line"><span class="cl"><span class="c1"># src/security/mfa_auth.py</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">hashlib</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">hmac</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">time</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">base64</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">qrcode</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">logging</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">,</span> <span class="n">Any</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">dataclasses</span> <span class="kn">import</span> <span class="n">dataclass</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">enum</span> <span class="kn">import</span> <span class="n">Enum</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">secrets</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">pyotp</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">ldap3</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">cryptography.fernet</span> <span class="kn">import</span> <span class="n">Fernet</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">cryptography.hazmat.primitives</span> <span class="kn">import</span> <span class="n">hashes</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">cryptography.hazmat.primitives.kdf.pbkdf2</span> <span class="kn">import</span> <span class="n">PBKDF2HMAC</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">AuthMethod</span><span class="p">(</span><span class="n">Enum</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">PASSWORD</span> <span class="o">=</span> <span class="s2">&#34;password&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">TOTP</span> <span class="o">=</span> <span class="s2">&#34;totp&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">SMS</span> <span class="o">=</span> <span class="s2">&#34;sms&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">EMAIL</span> <span class="o">=</span> <span class="s2">&#34;email&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">CERTIFICATE</span> <span class="o">=</span> <span class="s2">&#34;certificate&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">BIOMETRIC</span> <span class="o">=</span> <span class="s2">&#34;biometric&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nd">@dataclass</span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">AuthResult</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">success</span><span class="p">:</span> <span class="nb">bool</span>
</span></span><span class="line"><span class="cl">    <span class="n">user_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="n">session_token</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="n">required_methods</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">AuthMethod</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="n">error_message</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="n">risk_score</span><span class="p">:</span> <span class="nb">float</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nd">@dataclass</span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">UserCredentials</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span>
</span></span><span class="line"><span class="cl">    <span class="n">password_hash</span><span class="p">:</span> <span class="nb">str</span>
</span></span><span class="line"><span class="cl">    <span class="n">salt</span><span class="p">:</span> <span class="nb">str</span>
</span></span><span class="line"><span class="cl">    <span class="n">totp_secret</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="n">certificate_thumbprint</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="n">failed_attempts</span><span class="p">:</span> <span class="nb">int</span>
</span></span><span class="line"><span class="cl">    <span class="n">locked_until</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="n">last_login</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">DatabaseAuthenticator</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]):</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">config</span> <span class="o">=</span> <span class="n">config</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_setup_logging</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">encryption_key</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_derive_encryption_key</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">fernet</span> <span class="o">=</span> <span class="n">Fernet</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">encryption_key</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="c1"># Initialize LDAP connection if configured</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">ldap_connection</span> <span class="o">=</span> <span class="kc">None</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ldap&#39;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;enabled&#39;</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">            <span class="bp">self</span><span class="o">.</span><span class="n">_init_ldap</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">_setup_logging</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">logging</span><span class="o">.</span><span class="n">Logger</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s1">&#39;DatabaseAuth&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">logger</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">handler</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">StreamHandler</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="n">formatter</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">Formatter</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%(asctime)s</span><span class="s1"> - </span><span class="si">%(levelname)s</span><span class="s1"> - </span><span class="si">%(message)s</span><span class="s1">&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">handler</span><span class="o">.</span><span class="n">setFormatter</span><span class="p">(</span><span class="n">formatter</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">logger</span><span class="o">.</span><span class="n">addHandler</span><span class="p">(</span><span class="n">handler</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">logger</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">_derive_encryption_key</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bytes</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;&#34;&#34;Derive encryption key from master password&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="n">master_password</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;master_password&#39;</span><span class="p">,</span> <span class="s1">&#39;default_key&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="n">salt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;encryption_salt&#39;</span><span class="p">,</span> <span class="s1">&#39;default_salt&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="n">kdf</span> <span class="o">=</span> <span class="n">PBKDF2HMAC</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">            <span class="n">algorithm</span><span class="o">=</span><span class="n">hashes</span><span class="o">.</span><span class="n">SHA256</span><span class="p">(),</span>
</span></span><span class="line"><span class="cl">            <span class="n">length</span><span class="o">=</span><span class="mi">32</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="n">salt</span><span class="o">=</span><span class="n">salt</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="n">iterations</span><span class="o">=</span><span class="mi">100000</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">base64</span><span class="o">.</span><span class="n">urlsafe_b64encode</span><span class="p">(</span><span class="n">kdf</span><span class="o">.</span><span class="n">derive</span><span class="p">(</span><span class="n">master_password</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">_init_ldap</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;&#34;&#34;Initialize LDAP connection&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="n">ldap_config</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;ldap&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">        <span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">server</span> <span class="o">=</span> <span class="n">ldap3</span><span class="o">.</span><span class="n">Server</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">                <span class="n">ldap_config</span><span class="p">[</span><span class="s1">&#39;server&#39;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">                <span class="n">port</span><span class="o">=</span><span class="n">ldap_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;port&#39;</span><span class="p">,</span> <span class="mi">389</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">                <span class="n">use_ssl</span><span class="o">=</span><span class="n">ldap_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;use_ssl&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="bp">self</span><span class="o">.</span><span class="n">ldap_connection</span> <span class="o">=</span> <span class="n">ldap3</span><span class="o">.</span><span class="n">Connection</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">                <span class="n">server</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="n">user</span><span class="o">=</span><span class="n">ldap_config</span><span class="p">[</span><span class="s1">&#39;bind_dn&#39;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">                <span class="n">password</span><span class="o">=</span><span class="n">ldap_config</span><span class="p">[</span><span class="s1">&#39;bind_password&#39;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">                <span class="n">auto_bind</span><span class="o">=</span><span class="kc">True</span>
</span></span><span class="line"><span class="cl">            <span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&#34;LDAP connection established&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;Failed to connect to LDAP: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">hash_password</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">password</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">salt</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;&#34;&#34;Hash password with salt&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">salt</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">salt</span> <span class="o">=</span> <span class="n">secrets</span><span class="o">.</span><span class="n">token_hex</span><span class="p">(</span><span class="mi">32</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="c1"># Use PBKDF2 with SHA-256</span>
</span></span><span class="line"><span class="cl">        <span class="n">password_hash</span> <span class="o">=</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">pbkdf2_hmac</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;sha256&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="n">password</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">            <span class="n">salt</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">            <span class="mi">100000</span>  <span class="c1"># iterations</span>
</span></span><span class="line"><span class="cl">        <span class="p">)</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64encode</span><span class="p">(</span><span class="n">password_hash</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">),</span> <span class="n">salt</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">verify_password</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">password</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">stored_hash</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">salt</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;&#34;&#34;Verify password against stored hash&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="n">computed_hash</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hash_password</span><span class="p">(</span><span class="n">password</span><span class="p">,</span> <span class="n">salt</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">hmac</span><span class="o">.</span><span class="n">compare_digest</span><span class="p">(</span><span class="n">computed_hash</span><span class="p">,</span> <span class="n">stored_hash</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">generate_totp_secret</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;&#34;&#34;Generate TOTP secret and QR code&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="n">secret</span> <span class="o">=</span> <span class="n">pyotp</span><span class="o">.</span><span class="n">random_base32</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="c1"># Create TOTP URI</span>
</span></span><span class="line"><span class="cl">        <span class="n">totp_uri</span> <span class="o">=</span> <span class="n">pyotp</span><span class="o">.</span><span class="n">totp</span><span class="o">.</span><span class="n">TOTP</span><span class="p">(</span><span class="n">secret</span><span class="p">)</span><span class="o">.</span><span class="n">provisioning_uri</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">            <span class="n">name</span><span class="o">=</span><span class="n">user_id</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="n">issuer_name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;app_name&#39;</span><span class="p">,</span> <span class="s1">&#39;Database System&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="p">)</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="c1"># Generate QR code</span>
</span></span><span class="line"><span class="cl">        <span class="n">qr</span> <span class="o">=</span> <span class="n">qrcode</span><span class="o">.</span><span class="n">QRCode</span><span class="p">(</span><span class="n">version</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">box_size</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">border</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">qr</span><span class="o">.</span><span class="n">add_data</span><span class="p">(</span><span class="n">totp_uri</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">qr</span><span class="o">.</span><span class="n">make</span><span class="p">(</span><span class="n">fit</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">secret</span><span class="p">,</span> <span class="n">totp_uri</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">verify_totp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">secret</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">token</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;&#34;&#34;Verify TOTP token&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="n">totp</span> <span class="o">=</span> <span class="n">pyotp</span><span class="o">.</span><span class="n">TOTP</span><span class="p">(</span><span class="n">secret</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">totp</span><span class="o">.</span><span class="n">verify</span><span class="p">(</span><span class="n">token</span><span class="p">,</span> <span class="n">valid_window</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># Allow 30-second window</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">authenticate_ldap</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">username</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">password</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;&#34;&#34;Authenticate against LDAP&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">ldap_connection</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="kc">False</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">user_dn</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&#34;uid=</span><span class="si">{</span><span class="n">username</span><span class="si">}</span><span class="s2">,</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;ldap&#39;</span><span class="p">][</span><span class="s1">&#39;user_base&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">ldap_connection</span><span class="o">.</span><span class="n">authenticate</span><span class="p">(</span><span class="n">user_dn</span><span class="p">,</span> <span class="n">password</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;LDAP authentication failed: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="kc">False</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">calculate_risk_score</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">request_info</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;&#34;&#34;Calculate authentication risk score&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="n">risk_score</span> <span class="o">=</span> <span class="mf">0.0</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="c1"># Check for unusual login time</span>
</span></span><span class="line"><span class="cl">        <span class="n">current_hour</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">localtime</span><span class="p">()</span><span class="o">.</span><span class="n">tm_hour</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">current_hour</span> <span class="o">&lt;</span> <span class="mi">6</span> <span class="ow">or</span> <span class="n">current_hour</span> <span class="o">&gt;</span> <span class="mi">22</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">risk_score</span> <span class="o">+=</span> <span class="mf">0.2</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="c1"># Check for new IP address</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">request_info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ip_address&#39;</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_known_ips</span><span class="p">(</span><span class="n">user_id</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">            <span class="n">risk_score</span> <span class="o">+=</span> <span class="mf">0.3</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="c1"># Check for new device/user agent</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">request_info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;user_agent&#39;</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_known_devices</span><span class="p">(</span><span class="n">user_id</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">            <span class="n">risk_score</span> <span class="o">+=</span> <span class="mf">0.2</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="c1"># Check for geographic anomaly</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_geographic_anomaly</span><span class="p">(</span><span class="n">user_id</span><span class="p">,</span> <span class="n">request_info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ip_address&#39;</span><span class="p">)):</span>
</span></span><span class="line"><span class="cl">            <span class="n">risk_score</span> <span class="o">+=</span> <span class="mf">0.4</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="c1"># Check for recent failed attempts</span>
</span></span><span class="line"><span class="cl">        <span class="n">failed_attempts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_recent_failed_attempts</span><span class="p">(</span><span class="n">user_id</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">failed_attempts</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">risk_score</span> <span class="o">+=</span> <span class="nb">min</span><span class="p">(</span><span class="n">failed_attempts</span> <span class="o">*</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="nb">min</span><span class="p">(</span><span class="n">risk_score</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">_get_known_ips</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;&#34;&#34;Get list of known IP addresses for user&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># This would typically query a database</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">_get_known_devices</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;&#34;&#34;Get list of known devices for user&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># This would typically query a database</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">_is_geographic_anomaly</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">ip_address</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;&#34;&#34;Check if login location is anomalous&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># This would typically use IP geolocation services</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="kc">False</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">_get_recent_failed_attempts</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;&#34;&#34;Get count of recent failed login attempts&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># This would typically query audit logs</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="mi">0</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">authenticate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">credentials</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> 
</span></span><span class="line"><span class="cl">                    <span class="n">request_info</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">AuthResult</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;&#34;&#34;Main authentication method&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="c1"># Load user credentials</span>
</span></span><span class="line"><span class="cl">            <span class="n">user_creds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_user_credentials</span><span class="p">(</span><span class="n">user_id</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="ow">not</span> <span class="n">user_creds</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="k">return</span> <span class="n">AuthResult</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">                    <span class="n">success</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                    <span class="n">user_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                    <span class="n">session_token</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                    <span class="n">required_methods</span><span class="o">=</span><span class="p">[],</span>
</span></span><span class="line"><span class="cl">                    <span class="n">error_message</span><span class="o">=</span><span class="s2">&#34;User not found&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                    <span class="n">risk_score</span><span class="o">=</span><span class="mf">1.0</span>
</span></span><span class="line"><span class="cl">                <span class="p">)</span>
</span></span><span class="line"><span class="cl">            
</span></span><span class="line"><span class="cl">            <span class="c1"># Check if account is locked</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="n">user_creds</span><span class="o">.</span><span class="n">locked_until</span> <span class="ow">and</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">user_creds</span><span class="o">.</span><span class="n">locked_until</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="k">return</span> <span class="n">AuthResult</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">                    <span class="n">success</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                    <span class="n">user_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                    <span class="n">session_token</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                    <span class="n">required_methods</span><span class="o">=</span><span class="p">[],</span>
</span></span><span class="line"><span class="cl">                    <span class="n">error_message</span><span class="o">=</span><span class="s2">&#34;Account locked&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                    <span class="n">risk_score</span><span class="o">=</span><span class="mf">1.0</span>
</span></span><span class="line"><span class="cl">                <span class="p">)</span>
</span></span><span class="line"><span class="cl">            
</span></span><span class="line"><span class="cl">            <span class="c1"># Calculate risk score</span>
</span></span><span class="line"><span class="cl">            <span class="n">risk_score</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate_risk_score</span><span class="p">(</span><span class="n">user_id</span><span class="p">,</span> <span class="n">request_info</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            
</span></span><span class="line"><span class="cl">            <span class="c1"># Determine required authentication methods based on risk</span>
</span></span><span class="line"><span class="cl">            <span class="n">required_methods</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_determine_required_methods</span><span class="p">(</span><span class="n">risk_score</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            
</span></span><span class="line"><span class="cl">            <span class="c1"># Verify provided credentials</span>
</span></span><span class="line"><span class="cl">            <span class="n">auth_success</span> <span class="o">=</span> <span class="kc">True</span>
</span></span><span class="line"><span class="cl">            
</span></span><span class="line"><span class="cl">            <span class="c1"># Password authentication</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="n">AuthMethod</span><span class="o">.</span><span class="n">PASSWORD</span> <span class="ow">in</span> <span class="n">required_methods</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="n">password</span> <span class="o">=</span> <span class="n">credentials</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;password&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="k">if</span> <span class="ow">not</span> <span class="n">password</span> <span class="ow">or</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">verify_password</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">                    <span class="n">password</span><span class="p">,</span> <span class="n">user_creds</span><span class="o">.</span><span class="n">password_hash</span><span class="p">,</span> <span class="n">user_creds</span><span class="o">.</span><span class="n">salt</span>
</span></span><span class="line"><span class="cl">                <span class="p">):</span>
</span></span><span class="line"><span class="cl">                    <span class="n">auth_success</span> <span class="o">=</span> <span class="kc">False</span>
</span></span><span class="line"><span class="cl">            
</span></span><span class="line"><span class="cl">            <span class="c1"># TOTP authentication</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="n">AuthMethod</span><span class="o">.</span><span class="n">TOTP</span> <span class="ow">in</span> <span class="n">required_methods</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="n">totp_token</span> <span class="o">=</span> <span class="n">credentials</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;totp_token&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="k">if</span> <span class="ow">not</span> <span class="n">totp_token</span> <span class="ow">or</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">verify_totp</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">                    <span class="n">user_creds</span><span class="o">.</span><span class="n">totp_secret</span><span class="p">,</span> <span class="n">totp_token</span>
</span></span><span class="line"><span class="cl">                <span class="p">):</span>
</span></span><span class="line"><span class="cl">                    <span class="n">auth_success</span> <span class="o">=</span> <span class="kc">False</span>
</span></span><span class="line"><span class="cl">            
</span></span><span class="line"><span class="cl">            <span class="c1"># LDAP authentication</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ldap&#39;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;enabled&#39;</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">                <span class="n">password</span> <span class="o">=</span> <span class="n">credentials</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;password&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="k">if</span> <span class="n">password</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">authenticate_ldap</span><span class="p">(</span><span class="n">user_id</span><span class="p">,</span> <span class="n">password</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">                    <span class="n">auth_success</span> <span class="o">=</span> <span class="kc">False</span>
</span></span><span class="line"><span class="cl">            
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="n">auth_success</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="c1"># Generate session token</span>
</span></span><span class="line"><span class="cl">                <span class="n">session_token</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generate_session_token</span><span class="p">(</span><span class="n">user_id</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                
</span></span><span class="line"><span class="cl">                <span class="c1"># Update last login time</span>
</span></span><span class="line"><span class="cl">                <span class="bp">self</span><span class="o">.</span><span class="n">_update_last_login</span><span class="p">(</span><span class="n">user_id</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                
</span></span><span class="line"><span class="cl">                <span class="c1"># Reset failed attempts</span>
</span></span><span class="line"><span class="cl">                <span class="bp">self</span><span class="o">.</span><span class="n">_reset_failed_attempts</span><span class="p">(</span><span class="n">user_id</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                
</span></span><span class="line"><span class="cl">                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;Successful authentication for user: </span><span class="si">{</span><span class="n">user_id</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                
</span></span><span class="line"><span class="cl">                <span class="k">return</span> <span class="n">AuthResult</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">                    <span class="n">success</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                    <span class="n">user_id</span><span class="o">=</span><span class="n">user_id</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                    <span class="n">session_token</span><span class="o">=</span><span class="n">session_token</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                    <span class="n">required_methods</span><span class="o">=</span><span class="n">required_methods</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                    <span class="n">error_message</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                    <span class="n">risk_score</span><span class="o">=</span><span class="n">risk_score</span>
</span></span><span class="line"><span class="cl">                <span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="c1"># Increment failed attempts</span>
</span></span><span class="line"><span class="cl">                <span class="bp">self</span><span class="o">.</span><span class="n">_increment_failed_attempts</span><span class="p">(</span><span class="n">user_id</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                
</span></span><span class="line"><span class="cl">                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;Failed authentication for user: </span><span class="si">{</span><span class="n">user_id</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                
</span></span><span class="line"><span class="cl">                <span class="k">return</span> <span class="n">AuthResult</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">                    <span class="n">success</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                    <span class="n">user_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                    <span class="n">session_token</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                    <span class="n">required_methods</span><span class="o">=</span><span class="n">required_methods</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                    <span class="n">error_message</span><span class="o">=</span><span class="s2">&#34;Authentication failed&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                    <span class="n">risk_score</span><span class="o">=</span><span class="n">risk_score</span>
</span></span><span class="line"><span class="cl">                <span class="p">)</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;Authentication error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="n">AuthResult</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">                <span class="n">success</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="n">user_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="n">session_token</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="n">required_methods</span><span class="o">=</span><span class="p">[],</span>
</span></span><span class="line"><span class="cl">                <span class="n">error_message</span><span class="o">=</span><span class="s2">&#34;Internal error&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="n">risk_score</span><span class="o">=</span><span class="mf">1.0</span>
</span></span><span class="line"><span class="cl">            <span class="p">)</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">_determine_required_methods</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">risk_score</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">AuthMethod</span><span class="p">]:</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;&#34;&#34;Determine required authentication methods based on risk score&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="n">methods</span> <span class="o">=</span> <span class="p">[</span><span class="n">AuthMethod</span><span class="o">.</span><span class="n">PASSWORD</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">risk_score</span> <span class="o">&gt;</span> <span class="mf">0.3</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">methods</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">AuthMethod</span><span class="o">.</span><span class="n">TOTP</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">risk_score</span> <span class="o">&gt;</span> <span class="mf">0.7</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">methods</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">AuthMethod</span><span class="o">.</span><span class="n">EMAIL</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">methods</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">_load_user_credentials</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">UserCredentials</span><span class="p">]:</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;&#34;&#34;Load user credentials from database&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># This would typically query the database</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># For demo purposes, return a sample user</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">user_id</span> <span class="o">==</span> <span class="s2">&#34;demo_user&#34;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">password_hash</span><span class="p">,</span> <span class="n">salt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hash_password</span><span class="p">(</span><span class="s2">&#34;demo_password&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="n">UserCredentials</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">                <span class="n">user_id</span><span class="o">=</span><span class="n">user_id</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="n">password_hash</span><span class="o">=</span><span class="n">password_hash</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="n">salt</span><span class="o">=</span><span class="n">salt</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="n">totp_secret</span><span class="o">=</span><span class="s2">&#34;JBSWY3DPEHPK3PXP&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="n">certificate_thumbprint</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="n">failed_attempts</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="n">locked_until</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="n">last_login</span><span class="o">=</span><span class="kc">None</span>
</span></span><span class="line"><span class="cl">            <span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="kc">None</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">_generate_session_token</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;&#34;&#34;Generate secure session token&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="n">token_data</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;user_id&#39;</span><span class="p">:</span> <span class="n">user_id</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;timestamp&#39;</span><span class="p">:</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">(),</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;random&#39;</span><span class="p">:</span> <span class="n">secrets</span><span class="o">.</span><span class="n">token_hex</span><span class="p">(</span><span class="mi">16</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="n">token_json</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">token_data</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="n">encrypted_token</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fernet</span><span class="o">.</span><span class="n">encrypt</span><span class="p">(</span><span class="n">token_json</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">base64</span><span class="o">.</span><span class="n">urlsafe_b64encode</span><span class="p">(</span><span class="n">encrypted_token</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">_update_last_login</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;&#34;&#34;Update last login timestamp&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># This would typically update the database</span>
</span></span><span class="line"><span class="cl">        <span class="k">pass</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">_reset_failed_attempts</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;&#34;&#34;Reset failed login attempts counter&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># This would typically update the database</span>
</span></span><span class="line"><span class="cl">        <span class="k">pass</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">_increment_failed_attempts</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;&#34;&#34;Increment failed login attempts counter&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># This would typically update the database</span>
</span></span><span class="line"><span class="cl">        <span class="k">pass</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Example usage</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="n">config</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;master_password&#39;</span><span class="p">:</span> <span class="s1">&#39;secure_master_key_2024&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;encryption_salt&#39;</span><span class="p">:</span> <span class="s1">&#39;database_security_salt&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;app_name&#39;</span><span class="p">:</span> <span class="s1">&#39;Secure Database System&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;ldap&#39;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;enabled&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;server&#39;</span><span class="p">:</span> <span class="s1">&#39;ldap.company.com&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;port&#39;</span><span class="p">:</span> <span class="mi">389</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;bind_dn&#39;</span><span class="p">:</span> <span class="s1">&#39;cn=admin,dc=company,dc=com&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;bind_password&#39;</span><span class="p">:</span> <span class="s1">&#39;admin_password&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;user_base&#39;</span><span class="p">:</span> <span class="s1">&#39;ou=users,dc=company,dc=com&#39;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="n">authenticator</span> <span class="o">=</span> <span class="n">DatabaseAuthenticator</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1"># Test authentication</span>
</span></span><span class="line"><span class="cl">    <span class="n">credentials</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;password&#39;</span><span class="p">:</span> <span class="s1">&#39;demo_password&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;totp_token&#39;</span><span class="p">:</span> <span class="s1">&#39;123456&#39;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="n">request_info</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;ip_address&#39;</span><span class="p">:</span> <span class="s1">&#39;192.168.1.100&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;user_agent&#39;</span><span class="p">:</span> <span class="s1">&#39;Mozilla/5.0 (Windows NT 10.0; Win64; x64)&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;timestamp&#39;</span><span class="p">:</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="n">result</span> <span class="o">=</span> <span class="n">authenticator</span><span class="o">.</span><span class="n">authenticate</span><span class="p">(</span><span class="s1">&#39;demo_user&#39;</span><span class="p">,</span> <span class="n">credentials</span><span class="p">,</span> <span class="n">request_info</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;Authentication Result:&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;  Success: </span><span class="si">{</span><span class="n">result</span><span class="o">.</span><span class="n">success</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;  User ID: </span><span class="si">{</span><span class="n">result</span><span class="o">.</span><span class="n">user_id</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;  Session Token: </span><span class="si">{</span><span class="n">result</span><span class="o">.</span><span class="n">session_token</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;  Required Methods: </span><span class="si">{</span><span class="p">[</span><span class="n">method</span><span class="o">.</span><span class="n">value</span> <span class="k">for</span> <span class="n">method</span> <span class="ow">in</span> <span class="n">result</span><span class="o">.</span><span class="n">required_methods</span><span class="p">]</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;  Risk Score: </span><span class="si">{</span><span class="n">result</span><span class="o">.</span><span class="n">risk_score</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;  Error: </span><span class="si">{</span><span class="n">result</span><span class="o">.</span><span class="n">error_message</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&#34;__main__&#34;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">main</span><span class="p">()</span>
</span></span></code></pre></div><h3 id="2-role-based-access-control-rbac-system">2. Role-Based Access Control (RBAC) System</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="ch">#!/usr/bin/env python3</span>
</span></span><span class="line"><span class="cl"><span class="c1"># src/security/rbac_system.py</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">json</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">logging</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="n">Set</span><span class="p">,</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">Any</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">dataclasses</span> <span class="kn">import</span> <span class="n">dataclass</span><span class="p">,</span> <span class="n">field</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">enum</span> <span class="kn">import</span> <span class="n">Enum</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">time</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">timedelta</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Permission</span><span class="p">(</span><span class="n">Enum</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">READ</span> <span class="o">=</span> <span class="s2">&#34;read&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">WRITE</span> <span class="o">=</span> <span class="s2">&#34;write&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">DELETE</span> <span class="o">=</span> <span class="s2">&#34;delete&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">EXECUTE</span> <span class="o">=</span> <span class="s2">&#34;execute&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">ADMIN</span> <span class="o">=</span> <span class="s2">&#34;admin&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">GRANT</span> <span class="o">=</span> <span class="s2">&#34;grant&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">ResourceType</span><span class="p">(</span><span class="n">Enum</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">TABLE</span> <span class="o">=</span> <span class="s2">&#34;table&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">VIEW</span> <span class="o">=</span> <span class="s2">&#34;view&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">PROCEDURE</span> <span class="o">=</span> <span class="s2">&#34;procedure&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">FUNCTION</span> <span class="o">=</span> <span class="s2">&#34;function&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">SCHEMA</span> <span class="o">=</span> <span class="s2">&#34;schema&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">DATABASE</span> <span class="o">=</span> <span class="s2">&#34;database&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nd">@dataclass</span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Resource</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">resource_type</span><span class="p">:</span> <span class="n">ResourceType</span>
</span></span><span class="line"><span class="cl">    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span>
</span></span><span class="line"><span class="cl">    <span class="n">schema</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span></span><span class="line"><span class="cl">    <span class="n">database</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">parts</span> <span class="o">=</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">database</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">database</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">schema</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">schema</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="s2">&#34;.&#34;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nd">@dataclass</span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Role</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span>
</span></span><span class="line"><span class="cl">    <span class="n">description</span><span class="p">:</span> <span class="nb">str</span>
</span></span><span class="line"><span class="cl">    <span class="n">permissions</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Set</span><span class="p">[</span><span class="n">Permission</span><span class="p">]]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">dict</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">parent_roles</span><span class="p">:</span> <span class="n">Set</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">set</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">created_at</span><span class="p">:</span> <span class="n">datetime</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">is_active</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nd">@dataclass</span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">User</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span>
</span></span><span class="line"><span class="cl">    <span class="n">username</span><span class="p">:</span> <span class="nb">str</span>
</span></span><span class="line"><span class="cl">    <span class="n">email</span><span class="p">:</span> <span class="nb">str</span>
</span></span><span class="line"><span class="cl">    <span class="n">roles</span><span class="p">:</span> <span class="n">Set</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">set</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">direct_permissions</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Set</span><span class="p">[</span><span class="n">Permission</span><span class="p">]]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">dict</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">created_at</span><span class="p">:</span> <span class="n">datetime</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">last_login</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">datetime</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span></span><span class="line"><span class="cl">    <span class="n">is_active</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
</span></span><span class="line"><span class="cl">    <span class="n">session_timeout</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">3600</span>  <span class="c1"># seconds</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nd">@dataclass</span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">AccessRequest</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span>
</span></span><span class="line"><span class="cl">    <span class="n">resource</span><span class="p">:</span> <span class="n">Resource</span>
</span></span><span class="line"><span class="cl">    <span class="n">permission</span><span class="p">:</span> <span class="n">Permission</span>
</span></span><span class="line"><span class="cl">    <span class="n">context</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">dict</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">timestamp</span><span class="p">:</span> <span class="n">datetime</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nd">@dataclass</span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">AccessResult</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">granted</span><span class="p">:</span> <span class="nb">bool</span>
</span></span><span class="line"><span class="cl">    <span class="n">reason</span><span class="p">:</span> <span class="nb">str</span>
</span></span><span class="line"><span class="cl">    <span class="n">effective_permissions</span><span class="p">:</span> <span class="n">Set</span><span class="p">[</span><span class="n">Permission</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="n">applied_policies</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">RBACManager</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_setup_logging</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">users</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">User</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">roles</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Role</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">access_policies</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">audit_log</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="c1"># Initialize default roles</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">_create_default_roles</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">_setup_logging</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">logging</span><span class="o">.</span><span class="n">Logger</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s1">&#39;RBACManager&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">logger</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">handler</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">StreamHandler</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="n">formatter</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">Formatter</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%(asctime)s</span><span class="s1"> - </span><span class="si">%(levelname)s</span><span class="s1"> - </span><span class="si">%(message)s</span><span class="s1">&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">handler</span><span class="o">.</span><span class="n">setFormatter</span><span class="p">(</span><span class="n">formatter</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">logger</span><span class="o">.</span><span class="n">addHandler</span><span class="p">(</span><span class="n">handler</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">logger</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">_create_default_roles</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;&#34;&#34;Create default system roles&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># Database Administrator</span>
</span></span><span class="line"><span class="cl">        <span class="n">dba_role</span> <span class="o">=</span> <span class="n">Role</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">            <span class="n">name</span><span class="o">=</span><span class="s2">&#34;dba&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="n">description</span><span class="o">=</span><span class="s2">&#34;Database Administrator with full access&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">dba_role</span><span class="o">.</span><span class="n">permissions</span><span class="p">[</span><span class="s2">&#34;*&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="n">Permission</span><span class="o">.</span><span class="n">READ</span><span class="p">,</span> <span class="n">Permission</span><span class="o">.</span><span class="n">WRITE</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">                                   <span class="n">Permission</span><span class="o">.</span><span class="n">DELETE</span><span class="p">,</span> <span class="n">Permission</span><span class="o">.</span><span class="n">EXECUTE</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">                                   <span class="n">Permission</span><span class="o">.</span><span class="n">ADMIN</span><span class="p">,</span> <span class="n">Permission</span><span class="o">.</span><span class="n">GRANT</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">roles</span><span class="p">[</span><span class="s2">&#34;dba&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dba_role</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="c1"># Data Analyst</span>
</span></span><span class="line"><span class="cl">        <span class="n">analyst_role</span> <span class="o">=</span> <span class="n">Role</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">            <span class="n">name</span><span class="o">=</span><span class="s2">&#34;data_analyst&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="n">description</span><span class="o">=</span><span class="s2">&#34;Read-only access to data tables&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">analyst_role</span><span class="o">.</span><span class="n">permissions</span><span class="p">[</span><span class="s2">&#34;*.data.*&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="n">Permission</span><span class="o">.</span><span class="n">READ</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">roles</span><span class="p">[</span><span class="s2">&#34;data_analyst&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="n">analyst_role</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="c1"># Application User</span>
</span></span><span class="line"><span class="cl">        <span class="n">app_user_role</span> <span class="o">=</span> <span class="n">Role</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">            <span class="n">name</span><span class="o">=</span><span class="s2">&#34;app_user&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="n">description</span><span class="o">=</span><span class="s2">&#34;Standard application user&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">app_user_role</span><span class="o">.</span><span class="n">permissions</span><span class="p">[</span><span class="s2">&#34;app_db.public.*&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="n">Permission</span><span class="o">.</span><span class="n">READ</span><span class="p">,</span> <span class="n">Permission</span><span class="o">.</span><span class="n">WRITE</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">roles</span><span class="p">[</span><span class="s2">&#34;app_user&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="n">app_user_role</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="c1"># Read-only User</span>
</span></span><span class="line"><span class="cl">        <span class="n">readonly_role</span> <span class="o">=</span> <span class="n">Role</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">            <span class="n">name</span><span class="o">=</span><span class="s2">&#34;readonly&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="n">description</span><span class="o">=</span><span class="s2">&#34;Read-only access to specific schemas&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">readonly_role</span><span class="o">.</span><span class="n">permissions</span><span class="p">[</span><span class="s2">&#34;*.public.*&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="n">Permission</span><span class="o">.</span><span class="n">READ</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">roles</span><span class="p">[</span><span class="s2">&#34;readonly&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="n">readonly_role</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">create_user</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">username</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">email</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">                   <span class="n">roles</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;&#34;&#34;Create a new user&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="n">user_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">users</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;User </span><span class="si">{</span><span class="n">user_id</span><span class="si">}</span><span class="s2"> already exists&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="k">return</span> <span class="kc">False</span>
</span></span><span class="line"><span class="cl">            
</span></span><span class="line"><span class="cl">            <span class="n">user</span> <span class="o">=</span> <span class="n">User</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">                <span class="n">user_id</span><span class="o">=</span><span class="n">user_id</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="n">username</span><span class="o">=</span><span class="n">username</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="n">email</span><span class="o">=</span><span class="n">email</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="n">roles</span><span class="o">=</span><span class="nb">set</span><span class="p">(</span><span class="n">roles</span> <span class="ow">or</span> <span class="p">[])</span>
</span></span><span class="line"><span class="cl">            <span class="p">)</span>
</span></span><span class="line"><span class="cl">            
</span></span><span class="line"><span class="cl">            <span class="c1"># Validate roles exist</span>
</span></span><span class="line"><span class="cl">            <span class="k">for</span> <span class="n">role_name</span> <span class="ow">in</span> <span class="n">user</span><span class="o">.</span><span class="n">roles</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="k">if</span> <span class="n">role_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">roles</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;Role </span><span class="si">{</span><span class="n">role_name</span><span class="si">}</span><span class="s2"> does not exist&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                    <span class="k">return</span> <span class="kc">False</span>
</span></span><span class="line"><span class="cl">            
</span></span><span class="line"><span class="cl">            <span class="bp">self</span><span class="o">.</span><span class="n">users</span><span class="p">[</span><span class="n">user_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">user</span>
</span></span><span class="line"><span class="cl">            <span class="bp">self</span><span class="o">.</span><span class="n">_audit_log</span><span class="p">(</span><span class="s2">&#34;USER_CREATED&#34;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&#34;user_id&#34;</span><span class="p">:</span> <span class="n">user_id</span><span class="p">,</span> <span class="s2">&#34;username&#34;</span><span class="p">:</span> <span class="n">username</span><span class="p">})</span>
</span></span><span class="line"><span class="cl">            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;Created user: </span><span class="si">{</span><span class="n">username</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">user_id</span><span class="si">}</span><span class="s2">)&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="kc">True</span>
</span></span><span class="line"><span class="cl">            
</span></span><span class="line"><span class="cl">        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;Failed to create user </span><span class="si">{</span><span class="n">user_id</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="kc">False</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">create_role</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">description</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">                   <span class="n">parent_roles</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;&#34;&#34;Create a new role&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">roles</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;Role </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> already exists&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="k">return</span> <span class="kc">False</span>
</span></span><span class="line"><span class="cl">            
</span></span><span class="line"><span class="cl">            <span class="n">role</span> <span class="o">=</span> <span class="n">Role</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">                <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="n">description</span><span class="o">=</span><span class="n">description</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="n">parent_roles</span><span class="o">=</span><span class="nb">set</span><span class="p">(</span><span class="n">parent_roles</span> <span class="ow">or</span> <span class="p">[])</span>
</span></span><span class="line"><span class="cl">            <span class="p">)</span>
</span></span><span class="line"><span class="cl">            
</span></span><span class="line"><span class="cl">            <span class="c1"># Validate parent roles exist</span>
</span></span><span class="line"><span class="cl">            <span class="k">for</span> <span class="n">parent_role</span> <span class="ow">in</span> <span class="n">role</span><span class="o">.</span><span class="n">parent_roles</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="k">if</span> <span class="n">parent_role</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">roles</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;Parent role </span><span class="si">{</span><span class="n">parent_role</span><span class="si">}</span><span class="s2"> does not exist&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                    <span class="k">return</span> <span class="kc">False</span>
</span></span><span class="line"><span class="cl">            
</span></span><span class="line"><span class="cl">            <span class="bp">self</span><span class="o">.</span><span class="n">roles</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">role</span>
</span></span><span class="line"><span class="cl">            <span class="bp">self</span><span class="o">.</span><span class="n">_audit_log</span><span class="p">(</span><span class="s2">&#34;ROLE_CREATED&#34;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&#34;role_name&#34;</span><span class="p">:</span> <span class="n">name</span><span class="p">,</span> <span class="s2">&#34;description&#34;</span><span class="p">:</span> <span class="n">description</span><span class="p">})</span>
</span></span><span class="line"><span class="cl">            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;Created role: </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="kc">True</span>
</span></span><span class="line"><span class="cl">            
</span></span><span class="line"><span class="cl">        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;Failed to create role </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="kc">False</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">grant_permission</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">role_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">resource_pattern</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">                        <span class="n">permissions</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Permission</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;&#34;&#34;Grant permissions to a role&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="n">role_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">roles</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;Role </span><span class="si">{</span><span class="n">role_name</span><span class="si">}</span><span class="s2"> does not exist&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="k">return</span> <span class="kc">False</span>
</span></span><span class="line"><span class="cl">            
</span></span><span class="line"><span class="cl">            <span class="n">role</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">roles</span><span class="p">[</span><span class="n">role_name</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="n">resource_pattern</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">role</span><span class="o">.</span><span class="n">permissions</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="n">role</span><span class="o">.</span><span class="n">permissions</span><span class="p">[</span><span class="n">resource_pattern</span><span class="p">]</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">            
</span></span><span class="line"><span class="cl">            <span class="n">role</span><span class="o">.</span><span class="n">permissions</span><span class="p">[</span><span class="n">resource_pattern</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">permissions</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            
</span></span><span class="line"><span class="cl">            <span class="bp">self</span><span class="o">.</span><span class="n">_audit_log</span><span class="p">(</span><span class="s2">&#34;PERMISSION_GRANTED&#34;</span><span class="p">,</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;role_name&#34;</span><span class="p">:</span> <span class="n">role_name</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;resource_pattern&#34;</span><span class="p">:</span> <span class="n">resource_pattern</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;permissions&#34;</span><span class="p">:</span> <span class="p">[</span><span class="n">p</span><span class="o">.</span><span class="n">value</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">permissions</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">            <span class="p">})</span>
</span></span><span class="line"><span class="cl">            
</span></span><span class="line"><span class="cl">            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;Granted permissions to role </span><span class="si">{</span><span class="n">role_name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">resource_pattern</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="kc">True</span>
</span></span><span class="line"><span class="cl">            
</span></span><span class="line"><span class="cl">        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;Failed to grant permission: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="kc">False</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">revoke_permission</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">role_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">resource_pattern</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">                         <span class="n">permissions</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Permission</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;&#34;&#34;Revoke permissions from a role&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="n">role_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">roles</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;Role </span><span class="si">{</span><span class="n">role_name</span><span class="si">}</span><span class="s2"> does not exist&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="k">return</span> <span class="kc">False</span>
</span></span><span class="line"><span class="cl">            
</span></span><span class="line"><span class="cl">            <span class="n">role</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">roles</span><span class="p">[</span><span class="n">role_name</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="n">resource_pattern</span> <span class="ow">in</span> <span class="n">role</span><span class="o">.</span><span class="n">permissions</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="n">role</span><span class="o">.</span><span class="n">permissions</span><span class="p">[</span><span class="n">resource_pattern</span><span class="p">]</span> <span class="o">-=</span> <span class="nb">set</span><span class="p">(</span><span class="n">permissions</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                
</span></span><span class="line"><span class="cl">                <span class="c1"># Remove empty permission sets</span>
</span></span><span class="line"><span class="cl">                <span class="k">if</span> <span class="ow">not</span> <span class="n">role</span><span class="o">.</span><span class="n">permissions</span><span class="p">[</span><span class="n">resource_pattern</span><span class="p">]:</span>
</span></span><span class="line"><span class="cl">                    <span class="k">del</span> <span class="n">role</span><span class="o">.</span><span class="n">permissions</span><span class="p">[</span><span class="n">resource_pattern</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">            
</span></span><span class="line"><span class="cl">            <span class="bp">self</span><span class="o">.</span><span class="n">_audit_log</span><span class="p">(</span><span class="s2">&#34;PERMISSION_REVOKED&#34;</span><span class="p">,</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;role_name&#34;</span><span class="p">:</span> <span class="n">role_name</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;resource_pattern&#34;</span><span class="p">:</span> <span class="n">resource_pattern</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;permissions&#34;</span><span class="p">:</span> <span class="p">[</span><span class="n">p</span><span class="o">.</span><span class="n">value</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">permissions</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">            <span class="p">})</span>
</span></span><span class="line"><span class="cl">            
</span></span><span class="line"><span class="cl">            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;Revoked permissions from role </span><span class="si">{</span><span class="n">role_name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">resource_pattern</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="kc">True</span>
</span></span><span class="line"><span class="cl">            
</span></span><span class="line"><span class="cl">        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;Failed to revoke permission: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="kc">False</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">assign_role</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">role_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;&#34;&#34;Assign a role to a user&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="n">user_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">users</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;User </span><span class="si">{</span><span class="n">user_id</span><span class="si">}</span><span class="s2"> does not exist&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="k">return</span> <span class="kc">False</span>
</span></span><span class="line"><span class="cl">            
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="n">role_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">roles</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;Role </span><span class="si">{</span><span class="n">role_name</span><span class="si">}</span><span class="s2"> does not exist&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="k">return</span> <span class="kc">False</span>
</span></span><span class="line"><span class="cl">            
</span></span><span class="line"><span class="cl">            <span class="bp">self</span><span class="o">.</span><span class="n">users</span><span class="p">[</span><span class="n">user_id</span><span class="p">]</span><span class="o">.</span><span class="n">roles</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">role_name</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            
</span></span><span class="line"><span class="cl">            <span class="bp">self</span><span class="o">.</span><span class="n">_audit_log</span><span class="p">(</span><span class="s2">&#34;ROLE_ASSIGNED&#34;</span><span class="p">,</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;user_id&#34;</span><span class="p">:</span> <span class="n">user_id</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;role_name&#34;</span><span class="p">:</span> <span class="n">role_name</span>
</span></span><span class="line"><span class="cl">            <span class="p">})</span>
</span></span><span class="line"><span class="cl">            
</span></span><span class="line"><span class="cl">            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;Assigned role </span><span class="si">{</span><span class="n">role_name</span><span class="si">}</span><span class="s2"> to user </span><span class="si">{</span><span class="n">user_id</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="kc">True</span>
</span></span><span class="line"><span class="cl">            
</span></span><span class="line"><span class="cl">        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;Failed to assign role: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="kc">False</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">remove_role</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">role_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;&#34;&#34;Remove a role from a user&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="n">user_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">users</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;User </span><span class="si">{</span><span class="n">user_id</span><span class="si">}</span><span class="s2"> does not exist&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="k">return</span> <span class="kc">False</span>
</span></span><span class="line"><span class="cl">            
</span></span><span class="line"><span class="cl">            <span class="bp">self</span><span class="o">.</span><span class="n">users</span><span class="p">[</span><span class="n">user_id</span><span class="p">]</span><span class="o">.</span><span class="n">roles</span><span class="o">.</span><span class="n">discard</span><span class="p">(</span><span class="n">role_name</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            
</span></span><span class="line"><span class="cl">            <span class="bp">self</span><span class="o">.</span><span class="n">_audit_log</span><span class="p">(</span><span class="s2">&#34;ROLE_REMOVED&#34;</span><span class="p">,</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;user_id&#34;</span><span class="p">:</span> <span class="n">user_id</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;role_name&#34;</span><span class="p">:</span> <span class="n">role_name</span>
</span></span><span class="line"><span class="cl">            <span class="p">})</span>
</span></span><span class="line"><span class="cl">            
</span></span><span class="line"><span class="cl">            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;Removed role </span><span class="si">{</span><span class="n">role_name</span><span class="si">}</span><span class="s2"> from user </span><span class="si">{</span><span class="n">user_id</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="kc">True</span>
</span></span><span class="line"><span class="cl">            
</span></span><span class="line"><span class="cl">        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;Failed to remove role: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="kc">False</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">_get_effective_permissions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Set</span><span class="p">[</span><span class="n">Permission</span><span class="p">]]:</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;&#34;&#34;Get all effective permissions for a user&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">user_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">users</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="p">{}</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="n">user</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">users</span><span class="p">[</span><span class="n">user_id</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">        <span class="n">effective_permissions</span> <span class="o">=</span> <span class="p">{}</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="c1"># Start with direct permissions</span>
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="n">resource_pattern</span><span class="p">,</span> <span class="n">perms</span> <span class="ow">in</span> <span class="n">user</span><span class="o">.</span><span class="n">direct_permissions</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">            <span class="n">effective_permissions</span><span class="p">[</span><span class="n">resource_pattern</span><span class="p">]</span> <span class="o">=</span> <span class="n">perms</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="c1"># Add permissions from roles (including inherited roles)</span>
</span></span><span class="line"><span class="cl">        <span class="n">processed_roles</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="n">roles_to_process</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">user</span><span class="o">.</span><span class="n">roles</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="k">while</span> <span class="n">roles_to_process</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">role_name</span> <span class="o">=</span> <span class="n">roles_to_process</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="n">role_name</span> <span class="ow">in</span> <span class="n">processed_roles</span> <span class="ow">or</span> <span class="n">role_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">roles</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="k">continue</span>
</span></span><span class="line"><span class="cl">            
</span></span><span class="line"><span class="cl">            <span class="n">processed_roles</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">role_name</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="n">role</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">roles</span><span class="p">[</span><span class="n">role_name</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">            
</span></span><span class="line"><span class="cl">            <span class="c1"># Add parent roles to processing queue</span>
</span></span><span class="line"><span class="cl">            <span class="n">roles_to_process</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">role</span><span class="o">.</span><span class="n">parent_roles</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            
</span></span><span class="line"><span class="cl">            <span class="c1"># Merge role permissions</span>
</span></span><span class="line"><span class="cl">            <span class="k">for</span> <span class="n">resource_pattern</span><span class="p">,</span> <span class="n">perms</span> <span class="ow">in</span> <span class="n">role</span><span class="o">.</span><span class="n">permissions</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">                <span class="k">if</span> <span class="n">resource_pattern</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">effective_permissions</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                    <span class="n">effective_permissions</span><span class="p">[</span><span class="n">resource_pattern</span><span class="p">]</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">                <span class="n">effective_permissions</span><span class="p">[</span><span class="n">resource_pattern</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">perms</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">effective_permissions</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">_match_resource_pattern</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pattern</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">resource</span><span class="p">:</span> <span class="n">Resource</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;&#34;&#34;Check if a resource matches a pattern&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="n">resource_str</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">resource</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="c1"># Handle wildcard patterns</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">pattern</span> <span class="o">==</span> <span class="s2">&#34;*&#34;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="kc">True</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="c1"># Split pattern and resource into parts</span>
</span></span><span class="line"><span class="cl">        <span class="n">pattern_parts</span> <span class="o">=</span> <span class="n">pattern</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&#34;.&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">resource_parts</span> <span class="o">=</span> <span class="n">resource_str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&#34;.&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="c1"># Ensure same number of parts or pattern has wildcards</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">pattern_parts</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">resource_parts</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="kc">False</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="c1"># Check each part</span>
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="n">pattern_part</span><span class="p">,</span> <span class="n">resource_part</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">pattern_parts</span><span class="p">,</span> <span class="n">resource_parts</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="n">pattern_part</span> <span class="o">!=</span> <span class="s2">&#34;*&#34;</span> <span class="ow">and</span> <span class="n">pattern_part</span> <span class="o">!=</span> <span class="n">resource_part</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="k">return</span> <span class="kc">False</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="kc">True</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">check_access</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">:</span> <span class="n">AccessRequest</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">AccessResult</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;&#34;&#34;Check if a user has access to a resource&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">user_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">users</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="k">return</span> <span class="n">AccessResult</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">                    <span class="n">granted</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                    <span class="n">reason</span><span class="o">=</span><span class="s2">&#34;User not found&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                    <span class="n">effective_permissions</span><span class="o">=</span><span class="nb">set</span><span class="p">(),</span>
</span></span><span class="line"><span class="cl">                    <span class="n">applied_policies</span><span class="o">=</span><span class="p">[]</span>
</span></span><span class="line"><span class="cl">                <span class="p">)</span>
</span></span><span class="line"><span class="cl">            
</span></span><span class="line"><span class="cl">            <span class="n">user</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">users</span><span class="p">[</span><span class="n">request</span><span class="o">.</span><span class="n">user_id</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">            
</span></span><span class="line"><span class="cl">            <span class="c1"># Check if user is active</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="ow">not</span> <span class="n">user</span><span class="o">.</span><span class="n">is_active</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="k">return</span> <span class="n">AccessResult</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">                    <span class="n">granted</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                    <span class="n">reason</span><span class="o">=</span><span class="s2">&#34;User account is inactive&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                    <span class="n">effective_permissions</span><span class="o">=</span><span class="nb">set</span><span class="p">(),</span>
</span></span><span class="line"><span class="cl">                    <span class="n">applied_policies</span><span class="o">=</span><span class="p">[]</span>
</span></span><span class="line"><span class="cl">                <span class="p">)</span>
</span></span><span class="line"><span class="cl">            
</span></span><span class="line"><span class="cl">            <span class="c1"># Get effective permissions</span>
</span></span><span class="line"><span class="cl">            <span class="n">effective_permissions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_effective_permissions</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">user_id</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            
</span></span><span class="line"><span class="cl">            <span class="c1"># Find matching permissions</span>
</span></span><span class="line"><span class="cl">            <span class="n">granted_permissions</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">            <span class="n">applied_policies</span> <span class="o">=</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl">            
</span></span><span class="line"><span class="cl">            <span class="k">for</span> <span class="n">pattern</span><span class="p">,</span> <span class="n">permissions</span> <span class="ow">in</span> <span class="n">effective_permissions</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_match_resource_pattern</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="n">request</span><span class="o">.</span><span class="n">resource</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">                    <span class="n">granted_permissions</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">permissions</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                    <span class="n">applied_policies</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;Pattern: </span><span class="si">{</span><span class="n">pattern</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            
</span></span><span class="line"><span class="cl">            <span class="c1"># Check if requested permission is granted</span>
</span></span><span class="line"><span class="cl">            <span class="n">access_granted</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">permission</span> <span class="ow">in</span> <span class="n">granted_permissions</span>
</span></span><span class="line"><span class="cl">            
</span></span><span class="line"><span class="cl">            <span class="c1"># Apply additional policies</span>
</span></span><span class="line"><span class="cl">            <span class="n">policy_result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_apply_access_policies</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">granted_permissions</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="ow">not</span> <span class="n">policy_result</span><span class="p">[</span><span class="s1">&#39;allowed&#39;</span><span class="p">]:</span>
</span></span><span class="line"><span class="cl">                <span class="n">access_granted</span> <span class="o">=</span> <span class="kc">False</span>
</span></span><span class="line"><span class="cl">                <span class="n">applied_policies</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">policy_result</span><span class="p">[</span><span class="s1">&#39;policies&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">            
</span></span><span class="line"><span class="cl">            <span class="c1"># Log access attempt</span>
</span></span><span class="line"><span class="cl">            <span class="bp">self</span><span class="o">.</span><span class="n">_audit_log</span><span class="p">(</span><span class="s2">&#34;ACCESS_CHECK&#34;</span><span class="p">,</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;user_id&#34;</span><span class="p">:</span> <span class="n">request</span><span class="o">.</span><span class="n">user_id</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;resource&#34;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">resource</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;permission&#34;</span><span class="p">:</span> <span class="n">request</span><span class="o">.</span><span class="n">permission</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;granted&#34;</span><span class="p">:</span> <span class="n">access_granted</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;reason&#34;</span><span class="p">:</span> <span class="s2">&#34;Permission granted&#34;</span> <span class="k">if</span> <span class="n">access_granted</span> <span class="k">else</span> <span class="s2">&#34;Permission denied&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="p">})</span>
</span></span><span class="line"><span class="cl">            
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="n">AccessResult</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">                <span class="n">granted</span><span class="o">=</span><span class="n">access_granted</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="n">reason</span><span class="o">=</span><span class="s2">&#34;Permission granted&#34;</span> <span class="k">if</span> <span class="n">access_granted</span> <span class="k">else</span> <span class="s2">&#34;Permission denied&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="n">effective_permissions</span><span class="o">=</span><span class="n">granted_permissions</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="n">applied_policies</span><span class="o">=</span><span class="n">applied_policies</span>
</span></span><span class="line"><span class="cl">            <span class="p">)</span>
</span></span><span class="line"><span class="cl">            
</span></span><span class="line"><span class="cl">        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;Access check failed: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="n">AccessResult</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">                <span class="n">granted</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="n">reason</span><span class="o">=</span><span class="sa">f</span><span class="s2">&#34;Internal error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="n">effective_permissions</span><span class="o">=</span><span class="nb">set</span><span class="p">(),</span>
</span></span><span class="line"><span class="cl">                <span class="n">applied_policies</span><span class="o">=</span><span class="p">[]</span>
</span></span><span class="line"><span class="cl">            <span class="p">)</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">_apply_access_policies</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">:</span> <span class="n">AccessRequest</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">                              <span class="n">granted_permissions</span><span class="p">:</span> <span class="n">Set</span><span class="p">[</span><span class="n">Permission</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;&#34;&#34;Apply additional access policies&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="n">policies_applied</span> <span class="o">=</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl">        <span class="n">allowed</span> <span class="o">=</span> <span class="kc">True</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="c1"># Time-based access policy</span>
</span></span><span class="line"><span class="cl">        <span class="n">current_hour</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">hour</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">current_hour</span> <span class="o">&lt;</span> <span class="mi">6</span> <span class="ow">or</span> <span class="n">current_hour</span> <span class="o">&gt;</span> <span class="mi">22</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="n">Permission</span><span class="o">.</span><span class="n">ADMIN</span> <span class="ow">in</span> <span class="n">granted_permissions</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="c1"># Admin operations restricted during off-hours</span>
</span></span><span class="line"><span class="cl">                <span class="n">allowed</span> <span class="o">=</span> <span class="kc">False</span>
</span></span><span class="line"><span class="cl">                <span class="n">policies_applied</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&#34;Off-hours admin restriction&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="c1"># Sensitive data access policy</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="s2">&#34;sensitive&#34;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">resource</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="n">Permission</span><span class="o">.</span><span class="n">READ</span> <span class="ow">in</span> <span class="n">granted_permissions</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="c1"># Additional logging for sensitive data access</span>
</span></span><span class="line"><span class="cl">                <span class="n">policies_applied</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&#34;Sensitive data access logged&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="c1"># High-privilege operation policy</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">permission</span> <span class="ow">in</span> <span class="p">[</span><span class="n">Permission</span><span class="o">.</span><span class="n">DELETE</span><span class="p">,</span> <span class="n">Permission</span><span class="o">.</span><span class="n">ADMIN</span><span class="p">]:</span>
</span></span><span class="line"><span class="cl">            <span class="c1"># Require additional verification for high-privilege operations</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="ow">not</span> <span class="n">request</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;verified&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">                <span class="n">allowed</span> <span class="o">=</span> <span class="kc">False</span>
</span></span><span class="line"><span class="cl">                <span class="n">policies_applied</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&#34;High-privilege operation requires verification&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;allowed&#39;</span><span class="p">:</span> <span class="n">allowed</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;policies&#39;</span><span class="p">:</span> <span class="n">policies_applied</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">_audit_log</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">action</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">details</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]):</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;&#34;&#34;Log audit event&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="n">audit_entry</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;timestamp&#39;</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">isoformat</span><span class="p">(),</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;action&#39;</span><span class="p">:</span> <span class="n">action</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;details&#39;</span><span class="p">:</span> <span class="n">details</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">audit_log</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">audit_entry</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">get_user_permissions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;&#34;&#34;Get comprehensive permission report for a user&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">user_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">users</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="p">{}</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="n">user</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">users</span><span class="p">[</span><span class="n">user_id</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">        <span class="n">effective_permissions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_effective_permissions</span><span class="p">(</span><span class="n">user_id</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;user_id&#39;</span><span class="p">:</span> <span class="n">user_id</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;username&#39;</span><span class="p">:</span> <span class="n">user</span><span class="o">.</span><span class="n">username</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;roles&#39;</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="n">user</span><span class="o">.</span><span class="n">roles</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;effective_permissions&#39;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="n">pattern</span><span class="p">:</span> <span class="p">[</span><span class="n">p</span><span class="o">.</span><span class="n">value</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">perms</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">                <span class="k">for</span> <span class="n">pattern</span><span class="p">,</span> <span class="n">perms</span> <span class="ow">in</span> <span class="n">effective_permissions</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">            <span class="p">},</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;direct_permissions&#39;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="n">pattern</span><span class="p">:</span> <span class="p">[</span><span class="n">p</span><span class="o">.</span><span class="n">value</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">perms</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">                <span class="k">for</span> <span class="n">pattern</span><span class="p">,</span> <span class="n">perms</span> <span class="ow">in</span> <span class="n">user</span><span class="o">.</span><span class="n">direct_permissions</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">export_configuration</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;&#34;&#34;Export RBAC configuration&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;users&#39;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="n">user_id</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                    <span class="s1">&#39;username&#39;</span><span class="p">:</span> <span class="n">user</span><span class="o">.</span><span class="n">username</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                    <span class="s1">&#39;email&#39;</span><span class="p">:</span> <span class="n">user</span><span class="o">.</span><span class="n">email</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                    <span class="s1">&#39;roles&#39;</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="n">user</span><span class="o">.</span><span class="n">roles</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">                    <span class="s1">&#39;is_active&#39;</span><span class="p">:</span> <span class="n">user</span><span class="o">.</span><span class="n">is_active</span>
</span></span><span class="line"><span class="cl">                <span class="p">}</span>
</span></span><span class="line"><span class="cl">                <span class="k">for</span> <span class="n">user_id</span><span class="p">,</span> <span class="n">user</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">users</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">            <span class="p">},</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;roles&#39;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="n">role_name</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                    <span class="s1">&#39;description&#39;</span><span class="p">:</span> <span class="n">role</span><span class="o">.</span><span class="n">description</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                    <span class="s1">&#39;permissions&#39;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                        <span class="n">pattern</span><span class="p">:</span> <span class="p">[</span><span class="n">p</span><span class="o">.</span><span class="n">value</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">perms</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">                        <span class="k">for</span> <span class="n">pattern</span><span class="p">,</span> <span class="n">perms</span> <span class="ow">in</span> <span class="n">role</span><span class="o">.</span><span class="n">permissions</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">                    <span class="p">},</span>
</span></span><span class="line"><span class="cl">                    <span class="s1">&#39;parent_roles&#39;</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="n">role</span><span class="o">.</span><span class="n">parent_roles</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">                    <span class="s1">&#39;is_active&#39;</span><span class="p">:</span> <span class="n">role</span><span class="o">.</span><span class="n">is_active</span>
</span></span><span class="line"><span class="cl">                <span class="p">}</span>
</span></span><span class="line"><span class="cl">                <span class="k">for</span> <span class="n">role_name</span><span class="p">,</span> <span class="n">role</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">roles</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Example usage</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="n">rbac</span> <span class="o">=</span> <span class="n">RBACManager</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1"># Create users</span>
</span></span><span class="line"><span class="cl">    <span class="n">rbac</span><span class="o">.</span><span class="n">create_user</span><span class="p">(</span><span class="s2">&#34;alice&#34;</span><span class="p">,</span> <span class="s2">&#34;Alice Smith&#34;</span><span class="p">,</span> <span class="s2">&#34;alice@company.com&#34;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&#34;dba&#34;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">    <span class="n">rbac</span><span class="o">.</span><span class="n">create_user</span><span class="p">(</span><span class="s2">&#34;bob&#34;</span><span class="p">,</span> <span class="s2">&#34;Bob Johnson&#34;</span><span class="p">,</span> <span class="s2">&#34;bob@company.com&#34;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&#34;data_analyst&#34;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">    <span class="n">rbac</span><span class="o">.</span><span class="n">create_user</span><span class="p">(</span><span class="s2">&#34;charlie&#34;</span><span class="p">,</span> <span class="s2">&#34;Charlie Brown&#34;</span><span class="p">,</span> <span class="s2">&#34;charlie@company.com&#34;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&#34;app_user&#34;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1"># Create custom role</span>
</span></span><span class="line"><span class="cl">    <span class="n">rbac</span><span class="o">.</span><span class="n">create_role</span><span class="p">(</span><span class="s2">&#34;report_viewer&#34;</span><span class="p">,</span> <span class="s2">&#34;Can view reports&#34;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&#34;readonly&#34;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">    <span class="n">rbac</span><span class="o">.</span><span class="n">grant_permission</span><span class="p">(</span><span class="s2">&#34;report_viewer&#34;</span><span class="p">,</span> <span class="s2">&#34;reports.*&#34;</span><span class="p">,</span> <span class="p">[</span><span class="n">Permission</span><span class="o">.</span><span class="n">READ</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1"># Test access</span>
</span></span><span class="line"><span class="cl">    <span class="n">resource</span> <span class="o">=</span> <span class="n">Resource</span><span class="p">(</span><span class="n">ResourceType</span><span class="o">.</span><span class="n">TABLE</span><span class="p">,</span> <span class="s2">&#34;users&#34;</span><span class="p">,</span> <span class="s2">&#34;public&#34;</span><span class="p">,</span> <span class="s2">&#34;app_db&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">request</span> <span class="o">=</span> <span class="n">AccessRequest</span><span class="p">(</span><span class="s2">&#34;alice&#34;</span><span class="p">,</span> <span class="n">resource</span><span class="p">,</span> <span class="n">Permission</span><span class="o">.</span><span class="n">READ</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="n">result</span> <span class="o">=</span> <span class="n">rbac</span><span class="o">.</span><span class="n">check_access</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;Access Result for Alice:&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;  Granted: </span><span class="si">{</span><span class="n">result</span><span class="o">.</span><span class="n">granted</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;  Reason: </span><span class="si">{</span><span class="n">result</span><span class="o">.</span><span class="n">reason</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;  Effective Permissions: </span><span class="si">{</span><span class="p">[</span><span class="n">p</span><span class="o">.</span><span class="n">value</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">result</span><span class="o">.</span><span class="n">effective_permissions</span><span class="p">]</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1"># Get user permissions report</span>
</span></span><span class="line"><span class="cl">    <span class="n">permissions_report</span> <span class="o">=</span> <span class="n">rbac</span><span class="o">.</span><span class="n">get_user_permissions</span><span class="p">(</span><span class="s2">&#34;alice&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;</span><span class="se">\n</span><span class="s2">Alice&#39;s Permissions:&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">permissions_report</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&#34;__main__&#34;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">main</span><span class="p">()</span>
</span></span></code></pre></div><h2 id="data-encryption">Data Encryption</h2>
<h3 id="1-comprehensive-encryption-manager">1. Comprehensive Encryption Manager</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="ch">#!/usr/bin/env python3</span>
</span></span><span class="line"><span class="cl"><span class="c1"># src/security/encryption_manager.py</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">os</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">base64</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">json</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">logging</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Tuple</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">dataclasses</span> <span class="kn">import</span> <span class="n">dataclass</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">enum</span> <span class="kn">import</span> <span class="n">Enum</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">secrets</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">cryptography.fernet</span> <span class="kn">import</span> <span class="n">Fernet</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">cryptography.hazmat.primitives</span> <span class="kn">import</span> <span class="n">hashes</span><span class="p">,</span> <span class="n">serialization</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">cryptography.hazmat.primitives.asymmetric</span> <span class="kn">import</span> <span class="n">rsa</span><span class="p">,</span> <span class="n">padding</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">cryptography.hazmat.primitives.ciphers</span> <span class="kn">import</span> <span class="n">Cipher</span><span class="p">,</span> <span class="n">algorithms</span><span class="p">,</span> <span class="n">modes</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">cryptography.hazmat.primitives.kdf.pbkdf2</span> <span class="kn">import</span> <span class="n">PBKDF2HMAC</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">cryptography.hazmat.primitives.kdf.scrypt</span> <span class="kn">import</span> <span class="n">Scrypt</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">hashlib</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">hmac</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">EncryptionAlgorithm</span><span class="p">(</span><span class="n">Enum</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">AES_256_GCM</span> <span class="o">=</span> <span class="s2">&#34;aes_256_gcm&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">AES_256_CBC</span> <span class="o">=</span> <span class="s2">&#34;aes_256_cbc&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">CHACHA20_POLY1305</span> <span class="o">=</span> <span class="s2">&#34;chacha20_poly1305&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">RSA_OAEP</span> <span class="o">=</span> <span class="s2">&#34;rsa_oaep&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">FERNET</span> <span class="o">=</span> <span class="s2">&#34;fernet&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">KeyDerivationFunction</span><span class="p">(</span><span class="n">Enum</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">PBKDF2</span> <span class="o">=</span> <span class="s2">&#34;pbkdf2&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">SCRYPT</span> <span class="o">=</span> <span class="s2">&#34;scrypt&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">ARGON2</span> <span class="o">=</span> <span class="s2">&#34;argon2&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nd">@dataclass</span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">EncryptionConfig</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">algorithm</span><span class="p">:</span> <span class="n">EncryptionAlgorithm</span>
</span></span><span class="line"><span class="cl">    <span class="n">key_size</span><span class="p">:</span> <span class="nb">int</span>
</span></span><span class="line"><span class="cl">    <span class="n">kdf</span><span class="p">:</span> <span class="n">KeyDerivationFunction</span>
</span></span><span class="line"><span class="cl">    <span class="n">iterations</span><span class="p">:</span> <span class="nb">int</span>
</span></span><span class="line"><span class="cl">    <span class="n">salt_size</span><span class="p">:</span> <span class="nb">int</span>
</span></span><span class="line"><span class="cl">    <span class="n">iv_size</span><span class="p">:</span> <span class="nb">int</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nd">@dataclass</span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">EncryptedData</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">ciphertext</span><span class="p">:</span> <span class="nb">bytes</span>
</span></span><span class="line"><span class="cl">    <span class="n">iv</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bytes</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="n">salt</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bytes</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="n">tag</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bytes</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="n">algorithm</span><span class="p">:</span> <span class="n">EncryptionAlgorithm</span>
</span></span><span class="line"><span class="cl">    <span class="n">metadata</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">EncryptionManager</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]):</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">config</span> <span class="o">=</span> <span class="n">config</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_setup_logging</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">master_key</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_derive_master_key</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">key_cache</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="c1"># Default encryption configurations</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">encryption_configs</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;default&#39;</span><span class="p">:</span> <span class="n">EncryptionConfig</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">                <span class="n">algorithm</span><span class="o">=</span><span class="n">EncryptionAlgorithm</span><span class="o">.</span><span class="n">AES_256_GCM</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="n">key_size</span><span class="o">=</span><span class="mi">32</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="n">kdf</span><span class="o">=</span><span class="n">KeyDerivationFunction</span><span class="o">.</span><span class="n">PBKDF2</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="n">iterations</span><span class="o">=</span><span class="mi">100000</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="n">salt_size</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="n">iv_size</span><span class="o">=</span><span class="mi">12</span>
</span></span><span class="line"><span class="cl">            <span class="p">),</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;high_security&#39;</span><span class="p">:</span> <span class="n">EncryptionConfig</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">                <span class="n">algorithm</span><span class="o">=</span><span class="n">EncryptionAlgorithm</span><span class="o">.</span><span class="n">AES_256_GCM</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="n">key_size</span><span class="o">=</span><span class="mi">32</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="n">kdf</span><span class="o">=</span><span class="n">KeyDerivationFunction</span><span class="o">.</span><span class="n">SCRYPT</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="n">iterations</span><span class="o">=</span><span class="mi">32768</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="n">salt_size</span><span class="o">=</span><span class="mi">32</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="n">iv_size</span><span class="o">=</span><span class="mi">12</span>
</span></span><span class="line"><span class="cl">            <span class="p">),</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;performance&#39;</span><span class="p">:</span> <span class="n">EncryptionConfig</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">                <span class="n">algorithm</span><span class="o">=</span><span class="n">EncryptionAlgorithm</span><span class="o">.</span><span class="n">CHACHA20_POLY1305</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="n">key_size</span><span class="o">=</span><span class="mi">32</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="n">kdf</span><span class="o">=</span><span class="n">KeyDerivationFunction</span><span class="o">.</span><span class="n">PBKDF2</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="n">iterations</span><span class="o">=</span><span class="mi">50000</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="n">salt_size</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="n">iv_size</span><span class="o">=</span><span class="mi">12</span>
</span></span><span class="line"><span class="cl">            <span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">_setup_logging</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">logging</span><span class="o">.</span><span class="n">Logger</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s1">&#39;EncryptionManager&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">logger</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">handler</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">StreamHandler</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="n">formatter</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">Formatter</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%(asctime)s</span><span class="s1"> - </span><span class="si">%(levelname)s</span><span class="s1"> - </span><span class="si">%(message)s</span><span class="s1">&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">handler</span><span class="o">.</span><span class="n">setFormatter</span><span class="p">(</span><span class="n">formatter</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">logger</span><span class="o">.</span><span class="n">addHandler</span><span class="p">(</span><span class="n">handler</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">logger</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">_derive_master_key</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bytes</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;&#34;&#34;Derive master key from configuration&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="n">master_password</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;master_password&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="n">salt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;master_salt&#39;</span><span class="p">,</span> <span class="s1">&#39;default_salt&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="ow">not</span> <span class="n">master_password</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="c1"># Generate random master key if no password provided</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="n">secrets</span><span class="o">.</span><span class="n">token_bytes</span><span class="p">(</span><span class="mi">32</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="n">kdf</span> <span class="o">=</span> <span class="n">PBKDF2HMAC</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">            <span class="n">algorithm</span><span class="o">=</span><span class="n">hashes</span><span class="o">.</span><span class="n">SHA256</span><span class="p">(),</span>
</span></span><span class="line"><span class="cl">            <span class="n">length</span><span class="o">=</span><span class="mi">32</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="n">salt</span><span class="o">=</span><span class="n">salt</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="n">iterations</span><span class="o">=</span><span class="mi">100000</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">kdf</span><span class="o">.</span><span class="n">derive</span><span class="p">(</span><span class="n">master_password</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">derive_key</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">password</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">salt</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">,</span> <span class="n">config</span><span class="p">:</span> <span class="n">EncryptionConfig</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bytes</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;&#34;&#34;Derive encryption key from password&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="n">password_bytes</span> <span class="o">=</span> <span class="n">password</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">config</span><span class="o">.</span><span class="n">kdf</span> <span class="o">==</span> <span class="n">KeyDerivationFunction</span><span class="o">.</span><span class="n">PBKDF2</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">kdf</span> <span class="o">=</span> <span class="n">PBKDF2HMAC</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">                <span class="n">algorithm</span><span class="o">=</span><span class="n">hashes</span><span class="o">.</span><span class="n">SHA256</span><span class="p">(),</span>
</span></span><span class="line"><span class="cl">                <span class="n">length</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">key_size</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="n">salt</span><span class="o">=</span><span class="n">salt</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="n">iterations</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">iterations</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="n">kdf</span><span class="o">.</span><span class="n">derive</span><span class="p">(</span><span class="n">password_bytes</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="k">elif</span> <span class="n">config</span><span class="o">.</span><span class="n">kdf</span> <span class="o">==</span> <span class="n">KeyDerivationFunction</span><span class="o">.</span><span class="n">SCRYPT</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">kdf</span> <span class="o">=</span> <span class="n">Scrypt</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">                <span class="n">algorithm</span><span class="o">=</span><span class="n">hashes</span><span class="o">.</span><span class="n">SHA256</span><span class="p">(),</span>
</span></span><span class="line"><span class="cl">                <span class="n">length</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">key_size</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="n">salt</span><span class="o">=</span><span class="n">salt</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="n">n</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">iterations</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="n">r</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="n">p</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="n">kdf</span><span class="o">.</span><span class="n">derive</span><span class="p">(</span><span class="n">password_bytes</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;Unsupported KDF: </span><span class="si">{</span><span class="n">config</span><span class="o">.</span><span class="n">kdf</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">generate_key</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">config_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;default&#39;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bytes</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;&#34;&#34;Generate and store a new encryption key&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="n">config</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">encryption_configs</span><span class="p">[</span><span class="n">config_name</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">        <span class="n">key</span> <span class="o">=</span> <span class="n">secrets</span><span class="o">.</span><span class="n">token_bytes</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">key_size</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="c1"># Encrypt key with master key for storage</span>
</span></span><span class="line"><span class="cl">        <span class="n">encrypted_key</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_encrypt_key</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="c1"># Store encrypted key (in production, this would be in a secure key store)</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">_store_key</span><span class="p">(</span><span class="n">key_id</span><span class="p">,</span> <span class="n">encrypted_key</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="c1"># Cache the key</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">key_cache</span><span class="p">[</span><span class="n">key_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">key</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;Generated new key: </span><span class="si">{</span><span class="n">key_id</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">key</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">get_key</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bytes</span><span class="p">]:</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;&#34;&#34;Retrieve encryption key&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">key_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">key_cache</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">key_cache</span><span class="p">[</span><span class="n">key_id</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="c1"># Load from storage</span>
</span></span><span class="line"><span class="cl">        <span class="n">encrypted_key</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_key</span><span class="p">(</span><span class="n">key_id</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">encrypted_key</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">key</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_decrypt_key</span><span class="p">(</span><span class="n">encrypted_key</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="bp">self</span><span class="o">.</span><span class="n">key_cache</span><span class="p">[</span><span class="n">key_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">key</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="n">key</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="kc">None</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">_encrypt_key</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bytes</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;&#34;&#34;Encrypt key with master key&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="n">fernet</span> <span class="o">=</span> <span class="n">Fernet</span><span class="p">(</span><span class="n">base64</span><span class="o">.</span><span class="n">urlsafe_b64encode</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">master_key</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">fernet</span><span class="o">.</span><span class="n">encrypt</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">_decrypt_key</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">encrypted_key</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bytes</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;&#34;&#34;Decrypt key with master key&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="n">fernet</span> <span class="o">=</span> <span class="n">Fernet</span><span class="p">(</span><span class="n">base64</span><span class="o">.</span><span class="n">urlsafe_b64encode</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">master_key</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">fernet</span><span class="o">.</span><span class="n">decrypt</span><span class="p">(</span><span class="n">encrypted_key</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">_store_key</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">encrypted_key</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;&#34;&#34;Store encrypted key (placeholder implementation)&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># In production, this would store in a secure key management system</span>
</span></span><span class="line"><span class="cl">        <span class="n">key_file</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&#34;/tmp/keys/</span><span class="si">{</span><span class="n">key_id</span><span class="si">}</span><span class="s2">.key&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">key_file</span><span class="p">),</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">key_file</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">encrypted_key</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">_load_key</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bytes</span><span class="p">]:</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;&#34;&#34;Load encrypted key (placeholder implementation)&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="n">key_file</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&#34;/tmp/keys/</span><span class="si">{</span><span class="n">key_id</span><span class="si">}</span><span class="s2">.key&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">key_file</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="k">return</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="k">except</span> <span class="ne">FileNotFoundError</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="kc">None</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">encrypt_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">,</span> <span class="n">key_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">                    <span class="n">config_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;default&#39;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">EncryptedData</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;&#34;&#34;Encrypt data using specified configuration&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="n">config</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">encryption_configs</span><span class="p">[</span><span class="n">config_name</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">        <span class="n">key</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_key</span><span class="p">(</span><span class="n">key_id</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="ow">not</span> <span class="n">key</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;Key not found: </span><span class="si">{</span><span class="n">key_id</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">config</span><span class="o">.</span><span class="n">algorithm</span> <span class="o">==</span> <span class="n">EncryptionAlgorithm</span><span class="o">.</span><span class="n">AES_256_GCM</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_encrypt_aes_gcm</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">config</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">elif</span> <span class="n">config</span><span class="o">.</span><span class="n">algorithm</span> <span class="o">==</span> <span class="n">EncryptionAlgorithm</span><span class="o">.</span><span class="n">AES_256_CBC</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_encrypt_aes_cbc</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">config</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">elif</span> <span class="n">config</span><span class="o">.</span><span class="n">algorithm</span> <span class="o">==</span> <span class="n">EncryptionAlgorithm</span><span class="o">.</span><span class="n">CHACHA20_POLY1305</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_encrypt_chacha20</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">config</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">elif</span> <span class="n">config</span><span class="o">.</span><span class="n">algorithm</span> <span class="o">==</span> <span class="n">EncryptionAlgorithm</span><span class="o">.</span><span class="n">FERNET</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_encrypt_fernet</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">config</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;Unsupported algorithm: </span><span class="si">{</span><span class="n">config</span><span class="o">.</span><span class="n">algorithm</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">decrypt_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">encrypted_data</span><span class="p">:</span> <span class="n">EncryptedData</span><span class="p">,</span> <span class="n">key_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bytes</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;&#34;&#34;Decrypt data&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="n">key</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_key</span><span class="p">(</span><span class="n">key_id</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="ow">not</span> <span class="n">key</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;Key not found: </span><span class="si">{</span><span class="n">key_id</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">encrypted_data</span><span class="o">.</span><span class="n">algorithm</span> <span class="o">==</span> <span class="n">EncryptionAlgorithm</span><span class="o">.</span><span class="n">AES_256_GCM</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_decrypt_aes_gcm</span><span class="p">(</span><span class="n">encrypted_data</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">elif</span> <span class="n">encrypted_data</span><span class="o">.</span><span class="n">algorithm</span> <span class="o">==</span> <span class="n">EncryptionAlgorithm</span><span class="o">.</span><span class="n">AES_256_CBC</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_decrypt_aes_cbc</span><span class="p">(</span><span class="n">encrypted_data</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">elif</span> <span class="n">encrypted_data</span><span class="o">.</span><span class="n">algorithm</span> <span class="o">==</span> <span class="n">EncryptionAlgorithm</span><span class="o">.</span><span class="n">CHACHA20_POLY1305</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_decrypt_chacha20</span><span class="p">(</span><span class="n">encrypted_data</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">elif</span> <span class="n">encrypted_data</span><span class="o">.</span><span class="n">algorithm</span> <span class="o">==</span> <span class="n">EncryptionAlgorithm</span><span class="o">.</span><span class="n">FERNET</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_decrypt_fernet</span><span class="p">(</span><span class="n">encrypted_data</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;Unsupported algorithm: </span><span class="si">{</span><span class="n">encrypted_data</span><span class="o">.</span><span class="n">algorithm</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">_encrypt_aes_gcm</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">                        <span class="n">config</span><span class="p">:</span> <span class="n">EncryptionConfig</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">EncryptedData</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;&#34;&#34;Encrypt using AES-256-GCM&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="n">iv</span> <span class="o">=</span> <span class="n">secrets</span><span class="o">.</span><span class="n">token_bytes</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">iv_size</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="n">cipher</span> <span class="o">=</span> <span class="n">Cipher</span><span class="p">(</span><span class="n">algorithms</span><span class="o">.</span><span class="n">AES</span><span class="p">(</span><span class="n">key</span><span class="p">),</span> <span class="n">modes</span><span class="o">.</span><span class="n">GCM</span><span class="p">(</span><span class="n">iv</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">        <span class="n">encryptor</span> <span class="o">=</span> <span class="n">cipher</span><span class="o">.</span><span class="n">encryptor</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="n">ciphertext</span> <span class="o">=</span> <span class="n">encryptor</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">+</span> <span class="n">encryptor</span><span class="o">.</span><span class="n">finalize</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">EncryptedData</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">            <span class="n">ciphertext</span><span class="o">=</span><span class="n">ciphertext</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="n">iv</span><span class="o">=</span><span class="n">iv</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="n">salt</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="n">tag</span><span class="o">=</span><span class="n">encryptor</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="n">algorithm</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">algorithm</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="n">metadata</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;key_size&#39;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">key</span><span class="p">)}</span>
</span></span><span class="line"><span class="cl">        <span class="p">)</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">_decrypt_aes_gcm</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">encrypted_data</span><span class="p">:</span> <span class="n">EncryptedData</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bytes</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;&#34;&#34;Decrypt using AES-256-GCM&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="n">cipher</span> <span class="o">=</span> <span class="n">Cipher</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">            <span class="n">algorithms</span><span class="o">.</span><span class="n">AES</span><span class="p">(</span><span class="n">key</span><span class="p">),</span> 
</span></span><span class="line"><span class="cl">            <span class="n">modes</span><span class="o">.</span><span class="n">GCM</span><span class="p">(</span><span class="n">encrypted_data</span><span class="o">.</span><span class="n">iv</span><span class="p">,</span> <span class="n">encrypted_data</span><span class="o">.</span><span class="n">tag</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">decryptor</span> <span class="o">=</span> <span class="n">cipher</span><span class="o">.</span><span class="n">decryptor</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">decryptor</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">encrypted_data</span><span class="o">.</span><span class="n">ciphertext</span><span class="p">)</span> <span class="o">+</span> <span class="n">decryptor</span><span class="o">.</span><span class="n">finalize</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">_encrypt_aes_cbc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">                        <span class="n">config</span><span class="p">:</span> <span class="n">EncryptionConfig</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">EncryptedData</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;&#34;&#34;Encrypt using AES-256-CBC&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="n">iv</span> <span class="o">=</span> <span class="n">secrets</span><span class="o">.</span><span class="n">token_bytes</span><span class="p">(</span><span class="mi">16</span><span class="p">)</span>  <span class="c1"># AES block size</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="c1"># Pad data to block size</span>
</span></span><span class="line"><span class="cl">        <span class="n">padding_length</span> <span class="o">=</span> <span class="mi">16</span> <span class="o">-</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">%</span> <span class="mi">16</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">padded_data</span> <span class="o">=</span> <span class="n">data</span> <span class="o">+</span> <span class="nb">bytes</span><span class="p">([</span><span class="n">padding_length</span><span class="p">]</span> <span class="o">*</span> <span class="n">padding_length</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="n">cipher</span> <span class="o">=</span> <span class="n">Cipher</span><span class="p">(</span><span class="n">algorithms</span><span class="o">.</span><span class="n">AES</span><span class="p">(</span><span class="n">key</span><span class="p">),</span> <span class="n">modes</span><span class="o">.</span><span class="n">CBC</span><span class="p">(</span><span class="n">iv</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">        <span class="n">encryptor</span> <span class="o">=</span> <span class="n">cipher</span><span class="o">.</span><span class="n">encryptor</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="n">ciphertext</span> <span class="o">=</span> <span class="n">encryptor</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">padded_data</span><span class="p">)</span> <span class="o">+</span> <span class="n">encryptor</span><span class="o">.</span><span class="n">finalize</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">EncryptedData</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">            <span class="n">ciphertext</span><span class="o">=</span><span class="n">ciphertext</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="n">iv</span><span class="o">=</span><span class="n">iv</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="n">salt</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="n">tag</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="n">algorithm</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">algorithm</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="n">metadata</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;key_size&#39;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">key</span><span class="p">)}</span>
</span></span><span class="line"><span class="cl">        <span class="p">)</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">_decrypt_aes_cbc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">encrypted_data</span><span class="p">:</span> <span class="n">EncryptedData</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bytes</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;&#34;&#34;Decrypt using AES-256-CBC&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="n">cipher</span> <span class="o">=</span> <span class="n">Cipher</span><span class="p">(</span><span class="n">algorithms</span><span class="o">.</span><span class="n">AES</span><span class="p">(</span><span class="n">key</span><span class="p">),</span> <span class="n">modes</span><span class="o">.</span><span class="n">CBC</span><span class="p">(</span><span class="n">encrypted_data</span><span class="o">.</span><span class="n">iv</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">        <span class="n">decryptor</span> <span class="o">=</span> <span class="n">cipher</span><span class="o">.</span><span class="n">decryptor</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="n">padded_data</span> <span class="o">=</span> <span class="n">decryptor</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">encrypted_data</span><span class="o">.</span><span class="n">ciphertext</span><span class="p">)</span> <span class="o">+</span> <span class="n">decryptor</span><span class="o">.</span><span class="n">finalize</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="c1"># Remove padding</span>
</span></span><span class="line"><span class="cl">        <span class="n">padding_length</span> <span class="o">=</span> <span class="n">padded_data</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">padded_data</span><span class="p">[:</span><span class="o">-</span><span class="n">padding_length</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">_encrypt_chacha20</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">                         <span class="n">config</span><span class="p">:</span> <span class="n">EncryptionConfig</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">EncryptedData</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;&#34;&#34;Encrypt using ChaCha20-Poly1305&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="n">nonce</span> <span class="o">=</span> <span class="n">secrets</span><span class="o">.</span><span class="n">token_bytes</span><span class="p">(</span><span class="mi">12</span><span class="p">)</span>  <span class="c1"># ChaCha20 nonce size</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="n">cipher</span> <span class="o">=</span> <span class="n">Cipher</span><span class="p">(</span><span class="n">algorithms</span><span class="o">.</span><span class="n">ChaCha20</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">nonce</span><span class="p">),</span> <span class="n">mode</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">encryptor</span> <span class="o">=</span> <span class="n">cipher</span><span class="o">.</span><span class="n">encryptor</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="n">ciphertext</span> <span class="o">=</span> <span class="n">encryptor</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">+</span> <span class="n">encryptor</span><span class="o">.</span><span class="n">finalize</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">EncryptedData</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">            <span class="n">ciphertext</span><span class="o">=</span><span class="n">ciphertext</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="n">iv</span><span class="o">=</span><span class="n">nonce</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="n">salt</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="n">tag</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="n">algorithm</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">algorithm</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="n">metadata</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;key_size&#39;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">key</span><span class="p">)}</span>
</span></span><span class="line"><span class="cl">        <span class="p">)</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">_decrypt_chacha20</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">encrypted_data</span><span class="p">:</span> <span class="n">EncryptedData</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bytes</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;&#34;&#34;Decrypt using ChaCha20-Poly1305&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="n">cipher</span> <span class="o">=</span> <span class="n">Cipher</span><span class="p">(</span><span class="n">algorithms</span><span class="o">.</span><span class="n">ChaCha20</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">encrypted_data</span><span class="o">.</span><span class="n">iv</span><span class="p">),</span> <span class="n">mode</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">decryptor</span> <span class="o">=</span> <span class="n">cipher</span><span class="o">.</span><span class="n">decryptor</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">decryptor</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">encrypted_data</span><span class="o">.</span><span class="n">ciphertext</span><span class="p">)</span> <span class="o">+</span> <span class="n">decryptor</span><span class="o">.</span><span class="n">finalize</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">_encrypt_fernet</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">                       <span class="n">config</span><span class="p">:</span> <span class="n">EncryptionConfig</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">EncryptedData</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;&#34;&#34;Encrypt using Fernet&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="n">fernet</span> <span class="o">=</span> <span class="n">Fernet</span><span class="p">(</span><span class="n">base64</span><span class="o">.</span><span class="n">urlsafe_b64encode</span><span class="p">(</span><span class="n">key</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">        <span class="n">ciphertext</span> <span class="o">=</span> <span class="n">fernet</span><span class="o">.</span><span class="n">encrypt</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">EncryptedData</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">            <span class="n">ciphertext</span><span class="o">=</span><span class="n">ciphertext</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="n">iv</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="n">salt</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="n">tag</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="n">algorithm</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">algorithm</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="n">metadata</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;key_size&#39;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">key</span><span class="p">)}</span>
</span></span><span class="line"><span class="cl">        <span class="p">)</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">_decrypt_fernet</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">encrypted_data</span><span class="p">:</span> <span class="n">EncryptedData</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bytes</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;&#34;&#34;Decrypt using Fernet&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="n">fernet</span> <span class="o">=</span> <span class="n">Fernet</span><span class="p">(</span><span class="n">base64</span><span class="o">.</span><span class="n">urlsafe_b64encode</span><span class="p">(</span><span class="n">key</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">fernet</span><span class="o">.</span><span class="n">decrypt</span><span class="p">(</span><span class="n">encrypted_data</span><span class="o">.</span><span class="n">ciphertext</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">encrypt_column_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">table_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">column_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">                           <span class="n">data</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">data_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;&#34;&#34;Encrypt column data with format preservation&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># Convert data to bytes</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">            <span class="n">data_bytes</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">)):</span>
</span></span><span class="line"><span class="cl">            <span class="n">data_bytes</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">data_bytes</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="c1"># Use column-specific key</span>
</span></span><span class="line"><span class="cl">        <span class="n">key_id</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&#34;</span><span class="si">{</span><span class="n">table_name</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">column_name</span><span class="si">}</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="c1"># Ensure key exists</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_key</span><span class="p">(</span><span class="n">key_id</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">            <span class="bp">self</span><span class="o">.</span><span class="n">generate_key</span><span class="p">(</span><span class="n">key_id</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="c1"># Encrypt data</span>
</span></span><span class="line"><span class="cl">        <span class="n">encrypted_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">encrypt_data</span><span class="p">(</span><span class="n">data_bytes</span><span class="p">,</span> <span class="n">key_id</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="c1"># Return base64-encoded ciphertext for storage</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64encode</span><span class="p">(</span><span class="n">encrypted_data</span><span class="o">.</span><span class="n">ciphertext</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">decrypt_column_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">table_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">column_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">                           <span class="n">encrypted_value</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">data_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;&#34;&#34;Decrypt column data and convert back to original type&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="n">key_id</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&#34;</span><span class="si">{</span><span class="n">table_name</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">column_name</span><span class="si">}</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="c1"># Decode base64</span>
</span></span><span class="line"><span class="cl">        <span class="n">ciphertext</span> <span class="o">=</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64decode</span><span class="p">(</span><span class="n">encrypted_value</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="c1"># Create EncryptedData object (simplified - in practice, store metadata)</span>
</span></span><span class="line"><span class="cl">        <span class="n">encrypted_data</span> <span class="o">=</span> <span class="n">EncryptedData</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">            <span class="n">ciphertext</span><span class="o">=</span><span class="n">ciphertext</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="n">iv</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="n">salt</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="n">tag</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="n">algorithm</span><span class="o">=</span><span class="n">EncryptionAlgorithm</span><span class="o">.</span><span class="n">FERNET</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="n">metadata</span><span class="o">=</span><span class="p">{}</span>
</span></span><span class="line"><span class="cl">        <span class="p">)</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="c1"># Decrypt</span>
</span></span><span class="line"><span class="cl">        <span class="n">decrypted_bytes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">decrypt_data</span><span class="p">(</span><span class="n">encrypted_data</span><span class="p">,</span> <span class="n">key_id</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">decrypted_str</span> <span class="o">=</span> <span class="n">decrypted_bytes</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="c1"># Convert back to original type</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">data_type</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;int&#39;</span><span class="p">,</span> <span class="s1">&#39;integer&#39;</span><span class="p">,</span> <span class="s1">&#39;bigint&#39;</span><span class="p">]:</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">decrypted_str</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">elif</span> <span class="n">data_type</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;float&#39;</span><span class="p">,</span> <span class="s1">&#39;double&#39;</span><span class="p">,</span> <span class="s1">&#39;decimal&#39;</span><span class="p">]:</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">decrypted_str</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="n">decrypted_str</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">rotate_key</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;&#34;&#34;Rotate encryption key&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="c1"># Generate new key</span>
</span></span><span class="line"><span class="cl">            <span class="n">old_key</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_key</span><span class="p">(</span><span class="n">key_id</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="n">new_key</span> <span class="o">=</span> <span class="n">secrets</span><span class="o">.</span><span class="n">token_bytes</span><span class="p">(</span><span class="mi">32</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            
</span></span><span class="line"><span class="cl">            <span class="c1"># Store new key with versioned ID</span>
</span></span><span class="line"><span class="cl">            <span class="n">new_key_id</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&#34;</span><span class="si">{</span><span class="n">key_id</span><span class="si">}</span><span class="s2">_v</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">())</span><span class="si">}</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="n">encrypted_new_key</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_encrypt_key</span><span class="p">(</span><span class="n">new_key</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="bp">self</span><span class="o">.</span><span class="n">_store_key</span><span class="p">(</span><span class="n">new_key_id</span><span class="p">,</span> <span class="n">encrypted_new_key</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            
</span></span><span class="line"><span class="cl">            <span class="c1"># Update key cache</span>
</span></span><span class="line"><span class="cl">            <span class="bp">self</span><span class="o">.</span><span class="n">key_cache</span><span class="p">[</span><span class="n">key_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_key</span>
</span></span><span class="line"><span class="cl">            
</span></span><span class="line"><span class="cl">            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;Rotated key: </span><span class="si">{</span><span class="n">key_id</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="kc">True</span>
</span></span><span class="line"><span class="cl">            
</span></span><span class="line"><span class="cl">        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;Key rotation failed for </span><span class="si">{</span><span class="n">key_id</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="kc">False</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">generate_hash</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">salt</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;&#34;&#34;Generate secure hash for data&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">salt</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">salt</span> <span class="o">=</span> <span class="n">secrets</span><span class="o">.</span><span class="n">token_hex</span><span class="p">(</span><span class="mi">16</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="c1"># Use PBKDF2 for password-like data</span>
</span></span><span class="line"><span class="cl">        <span class="n">hash_value</span> <span class="o">=</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">pbkdf2_hmac</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;sha256&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="n">data</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">            <span class="n">salt</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">            <span class="mi">100000</span>
</span></span><span class="line"><span class="cl">        <span class="p">)</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64encode</span><span class="p">(</span><span class="n">hash_value</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">),</span> <span class="n">salt</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">verify_hash</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">hash_value</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">salt</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;&#34;&#34;Verify data against hash&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="n">computed_hash</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">generate_hash</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">salt</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">hmac</span><span class="o">.</span><span class="n">compare_digest</span><span class="p">(</span><span class="n">computed_hash</span><span class="p">,</span> <span class="n">hash_value</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Example usage</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="n">config</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;master_password&#39;</span><span class="p">:</span> <span class="s1">&#39;secure_master_password_2024&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;master_salt&#39;</span><span class="p">:</span> <span class="s1">&#39;encryption_salt_2024&#39;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="n">encryption_manager</span> <span class="o">=</span> <span class="n">EncryptionManager</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1"># Generate a key for sensitive data</span>
</span></span><span class="line"><span class="cl">    <span class="n">key_id</span> <span class="o">=</span> <span class="s2">&#34;users.ssn&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">encryption_manager</span><span class="o">.</span><span class="n">generate_key</span><span class="p">(</span><span class="n">key_id</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1"># Encrypt sensitive data</span>
</span></span><span class="line"><span class="cl">    <span class="n">sensitive_data</span> <span class="o">=</span> <span class="s2">&#34;123-45-6789&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">encrypted_ssn</span> <span class="o">=</span> <span class="n">encryption_manager</span><span class="o">.</span><span class="n">encrypt_column_data</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;users&#34;</span><span class="p">,</span> <span class="s2">&#34;ssn&#34;</span><span class="p">,</span> <span class="n">sensitive_data</span><span class="p">,</span> <span class="s2">&#34;varchar&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="p">)</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;Original SSN: </span><span class="si">{</span><span class="n">sensitive_data</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;Encrypted SSN: </span><span class="si">{</span><span class="n">encrypted_ssn</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1"># Decrypt data</span>
</span></span><span class="line"><span class="cl">    <span class="n">decrypted_ssn</span> <span class="o">=</span> <span class="n">encryption_manager</span><span class="o">.</span><span class="n">decrypt_column_data</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;users&#34;</span><span class="p">,</span> <span class="s2">&#34;ssn&#34;</span><span class="p">,</span> <span class="n">encrypted_ssn</span><span class="p">,</span> <span class="s2">&#34;varchar&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="p">)</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;Decrypted SSN: </span><span class="si">{</span><span class="n">decrypted_ssn</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1"># Generate hash for password</span>
</span></span><span class="line"><span class="cl">    <span class="n">password</span> <span class="o">=</span> <span class="s2">&#34;user_password_123&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">hash_value</span><span class="p">,</span> <span class="n">salt</span> <span class="o">=</span> <span class="n">encryption_manager</span><span class="o">.</span><span class="n">generate_hash</span><span class="p">(</span><span class="n">password</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;Password hash: </span><span class="si">{</span><span class="n">hash_value</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;Salt: </span><span class="si">{</span><span class="n">salt</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1"># Verify password</span>
</span></span><span class="line"><span class="cl">    <span class="n">is_valid</span> <span class="o">=</span> <span class="n">encryption_manager</span><span class="o">.</span><span class="n">verify_hash</span><span class="p">(</span><span class="n">password</span><span class="p">,</span> <span class="n">hash_value</span><span class="p">,</span> <span class="n">salt</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;Password verification: </span><span class="si">{</span><span class="n">is_valid</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&#34;__main__&#34;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">main</span><span class="p">()</span>
</span></span></code></pre></div><h2 id="access-control-implementation">Access Control Implementation</h2>
<h3 id="1-database-level-access-control">1. Database-Level Access Control</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">sqlite3</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">mysql.connector</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">psycopg2</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">Any</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">logging</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">timedelta</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">DatabaseAccessController</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;&#34;&#34;Unified database access control implementation&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]):</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">config</span> <span class="o">=</span> <span class="n">config</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">connections</span> <span class="o">=</span> <span class="p">{}</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">access_policies</span> <span class="o">=</span> <span class="p">{}</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">create_connection</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">db_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">connection_params</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;&#34;&#34;Create secure database connection&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="n">db_type</span> <span class="o">==</span> <span class="s1">&#39;mysql&#39;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="n">connection</span> <span class="o">=</span> <span class="n">mysql</span><span class="o">.</span><span class="n">connector</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">                    <span class="o">**</span><span class="n">connection_params</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                    <span class="n">ssl_disabled</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                    <span class="n">ssl_verify_cert</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                    <span class="n">ssl_verify_identity</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                    <span class="n">autocommit</span><span class="o">=</span><span class="kc">False</span>
</span></span><span class="line"><span class="cl">                <span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="k">elif</span> <span class="n">db_type</span> <span class="o">==</span> <span class="s1">&#39;postgresql&#39;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="n">connection</span> <span class="o">=</span> <span class="n">psycopg2</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">                    <span class="o">**</span><span class="n">connection_params</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                    <span class="n">sslmode</span><span class="o">=</span><span class="s1">&#39;require&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                    <span class="n">connect_timeout</span><span class="o">=</span><span class="mi">10</span>
</span></span><span class="line"><span class="cl">                <span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="k">elif</span> <span class="n">db_type</span> <span class="o">==</span> <span class="s1">&#39;sqlite&#39;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="n">connection</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">                    <span class="n">connection_params</span><span class="p">[</span><span class="s1">&#39;database&#39;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">                    <span class="n">timeout</span><span class="o">=</span><span class="mf">10.0</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                    <span class="n">check_same_thread</span><span class="o">=</span><span class="kc">False</span>
</span></span><span class="line"><span class="cl">                <span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;Unsupported database type: </span><span class="si">{</span><span class="n">db_type</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                
</span></span><span class="line"><span class="cl">            <span class="bp">self</span><span class="o">.</span><span class="n">connections</span><span class="p">[</span><span class="n">db_type</span><span class="p">]</span> <span class="o">=</span> <span class="n">connection</span>
</span></span><span class="line"><span class="cl">            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;Secure connection established for </span><span class="si">{</span><span class="n">db_type</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="n">connection</span>
</span></span><span class="line"><span class="cl">            
</span></span><span class="line"><span class="cl">        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;Connection failed for </span><span class="si">{</span><span class="n">db_type</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="k">raise</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">create_user_with_privileges</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">db_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">username</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">                                  <span class="n">password</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">privileges</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">                                  <span class="n">databases</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;&#34;&#34;Create database user with specific privileges&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">connection</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connections</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">db_type</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="ow">not</span> <span class="n">connection</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;No connection available for </span><span class="si">{</span><span class="n">db_type</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                
</span></span><span class="line"><span class="cl">            <span class="n">cursor</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">            
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="n">db_type</span> <span class="o">==</span> <span class="s1">&#39;mysql&#39;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="c1"># Create user</span>
</span></span><span class="line"><span class="cl">                <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;CREATE USER &#39;</span><span class="si">{</span><span class="n">username</span><span class="si">}</span><span class="s2">&#39;@&#39;%&#39; IDENTIFIED BY %s&#34;</span><span class="p">,</span> <span class="p">(</span><span class="n">password</span><span class="p">,))</span>
</span></span><span class="line"><span class="cl">                
</span></span><span class="line"><span class="cl">                <span class="c1"># Grant privileges</span>
</span></span><span class="line"><span class="cl">                <span class="k">for</span> <span class="n">db_name</span> <span class="ow">in</span> <span class="p">(</span><span class="n">databases</span> <span class="ow">or</span> <span class="p">[</span><span class="s1">&#39;*&#39;</span><span class="p">]):</span>
</span></span><span class="line"><span class="cl">                    <span class="k">for</span> <span class="n">privilege</span> <span class="ow">in</span> <span class="n">privileges</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                        <span class="k">if</span> <span class="n">privilege</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;ALL&#39;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                            <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;GRANT ALL PRIVILEGES ON </span><span class="si">{</span><span class="n">db_name</span><span class="si">}</span><span class="s2">.* TO &#39;</span><span class="si">{</span><span class="n">username</span><span class="si">}</span><span class="s2">&#39;@&#39;%&#39;&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                        <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                            <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;GRANT </span><span class="si">{</span><span class="n">privilege</span><span class="si">}</span><span class="s2"> ON </span><span class="si">{</span><span class="n">db_name</span><span class="si">}</span><span class="s2">.* TO &#39;</span><span class="si">{</span><span class="n">username</span><span class="si">}</span><span class="s2">&#39;@&#39;%&#39;&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                
</span></span><span class="line"><span class="cl">                <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&#34;FLUSH PRIVILEGES&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                
</span></span><span class="line"><span class="cl">            <span class="k">elif</span> <span class="n">db_type</span> <span class="o">==</span> <span class="s1">&#39;postgresql&#39;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="c1"># Create user</span>
</span></span><span class="line"><span class="cl">                <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;CREATE USER </span><span class="si">{</span><span class="n">username</span><span class="si">}</span><span class="s2"> WITH PASSWORD %s&#34;</span><span class="p">,</span> <span class="p">(</span><span class="n">password</span><span class="p">,))</span>
</span></span><span class="line"><span class="cl">                
</span></span><span class="line"><span class="cl">                <span class="c1"># Grant privileges</span>
</span></span><span class="line"><span class="cl">                <span class="k">for</span> <span class="n">db_name</span> <span class="ow">in</span> <span class="p">(</span><span class="n">databases</span> <span class="ow">or</span> <span class="p">[]):</span>
</span></span><span class="line"><span class="cl">                    <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;GRANT CONNECT ON DATABASE </span><span class="si">{</span><span class="n">db_name</span><span class="si">}</span><span class="s2"> TO </span><span class="si">{</span><span class="n">username</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                    <span class="k">for</span> <span class="n">privilege</span> <span class="ow">in</span> <span class="n">privileges</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                        <span class="k">if</span> <span class="n">privilege</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;ALL&#39;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                            <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;GRANT ALL PRIVILEGES ON DATABASE </span><span class="si">{</span><span class="n">db_name</span><span class="si">}</span><span class="s2"> TO </span><span class="si">{</span><span class="n">username</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                        <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                            <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;GRANT </span><span class="si">{</span><span class="n">privilege</span><span class="si">}</span><span class="s2"> ON DATABASE </span><span class="si">{</span><span class="n">db_name</span><span class="si">}</span><span class="s2"> TO </span><span class="si">{</span><span class="n">username</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            
</span></span><span class="line"><span class="cl">            <span class="n">connection</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;User </span><span class="si">{</span><span class="n">username</span><span class="si">}</span><span class="s2"> created with privileges: </span><span class="si">{</span><span class="n">privileges</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="kc">True</span>
</span></span><span class="line"><span class="cl">            
</span></span><span class="line"><span class="cl">        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;Failed to create user </span><span class="si">{</span><span class="n">username</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="n">connection</span><span class="o">.</span><span class="n">rollback</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="kc">False</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">implement_row_level_security</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">db_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">table_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                                   <span class="n">policy_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">policy_condition</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;&#34;&#34;Implement row-level security policies&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">connection</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connections</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">db_type</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="n">cursor</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">            
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="n">db_type</span> <span class="o">==</span> <span class="s1">&#39;postgresql&#39;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="c1"># Enable RLS on table</span>
</span></span><span class="line"><span class="cl">                <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;ALTER TABLE </span><span class="si">{</span><span class="n">table_name</span><span class="si">}</span><span class="s2"> ENABLE ROW LEVEL SECURITY&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                
</span></span><span class="line"><span class="cl">                <span class="c1"># Create policy</span>
</span></span><span class="line"><span class="cl">                <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">                    CREATE POLICY </span><span class="si">{</span><span class="n">policy_name</span><span class="si">}</span><span class="s2"> ON </span><span class="si">{</span><span class="n">table_name</span><span class="si">}</span><span class="s2">
</span></span></span><span class="line"><span class="cl"><span class="s2">                    FOR ALL TO PUBLIC
</span></span></span><span class="line"><span class="cl"><span class="s2">                    USING (</span><span class="si">{</span><span class="n">policy_condition</span><span class="si">}</span><span class="s2">)
</span></span></span><span class="line"><span class="cl"><span class="s2">                &#34;&#34;&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                
</span></span><span class="line"><span class="cl">            <span class="k">elif</span> <span class="n">db_type</span> <span class="o">==</span> <span class="s1">&#39;mysql&#39;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="c1"># MySQL doesn&#39;t have native RLS, implement with views</span>
</span></span><span class="line"><span class="cl">                <span class="n">view_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&#34;</span><span class="si">{</span><span class="n">table_name</span><span class="si">}</span><span class="s2">_secure&#34;</span>
</span></span><span class="line"><span class="cl">                <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">                    CREATE VIEW </span><span class="si">{</span><span class="n">view_name</span><span class="si">}</span><span class="s2"> AS
</span></span></span><span class="line"><span class="cl"><span class="s2">                    SELECT * FROM </span><span class="si">{</span><span class="n">table_name</span><span class="si">}</span><span class="s2">
</span></span></span><span class="line"><span class="cl"><span class="s2">                    WHERE </span><span class="si">{</span><span class="n">policy_condition</span><span class="si">}</span><span class="s2">
</span></span></span><span class="line"><span class="cl"><span class="s2">                &#34;&#34;&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            
</span></span><span class="line"><span class="cl">            <span class="n">connection</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;Row-level security implemented for </span><span class="si">{</span><span class="n">table_name</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="kc">True</span>
</span></span><span class="line"><span class="cl">            
</span></span><span class="line"><span class="cl">        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;Failed to implement RLS for </span><span class="si">{</span><span class="n">table_name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="kc">False</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">create_security_definer_function</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">db_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">function_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                                       <span class="n">function_body</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">owner</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;&#34;&#34;Create security definer functions for controlled access&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">connection</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connections</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">db_type</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="n">cursor</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">            
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="n">db_type</span> <span class="o">==</span> <span class="s1">&#39;postgresql&#39;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">                    CREATE OR REPLACE FUNCTION </span><span class="si">{</span><span class="n">function_name</span><span class="si">}</span><span class="s2">()
</span></span></span><span class="line"><span class="cl"><span class="s2">                    RETURNS TABLE(result_data TEXT)
</span></span></span><span class="line"><span class="cl"><span class="s2">                    LANGUAGE plpgsql
</span></span></span><span class="line"><span class="cl"><span class="s2">                    SECURITY DEFINER
</span></span></span><span class="line"><span class="cl"><span class="s2">                    SET search_path = public
</span></span></span><span class="line"><span class="cl"><span class="s2">                    AS $$
</span></span></span><span class="line"><span class="cl"><span class="s2">                    BEGIN
</span></span></span><span class="line"><span class="cl"><span class="s2">                        </span><span class="si">{</span><span class="n">function_body</span><span class="si">}</span><span class="s2">
</span></span></span><span class="line"><span class="cl"><span class="s2">                    END;
</span></span></span><span class="line"><span class="cl"><span class="s2">                    $$;
</span></span></span><span class="line"><span class="cl"><span class="s2">                &#34;&#34;&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                
</span></span><span class="line"><span class="cl">                <span class="c1"># Set owner</span>
</span></span><span class="line"><span class="cl">                <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;ALTER FUNCTION </span><span class="si">{</span><span class="n">function_name</span><span class="si">}</span><span class="s2">() OWNER TO </span><span class="si">{</span><span class="n">owner</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                
</span></span><span class="line"><span class="cl">            <span class="n">connection</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;Security definer function </span><span class="si">{</span><span class="n">function_name</span><span class="si">}</span><span class="s2"> created&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="kc">True</span>
</span></span><span class="line"><span class="cl">            
</span></span><span class="line"><span class="cl">        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;Failed to create function </span><span class="si">{</span><span class="n">function_name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="kc">False</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">### 2. Application-Level Access Control</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">ApplicationAccessControl</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;&#34;&#34;Application-level access control and session management&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]):</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">config</span> <span class="o">=</span> <span class="n">config</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">active_sessions</span> <span class="o">=</span> <span class="p">{}</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">failed_attempts</span> <span class="o">=</span> <span class="p">{}</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">validate_session</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">session_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;&#34;&#34;Validate user session&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">session</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">active_sessions</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">session_id</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="ow">not</span> <span class="n">session</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="k">return</span> <span class="kc">False</span>
</span></span><span class="line"><span class="cl">                
</span></span><span class="line"><span class="cl">            <span class="c1"># Check session expiry</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span> <span class="o">&gt;</span> <span class="n">session</span><span class="p">[</span><span class="s1">&#39;expires_at&#39;</span><span class="p">]:</span>
</span></span><span class="line"><span class="cl">                <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">active_sessions</span><span class="p">[</span><span class="n">session_id</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">                <span class="k">return</span> <span class="kc">False</span>
</span></span><span class="line"><span class="cl">                
</span></span><span class="line"><span class="cl">            <span class="c1"># Check user match</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="n">session</span><span class="p">[</span><span class="s1">&#39;user_id&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="n">user_id</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="k">return</span> <span class="kc">False</span>
</span></span><span class="line"><span class="cl">                
</span></span><span class="line"><span class="cl">            <span class="c1"># Update last activity</span>
</span></span><span class="line"><span class="cl">            <span class="n">session</span><span class="p">[</span><span class="s1">&#39;last_activity&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="kc">True</span>
</span></span><span class="line"><span class="cl">            
</span></span><span class="line"><span class="cl">        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;Session validation failed: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="kc">False</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">check_rate_limiting</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">action</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;&#34;&#34;Implement rate limiting for database operations&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">current_time</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">            <span class="n">key</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&#34;</span><span class="si">{</span><span class="n">user_id</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">action</span><span class="si">}</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl">            
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">failed_attempts</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="bp">self</span><span class="o">.</span><span class="n">failed_attempts</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl">            
</span></span><span class="line"><span class="cl">            <span class="c1"># Clean old attempts</span>
</span></span><span class="line"><span class="cl">            <span class="bp">self</span><span class="o">.</span><span class="n">failed_attempts</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">                <span class="n">attempt</span> <span class="k">for</span> <span class="n">attempt</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">failed_attempts</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">                <span class="k">if</span> <span class="n">current_time</span> <span class="o">-</span> <span class="n">attempt</span> <span class="o">&lt;</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">minutes</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="p">]</span>
</span></span><span class="line"><span class="cl">            
</span></span><span class="line"><span class="cl">            <span class="c1"># Check rate limit</span>
</span></span><span class="line"><span class="cl">            <span class="n">max_attempts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;rate_limit&#39;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">action</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">failed_attempts</span><span class="p">[</span><span class="n">key</span><span class="p">])</span> <span class="o">&gt;=</span> <span class="n">max_attempts</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;Rate limit exceeded for </span><span class="si">{</span><span class="n">user_id</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">action</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="k">return</span> <span class="kc">False</span>
</span></span><span class="line"><span class="cl">                
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="kc">True</span>
</span></span><span class="line"><span class="cl">            
</span></span><span class="line"><span class="cl">        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;Rate limiting check failed: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="kc">False</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">log_access_attempt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">action</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">                          <span class="n">success</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span> <span class="n">details</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;&#34;&#34;Log access attempts for auditing&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">log_entry</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="s1">&#39;timestamp&#39;</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">isoformat</span><span class="p">(),</span>
</span></span><span class="line"><span class="cl">                <span class="s1">&#39;user_id&#39;</span><span class="p">:</span> <span class="n">user_id</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s1">&#39;action&#39;</span><span class="p">:</span> <span class="n">action</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s1">&#39;success&#39;</span><span class="p">:</span> <span class="n">success</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s1">&#39;ip_address&#39;</span><span class="p">:</span> <span class="n">details</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ip_address&#39;</span><span class="p">)</span> <span class="k">if</span> <span class="n">details</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s1">&#39;user_agent&#39;</span><span class="p">:</span> <span class="n">details</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;user_agent&#39;</span><span class="p">)</span> <span class="k">if</span> <span class="n">details</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s1">&#39;resource&#39;</span><span class="p">:</span> <span class="n">details</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;resource&#39;</span><span class="p">)</span> <span class="k">if</span> <span class="n">details</span> <span class="k">else</span> <span class="kc">None</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">            
</span></span><span class="line"><span class="cl">            <span class="c1"># Log to file or database</span>
</span></span><span class="line"><span class="cl">            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;Access attempt: </span><span class="si">{</span><span class="n">log_entry</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            
</span></span><span class="line"><span class="cl">            <span class="c1"># Track failed attempts for rate limiting</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="ow">not</span> <span class="n">success</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="n">key</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&#34;</span><span class="si">{</span><span class="n">user_id</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">action</span><span class="si">}</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl">                <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">failed_attempts</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                    <span class="bp">self</span><span class="o">.</span><span class="n">failed_attempts</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl">                <span class="bp">self</span><span class="o">.</span><span class="n">failed_attempts</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">                
</span></span><span class="line"><span class="cl">        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;Failed to log access attempt: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">## Auditing and Monitoring</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">### 1. Comprehensive Audit System</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="err">```</span><span class="n">python</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">json</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">hashlib</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Optional</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">dataclasses</span> <span class="kn">import</span> <span class="n">dataclass</span><span class="p">,</span> <span class="n">asdict</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">enum</span> <span class="kn">import</span> <span class="n">Enum</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">AuditEventType</span><span class="p">(</span><span class="n">Enum</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">LOGIN</span> <span class="o">=</span> <span class="s2">&#34;login&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">LOGOUT</span> <span class="o">=</span> <span class="s2">&#34;logout&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">QUERY</span> <span class="o">=</span> <span class="s2">&#34;query&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">INSERT</span> <span class="o">=</span> <span class="s2">&#34;insert&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">UPDATE</span> <span class="o">=</span> <span class="s2">&#34;update&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">DELETE</span> <span class="o">=</span> <span class="s2">&#34;delete&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">SCHEMA_CHANGE</span> <span class="o">=</span> <span class="s2">&#34;schema_change&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">PRIVILEGE_CHANGE</span> <span class="o">=</span> <span class="s2">&#34;privilege_change&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">BACKUP</span> <span class="o">=</span> <span class="s2">&#34;backup&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">RESTORE</span> <span class="o">=</span> <span class="s2">&#34;restore&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nd">@dataclass</span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">AuditEvent</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">event_id</span><span class="p">:</span> <span class="nb">str</span>
</span></span><span class="line"><span class="cl">    <span class="n">timestamp</span><span class="p">:</span> <span class="n">datetime</span>
</span></span><span class="line"><span class="cl">    <span class="n">event_type</span><span class="p">:</span> <span class="n">AuditEventType</span>
</span></span><span class="line"><span class="cl">    <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span>
</span></span><span class="line"><span class="cl">    <span class="n">session_id</span><span class="p">:</span> <span class="nb">str</span>
</span></span><span class="line"><span class="cl">    <span class="n">database_name</span><span class="p">:</span> <span class="nb">str</span>
</span></span><span class="line"><span class="cl">    <span class="n">table_name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="n">query</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="n">affected_rows</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="n">ip_address</span><span class="p">:</span> <span class="nb">str</span>
</span></span><span class="line"><span class="cl">    <span class="n">user_agent</span><span class="p">:</span> <span class="nb">str</span>
</span></span><span class="line"><span class="cl">    <span class="n">success</span><span class="p">:</span> <span class="nb">bool</span>
</span></span><span class="line"><span class="cl">    <span class="n">error_message</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="n">data_before</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span>
</span></span><span class="line"><span class="cl">    <span class="n">data_after</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">DatabaseAuditSystem</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;&#34;&#34;Comprehensive database auditing system&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]):</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">config</span> <span class="o">=</span> <span class="n">config</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">audit_storage</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;audit_storage&#39;</span><span class="p">,</span> <span class="s1">&#39;file&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">retention_days</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;retention_days&#39;</span><span class="p">,</span> <span class="mi">365</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">generate_event_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event_data</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;&#34;&#34;Generate unique event ID&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="n">event_string</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">event_data</span><span class="p">,</span> <span class="n">sort_keys</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="nb">str</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">sha256</span><span class="p">(</span><span class="n">event_string</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()[:</span><span class="mi">16</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">log_audit_event</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">:</span> <span class="n">AuditEvent</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;&#34;&#34;Log audit event to storage&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">event_dict</span> <span class="o">=</span> <span class="n">asdict</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="n">event_dict</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">timestamp</span><span class="o">.</span><span class="n">isoformat</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">            <span class="n">event_dict</span><span class="p">[</span><span class="s1">&#39;event_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">event_type</span><span class="o">.</span><span class="n">value</span>
</span></span><span class="line"><span class="cl">            
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">audit_storage</span> <span class="o">==</span> <span class="s1">&#39;file&#39;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="bp">self</span><span class="o">.</span><span class="n">_log_to_file</span><span class="p">(</span><span class="n">event_dict</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">audit_storage</span> <span class="o">==</span> <span class="s1">&#39;database&#39;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="bp">self</span><span class="o">.</span><span class="n">_log_to_database</span><span class="p">(</span><span class="n">event_dict</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">audit_storage</span> <span class="o">==</span> <span class="s1">&#39;syslog&#39;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="bp">self</span><span class="o">.</span><span class="n">_log_to_syslog</span><span class="p">(</span><span class="n">event_dict</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="kc">True</span>
</span></span><span class="line"><span class="cl">            
</span></span><span class="line"><span class="cl">        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;Failed to log audit event: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="kc">False</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">_log_to_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event_dict</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]):</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;&#34;&#34;Log audit event to file&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="n">audit_file</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&#34;audit_</span><span class="si">{</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y%m</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">.log&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">audit_file</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">event_dict</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">_log_to_database</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event_dict</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]):</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;&#34;&#34;Log audit event to database&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># Implementation for database logging</span>
</span></span><span class="line"><span class="cl">        <span class="k">pass</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">_log_to_syslog</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event_dict</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]):</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;&#34;&#34;Log audit event to syslog&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="kn">import</span> <span class="nn">syslog</span>
</span></span><span class="line"><span class="cl">        <span class="n">syslog</span><span class="o">.</span><span class="n">openlog</span><span class="p">(</span><span class="s2">&#34;database_audit&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">syslog</span><span class="o">.</span><span class="n">syslog</span><span class="p">(</span><span class="n">syslog</span><span class="o">.</span><span class="n">LOG_INFO</span><span class="p">,</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">event_dict</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">create_audit_triggers</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">db_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">table_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;&#34;&#34;Create database triggers for automatic auditing&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="n">triggers</span> <span class="o">=</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">db_type</span> <span class="o">==</span> <span class="s1">&#39;postgresql&#39;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="c1"># Create audit table</span>
</span></span><span class="line"><span class="cl">            <span class="n">audit_table</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&#34;</span><span class="si">{</span><span class="n">table_name</span><span class="si">}</span><span class="s2">_audit&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="n">triggers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">                CREATE TABLE IF NOT EXISTS </span><span class="si">{</span><span class="n">audit_table</span><span class="si">}</span><span class="s2"> (
</span></span></span><span class="line"><span class="cl"><span class="s2">                    audit_id SERIAL PRIMARY KEY,
</span></span></span><span class="line"><span class="cl"><span class="s2">                    operation CHAR(1) NOT NULL,
</span></span></span><span class="line"><span class="cl"><span class="s2">                    stamp TIMESTAMP NOT NULL DEFAULT NOW(),
</span></span></span><span class="line"><span class="cl"><span class="s2">                    userid TEXT NOT NULL DEFAULT USER,
</span></span></span><span class="line"><span class="cl"><span class="s2">                    old_values JSONB,
</span></span></span><span class="line"><span class="cl"><span class="s2">                    new_values JSONB
</span></span></span><span class="line"><span class="cl"><span class="s2">                );
</span></span></span><span class="line"><span class="cl"><span class="s2">            &#34;&#34;&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            
</span></span><span class="line"><span class="cl">            <span class="c1"># Create trigger function</span>
</span></span><span class="line"><span class="cl">            <span class="n">triggers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">                CREATE OR REPLACE FUNCTION </span><span class="si">{</span><span class="n">table_name</span><span class="si">}</span><span class="s2">_audit_trigger()
</span></span></span><span class="line"><span class="cl"><span class="s2">                RETURNS TRIGGER AS $$
</span></span></span><span class="line"><span class="cl"><span class="s2">                BEGIN
</span></span></span><span class="line"><span class="cl"><span class="s2">                    IF TG_OP = &#39;DELETE&#39; THEN
</span></span></span><span class="line"><span class="cl"><span class="s2">                        INSERT INTO </span><span class="si">{</span><span class="n">audit_table</span><span class="si">}</span><span class="s2"> (operation, old_values)
</span></span></span><span class="line"><span class="cl"><span class="s2">                        VALUES (&#39;D&#39;, row_to_json(OLD));
</span></span></span><span class="line"><span class="cl"><span class="s2">                        RETURN OLD;
</span></span></span><span class="line"><span class="cl"><span class="s2">                    ELSIF TG_OP = &#39;UPDATE&#39; THEN
</span></span></span><span class="line"><span class="cl"><span class="s2">                        INSERT INTO </span><span class="si">{</span><span class="n">audit_table</span><span class="si">}</span><span class="s2"> (operation, old_values, new_values)
</span></span></span><span class="line"><span class="cl"><span class="s2">                        VALUES (&#39;U&#39;, row_to_json(OLD), row_to_json(NEW));
</span></span></span><span class="line"><span class="cl"><span class="s2">                        RETURN NEW;
</span></span></span><span class="line"><span class="cl"><span class="s2">                    ELSIF TG_OP = &#39;INSERT&#39; THEN
</span></span></span><span class="line"><span class="cl"><span class="s2">                        INSERT INTO </span><span class="si">{</span><span class="n">audit_table</span><span class="si">}</span><span class="s2"> (operation, new_values)
</span></span></span><span class="line"><span class="cl"><span class="s2">                        VALUES (&#39;I&#39;, row_to_json(NEW));
</span></span></span><span class="line"><span class="cl"><span class="s2">                        RETURN NEW;
</span></span></span><span class="line"><span class="cl"><span class="s2">                    END IF;
</span></span></span><span class="line"><span class="cl"><span class="s2">                    RETURN NULL;
</span></span></span><span class="line"><span class="cl"><span class="s2">                END;
</span></span></span><span class="line"><span class="cl"><span class="s2">                $$ LANGUAGE plpgsql;
</span></span></span><span class="line"><span class="cl"><span class="s2">            &#34;&#34;&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            
</span></span><span class="line"><span class="cl">            <span class="c1"># Create triggers</span>
</span></span><span class="line"><span class="cl">            <span class="k">for</span> <span class="n">operation</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;INSERT&#39;</span><span class="p">,</span> <span class="s1">&#39;UPDATE&#39;</span><span class="p">,</span> <span class="s1">&#39;DELETE&#39;</span><span class="p">]:</span>
</span></span><span class="line"><span class="cl">                <span class="n">triggers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">                    CREATE TRIGGER </span><span class="si">{</span><span class="n">table_name</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">operation</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="si">}</span><span class="s2">_audit
</span></span></span><span class="line"><span class="cl"><span class="s2">                    AFTER </span><span class="si">{</span><span class="n">operation</span><span class="si">}</span><span class="s2"> ON </span><span class="si">{</span><span class="n">table_name</span><span class="si">}</span><span class="s2">
</span></span></span><span class="line"><span class="cl"><span class="s2">                    FOR EACH ROW EXECUTE FUNCTION </span><span class="si">{</span><span class="n">table_name</span><span class="si">}</span><span class="s2">_audit_trigger();
</span></span></span><span class="line"><span class="cl"><span class="s2">                &#34;&#34;&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="k">elif</span> <span class="n">db_type</span> <span class="o">==</span> <span class="s1">&#39;mysql&#39;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="c1"># MySQL trigger implementation</span>
</span></span><span class="line"><span class="cl">            <span class="n">audit_table</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&#34;</span><span class="si">{</span><span class="n">table_name</span><span class="si">}</span><span class="s2">_audit&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="n">triggers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">                CREATE TABLE IF NOT EXISTS </span><span class="si">{</span><span class="n">audit_table</span><span class="si">}</span><span class="s2"> (
</span></span></span><span class="line"><span class="cl"><span class="s2">                    audit_id INT AUTO_INCREMENT PRIMARY KEY,
</span></span></span><span class="line"><span class="cl"><span class="s2">                    operation CHAR(1) NOT NULL,
</span></span></span><span class="line"><span class="cl"><span class="s2">                    stamp TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
</span></span></span><span class="line"><span class="cl"><span class="s2">                    userid VARCHAR(255) DEFAULT USER(),
</span></span></span><span class="line"><span class="cl"><span class="s2">                    old_values JSON,
</span></span></span><span class="line"><span class="cl"><span class="s2">                    new_values JSON
</span></span></span><span class="line"><span class="cl"><span class="s2">                );
</span></span></span><span class="line"><span class="cl"><span class="s2">            &#34;&#34;&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            
</span></span><span class="line"><span class="cl">            <span class="c1"># Create triggers for each operation</span>
</span></span><span class="line"><span class="cl">            <span class="n">triggers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">                CREATE TRIGGER </span><span class="si">{</span><span class="n">table_name</span><span class="si">}</span><span class="s2">_insert_audit
</span></span></span><span class="line"><span class="cl"><span class="s2">                AFTER INSERT ON </span><span class="si">{</span><span class="n">table_name</span><span class="si">}</span><span class="s2">
</span></span></span><span class="line"><span class="cl"><span class="s2">                FOR EACH ROW
</span></span></span><span class="line"><span class="cl"><span class="s2">                INSERT INTO </span><span class="si">{</span><span class="n">audit_table</span><span class="si">}</span><span class="s2"> (operation, new_values)
</span></span></span><span class="line"><span class="cl"><span class="s2">                VALUES (&#39;I&#39;, JSON_OBJECT(</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_column_list</span><span class="p">(</span><span class="n">table_name</span><span class="p">,</span> <span class="s1">&#39;NEW&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">));
</span></span></span><span class="line"><span class="cl"><span class="s2">            &#34;&#34;&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">triggers</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">analyze_audit_logs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start_date</span><span class="p">:</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">end_date</span><span class="p">:</span> <span class="n">datetime</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;&#34;&#34;Analyze audit logs for security insights&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">analysis</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="s1">&#39;total_events&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s1">&#39;events_by_type&#39;</span><span class="p">:</span> <span class="p">{},</span>
</span></span><span class="line"><span class="cl">                <span class="s1">&#39;events_by_user&#39;</span><span class="p">:</span> <span class="p">{},</span>
</span></span><span class="line"><span class="cl">                <span class="s1">&#39;failed_attempts&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s1">&#39;suspicious_activities&#39;</span><span class="p">:</span> <span class="p">[],</span>
</span></span><span class="line"><span class="cl">                <span class="s1">&#39;top_queries&#39;</span><span class="p">:</span> <span class="p">[],</span>
</span></span><span class="line"><span class="cl">                <span class="s1">&#39;peak_hours&#39;</span><span class="p">:</span> <span class="p">{}</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">            
</span></span><span class="line"><span class="cl">            <span class="c1"># Read and analyze audit logs</span>
</span></span><span class="line"><span class="cl">            <span class="c1"># Implementation depends on storage type</span>
</span></span><span class="line"><span class="cl">            
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="n">analysis</span>
</span></span><span class="line"><span class="cl">            
</span></span><span class="line"><span class="cl">        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;Audit log analysis failed: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="p">{}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">### 2. Real-time Security Monitoring</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="err">```</span><span class="n">bash</span>
</span></span><span class="line"><span class="cl"><span class="c1">#!/bin/bash</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Database Security Monitoring Script</span>
</span></span><span class="line"><span class="cl"><span class="c1"># Monitors database security events and generates alerts</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Configuration</span>
</span></span><span class="line"><span class="cl"><span class="n">DB_HOST</span><span class="o">=</span><span class="s2">&#34;localhost&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">DB_PORT</span><span class="o">=</span><span class="s2">&#34;3306&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">DB_USER</span><span class="o">=</span><span class="s2">&#34;monitor_user&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">DB_PASS</span><span class="o">=</span><span class="s2">&#34;monitor_password&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">ALERT_EMAIL</span><span class="o">=</span><span class="s2">&#34;security@company.com&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">LOG_FILE</span><span class="o">=</span><span class="s2">&#34;/var/log/db_security_monitor.log&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">THRESHOLD_FAILED_LOGINS</span><span class="o">=</span><span class="mi">5</span>
</span></span><span class="line"><span class="cl"><span class="n">THRESHOLD_QUERY_TIME</span><span class="o">=</span><span class="mi">30</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Logging function</span>
</span></span><span class="line"><span class="cl"><span class="n">log_message</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">echo</span> <span class="s2">&#34;[$(date &#39;+%Y-%m-</span><span class="si">%d</span><span class="s2"> %H:%M:%S&#39;)] $1&#34;</span> <span class="o">|</span> <span class="n">tee</span> <span class="o">-</span><span class="n">a</span> <span class="s2">&#34;$LOG_FILE&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Check for failed login attempts</span>
</span></span><span class="line"><span class="cl"><span class="n">check_failed_logins</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">log_message</span> <span class="s2">&#34;Checking for failed login attempts...&#34;</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="n">failed_logins</span><span class="o">=</span><span class="err">$</span><span class="p">(</span><span class="n">mysql</span> <span class="o">-</span><span class="n">h</span> <span class="s2">&#34;$DB_HOST&#34;</span> <span class="o">-</span><span class="n">P</span> <span class="s2">&#34;$DB_PORT&#34;</span> <span class="o">-</span><span class="n">u</span> <span class="s2">&#34;$DB_USER&#34;</span> <span class="o">-</span><span class="n">p</span><span class="s2">&#34;$DB_PASS&#34;</span> \
</span></span><span class="line"><span class="cl">        <span class="o">-</span><span class="n">e</span> <span class="s2">&#34;SELECT COUNT(*) FROM mysql.general_log WHERE command_type = &#39;Connect&#39; AND argument LIKE &#39;%Access denied%&#39; AND event_time &gt; DATE_SUB(NOW(), INTERVAL 1 HOUR);&#34;</span> \
</span></span><span class="line"><span class="cl">        <span class="o">-</span><span class="n">s</span> <span class="o">-</span><span class="n">N</span> <span class="mi">2</span><span class="o">&gt;/</span><span class="n">dev</span><span class="o">/</span><span class="n">null</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">[</span> <span class="s2">&#34;$failed_logins&#34;</span> <span class="o">-</span><span class="n">gt</span> <span class="s2">&#34;$THRESHOLD_FAILED_LOGINS&#34;</span> <span class="p">];</span> <span class="n">then</span>
</span></span><span class="line"><span class="cl">        <span class="n">alert_message</span><span class="o">=</span><span class="s2">&#34;SECURITY ALERT: $failed_logins failed login attempts in the last hour&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="n">log_message</span> <span class="s2">&#34;$alert_message&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="n">send_alert</span> <span class="s2">&#34;$alert_message&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">fi</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Check for suspicious queries</span>
</span></span><span class="line"><span class="cl"><span class="n">check_suspicious_queries</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">log_message</span> <span class="s2">&#34;Checking for suspicious queries...&#34;</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1"># Check for potential SQL injection patterns</span>
</span></span><span class="line"><span class="cl">    <span class="n">suspicious_patterns</span><span class="o">=</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;UNION.*SELECT&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;OR.*1=1&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;DROP.*TABLE&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;DELETE.*FROM.*WHERE.*1=1&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;INSERT.*INTO.*VALUES.*SELECT&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="p">)</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">pattern</span> <span class="ow">in</span> <span class="s2">&#34;$</span><span class="si">{suspicious_patterns[@]}</span><span class="s2">&#34;</span><span class="p">;</span> <span class="n">do</span>
</span></span><span class="line"><span class="cl">        <span class="n">count</span><span class="o">=</span><span class="err">$</span><span class="p">(</span><span class="n">mysql</span> <span class="o">-</span><span class="n">h</span> <span class="s2">&#34;$DB_HOST&#34;</span> <span class="o">-</span><span class="n">P</span> <span class="s2">&#34;$DB_PORT&#34;</span> <span class="o">-</span><span class="n">u</span> <span class="s2">&#34;$DB_USER&#34;</span> <span class="o">-</span><span class="n">p</span><span class="s2">&#34;$DB_PASS&#34;</span> \
</span></span><span class="line"><span class="cl">            <span class="o">-</span><span class="n">e</span> <span class="s2">&#34;SELECT COUNT(*) FROM mysql.general_log WHERE argument REGEXP &#39;$pattern&#39; AND event_time &gt; DATE_SUB(NOW(), INTERVAL 1 HOUR);&#34;</span> \
</span></span><span class="line"><span class="cl">            <span class="o">-</span><span class="n">s</span> <span class="o">-</span><span class="n">N</span> <span class="mi">2</span><span class="o">&gt;/</span><span class="n">dev</span><span class="o">/</span><span class="n">null</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">[</span> <span class="s2">&#34;$count&#34;</span> <span class="o">-</span><span class="n">gt</span> <span class="mi">0</span> <span class="p">];</span> <span class="n">then</span>
</span></span><span class="line"><span class="cl">            <span class="n">alert_message</span><span class="o">=</span><span class="s2">&#34;SECURITY ALERT: $count suspicious queries detected with pattern: $pattern&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="n">log_message</span> <span class="s2">&#34;$alert_message&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="n">send_alert</span> <span class="s2">&#34;$alert_message&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="n">fi</span>
</span></span><span class="line"><span class="cl">    <span class="n">done</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Check for long-running queries</span>
</span></span><span class="line"><span class="cl"><span class="n">check_long_queries</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">log_message</span> <span class="s2">&#34;Checking for long-running queries...&#34;</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="n">long_queries</span><span class="o">=</span><span class="err">$</span><span class="p">(</span><span class="n">mysql</span> <span class="o">-</span><span class="n">h</span> <span class="s2">&#34;$DB_HOST&#34;</span> <span class="o">-</span><span class="n">P</span> <span class="s2">&#34;$DB_PORT&#34;</span> <span class="o">-</span><span class="n">u</span> <span class="s2">&#34;$DB_USER&#34;</span> <span class="o">-</span><span class="n">p</span><span class="s2">&#34;$DB_PASS&#34;</span> \
</span></span><span class="line"><span class="cl">        <span class="o">-</span><span class="n">e</span> <span class="s2">&#34;SELECT COUNT(*) FROM information_schema.processlist WHERE time &gt; $THRESHOLD_QUERY_TIME AND command != &#39;Sleep&#39;;&#34;</span> \
</span></span><span class="line"><span class="cl">        <span class="o">-</span><span class="n">s</span> <span class="o">-</span><span class="n">N</span> <span class="mi">2</span><span class="o">&gt;/</span><span class="n">dev</span><span class="o">/</span><span class="n">null</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">[</span> <span class="s2">&#34;$long_queries&#34;</span> <span class="o">-</span><span class="n">gt</span> <span class="mi">0</span> <span class="p">];</span> <span class="n">then</span>
</span></span><span class="line"><span class="cl">        <span class="n">alert_message</span><span class="o">=</span><span class="s2">&#34;PERFORMANCE ALERT: $long_queries queries running longer than $THRESHOLD_QUERY_TIME seconds&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="n">log_message</span> <span class="s2">&#34;$alert_message&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="n">send_alert</span> <span class="s2">&#34;$alert_message&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">fi</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Check database connections</span>
</span></span><span class="line"><span class="cl"><span class="n">check_connections</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">log_message</span> <span class="s2">&#34;Checking database connections...&#34;</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="n">max_connections</span><span class="o">=</span><span class="err">$</span><span class="p">(</span><span class="n">mysql</span> <span class="o">-</span><span class="n">h</span> <span class="s2">&#34;$DB_HOST&#34;</span> <span class="o">-</span><span class="n">P</span> <span class="s2">&#34;$DB_PORT&#34;</span> <span class="o">-</span><span class="n">u</span> <span class="s2">&#34;$DB_USER&#34;</span> <span class="o">-</span><span class="n">p</span><span class="s2">&#34;$DB_PASS&#34;</span> \
</span></span><span class="line"><span class="cl">        <span class="o">-</span><span class="n">e</span> <span class="s2">&#34;SHOW VARIABLES LIKE &#39;max_connections&#39;;&#34;</span> <span class="o">-</span><span class="n">s</span> <span class="o">-</span><span class="n">N</span> <span class="o">|</span> <span class="n">cut</span> <span class="o">-</span><span class="n">f2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="n">current_connections</span><span class="o">=</span><span class="err">$</span><span class="p">(</span><span class="n">mysql</span> <span class="o">-</span><span class="n">h</span> <span class="s2">&#34;$DB_HOST&#34;</span> <span class="o">-</span><span class="n">P</span> <span class="s2">&#34;$DB_PORT&#34;</span> <span class="o">-</span><span class="n">u</span> <span class="s2">&#34;$DB_USER&#34;</span> <span class="o">-</span><span class="n">p</span><span class="s2">&#34;$DB_PASS&#34;</span> \
</span></span><span class="line"><span class="cl">        <span class="o">-</span><span class="n">e</span> <span class="s2">&#34;SHOW STATUS LIKE &#39;Threads_connected&#39;;&#34;</span> <span class="o">-</span><span class="n">s</span> <span class="o">-</span><span class="n">N</span> <span class="o">|</span> <span class="n">cut</span> <span class="o">-</span><span class="n">f2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="n">connection_percentage</span><span class="o">=</span><span class="err">$</span><span class="p">((</span><span class="n">current_connections</span> <span class="o">*</span> <span class="mi">100</span> <span class="o">/</span> <span class="n">max_connections</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">[</span> <span class="s2">&#34;$connection_percentage&#34;</span> <span class="o">-</span><span class="n">gt</span> <span class="mi">80</span> <span class="p">];</span> <span class="n">then</span>
</span></span><span class="line"><span class="cl">        <span class="n">alert_message</span><span class="o">=</span><span class="s2">&#34;CONNECTION ALERT: Database connections at $connection_percentage</span><span class="si">% c</span><span class="s2">apacity ($current_connections/$max_connections)&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="n">log_message</span> <span class="s2">&#34;$alert_message&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="n">send_alert</span> <span class="s2">&#34;$alert_message&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">fi</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Check for privilege escalation attempts</span>
</span></span><span class="line"><span class="cl"><span class="n">check_privilege_escalation</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">log_message</span> <span class="s2">&#34;Checking for privilege escalation attempts...&#34;</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="n">privilege_changes</span><span class="o">=</span><span class="err">$</span><span class="p">(</span><span class="n">mysql</span> <span class="o">-</span><span class="n">h</span> <span class="s2">&#34;$DB_HOST&#34;</span> <span class="o">-</span><span class="n">P</span> <span class="s2">&#34;$DB_PORT&#34;</span> <span class="o">-</span><span class="n">u</span> <span class="s2">&#34;$DB_USER&#34;</span> <span class="o">-</span><span class="n">p</span><span class="s2">&#34;$DB_PASS&#34;</span> \
</span></span><span class="line"><span class="cl">        <span class="o">-</span><span class="n">e</span> <span class="s2">&#34;SELECT COUNT(*) FROM mysql.general_log WHERE argument REGEXP &#39;GRANT|REVOKE|CREATE USER|DROP USER&#39; AND event_time &gt; DATE_SUB(NOW(), INTERVAL 1 HOUR);&#34;</span> \
</span></span><span class="line"><span class="cl">        <span class="o">-</span><span class="n">s</span> <span class="o">-</span><span class="n">N</span> <span class="mi">2</span><span class="o">&gt;/</span><span class="n">dev</span><span class="o">/</span><span class="n">null</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">[</span> <span class="s2">&#34;$privilege_changes&#34;</span> <span class="o">-</span><span class="n">gt</span> <span class="mi">0</span> <span class="p">];</span> <span class="n">then</span>
</span></span><span class="line"><span class="cl">        <span class="n">alert_message</span><span class="o">=</span><span class="s2">&#34;SECURITY ALERT: $privilege_changes privilege changes detected in the last hour&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="n">log_message</span> <span class="s2">&#34;$alert_message&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="n">send_alert</span> <span class="s2">&#34;$alert_message&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">fi</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Send alert notification</span>
</span></span><span class="line"><span class="cl"><span class="n">send_alert</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">local</span> <span class="n">message</span><span class="o">=</span><span class="s2">&#34;$1&#34;</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1"># Send email alert</span>
</span></span><span class="line"><span class="cl">    <span class="n">echo</span> <span class="s2">&#34;$message&#34;</span> <span class="o">|</span> <span class="n">mail</span> <span class="o">-</span><span class="n">s</span> <span class="s2">&#34;Database Security Alert - $(hostname)&#34;</span> <span class="s2">&#34;$ALERT_EMAIL&#34;</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1"># Send to syslog</span>
</span></span><span class="line"><span class="cl">    <span class="n">logger</span> <span class="o">-</span><span class="n">p</span> <span class="n">local0</span><span class="o">.</span><span class="n">alert</span> <span class="s2">&#34;$message&#34;</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1"># Send to monitoring system (example: Prometheus Alertmanager)</span>
</span></span><span class="line"><span class="cl">    <span class="n">curl</span> <span class="o">-</span><span class="n">X</span> <span class="n">POST</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">alertmanager</span><span class="p">:</span><span class="mi">9093</span><span class="o">/</span><span class="n">api</span><span class="o">/</span><span class="n">v1</span><span class="o">/</span><span class="n">alerts</span> \
</span></span><span class="line"><span class="cl">        <span class="o">-</span><span class="n">H</span> <span class="s2">&#34;Content-Type: application/json&#34;</span> \
</span></span><span class="line"><span class="cl">        <span class="o">-</span><span class="n">d</span> <span class="s2">&#34;[{</span>
</span></span><span class="line"><span class="cl">            \<span class="s2">&#34;labels</span><span class="se">\&#34;</span><span class="s2">: {</span>
</span></span><span class="line"><span class="cl">                \<span class="s2">&#34;alertname</span><span class="se">\&#34;</span><span class="s2">: </span><span class="se">\&#34;</span><span class="s2">DatabaseSecurityAlert</span><span class="se">\&#34;</span><span class="s2">,</span>
</span></span><span class="line"><span class="cl">                \<span class="s2">&#34;severity</span><span class="se">\&#34;</span><span class="s2">: </span><span class="se">\&#34;</span><span class="s2">critical</span><span class="se">\&#34;</span><span class="s2">,</span>
</span></span><span class="line"><span class="cl">                \<span class="s2">&#34;instance</span><span class="se">\&#34;</span><span class="s2">: </span><span class="se">\&#34;</span><span class="s2">$(hostname)</span><span class="se">\&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="p">},</span>
</span></span><span class="line"><span class="cl">            \<span class="s2">&#34;annotations</span><span class="se">\&#34;</span><span class="s2">: {</span>
</span></span><span class="line"><span class="cl">                \<span class="s2">&#34;summary</span><span class="se">\&#34;</span><span class="s2">: </span><span class="se">\&#34;</span><span class="s2">$message</span><span class="se">\&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="p">}]</span><span class="s2">&#34; 2&gt;/dev/null</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Generate security report</span>
</span></span><span class="line"><span class="cl"><span class="n">generate_security_report</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">log_message</span> <span class="s2">&#34;Generating security report...&#34;</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="n">report_file</span><span class="o">=</span><span class="s2">&#34;/tmp/db_security_report_$(date +%Y%m</span><span class="si">%d</span><span class="s2">_%H%M%S).txt&#34;</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="n">cat</span> <span class="o">&gt;</span> <span class="s2">&#34;$report_file&#34;</span> <span class="o">&lt;&lt;</span> <span class="n">EOF</span>
</span></span><span class="line"><span class="cl"><span class="n">Database</span> <span class="n">Security</span> <span class="n">Report</span> <span class="o">-</span> <span class="err">$</span><span class="p">(</span><span class="n">date</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="o">=====================================</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">System</span> <span class="n">Information</span><span class="p">:</span>
</span></span><span class="line"><span class="cl"><span class="o">-</span> <span class="n">Database</span> <span class="n">Host</span><span class="p">:</span> <span class="err">$</span><span class="n">DB_HOST</span><span class="p">:</span><span class="err">$</span><span class="n">DB_PORT</span>
</span></span><span class="line"><span class="cl"><span class="o">-</span> <span class="n">Report</span> <span class="n">Generated</span><span class="p">:</span> <span class="err">$</span><span class="p">(</span><span class="n">date</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">Security</span> <span class="n">Metrics</span><span class="p">:</span>
</span></span><span class="line"><span class="cl"><span class="n">EOF</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1"># Add failed login statistics</span>
</span></span><span class="line"><span class="cl">    <span class="n">echo</span> <span class="s2">&#34;- Failed Logins (last 24h): $(mysql -h &#34;</span><span class="err">$</span><span class="n">DB_HOST</span><span class="s2">&#34; -P &#34;</span><span class="err">$</span><span class="n">DB_PORT</span><span class="s2">&#34; -u &#34;</span><span class="err">$</span><span class="n">DB_USER</span><span class="s2">&#34; -p&#34;</span><span class="err">$</span><span class="n">DB_PASS</span><span class="s2">&#34; </span><span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span><span class="s2">        -e &#34;</span><span class="n">SELECT</span> <span class="n">COUNT</span><span class="p">(</span><span class="o">*</span><span class="p">)</span> <span class="n">FROM</span> <span class="n">mysql</span><span class="o">.</span><span class="n">general_log</span> <span class="n">WHERE</span> <span class="n">command_type</span> <span class="o">=</span> <span class="s1">&#39;Connect&#39;</span> <span class="n">AND</span> <span class="n">argument</span> <span class="n">LIKE</span> <span class="s1">&#39;%Access denied%&#39;</span> <span class="n">AND</span> <span class="n">event_time</span> <span class="o">&gt;</span> <span class="n">DATE_SUB</span><span class="p">(</span><span class="n">NOW</span><span class="p">(),</span> <span class="n">INTERVAL</span> <span class="mi">24</span> <span class="n">HOUR</span><span class="p">);</span><span class="s2">&#34; </span><span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span><span class="s2">        -s -N 2&gt;/dev/null)&#34;</span> <span class="o">&gt;&gt;</span> <span class="s2">&#34;$report_file&#34;</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1"># Add connection statistics</span>
</span></span><span class="line"><span class="cl">    <span class="n">echo</span> <span class="s2">&#34;- Current Connections: $(mysql -h &#34;</span><span class="err">$</span><span class="n">DB_HOST</span><span class="s2">&#34; -P &#34;</span><span class="err">$</span><span class="n">DB_PORT</span><span class="s2">&#34; -u &#34;</span><span class="err">$</span><span class="n">DB_USER</span><span class="s2">&#34; -p&#34;</span><span class="err">$</span><span class="n">DB_PASS</span><span class="s2">&#34; </span><span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span><span class="s2">        -e &#34;</span><span class="n">SHOW</span> <span class="n">STATUS</span> <span class="n">LIKE</span> <span class="s1">&#39;Threads_connected&#39;</span><span class="p">;</span><span class="s2">&#34; -s -N | cut -f2)&#34;</span> <span class="o">&gt;&gt;</span> <span class="s2">&#34;$report_file&#34;</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1"># Add query statistics</span>
</span></span><span class="line"><span class="cl">    <span class="n">echo</span> <span class="s2">&#34;- Queries (last 24h): $(mysql -h &#34;</span><span class="err">$</span><span class="n">DB_HOST</span><span class="s2">&#34; -P &#34;</span><span class="err">$</span><span class="n">DB_PORT</span><span class="s2">&#34; -u &#34;</span><span class="err">$</span><span class="n">DB_USER</span><span class="s2">&#34; -p&#34;</span><span class="err">$</span><span class="n">DB_PASS</span><span class="s2">&#34; </span><span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span><span class="s2">        -e &#34;</span><span class="n">SELECT</span> <span class="n">COUNT</span><span class="p">(</span><span class="o">*</span><span class="p">)</span> <span class="n">FROM</span> <span class="n">mysql</span><span class="o">.</span><span class="n">general_log</span> <span class="n">WHERE</span> <span class="n">event_time</span> <span class="o">&gt;</span> <span class="n">DATE_SUB</span><span class="p">(</span><span class="n">NOW</span><span class="p">(),</span> <span class="n">INTERVAL</span> <span class="mi">24</span> <span class="n">HOUR</span><span class="p">);</span><span class="s2">&#34; </span><span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span><span class="s2">        -s -N 2&gt;/dev/null)&#34;</span> <span class="o">&gt;&gt;</span> <span class="s2">&#34;$report_file&#34;</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="n">log_message</span> <span class="s2">&#34;Security report generated: $report_file&#34;</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1"># Email the report</span>
</span></span><span class="line"><span class="cl">    <span class="n">mail</span> <span class="o">-</span><span class="n">s</span> <span class="s2">&#34;Daily Database Security Report - $(hostname)&#34;</span> <span class="s2">&#34;$ALERT_EMAIL&#34;</span> <span class="o">&lt;</span> <span class="s2">&#34;$report_file&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Main monitoring loop</span>
</span></span><span class="line"><span class="cl"><span class="n">main</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">log_message</span> <span class="s2">&#34;Starting database security monitoring...&#34;</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">while</span> <span class="n">true</span><span class="p">;</span> <span class="n">do</span>
</span></span><span class="line"><span class="cl">        <span class="n">check_failed_logins</span>
</span></span><span class="line"><span class="cl">        <span class="n">check_suspicious_queries</span>
</span></span><span class="line"><span class="cl">        <span class="n">check_long_queries</span>
</span></span><span class="line"><span class="cl">        <span class="n">check_connections</span>
</span></span><span class="line"><span class="cl">        <span class="n">check_privilege_escalation</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="c1"># Generate daily report at midnight</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">[</span> <span class="s2">&#34;$(date +%H%M)&#34;</span> <span class="o">=</span> <span class="s2">&#34;0000&#34;</span> <span class="p">];</span> <span class="n">then</span>
</span></span><span class="line"><span class="cl">            <span class="n">generate_security_report</span>
</span></span><span class="line"><span class="cl">        <span class="n">fi</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="c1"># Wait 5 minutes before next check</span>
</span></span><span class="line"><span class="cl">        <span class="n">sleep</span> <span class="mi">300</span>
</span></span><span class="line"><span class="cl">    <span class="n">done</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Run monitoring if script is executed directly</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="p">[</span> <span class="s2">&#34;$</span><span class="si">{BASH_SOURCE[0]}</span><span class="s2">&#34;</span> <span class="o">=</span> <span class="s2">&#34;$</span><span class="si">{0}</span><span class="s2">&#34;</span> <span class="p">];</span> <span class="n">then</span>
</span></span><span class="line"><span class="cl">    <span class="n">main</span> <span class="s2">&#34;$@&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">fi</span>
</span></span></code></pre></div><h2 id="compliance-and-governance">Compliance and Governance</h2>
<h3 id="1-compliance-framework-implementation">1. Compliance Framework Implementation</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Optional</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">dataclasses</span> <span class="kn">import</span> <span class="n">dataclass</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">enum</span> <span class="kn">import</span> <span class="n">Enum</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">json</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">re</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">timedelta</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">ComplianceStandard</span><span class="p">(</span><span class="n">Enum</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">GDPR</span> <span class="o">=</span> <span class="s2">&#34;gdpr&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">HIPAA</span> <span class="o">=</span> <span class="s2">&#34;hipaa&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">PCI_DSS</span> <span class="o">=</span> <span class="s2">&#34;pci_dss&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">SOX</span> <span class="o">=</span> <span class="s2">&#34;sox&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">ISO27001</span> <span class="o">=</span> <span class="s2">&#34;iso27001&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nd">@dataclass</span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">ComplianceRule</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">rule_id</span><span class="p">:</span> <span class="nb">str</span>
</span></span><span class="line"><span class="cl">    <span class="n">standard</span><span class="p">:</span> <span class="n">ComplianceStandard</span>
</span></span><span class="line"><span class="cl">    <span class="n">category</span><span class="p">:</span> <span class="nb">str</span>
</span></span><span class="line"><span class="cl">    <span class="n">description</span><span class="p">:</span> <span class="nb">str</span>
</span></span><span class="line"><span class="cl">    <span class="n">severity</span><span class="p">:</span> <span class="nb">str</span>
</span></span><span class="line"><span class="cl">    <span class="n">check_function</span><span class="p">:</span> <span class="nb">str</span>
</span></span><span class="line"><span class="cl">    <span class="n">remediation</span><span class="p">:</span> <span class="nb">str</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">DatabaseComplianceManager</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;&#34;&#34;Database compliance management and validation&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]):</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">config</span> <span class="o">=</span> <span class="n">config</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">compliance_rules</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_compliance_rules</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">scan_results</span> <span class="o">=</span> <span class="p">{}</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">_load_compliance_rules</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">ComplianceRule</span><span class="p">]:</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;&#34;&#34;Load compliance rules for different standards&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="n">rules</span> <span class="o">=</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="c1"># GDPR Rules</span>
</span></span><span class="line"><span class="cl">        <span class="n">rules</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span>
</span></span><span class="line"><span class="cl">            <span class="n">ComplianceRule</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">                <span class="n">rule_id</span><span class="o">=</span><span class="s2">&#34;GDPR-001&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="n">standard</span><span class="o">=</span><span class="n">ComplianceStandard</span><span class="o">.</span><span class="n">GDPR</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="n">category</span><span class="o">=</span><span class="s2">&#34;Data Protection&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="n">description</span><span class="o">=</span><span class="s2">&#34;Personal data must be encrypted at rest&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="n">severity</span><span class="o">=</span><span class="s2">&#34;high&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="n">check_function</span><span class="o">=</span><span class="s2">&#34;check_encryption_at_rest&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="n">remediation</span><span class="o">=</span><span class="s2">&#34;Enable transparent data encryption (TDE) or column-level encryption&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="p">),</span>
</span></span><span class="line"><span class="cl">            <span class="n">ComplianceRule</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">                <span class="n">rule_id</span><span class="o">=</span><span class="s2">&#34;GDPR-002&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="n">standard</span><span class="o">=</span><span class="n">ComplianceStandard</span><span class="o">.</span><span class="n">GDPR</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="n">category</span><span class="o">=</span><span class="s2">&#34;Access Control&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="n">description</span><span class="o">=</span><span class="s2">&#34;Access to personal data must be logged and auditable&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="n">severity</span><span class="o">=</span><span class="s2">&#34;high&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="n">check_function</span><span class="o">=</span><span class="s2">&#34;check_audit_logging&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="n">remediation</span><span class="o">=</span><span class="s2">&#34;Enable comprehensive audit logging for all data access&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="p">),</span>
</span></span><span class="line"><span class="cl">            <span class="n">ComplianceRule</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">                <span class="n">rule_id</span><span class="o">=</span><span class="s2">&#34;GDPR-003&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="n">standard</span><span class="o">=</span><span class="n">ComplianceStandard</span><span class="o">.</span><span class="n">GDPR</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="n">category</span><span class="o">=</span><span class="s2">&#34;Data Retention&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="n">description</span><span class="o">=</span><span class="s2">&#34;Personal data retention policies must be enforced&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="n">severity</span><span class="o">=</span><span class="s2">&#34;medium&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="n">check_function</span><span class="o">=</span><span class="s2">&#34;check_data_retention_policies&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="n">remediation</span><span class="o">=</span><span class="s2">&#34;Implement automated data retention and deletion policies&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="p">])</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="c1"># HIPAA Rules</span>
</span></span><span class="line"><span class="cl">        <span class="n">rules</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span>
</span></span><span class="line"><span class="cl">            <span class="n">ComplianceRule</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">                <span class="n">rule_id</span><span class="o">=</span><span class="s2">&#34;HIPAA-001&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="n">standard</span><span class="o">=</span><span class="n">ComplianceStandard</span><span class="o">.</span><span class="n">HIPAA</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="n">category</span><span class="o">=</span><span class="s2">&#34;Access Control&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="n">description</span><span class="o">=</span><span class="s2">&#34;Unique user identification required&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="n">severity</span><span class="o">=</span><span class="s2">&#34;high&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="n">check_function</span><span class="o">=</span><span class="s2">&#34;check_unique_user_identification&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="n">remediation</span><span class="o">=</span><span class="s2">&#34;Ensure each user has a unique identifier and disable shared accounts&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="p">),</span>
</span></span><span class="line"><span class="cl">            <span class="n">ComplianceRule</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">                <span class="n">rule_id</span><span class="o">=</span><span class="s2">&#34;HIPAA-002&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="n">standard</span><span class="o">=</span><span class="n">ComplianceStandard</span><span class="o">.</span><span class="n">HIPAA</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="n">category</span><span class="o">=</span><span class="s2">&#34;Audit Controls&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="n">description</span><span class="o">=</span><span class="s2">&#34;Audit logs must capture access to PHI&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="n">severity</span><span class="o">=</span><span class="s2">&#34;high&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="n">check_function</span><span class="o">=</span><span class="s2">&#34;check_phi_audit_logging&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="n">remediation</span><span class="o">=</span><span class="s2">&#34;Enable detailed audit logging for all PHI access&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="p">])</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="c1"># PCI DSS Rules</span>
</span></span><span class="line"><span class="cl">        <span class="n">rules</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span>
</span></span><span class="line"><span class="cl">            <span class="n">ComplianceRule</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">                <span class="n">rule_id</span><span class="o">=</span><span class="s2">&#34;PCI-001&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="n">standard</span><span class="o">=</span><span class="n">ComplianceStandard</span><span class="o">.</span><span class="n">PCI_DSS</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="n">category</span><span class="o">=</span><span class="s2">&#34;Data Protection&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="n">description</span><span class="o">=</span><span class="s2">&#34;Cardholder data must be encrypted&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="n">severity</span><span class="o">=</span><span class="s2">&#34;critical&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="n">check_function</span><span class="o">=</span><span class="s2">&#34;check_cardholder_data_encryption&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="n">remediation</span><span class="o">=</span><span class="s2">&#34;Encrypt all stored cardholder data using strong cryptography&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="p">),</span>
</span></span><span class="line"><span class="cl">            <span class="n">ComplianceRule</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">                <span class="n">rule_id</span><span class="o">=</span><span class="s2">&#34;PCI-002&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="n">standard</span><span class="o">=</span><span class="n">ComplianceStandard</span><span class="o">.</span><span class="n">PCI_DSS</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="n">category</span><span class="o">=</span><span class="s2">&#34;Access Control&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="n">description</span><span class="o">=</span><span class="s2">&#34;Restrict access to cardholder data by business need-to-know&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="n">severity</span><span class="o">=</span><span class="s2">&#34;high&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="n">check_function</span><span class="o">=</span><span class="s2">&#34;check_cardholder_data_access&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="n">remediation</span><span class="o">=</span><span class="s2">&#34;Implement role-based access control for cardholder data&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="p">])</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">rules</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">run_compliance_scan</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">standards</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">ComplianceStandard</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;&#34;&#34;Run comprehensive compliance scan&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="n">standards</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="n">standards</span> <span class="o">=</span> <span class="p">[</span><span class="n">standard</span> <span class="k">for</span> <span class="n">standard</span> <span class="ow">in</span> <span class="n">ComplianceStandard</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">            
</span></span><span class="line"><span class="cl">            <span class="n">scan_results</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="s1">&#39;scan_id&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&#34;scan_</span><span class="si">{</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y%m</span><span class="si">%d</span><span class="s1">_%H%M%S&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s1">&#39;timestamp&#39;</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">isoformat</span><span class="p">(),</span>
</span></span><span class="line"><span class="cl">                <span class="s1">&#39;standards_checked&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">s</span><span class="o">.</span><span class="n">value</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">standards</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">                <span class="s1">&#39;results&#39;</span><span class="p">:</span> <span class="p">{},</span>
</span></span><span class="line"><span class="cl">                <span class="s1">&#39;summary&#39;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                    <span class="s1">&#39;total_rules&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                    <span class="s1">&#39;passed&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                    <span class="s1">&#39;failed&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                    <span class="s1">&#39;warnings&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                    <span class="s1">&#39;compliance_score&#39;</span><span class="p">:</span> <span class="mi">0</span>
</span></span><span class="line"><span class="cl">                <span class="p">}</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">            
</span></span><span class="line"><span class="cl">            <span class="k">for</span> <span class="n">standard</span> <span class="ow">in</span> <span class="n">standards</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="n">standard_results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scan_standard</span><span class="p">(</span><span class="n">standard</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="n">scan_results</span><span class="p">[</span><span class="s1">&#39;results&#39;</span><span class="p">][</span><span class="n">standard</span><span class="o">.</span><span class="n">value</span><span class="p">]</span> <span class="o">=</span> <span class="n">standard_results</span>
</span></span><span class="line"><span class="cl">                
</span></span><span class="line"><span class="cl">                <span class="c1"># Update summary</span>
</span></span><span class="line"><span class="cl">                <span class="n">scan_results</span><span class="p">[</span><span class="s1">&#39;summary&#39;</span><span class="p">][</span><span class="s1">&#39;total_rules&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">standard_results</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="n">scan_results</span><span class="p">[</span><span class="s1">&#39;summary&#39;</span><span class="p">][</span><span class="s1">&#39;passed&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="nb">sum</span><span class="p">(</span><span class="mi">1</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">standard_results</span> <span class="k">if</span> <span class="n">r</span><span class="p">[</span><span class="s1">&#39;status&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;passed&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="n">scan_results</span><span class="p">[</span><span class="s1">&#39;summary&#39;</span><span class="p">][</span><span class="s1">&#39;failed&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="nb">sum</span><span class="p">(</span><span class="mi">1</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">standard_results</span> <span class="k">if</span> <span class="n">r</span><span class="p">[</span><span class="s1">&#39;status&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;failed&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="n">scan_results</span><span class="p">[</span><span class="s1">&#39;summary&#39;</span><span class="p">][</span><span class="s1">&#39;warnings&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="nb">sum</span><span class="p">(</span><span class="mi">1</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">standard_results</span> <span class="k">if</span> <span class="n">r</span><span class="p">[</span><span class="s1">&#39;status&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;warning&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            
</span></span><span class="line"><span class="cl">            <span class="c1"># Calculate compliance score</span>
</span></span><span class="line"><span class="cl">            <span class="n">total_rules</span> <span class="o">=</span> <span class="n">scan_results</span><span class="p">[</span><span class="s1">&#39;summary&#39;</span><span class="p">][</span><span class="s1">&#39;total_rules&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="n">total_rules</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="n">scan_results</span><span class="p">[</span><span class="s1">&#39;summary&#39;</span><span class="p">][</span><span class="s1">&#39;compliance_score&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">                    <span class="n">scan_results</span><span class="p">[</span><span class="s1">&#39;summary&#39;</span><span class="p">][</span><span class="s1">&#39;passed&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">total_rules</span> <span class="o">*</span> <span class="mi">100</span>
</span></span><span class="line"><span class="cl">                <span class="p">)</span>
</span></span><span class="line"><span class="cl">            
</span></span><span class="line"><span class="cl">            <span class="bp">self</span><span class="o">.</span><span class="n">scan_results</span> <span class="o">=</span> <span class="n">scan_results</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="n">scan_results</span>
</span></span><span class="line"><span class="cl">            
</span></span><span class="line"><span class="cl">        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;Compliance scan failed: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="p">{}</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">_scan_standard</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">standard</span><span class="p">:</span> <span class="n">ComplianceStandard</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;&#34;&#34;Scan for specific compliance standard&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="n">rule</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">compliance_rules</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="n">rule</span><span class="o">.</span><span class="n">standard</span> <span class="o">==</span> <span class="n">standard</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                    <span class="c1"># Execute check function</span>
</span></span><span class="line"><span class="cl">                    <span class="n">check_method</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rule</span><span class="o">.</span><span class="n">check_function</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                    <span class="k">if</span> <span class="n">check_method</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                        <span class="n">check_result</span> <span class="o">=</span> <span class="n">check_method</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">                        <span class="n">status</span> <span class="o">=</span> <span class="s1">&#39;passed&#39;</span> <span class="k">if</span> <span class="n">check_result</span> <span class="k">else</span> <span class="s1">&#39;failed&#39;</span>
</span></span><span class="line"><span class="cl">                    <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                        <span class="n">status</span> <span class="o">=</span> <span class="s1">&#39;warning&#39;</span>
</span></span><span class="line"><span class="cl">                        <span class="n">check_result</span> <span class="o">=</span> <span class="kc">False</span>
</span></span><span class="line"><span class="cl">                    
</span></span><span class="line"><span class="cl">                    <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">                        <span class="s1">&#39;rule_id&#39;</span><span class="p">:</span> <span class="n">rule</span><span class="o">.</span><span class="n">rule_id</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                        <span class="s1">&#39;description&#39;</span><span class="p">:</span> <span class="n">rule</span><span class="o">.</span><span class="n">description</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                        <span class="s1">&#39;category&#39;</span><span class="p">:</span> <span class="n">rule</span><span class="o">.</span><span class="n">category</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                        <span class="s1">&#39;severity&#39;</span><span class="p">:</span> <span class="n">rule</span><span class="o">.</span><span class="n">severity</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                        <span class="s1">&#39;status&#39;</span><span class="p">:</span> <span class="n">status</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                        <span class="s1">&#39;details&#39;</span><span class="p">:</span> <span class="n">check_result</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                        <span class="s1">&#39;remediation&#39;</span><span class="p">:</span> <span class="n">rule</span><span class="o">.</span><span class="n">remediation</span> <span class="k">if</span> <span class="n">status</span> <span class="o">==</span> <span class="s1">&#39;failed&#39;</span> <span class="k">else</span> <span class="kc">None</span>
</span></span><span class="line"><span class="cl">                    <span class="p">})</span>
</span></span><span class="line"><span class="cl">                    
</span></span><span class="line"><span class="cl">                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;Check failed for rule </span><span class="si">{</span><span class="n">rule</span><span class="o">.</span><span class="n">rule_id</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                    <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">                        <span class="s1">&#39;rule_id&#39;</span><span class="p">:</span> <span class="n">rule</span><span class="o">.</span><span class="n">rule_id</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                        <span class="s1">&#39;description&#39;</span><span class="p">:</span> <span class="n">rule</span><span class="o">.</span><span class="n">description</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                        <span class="s1">&#39;category&#39;</span><span class="p">:</span> <span class="n">rule</span><span class="o">.</span><span class="n">category</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                        <span class="s1">&#39;severity&#39;</span><span class="p">:</span> <span class="n">rule</span><span class="o">.</span><span class="n">severity</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                        <span class="s1">&#39;status&#39;</span><span class="p">:</span> <span class="s1">&#39;error&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                        <span class="s1">&#39;details&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">                        <span class="s1">&#39;remediation&#39;</span><span class="p">:</span> <span class="n">rule</span><span class="o">.</span><span class="n">remediation</span>
</span></span><span class="line"><span class="cl">                    <span class="p">})</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">results</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1"># Compliance check functions</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">check_encryption_at_rest</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;&#34;&#34;Check if data encryption at rest is enabled&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># Implementation depends on database type</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="kc">True</span>  <span class="c1"># Placeholder</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">check_audit_logging</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;&#34;&#34;Check if comprehensive audit logging is enabled&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># Implementation depends on database type</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="kc">True</span>  <span class="c1"># Placeholder</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">check_data_retention_policies</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;&#34;&#34;Check if data retention policies are implemented&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># Check for automated data retention mechanisms</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="kc">False</span>  <span class="c1"># Placeholder</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">check_unique_user_identification</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;&#34;&#34;Check for unique user identification&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># Verify no shared accounts exist</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="kc">True</span>  <span class="c1"># Placeholder</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">check_phi_audit_logging</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;&#34;&#34;Check PHI access audit logging&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># Verify PHI access is logged</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="kc">True</span>  <span class="c1"># Placeholder</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">check_cardholder_data_encryption</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;&#34;&#34;Check cardholder data encryption&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># Verify cardholder data is encrypted</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="kc">False</span>  <span class="c1"># Placeholder</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">check_cardholder_data_access</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;&#34;&#34;Check cardholder data access controls&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># Verify access controls for cardholder data</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="kc">True</span>  <span class="c1"># Placeholder</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">generate_compliance_report</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">output_format</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;json&#39;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;&#34;&#34;Generate compliance report&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">scan_results</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&#34;No scan results available. Run compliance scan first.&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="n">output_format</span> <span class="o">==</span> <span class="s1">&#39;json&#39;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scan_results</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            
</span></span><span class="line"><span class="cl">            <span class="k">elif</span> <span class="n">output_format</span> <span class="o">==</span> <span class="s1">&#39;html&#39;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generate_html_report</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">            
</span></span><span class="line"><span class="cl">            <span class="k">elif</span> <span class="n">output_format</span> <span class="o">==</span> <span class="s1">&#39;csv&#39;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generate_csv_report</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">            
</span></span><span class="line"><span class="cl">            <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;Unsupported output format: </span><span class="si">{</span><span class="n">output_format</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                
</span></span><span class="line"><span class="cl">        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;Report generation failed: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">_generate_html_report</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;&#34;&#34;Generate HTML compliance report&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="n">html_template</span> <span class="o">=</span> <span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">        &lt;!DOCTYPE html&gt;
</span></span></span><span class="line"><span class="cl"><span class="s2">        &lt;html&gt;
</span></span></span><span class="line"><span class="cl"><span class="s2">        &lt;head&gt;
</span></span></span><span class="line"><span class="cl"><span class="s2">            &lt;title&gt;Database Compliance Report&lt;/title&gt;
</span></span></span><span class="line"><span class="cl"><span class="s2">            &lt;style&gt;
</span></span></span><span class="line"><span class="cl"><span class="s2">                body { font-family: Arial, sans-serif; margin: 20px; }
</span></span></span><span class="line"><span class="cl"><span class="s2">                .header { background-color: #f0f0f0; padding: 20px; border-radius: 5px; }
</span></span></span><span class="line"><span class="cl"><span class="s2">                .summary { margin: 20px 0; }
</span></span></span><span class="line"><span class="cl"><span class="s2">                .standard { margin: 20px 0; border: 1px solid #ddd; border-radius: 5px; }
</span></span></span><span class="line"><span class="cl"><span class="s2">                .standard-header { background-color: #e0e0e0; padding: 10px; font-weight: bold; }
</span></span></span><span class="line"><span class="cl"><span class="s2">                .rule { padding: 10px; border-bottom: 1px solid #eee; }
</span></span></span><span class="line"><span class="cl"><span class="s2">                .passed { color: green; }
</span></span></span><span class="line"><span class="cl"><span class="s2">                .failed { color: red; }
</span></span></span><span class="line"><span class="cl"><span class="s2">                .warning { color: orange; }
</span></span></span><span class="line"><span class="cl"><span class="s2">                .error { color: purple; }
</span></span></span><span class="line"><span class="cl"><span class="s2">            &lt;/style&gt;
</span></span></span><span class="line"><span class="cl"><span class="s2">        &lt;/head&gt;
</span></span></span><span class="line"><span class="cl"><span class="s2">        &lt;body&gt;
</span></span></span><span class="line"><span class="cl"><span class="s2">            &lt;div class=&#34;header&#34;&gt;
</span></span></span><span class="line"><span class="cl"><span class="s2">                &lt;h1&gt;Database Compliance Report&lt;/h1&gt;
</span></span></span><span class="line"><span class="cl"><span class="s2">                &lt;p&gt;Generated: </span><span class="si">{timestamp}</span><span class="s2">&lt;/p&gt;
</span></span></span><span class="line"><span class="cl"><span class="s2">                &lt;p&gt;Scan ID: </span><span class="si">{scan_id}</span><span class="s2">&lt;/p&gt;
</span></span></span><span class="line"><span class="cl"><span class="s2">            &lt;/div&gt;
</span></span></span><span class="line"><span class="cl"><span class="s2">            
</span></span></span><span class="line"><span class="cl"><span class="s2">            &lt;div class=&#34;summary&#34;&gt;
</span></span></span><span class="line"><span class="cl"><span class="s2">                &lt;h2&gt;Summary&lt;/h2&gt;
</span></span></span><span class="line"><span class="cl"><span class="s2">                &lt;p&gt;Compliance Score: </span><span class="si">{compliance_score:.1f}</span><span class="s2">%&lt;/p&gt;
</span></span></span><span class="line"><span class="cl"><span class="s2">                &lt;p&gt;Total Rules: </span><span class="si">{total_rules}</span><span class="s2">&lt;/p&gt;
</span></span></span><span class="line"><span class="cl"><span class="s2">                &lt;p&gt;Passed: </span><span class="si">{passed}</span><span class="s2"> | Failed: </span><span class="si">{failed}</span><span class="s2"> | Warnings: </span><span class="si">{warnings}</span><span class="s2">&lt;/p&gt;
</span></span></span><span class="line"><span class="cl"><span class="s2">            &lt;/div&gt;
</span></span></span><span class="line"><span class="cl"><span class="s2">            
</span></span></span><span class="line"><span class="cl"><span class="s2">            </span><span class="si">{standards_content}</span><span class="s2">
</span></span></span><span class="line"><span class="cl"><span class="s2">        &lt;/body&gt;
</span></span></span><span class="line"><span class="cl"><span class="s2">        &lt;/html&gt;
</span></span></span><span class="line"><span class="cl"><span class="s2">        &#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="c1"># Generate content for each standard</span>
</span></span><span class="line"><span class="cl">        <span class="n">standards_content</span> <span class="o">=</span> <span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="n">standard</span><span class="p">,</span> <span class="n">results</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">scan_results</span><span class="p">[</span><span class="s1">&#39;results&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">            <span class="n">standards_content</span> <span class="o">+=</span> <span class="sa">f</span><span class="s1">&#39;&lt;div class=&#34;standard&#34;&gt;&#39;</span>
</span></span><span class="line"><span class="cl">            <span class="n">standards_content</span> <span class="o">+=</span> <span class="sa">f</span><span class="s1">&#39;&lt;div class=&#34;standard-header&#34;&gt;</span><span class="si">{</span><span class="n">standard</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="si">}</span><span class="s1">&lt;/div&gt;&#39;</span>
</span></span><span class="line"><span class="cl">            
</span></span><span class="line"><span class="cl">            <span class="k">for</span> <span class="n">rule</span> <span class="ow">in</span> <span class="n">results</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="n">status_class</span> <span class="o">=</span> <span class="n">rule</span><span class="p">[</span><span class="s1">&#39;status&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">                <span class="n">standards_content</span> <span class="o">+=</span> <span class="sa">f</span><span class="s1">&#39;&#39;&#39;
</span></span></span><span class="line"><span class="cl"><span class="s1">                &lt;div class=&#34;rule&#34;&gt;
</span></span></span><span class="line"><span class="cl"><span class="s1">                    &lt;strong class=&#34;</span><span class="si">{</span><span class="n">status_class</span><span class="si">}</span><span class="s1">&#34;&gt;[</span><span class="si">{</span><span class="n">rule</span><span class="p">[</span><span class="s1">&#39;status&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="si">}</span><span class="s1">]&lt;/strong&gt;
</span></span></span><span class="line"><span class="cl"><span class="s1">                    </span><span class="si">{</span><span class="n">rule</span><span class="p">[</span><span class="s1">&#39;rule_id&#39;</span><span class="p">]</span><span class="si">}</span><span class="s1">: </span><span class="si">{</span><span class="n">rule</span><span class="p">[</span><span class="s1">&#39;description&#39;</span><span class="p">]</span><span class="si">}</span><span class="s1">
</span></span></span><span class="line"><span class="cl"><span class="s1">                    </span><span class="si">{</span><span class="sa">f</span><span class="s2">&#34;&lt;br&gt;&lt;em&gt;Remediation: </span><span class="si">{</span><span class="n">rule</span><span class="p">[</span><span class="s1">&#39;remediation&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&lt;/em&gt;&#34;</span> <span class="k">if</span> <span class="n">rule</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;remediation&#39;</span><span class="p">)</span> <span class="k">else</span> <span class="s2">&#34;&#34;</span><span class="si">}</span><span class="s1">
</span></span></span><span class="line"><span class="cl"><span class="s1">                &lt;/div&gt;
</span></span></span><span class="line"><span class="cl"><span class="s1">                &#39;&#39;&#39;</span>
</span></span><span class="line"><span class="cl">            
</span></span><span class="line"><span class="cl">            <span class="n">standards_content</span> <span class="o">+=</span> <span class="s1">&#39;&lt;/div&gt;&#39;</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">html_template</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">            <span class="n">timestamp</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">scan_results</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">            <span class="n">scan_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">scan_results</span><span class="p">[</span><span class="s1">&#39;scan_id&#39;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">            <span class="n">compliance_score</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">scan_results</span><span class="p">[</span><span class="s1">&#39;summary&#39;</span><span class="p">][</span><span class="s1">&#39;compliance_score&#39;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">            <span class="n">total_rules</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">scan_results</span><span class="p">[</span><span class="s1">&#39;summary&#39;</span><span class="p">][</span><span class="s1">&#39;total_rules&#39;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">            <span class="n">passed</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">scan_results</span><span class="p">[</span><span class="s1">&#39;summary&#39;</span><span class="p">][</span><span class="s1">&#39;passed&#39;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">            <span class="n">failed</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">scan_results</span><span class="p">[</span><span class="s1">&#39;summary&#39;</span><span class="p">][</span><span class="s1">&#39;failed&#39;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">            <span class="n">warnings</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">scan_results</span><span class="p">[</span><span class="s1">&#39;summary&#39;</span><span class="p">][</span><span class="s1">&#39;warnings&#39;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">            <span class="n">standards_content</span><span class="o">=</span><span class="n">standards_content</span>
</span></span><span class="line"><span class="cl">        <span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">## Security Testing and Validation</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">### 1. Automated Security Testing</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="err">```</span><span class="n">python</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">subprocess</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">socket</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">ssl</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">requests</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Tuple</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">time</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">random</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">string</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">DatabaseSecurityTester</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;&#34;&#34;Automated database security testing framework&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]):</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">config</span> <span class="o">=</span> <span class="n">config</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">test_results</span> <span class="o">=</span> <span class="p">{}</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">run_security_tests</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;&#34;&#34;Run comprehensive security test suite&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">test_results</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="s1">&#39;test_id&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&#34;test_</span><span class="si">{</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y%m</span><span class="si">%d</span><span class="s1">_%H%M%S&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s1">&#39;timestamp&#39;</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">isoformat</span><span class="p">(),</span>
</span></span><span class="line"><span class="cl">                <span class="s1">&#39;tests&#39;</span><span class="p">:</span> <span class="p">{},</span>
</span></span><span class="line"><span class="cl">                <span class="s1">&#39;summary&#39;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                    <span class="s1">&#39;total_tests&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                    <span class="s1">&#39;passed&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                    <span class="s1">&#39;failed&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                    <span class="s1">&#39;security_score&#39;</span><span class="p">:</span> <span class="mi">0</span>
</span></span><span class="line"><span class="cl">                <span class="p">}</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">            
</span></span><span class="line"><span class="cl">            <span class="c1"># Run different test categories</span>
</span></span><span class="line"><span class="cl">            <span class="n">test_categories</span> <span class="o">=</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">                <span class="p">(</span><span class="s1">&#39;authentication&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">test_authentication_security</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">                <span class="p">(</span><span class="s1">&#39;authorization&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">test_authorization_controls</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">                <span class="p">(</span><span class="s1">&#39;encryption&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">test_encryption_implementation</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">                <span class="p">(</span><span class="s1">&#39;injection&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">test_sql_injection_protection</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">                <span class="p">(</span><span class="s1">&#39;network&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">test_network_security</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">                <span class="p">(</span><span class="s1">&#39;configuration&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">test_security_configuration</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="p">]</span>
</span></span><span class="line"><span class="cl">            
</span></span><span class="line"><span class="cl">            <span class="k">for</span> <span class="n">category</span><span class="p">,</span> <span class="n">test_function</span> <span class="ow">in</span> <span class="n">test_categories</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="n">category_results</span> <span class="o">=</span> <span class="n">test_function</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">                <span class="n">test_results</span><span class="p">[</span><span class="s1">&#39;tests&#39;</span><span class="p">][</span><span class="n">category</span><span class="p">]</span> <span class="o">=</span> <span class="n">category_results</span>
</span></span><span class="line"><span class="cl">                
</span></span><span class="line"><span class="cl">                <span class="c1"># Update summary</span>
</span></span><span class="line"><span class="cl">                <span class="n">test_results</span><span class="p">[</span><span class="s1">&#39;summary&#39;</span><span class="p">][</span><span class="s1">&#39;total_tests&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">category_results</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="n">test_results</span><span class="p">[</span><span class="s1">&#39;summary&#39;</span><span class="p">][</span><span class="s1">&#39;passed&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="nb">sum</span><span class="p">(</span><span class="mi">1</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">category_results</span> <span class="k">if</span> <span class="n">r</span><span class="p">[</span><span class="s1">&#39;status&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;passed&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="n">test_results</span><span class="p">[</span><span class="s1">&#39;summary&#39;</span><span class="p">][</span><span class="s1">&#39;failed&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="nb">sum</span><span class="p">(</span><span class="mi">1</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">category_results</span> <span class="k">if</span> <span class="n">r</span><span class="p">[</span><span class="s1">&#39;status&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;failed&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            
</span></span><span class="line"><span class="cl">            <span class="c1"># Calculate security score</span>
</span></span><span class="line"><span class="cl">            <span class="n">total_tests</span> <span class="o">=</span> <span class="n">test_results</span><span class="p">[</span><span class="s1">&#39;summary&#39;</span><span class="p">][</span><span class="s1">&#39;total_tests&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="n">total_tests</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="n">test_results</span><span class="p">[</span><span class="s1">&#39;summary&#39;</span><span class="p">][</span><span class="s1">&#39;security_score&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">                    <span class="n">test_results</span><span class="p">[</span><span class="s1">&#39;summary&#39;</span><span class="p">][</span><span class="s1">&#39;passed&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">total_tests</span> <span class="o">*</span> <span class="mi">100</span>
</span></span><span class="line"><span class="cl">                <span class="p">)</span>
</span></span><span class="line"><span class="cl">            
</span></span><span class="line"><span class="cl">            <span class="bp">self</span><span class="o">.</span><span class="n">test_results</span> <span class="o">=</span> <span class="n">test_results</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="n">test_results</span>
</span></span><span class="line"><span class="cl">            
</span></span><span class="line"><span class="cl">        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;Security testing failed: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="p">{}</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">test_authentication_security</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;&#34;&#34;Test authentication security controls&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="n">tests</span> <span class="o">=</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="c1"># Test 1: Weak password policy</span>
</span></span><span class="line"><span class="cl">        <span class="n">tests</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_test_weak_passwords</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="c1"># Test 2: Account lockout policy</span>
</span></span><span class="line"><span class="cl">        <span class="n">tests</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_test_account_lockout</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="c1"># Test 3: Multi-factor authentication</span>
</span></span><span class="line"><span class="cl">        <span class="n">tests</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_test_mfa_enforcement</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="c1"># Test 4: Session management</span>
</span></span><span class="line"><span class="cl">        <span class="n">tests</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_test_session_security</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">tests</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">test_authorization_controls</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;&#34;&#34;Test authorization and access controls&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="n">tests</span> <span class="o">=</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="c1"># Test 1: Privilege escalation</span>
</span></span><span class="line"><span class="cl">        <span class="n">tests</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_test_privilege_escalation</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="c1"># Test 2: Role-based access control</span>
</span></span><span class="line"><span class="cl">        <span class="n">tests</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_test_rbac_implementation</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="c1"># Test 3: Data access controls</span>
</span></span><span class="line"><span class="cl">        <span class="n">tests</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_test_data_access_controls</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">tests</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">test_encryption_implementation</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;&#34;&#34;Test encryption implementation&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="n">tests</span> <span class="o">=</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="c1"># Test 1: Data at rest encryption</span>
</span></span><span class="line"><span class="cl">        <span class="n">tests</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_test_encryption_at_rest</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="c1"># Test 2: Data in transit encryption</span>
</span></span><span class="line"><span class="cl">        <span class="n">tests</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_test_encryption_in_transit</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="c1"># Test 3: Key management</span>
</span></span><span class="line"><span class="cl">        <span class="n">tests</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_test_key_management</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">tests</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">test_sql_injection_protection</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;&#34;&#34;Test SQL injection protection&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="n">tests</span> <span class="o">=</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="c1"># Test various SQL injection patterns</span>
</span></span><span class="line"><span class="cl">        <span class="n">injection_patterns</span> <span class="o">=</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;&#39; OR &#39;1&#39;=&#39;1&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;&#39;; DROP TABLE users; --&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;&#39; UNION SELECT * FROM information_schema.tables --&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;&#39; AND 1=1 --&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;admin&#39;--&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;&#39; OR 1=1#&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="p">]</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="n">pattern</span> <span class="ow">in</span> <span class="n">injection_patterns</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">tests</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_test_sql_injection_pattern</span><span class="p">(</span><span class="n">pattern</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">tests</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">test_network_security</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;&#34;&#34;Test network security controls&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="n">tests</span> <span class="o">=</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="c1"># Test 1: SSL/TLS configuration</span>
</span></span><span class="line"><span class="cl">        <span class="n">tests</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_test_ssl_configuration</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="c1"># Test 2: Port security</span>
</span></span><span class="line"><span class="cl">        <span class="n">tests</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_test_port_security</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="c1"># Test 3: Firewall rules</span>
</span></span><span class="line"><span class="cl">        <span class="n">tests</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_test_firewall_rules</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">tests</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">test_security_configuration</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;&#34;&#34;Test security configuration&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="n">tests</span> <span class="o">=</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="c1"># Test 1: Default accounts</span>
</span></span><span class="line"><span class="cl">        <span class="n">tests</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_test_default_accounts</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="c1"># Test 2: Security parameters</span>
</span></span><span class="line"><span class="cl">        <span class="n">tests</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_test_security_parameters</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="c1"># Test 3: Audit configuration</span>
</span></span><span class="line"><span class="cl">        <span class="n">tests</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_test_audit_configuration</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">tests</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">_test_weak_passwords</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;&#34;&#34;Test for weak password policies&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="c1"># Attempt to create user with weak password</span>
</span></span><span class="line"><span class="cl">            <span class="n">weak_passwords</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;123456&#39;</span><span class="p">,</span> <span class="s1">&#39;password&#39;</span><span class="p">,</span> <span class="s1">&#39;admin&#39;</span><span class="p">,</span> <span class="s1">&#39;test&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">            
</span></span><span class="line"><span class="cl">            <span class="k">for</span> <span class="n">password</span> <span class="ow">in</span> <span class="n">weak_passwords</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="c1"># Test password creation (implementation depends on database)</span>
</span></span><span class="line"><span class="cl">                <span class="c1"># This is a simulation</span>
</span></span><span class="line"><span class="cl">                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">password</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">8</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                    <span class="k">return</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                        <span class="s1">&#39;test_name&#39;</span><span class="p">:</span> <span class="s1">&#39;Weak Password Policy&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                        <span class="s1">&#39;status&#39;</span><span class="p">:</span> <span class="s1">&#39;failed&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                        <span class="s1">&#39;details&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;Weak password &#34;</span><span class="si">{</span><span class="n">password</span><span class="si">}</span><span class="s1">&#34; was accepted&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                        <span class="s1">&#39;recommendation&#39;</span><span class="p">:</span> <span class="s1">&#39;Implement strong password policy with minimum length, complexity requirements&#39;</span>
</span></span><span class="line"><span class="cl">                    <span class="p">}</span>
</span></span><span class="line"><span class="cl">            
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="s1">&#39;test_name&#39;</span><span class="p">:</span> <span class="s1">&#39;Weak Password Policy&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s1">&#39;status&#39;</span><span class="p">:</span> <span class="s1">&#39;passed&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s1">&#39;details&#39;</span><span class="p">:</span> <span class="s1">&#39;Strong password policy is enforced&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s1">&#39;recommendation&#39;</span><span class="p">:</span> <span class="kc">None</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">            
</span></span><span class="line"><span class="cl">        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="s1">&#39;test_name&#39;</span><span class="p">:</span> <span class="s1">&#39;Weak Password Policy&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s1">&#39;status&#39;</span><span class="p">:</span> <span class="s1">&#39;error&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s1">&#39;details&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">                <span class="s1">&#39;recommendation&#39;</span><span class="p">:</span> <span class="s1">&#39;Review password policy configuration&#39;</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">_test_account_lockout</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;&#34;&#34;Test account lockout policy&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="c1"># Simulate multiple failed login attempts</span>
</span></span><span class="line"><span class="cl">            <span class="c1"># Implementation depends on database and authentication system</span>
</span></span><span class="line"><span class="cl">            
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="s1">&#39;test_name&#39;</span><span class="p">:</span> <span class="s1">&#39;Account Lockout Policy&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s1">&#39;status&#39;</span><span class="p">:</span> <span class="s1">&#39;passed&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s1">&#39;details&#39;</span><span class="p">:</span> <span class="s1">&#39;Account lockout policy is properly configured&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s1">&#39;recommendation&#39;</span><span class="p">:</span> <span class="kc">None</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">            
</span></span><span class="line"><span class="cl">        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="s1">&#39;test_name&#39;</span><span class="p">:</span> <span class="s1">&#39;Account Lockout Policy&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s1">&#39;status&#39;</span><span class="p">:</span> <span class="s1">&#39;error&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s1">&#39;details&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">                <span class="s1">&#39;recommendation&#39;</span><span class="p">:</span> <span class="s1">&#39;Configure account lockout after failed attempts&#39;</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">_test_mfa_enforcement</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;&#34;&#34;Test multi-factor authentication enforcement&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="c1"># Check if MFA is enforced for privileged accounts</span>
</span></span><span class="line"><span class="cl">            <span class="c1"># Implementation depends on authentication system</span>
</span></span><span class="line"><span class="cl">            
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="s1">&#39;test_name&#39;</span><span class="p">:</span> <span class="s1">&#39;Multi-Factor Authentication&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s1">&#39;status&#39;</span><span class="p">:</span> <span class="s1">&#39;warning&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s1">&#39;details&#39;</span><span class="p">:</span> <span class="s1">&#39;MFA enforcement could not be verified&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s1">&#39;recommendation&#39;</span><span class="p">:</span> <span class="s1">&#39;Implement MFA for all privileged accounts&#39;</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">            
</span></span><span class="line"><span class="cl">        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="s1">&#39;test_name&#39;</span><span class="p">:</span> <span class="s1">&#39;Multi-Factor Authentication&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s1">&#39;status&#39;</span><span class="p">:</span> <span class="s1">&#39;error&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s1">&#39;details&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">                <span class="s1">&#39;recommendation&#39;</span><span class="p">:</span> <span class="s1">&#39;Review MFA configuration&#39;</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">_test_session_security</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;&#34;&#34;Test session security controls&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="c1"># Test session timeout, secure cookies, etc.</span>
</span></span><span class="line"><span class="cl">            <span class="c1"># Implementation depends on application framework</span>
</span></span><span class="line"><span class="cl">            
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="s1">&#39;test_name&#39;</span><span class="p">:</span> <span class="s1">&#39;Session Security&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s1">&#39;status&#39;</span><span class="p">:</span> <span class="s1">&#39;passed&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s1">&#39;details&#39;</span><span class="p">:</span> <span class="s1">&#39;Session security controls are properly implemented&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s1">&#39;recommendation&#39;</span><span class="p">:</span> <span class="kc">None</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">            
</span></span><span class="line"><span class="cl">        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="s1">&#39;test_name&#39;</span><span class="p">:</span> <span class="s1">&#39;Session Security&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s1">&#39;status&#39;</span><span class="p">:</span> <span class="s1">&#39;error&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s1">&#39;details&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">                <span class="s1">&#39;recommendation&#39;</span><span class="p">:</span> <span class="s1">&#39;Review session management configuration&#39;</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">_test_privilege_escalation</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;&#34;&#34;Test for privilege escalation vulnerabilities&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="c1"># Test various privilege escalation scenarios</span>
</span></span><span class="line"><span class="cl">            <span class="c1"># Implementation depends on database type and configuration</span>
</span></span><span class="line"><span class="cl">            
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="s1">&#39;test_name&#39;</span><span class="p">:</span> <span class="s1">&#39;Privilege Escalation&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s1">&#39;status&#39;</span><span class="p">:</span> <span class="s1">&#39;passed&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s1">&#39;details&#39;</span><span class="p">:</span> <span class="s1">&#39;No privilege escalation vulnerabilities detected&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s1">&#39;recommendation&#39;</span><span class="p">:</span> <span class="kc">None</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">            
</span></span><span class="line"><span class="cl">        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="s1">&#39;test_name&#39;</span><span class="p">:</span> <span class="s1">&#39;Privilege Escalation&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s1">&#39;status&#39;</span><span class="p">:</span> <span class="s1">&#39;error&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s1">&#39;details&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">                <span class="s1">&#39;recommendation&#39;</span><span class="p">:</span> <span class="s1">&#39;Review user privileges and access controls&#39;</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">_test_rbac_implementation</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;&#34;&#34;Test role-based access control implementation&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="c1"># Verify RBAC is properly implemented</span>
</span></span><span class="line"><span class="cl">            <span class="c1"># Check role assignments, permissions, etc.</span>
</span></span><span class="line"><span class="cl">            
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="s1">&#39;test_name&#39;</span><span class="p">:</span> <span class="s1">&#39;Role-Based Access Control&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s1">&#39;status&#39;</span><span class="p">:</span> <span class="s1">&#39;passed&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s1">&#39;details&#39;</span><span class="p">:</span> <span class="s1">&#39;RBAC is properly implemented&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s1">&#39;recommendation&#39;</span><span class="p">:</span> <span class="kc">None</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">            
</span></span><span class="line"><span class="cl">        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="s1">&#39;test_name&#39;</span><span class="p">:</span> <span class="s1">&#39;Role-Based Access Control&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s1">&#39;status&#39;</span><span class="p">:</span> <span class="s1">&#39;error&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s1">&#39;details&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">                <span class="s1">&#39;recommendation&#39;</span><span class="p">:</span> <span class="s1">&#39;Implement proper RBAC system&#39;</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">_test_data_access_controls</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;&#34;&#34;Test data access controls&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="c1"># Test row-level security, column-level security, etc.</span>
</span></span><span class="line"><span class="cl">            <span class="c1"># Implementation depends on database features</span>
</span></span><span class="line"><span class="cl">            
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="s1">&#39;test_name&#39;</span><span class="p">:</span> <span class="s1">&#39;Data Access Controls&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s1">&#39;status&#39;</span><span class="p">:</span> <span class="s1">&#39;warning&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s1">&#39;details&#39;</span><span class="p">:</span> <span class="s1">&#39;Data access controls need review&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s1">&#39;recommendation&#39;</span><span class="p">:</span> <span class="s1">&#39;Implement row-level and column-level security&#39;</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">            
</span></span><span class="line"><span class="cl">        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="s1">&#39;test_name&#39;</span><span class="p">:</span> <span class="s1">&#39;Data Access Controls&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s1">&#39;status&#39;</span><span class="p">:</span> <span class="s1">&#39;error&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s1">&#39;details&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">                <span class="s1">&#39;recommendation&#39;</span><span class="p">:</span> <span class="s1">&#39;Review data access control implementation&#39;</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">_test_encryption_at_rest</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;&#34;&#34;Test encryption at rest&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="c1"># Check if data is encrypted at rest</span>
</span></span><span class="line"><span class="cl">            <span class="c1"># Implementation depends on database and storage configuration</span>
</span></span><span class="line"><span class="cl">            
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="s1">&#39;test_name&#39;</span><span class="p">:</span> <span class="s1">&#39;Encryption at Rest&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s1">&#39;status&#39;</span><span class="p">:</span> <span class="s1">&#39;passed&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s1">&#39;details&#39;</span><span class="p">:</span> <span class="s1">&#39;Data encryption at rest is enabled&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s1">&#39;recommendation&#39;</span><span class="p">:</span> <span class="kc">None</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">            
</span></span><span class="line"><span class="cl">        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="s1">&#39;test_name&#39;</span><span class="p">:</span> <span class="s1">&#39;Encryption at Rest&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s1">&#39;status&#39;</span><span class="p">:</span> <span class="s1">&#39;error&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s1">&#39;details&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">                <span class="s1">&#39;recommendation&#39;</span><span class="p">:</span> <span class="s1">&#39;Enable transparent data encryption (TDE)&#39;</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">_test_encryption_in_transit</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;&#34;&#34;Test encryption in transit&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="c1"># Check SSL/TLS configuration</span>
</span></span><span class="line"><span class="cl">            <span class="n">host</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;host&#39;</span><span class="p">,</span> <span class="s1">&#39;localhost&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="n">port</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;port&#39;</span><span class="p">,</span> <span class="mi">3306</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            
</span></span><span class="line"><span class="cl">            <span class="c1"># Test SSL connection</span>
</span></span><span class="line"><span class="cl">            <span class="n">context</span> <span class="o">=</span> <span class="n">ssl</span><span class="o">.</span><span class="n">create_default_context</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">            <span class="k">with</span> <span class="n">socket</span><span class="o">.</span><span class="n">create_connection</span><span class="p">((</span><span class="n">host</span><span class="p">,</span> <span class="n">port</span><span class="p">),</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span> <span class="k">as</span> <span class="n">sock</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="k">with</span> <span class="n">context</span><span class="o">.</span><span class="n">wrap_socket</span><span class="p">(</span><span class="n">sock</span><span class="p">,</span> <span class="n">server_hostname</span><span class="o">=</span><span class="n">host</span><span class="p">)</span> <span class="k">as</span> <span class="n">ssock</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                    <span class="n">cipher</span> <span class="o">=</span> <span class="n">ssock</span><span class="o">.</span><span class="n">cipher</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">                    <span class="k">if</span> <span class="n">cipher</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                        <span class="k">return</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                            <span class="s1">&#39;test_name&#39;</span><span class="p">:</span> <span class="s1">&#39;Encryption in Transit&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                            <span class="s1">&#39;status&#39;</span><span class="p">:</span> <span class="s1">&#39;passed&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                            <span class="s1">&#39;details&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;SSL/TLS enabled with cipher: </span><span class="si">{</span><span class="n">cipher</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                            <span class="s1">&#39;recommendation&#39;</span><span class="p">:</span> <span class="kc">None</span>
</span></span><span class="line"><span class="cl">                        <span class="p">}</span>
</span></span><span class="line"><span class="cl">            
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="s1">&#39;test_name&#39;</span><span class="p">:</span> <span class="s1">&#39;Encryption in Transit&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s1">&#39;status&#39;</span><span class="p">:</span> <span class="s1">&#39;failed&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s1">&#39;details&#39;</span><span class="p">:</span> <span class="s1">&#39;SSL/TLS not properly configured&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s1">&#39;recommendation&#39;</span><span class="p">:</span> <span class="s1">&#39;Enable SSL/TLS for all database connections&#39;</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">            
</span></span><span class="line"><span class="cl">        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="s1">&#39;test_name&#39;</span><span class="p">:</span> <span class="s1">&#39;Encryption in Transit&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s1">&#39;status&#39;</span><span class="p">:</span> <span class="s1">&#39;error&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s1">&#39;details&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">                <span class="s1">&#39;recommendation&#39;</span><span class="p">:</span> <span class="s1">&#39;Configure SSL/TLS for database connections&#39;</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">_test_key_management</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;&#34;&#34;Test key management practices&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="c1"># Test key rotation, storage, access controls</span>
</span></span><span class="line"><span class="cl">            <span class="c1"># Implementation depends on key management system</span>
</span></span><span class="line"><span class="cl">            
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="s1">&#39;test_name&#39;</span><span class="p">:</span> <span class="s1">&#39;Key Management&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s1">&#39;status&#39;</span><span class="p">:</span> <span class="s1">&#39;warning&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s1">&#39;details&#39;</span><span class="p">:</span> <span class="s1">&#39;Key management practices need review&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s1">&#39;recommendation&#39;</span><span class="p">:</span> <span class="s1">&#39;Implement proper key management with rotation and secure storage&#39;</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">            
</span></span><span class="line"><span class="cl">        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="s1">&#39;test_name&#39;</span><span class="p">:</span> <span class="s1">&#39;Key Management&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s1">&#39;status&#39;</span><span class="p">:</span> <span class="s1">&#39;error&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s1">&#39;details&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">                <span class="s1">&#39;recommendation&#39;</span><span class="p">:</span> <span class="s1">&#39;Review key management implementation&#39;</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">_test_sql_injection_pattern</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pattern</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;&#34;&#34;Test specific SQL injection pattern&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="c1"># Test SQL injection pattern</span>
</span></span><span class="line"><span class="cl">            <span class="c1"># This would typically involve sending the pattern to the application</span>
</span></span><span class="line"><span class="cl">            <span class="c1"># and checking if it&#39;s properly sanitized</span>
</span></span><span class="line"><span class="cl">            
</span></span><span class="line"><span class="cl">            <span class="n">test_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&#34;SQL Injection: </span><span class="si">{</span><span class="n">pattern</span><span class="p">[:</span><span class="mi">20</span><span class="p">]</span><span class="si">}</span><span class="s2">...&#34;</span>
</span></span><span class="line"><span class="cl">            
</span></span><span class="line"><span class="cl">            <span class="c1"># Simulate testing (in real implementation, this would test actual endpoints)</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="s2">&#34;DROP&#34;</span> <span class="ow">in</span> <span class="n">pattern</span><span class="o">.</span><span class="n">upper</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">                <span class="k">return</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                    <span class="s1">&#39;test_name&#39;</span><span class="p">:</span> <span class="n">test_name</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                    <span class="s1">&#39;status&#39;</span><span class="p">:</span> <span class="s1">&#39;passed&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                    <span class="s1">&#39;details&#39;</span><span class="p">:</span> <span class="s1">&#39;SQL injection attempt was blocked&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                    <span class="s1">&#39;recommendation&#39;</span><span class="p">:</span> <span class="kc">None</span>
</span></span><span class="line"><span class="cl">                <span class="p">}</span>
</span></span><span class="line"><span class="cl">            
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="s1">&#39;test_name&#39;</span><span class="p">:</span> <span class="n">test_name</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s1">&#39;status&#39;</span><span class="p">:</span> <span class="s1">&#39;passed&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s1">&#39;details&#39;</span><span class="p">:</span> <span class="s1">&#39;SQL injection protection is working&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s1">&#39;recommendation&#39;</span><span class="p">:</span> <span class="kc">None</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">            
</span></span><span class="line"><span class="cl">        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="s1">&#39;test_name&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&#34;SQL Injection: </span><span class="si">{</span><span class="n">pattern</span><span class="p">[:</span><span class="mi">20</span><span class="p">]</span><span class="si">}</span><span class="s2">...&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s1">&#39;status&#39;</span><span class="p">:</span> <span class="s1">&#39;error&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s1">&#39;details&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">                <span class="s1">&#39;recommendation&#39;</span><span class="p">:</span> <span class="s1">&#39;Implement proper input validation and parameterized queries&#39;</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">_test_ssl_configuration</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;&#34;&#34;Test SSL/TLS configuration&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="c1"># Test SSL configuration strength</span>
</span></span><span class="line"><span class="cl">            <span class="n">host</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;host&#39;</span><span class="p">,</span> <span class="s1">&#39;localhost&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="n">port</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ssl_port&#39;</span><span class="p">,</span> <span class="mi">443</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            
</span></span><span class="line"><span class="cl">            <span class="n">context</span> <span class="o">=</span> <span class="n">ssl</span><span class="o">.</span><span class="n">create_default_context</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">            <span class="k">with</span> <span class="n">socket</span><span class="o">.</span><span class="n">create_connection</span><span class="p">((</span><span class="n">host</span><span class="p">,</span> <span class="n">port</span><span class="p">),</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span> <span class="k">as</span> <span class="n">sock</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="k">with</span> <span class="n">context</span><span class="o">.</span><span class="n">wrap_socket</span><span class="p">(</span><span class="n">sock</span><span class="p">,</span> <span class="n">server_hostname</span><span class="o">=</span><span class="n">host</span><span class="p">)</span> <span class="k">as</span> <span class="n">ssock</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                    <span class="n">protocol</span> <span class="o">=</span> <span class="n">ssock</span><span class="o">.</span><span class="n">version</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">                    <span class="n">cipher</span> <span class="o">=</span> <span class="n">ssock</span><span class="o">.</span><span class="n">cipher</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">                    
</span></span><span class="line"><span class="cl">                    <span class="c1"># Check for strong protocols and ciphers</span>
</span></span><span class="line"><span class="cl">                    <span class="k">if</span> <span class="n">protocol</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;TLSv1.2&#39;</span><span class="p">,</span> <span class="s1">&#39;TLSv1.3&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="n">cipher</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                        <span class="k">return</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                            <span class="s1">&#39;test_name&#39;</span><span class="p">:</span> <span class="s1">&#39;SSL/TLS Configuration&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                            <span class="s1">&#39;status&#39;</span><span class="p">:</span> <span class="s1">&#39;passed&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                            <span class="s1">&#39;details&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;Strong SSL/TLS configuration: </span><span class="si">{</span><span class="n">protocol</span><span class="si">}</span><span class="s1">, </span><span class="si">{</span><span class="n">cipher</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                            <span class="s1">&#39;recommendation&#39;</span><span class="p">:</span> <span class="kc">None</span>
</span></span><span class="line"><span class="cl">                        <span class="p">}</span>
</span></span><span class="line"><span class="cl">                    <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                        <span class="k">return</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                            <span class="s1">&#39;test_name&#39;</span><span class="p">:</span> <span class="s1">&#39;SSL/TLS Configuration&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                            <span class="s1">&#39;status&#39;</span><span class="p">:</span> <span class="s1">&#39;failed&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                            <span class="s1">&#39;details&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;Weak SSL/TLS configuration: </span><span class="si">{</span><span class="n">protocol</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                            <span class="s1">&#39;recommendation&#39;</span><span class="p">:</span> <span class="s1">&#39;Upgrade to TLS 1.2 or higher with strong ciphers&#39;</span>
</span></span><span class="line"><span class="cl">                        <span class="p">}</span>
</span></span><span class="line"><span class="cl">            
</span></span><span class="line"><span class="cl">        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="s1">&#39;test_name&#39;</span><span class="p">:</span> <span class="s1">&#39;SSL/TLS Configuration&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s1">&#39;status&#39;</span><span class="p">:</span> <span class="s1">&#39;error&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s1">&#39;details&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">                <span class="s1">&#39;recommendation&#39;</span><span class="p">:</span> <span class="s1">&#39;Configure SSL/TLS properly&#39;</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">_test_port_security</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;&#34;&#34;Test port security&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="c1"># Test for unnecessary open ports</span>
</span></span><span class="line"><span class="cl">            <span class="n">host</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;host&#39;</span><span class="p">,</span> <span class="s1">&#39;localhost&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="n">common_ports</span> <span class="o">=</span> <span class="p">[</span><span class="mi">22</span><span class="p">,</span> <span class="mi">23</span><span class="p">,</span> <span class="mi">80</span><span class="p">,</span> <span class="mi">443</span><span class="p">,</span> <span class="mi">3306</span><span class="p">,</span> <span class="mi">5432</span><span class="p">,</span> <span class="mi">1521</span><span class="p">,</span> <span class="mi">1433</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">            
</span></span><span class="line"><span class="cl">            <span class="n">open_ports</span> <span class="o">=</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl">            <span class="k">for</span> <span class="n">port</span> <span class="ow">in</span> <span class="n">common_ports</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="n">sock</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">socket</span><span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">AF_INET</span><span class="p">,</span> <span class="n">socket</span><span class="o">.</span><span class="n">SOCK_STREAM</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="n">sock</span><span class="o">.</span><span class="n">settimeout</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="n">result</span> <span class="o">=</span> <span class="n">sock</span><span class="o">.</span><span class="n">connect_ex</span><span class="p">((</span><span class="n">host</span><span class="p">,</span> <span class="n">port</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                <span class="k">if</span> <span class="n">result</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                    <span class="n">open_ports</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">port</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="n">sock</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">            
</span></span><span class="line"><span class="cl">            <span class="c1"># Check if only necessary ports are open</span>
</span></span><span class="line"><span class="cl">            <span class="n">necessary_ports</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;necessary_ports&#39;</span><span class="p">,</span> <span class="p">[])</span>
</span></span><span class="line"><span class="cl">            <span class="n">unnecessary_ports</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">open_ports</span> <span class="k">if</span> <span class="n">p</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">necessary_ports</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">            
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="n">unnecessary_ports</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="k">return</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                    <span class="s1">&#39;test_name&#39;</span><span class="p">:</span> <span class="s1">&#39;Port Security&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                    <span class="s1">&#39;status&#39;</span><span class="p">:</span> <span class="s1">&#39;warning&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                    <span class="s1">&#39;details&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;Unnecessary ports open: </span><span class="si">{</span><span class="n">unnecessary_ports</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                    <span class="s1">&#39;recommendation&#39;</span><span class="p">:</span> <span class="s1">&#39;Close unnecessary ports and use firewall rules&#39;</span>
</span></span><span class="line"><span class="cl">                <span class="p">}</span>
</span></span><span class="line"><span class="cl">            <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="k">return</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                    <span class="s1">&#39;test_name&#39;</span><span class="p">:</span> <span class="s1">&#39;Port Security&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                    <span class="s1">&#39;status&#39;</span><span class="p">:</span> <span class="s1">&#39;passed&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                    <span class="s1">&#39;details&#39;</span><span class="p">:</span> <span class="s1">&#39;Only necessary ports are open&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                    <span class="s1">&#39;recommendation&#39;</span><span class="p">:</span> <span class="kc">None</span>
</span></span><span class="line"><span class="cl">                <span class="p">}</span>
</span></span><span class="line"><span class="cl">            
</span></span><span class="line"><span class="cl">        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="s1">&#39;test_name&#39;</span><span class="p">:</span> <span class="s1">&#39;Port Security&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s1">&#39;status&#39;</span><span class="p">:</span> <span class="s1">&#39;error&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s1">&#39;details&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">                <span class="s1">&#39;recommendation&#39;</span><span class="p">:</span> <span class="s1">&#39;Review port configuration and firewall rules&#39;</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">_test_firewall_rules</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;&#34;&#34;Test firewall rules&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="c1"># Test firewall configuration</span>
</span></span><span class="line"><span class="cl">            <span class="c1"># This would typically involve checking iptables, ufw, or cloud security groups</span>
</span></span><span class="line"><span class="cl">            
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="s1">&#39;test_name&#39;</span><span class="p">:</span> <span class="s1">&#39;Firewall Rules&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s1">&#39;status&#39;</span><span class="p">:</span> <span class="s1">&#39;warning&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s1">&#39;details&#39;</span><span class="p">:</span> <span class="s1">&#39;Firewall configuration needs manual review&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s1">&#39;recommendation&#39;</span><span class="p">:</span> <span class="s1">&#39;Ensure proper firewall rules are in place&#39;</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">            
</span></span><span class="line"><span class="cl">        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="s1">&#39;test_name&#39;</span><span class="p">:</span> <span class="s1">&#39;Firewall Rules&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s1">&#39;status&#39;</span><span class="p">:</span> <span class="s1">&#39;error&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s1">&#39;details&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">                <span class="s1">&#39;recommendation&#39;</span><span class="p">:</span> <span class="s1">&#39;Configure proper firewall rules&#39;</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">_test_default_accounts</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;&#34;&#34;Test for default accounts&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="c1"># Check for default database accounts</span>
</span></span><span class="line"><span class="cl">            <span class="n">default_accounts</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;root&#39;</span><span class="p">,</span> <span class="s1">&#39;admin&#39;</span><span class="p">,</span> <span class="s1">&#39;sa&#39;</span><span class="p">,</span> <span class="s1">&#39;postgres&#39;</span><span class="p">,</span> <span class="s1">&#39;mysql&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">            
</span></span><span class="line"><span class="cl">            <span class="c1"># This would typically query the database for user accounts</span>
</span></span><span class="line"><span class="cl">            <span class="c1"># Implementation depends on database type</span>
</span></span><span class="line"><span class="cl">            
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="s1">&#39;test_name&#39;</span><span class="p">:</span> <span class="s1">&#39;Default Accounts&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s1">&#39;status&#39;</span><span class="p">:</span> <span class="s1">&#39;passed&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s1">&#39;details&#39;</span><span class="p">:</span> <span class="s1">&#39;No default accounts with default passwords found&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s1">&#39;recommendation&#39;</span><span class="p">:</span> <span class="kc">None</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">            
</span></span><span class="line"><span class="cl">        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="s1">&#39;test_name&#39;</span><span class="p">:</span> <span class="s1">&#39;Default Accounts&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s1">&#39;status&#39;</span><span class="p">:</span> <span class="s1">&#39;error&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s1">&#39;details&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">                <span class="s1">&#39;recommendation&#39;</span><span class="p">:</span> <span class="s1">&#39;Remove or secure default accounts&#39;</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">_test_security_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;&#34;&#34;Test security parameters&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="c1"># Check database security parameters</span>
</span></span><span class="line"><span class="cl">            <span class="c1"># Implementation depends on database type</span>
</span></span><span class="line"><span class="cl">            
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="s1">&#39;test_name&#39;</span><span class="p">:</span> <span class="s1">&#39;Security Parameters&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s1">&#39;status&#39;</span><span class="p">:</span> <span class="s1">&#39;warning&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s1">&#39;details&#39;</span><span class="p">:</span> <span class="s1">&#39;Security parameters need review&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s1">&#39;recommendation&#39;</span><span class="p">:</span> <span class="s1">&#39;Review and harden database security parameters&#39;</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">            
</span></span><span class="line"><span class="cl">        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="s1">&#39;test_name&#39;</span><span class="p">:</span> <span class="s1">&#39;Security Parameters&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s1">&#39;status&#39;</span><span class="p">:</span> <span class="s1">&#39;error&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s1">&#39;details&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">                <span class="s1">&#39;recommendation&#39;</span><span class="p">:</span> <span class="s1">&#39;Configure security parameters properly&#39;</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">_test_audit_configuration</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;&#34;&#34;Test audit configuration&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="c1"># Check audit logging configuration</span>
</span></span><span class="line"><span class="cl">            <span class="c1"># Implementation depends on database type</span>
</span></span><span class="line"><span class="cl">            
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="s1">&#39;test_name&#39;</span><span class="p">:</span> <span class="s1">&#39;Audit Configuration&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s1">&#39;status&#39;</span><span class="p">:</span> <span class="s1">&#39;passed&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s1">&#39;details&#39;</span><span class="p">:</span> <span class="s1">&#39;Audit logging is properly configured&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s1">&#39;recommendation&#39;</span><span class="p">:</span> <span class="kc">None</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">            
</span></span><span class="line"><span class="cl">        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="s1">&#39;test_name&#39;</span><span class="p">:</span> <span class="s1">&#39;Audit Configuration&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s1">&#39;status&#39;</span><span class="p">:</span> <span class="s1">&#39;error&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s1">&#39;details&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">                <span class="s1">&#39;recommendation&#39;</span><span class="p">:</span> <span class="s1">&#39;Configure comprehensive audit logging&#39;</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Example usage</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="n">config</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;host&#39;</span><span class="p">:</span> <span class="s1">&#39;localhost&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;port&#39;</span><span class="p">:</span> <span class="mi">3306</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;ssl_port&#39;</span><span class="p">:</span> <span class="mi">443</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;necessary_ports&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">22</span><span class="p">,</span> <span class="mi">3306</span><span class="p">,</span> <span class="mi">443</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;database_type&#39;</span><span class="p">:</span> <span class="s1">&#39;mysql&#39;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1"># Initialize security tester</span>
</span></span><span class="line"><span class="cl">    <span class="n">security_tester</span> <span class="o">=</span> <span class="n">DatabaseSecurityTester</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1"># Run security tests</span>
</span></span><span class="line"><span class="cl">    <span class="n">test_results</span> <span class="o">=</span> <span class="n">security_tester</span><span class="o">.</span><span class="n">run_security_tests</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;Database Security Test Results:&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;Security Score: </span><span class="si">{</span><span class="n">test_results</span><span class="p">[</span><span class="s1">&#39;summary&#39;</span><span class="p">][</span><span class="s1">&#39;security_score&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">%&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;Tests Passed: </span><span class="si">{</span><span class="n">test_results</span><span class="p">[</span><span class="s1">&#39;summary&#39;</span><span class="p">][</span><span class="s1">&#39;passed&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;Tests Failed: </span><span class="si">{</span><span class="n">test_results</span><span class="p">[</span><span class="s1">&#39;summary&#39;</span><span class="p">][</span><span class="s1">&#39;failed&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1"># Initialize compliance manager</span>
</span></span><span class="line"><span class="cl">    <span class="n">compliance_manager</span> <span class="o">=</span> <span class="n">DatabaseComplianceManager</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1"># Run compliance scan</span>
</span></span><span class="line"><span class="cl">    <span class="n">compliance_results</span> <span class="o">=</span> <span class="n">compliance_manager</span><span class="o">.</span><span class="n">run_compliance_scan</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;</span><span class="se">\n</span><span class="s2">Compliance Scan Results:&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;Compliance Score: </span><span class="si">{</span><span class="n">compliance_results</span><span class="p">[</span><span class="s1">&#39;summary&#39;</span><span class="p">][</span><span class="s1">&#39;compliance_score&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">%&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;Rules Passed: </span><span class="si">{</span><span class="n">compliance_results</span><span class="p">[</span><span class="s1">&#39;summary&#39;</span><span class="p">][</span><span class="s1">&#39;passed&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;Rules Failed: </span><span class="si">{</span><span class="n">compliance_results</span><span class="p">[</span><span class="s1">&#39;summary&#39;</span><span class="p">][</span><span class="s1">&#39;failed&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1"># Generate reports</span>
</span></span><span class="line"><span class="cl">    <span class="n">security_report</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">test_results</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">compliance_report</span> <span class="o">=</span> <span class="n">compliance_manager</span><span class="o">.</span><span class="n">generate_compliance_report</span><span class="p">(</span><span class="s1">&#39;html&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;</span><span class="se">\n</span><span class="s2">Reports generated successfully!&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&#34;__main__&#34;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">main</span><span class="p">()</span>
</span></span></code></pre></div><h2 id="summary">Summary</h2>
<p>This comprehensive database security and access control guide covers essential aspects of protecting database systems in modern environments. The implementation includes:</p>
<h3 id="core-security-elements">Core Security Elements</h3>
<ol>
<li>
<p><strong>Multi-Layer Security Architecture</strong>: Comprehensive security model covering application, authentication, authorization, network, database, storage, and physical layers.</p>
</li>
<li>
<p><strong>Authentication and Authorization</strong>: Advanced multi-factor authentication system with TOTP, LDAP integration, risk-based authentication, and comprehensive RBAC implementation.</p>
</li>
<li>
<p><strong>Data Encryption</strong>: Complete encryption management system supporting multiple algorithms, key rotation, column-level encryption, and format-preserving encryption.</p>
</li>
<li>
<p><strong>Access Control Implementation</strong>: Database-level and application-level access controls with row-level security, security definer functions, session management, and rate limiting.</p>
</li>
<li>
<p><strong>Auditing and Monitoring</strong>: Comprehensive audit system with real-time monitoring, automated triggers, security event detection, and alert generation.</p>
</li>
<li>
<p><strong>Compliance and Governance</strong>: Framework supporting GDPR, HIPAA, PCI DSS, SOX, and ISO27001 with automated compliance scanning and reporting.</p>
</li>
<li>
<p><strong>Security Testing and Validation</strong>: Automated security testing framework covering authentication, authorization, encryption, injection protection, network security, and configuration validation.</p>
</li>
</ol>
<h3 id="best-practices">Best Practices</h3>
<ol>
<li><strong>Defense in Depth</strong>: Implement multiple layers of security controls</li>
<li><strong>Principle of Least Privilege</strong>: Grant minimum necessary access rights</li>
<li><strong>Regular Security Assessments</strong>: Conduct periodic security scans and compliance checks</li>
<li><strong>Continuous Monitoring</strong>: Implement real-time security monitoring and alerting</li>
<li><strong>Incident Response</strong>: Maintain documented incident response procedures</li>
<li><strong>Security Training</strong>: Provide regular security awareness training</li>
<li><strong>Documentation</strong>: Maintain comprehensive security documentation and procedures</li>
</ol>
<p>This guide provides a solid foundation for implementing robust database security measures that protect sensitive data while maintaining compliance with industry standards and regulations.</p>

            </div>

            
            

            
            

            
            
            <div class="mt-12 pt-8 border-t border-gray-200">
                <h3 class="text-lg font-semibold text-gray-900 mb-4">
                    æ ‡ç­¾
                </h3>
                <div class="flex flex-wrap gap-2">
                    
                    <a href="/tags/database"
                        class="inline-block px-3 py-1 text-sm text-gray-600 bg-gray-100 rounded-full hover:bg-primary-100 hover:text-primary-700 transition-colors duration-200">
                        #Database
                    </a>
                    
                    <a href="/tags/security"
                        class="inline-block px-3 py-1 text-sm text-gray-600 bg-gray-100 rounded-full hover:bg-primary-100 hover:text-primary-700 transition-colors duration-200">
                        #Security
                    </a>
                    
                    <a href="/tags/access-control"
                        class="inline-block px-3 py-1 text-sm text-gray-600 bg-gray-100 rounded-full hover:bg-primary-100 hover:text-primary-700 transition-colors duration-200">
                        #Access Control
                    </a>
                    
                    <a href="/tags/authentication"
                        class="inline-block px-3 py-1 text-sm text-gray-600 bg-gray-100 rounded-full hover:bg-primary-100 hover:text-primary-700 transition-colors duration-200">
                        #Authentication
                    </a>
                    
                    <a href="/tags/authorization"
                        class="inline-block px-3 py-1 text-sm text-gray-600 bg-gray-100 rounded-full hover:bg-primary-100 hover:text-primary-700 transition-colors duration-200">
                        #Authorization
                    </a>
                    
                    <a href="/tags/encryption"
                        class="inline-block px-3 py-1 text-sm text-gray-600 bg-gray-100 rounded-full hover:bg-primary-100 hover:text-primary-700 transition-colors duration-200">
                        #Encryption
                    </a>
                    
                </div>
            </div>
            

            
            <div class="mt-8 pt-8 border-t border-gray-200">
                <h3 class="text-lg font-semibold text-gray-900 mb-4">
                    åˆ†äº«æ–‡ç« 
                </h3>
                <div class="flex flex-wrap gap-4">
                    
                    <a href="https://x.com/intent/tweet?url=https%3a%2f%2fwww.dishuihengxin.com%2fposts%2fdatabase-security-access-control%2f&amp;text=Database%20Security%20and%20Access%20Control%3a%20A%20Comprehensive%20Guide%20to%20Protecting%20Your%20Data"
                        target="_blank" rel="noopener noreferrer"
                        class="inline-flex items-center px-4 py-2 bg-black text-white rounded-lg hover:bg-gray-800 transition-colors duration-200">
                        <svg class="w-4 h-4 mr-2" fill="currentColor" viewBox="0 0 24 24">
                            <path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/>
                        </svg>
                        X
                    </a>

                    
                    <a href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fwww.dishuihengxin.com%2fposts%2fdatabase-security-access-control%2f" target="_blank"
                        rel="noopener noreferrer"
                        class="inline-flex items-center px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors duration-200">
                        <svg class="w-4 h-4 mr-2" fill="currentColor" viewBox="0 0 24 24">
                            <path
                                d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z" />
                        </svg>
                        Facebook
                    </a>

                    
                    <a href="https://www.linkedin.com/sharing/share-offsite/?url=https%3a%2f%2fwww.dishuihengxin.com%2fposts%2fdatabase-security-access-control%2f" target="_blank"
                        rel="noopener noreferrer"
                        class="inline-flex items-center px-4 py-2 bg-blue-700 text-white rounded-lg hover:bg-blue-800 transition-colors duration-200">
                        <svg class="w-4 h-4 mr-2" fill="currentColor" viewBox="0 0 24 24">
                            <path
                                d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z" />
                        </svg>
                        LinkedIn
                    </a>

                    
                    <button onclick="copyToClipboard('https:\/\/www.dishuihengxin.com\/posts\/database-security-access-control\/')"
                        class="inline-flex items-center px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-colors duration-200">
                        <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z">
                            </path>
                        </svg>
                        å¤åˆ¶é“¾æ¥
                    </button>
                </div>
            </div>

            
            <div class="mt-12 pt-8 border-t border-gray-200 dark:border-gray-700">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    
                    <a href="/posts/database-elasticsearch-optimization/"
                        class="group flex items-center p-6 bg-gray-50 dark:bg-gray-800 rounded-xl hover:bg-gray-100 dark:hover:bg-gray-700 transition-all duration-200">
                        <div class="flex-shrink-0 mr-4">
                            <svg class="w-6 h-6 text-gray-400 group-hover:text-purple-600 transition-colors" fill="none"
                                stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M15 19l-7-7 7-7">
                                </path>
                            </svg>
                        </div>
                        <div class="flex-1 min-w-0">
                            <div class="text-sm text-gray-500 dark:text-gray-400 mb-1">
                                ä¸Šä¸€ç¯‡
                            </div>
                            <div
                                class="font-semibold text-gray-900 dark:text-white truncate group-hover:text-purple-600 transition-colors">
                                Elasticsearchæœç´¢å¼•æ“ä¼˜åŒ–ï¼šä»ç´¢å¼•è®¾è®¡åˆ°æŸ¥è¯¢æ€§èƒ½è°ƒä¼˜çš„å®Œæ•´æŒ‡å—
                            </div>
                        </div>
                    </a>
                    

                    
                    <a href="/posts/database-performance-optimization/"
                        class="group flex items-center p-6 bg-gray-50 dark:bg-gray-800 rounded-xl hover:bg-gray-100 dark:hover:bg-gray-700 transition-all duration-200 ">
                        <div class="flex-1 min-w-0 text-right">
                            <div class="text-sm text-gray-500 dark:text-gray-400 mb-1">
                                ä¸‹ä¸€ç¯‡
                            </div>
                            <div
                                class="font-semibold text-gray-900 dark:text-white truncate group-hover:text-purple-600 transition-colors">
                                Database Performance Optimization Strategies: From Query Tuning to System Architecture
                            </div>
                        </div>
                        <div class="flex-shrink-0 ml-4">
                            <svg class="w-6 h-6 text-gray-400 group-hover:text-purple-600 transition-colors" fill="none"
                                stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7">
                                </path>
                            </svg>
                        </div>
                    </a>
                    
                </div>
            </div>

        </article>

        
        <aside class="w-full lg:w-[320px]">
            <div class="sticky top-24 space-y-6">
                
                
                <div class="bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6">
                    <h3
                        class="text-lg font-semibold text-gray-900 dark:text-white mb-4 pb-4 border-b border-gray-200 dark:border-gray-700 flex items-center gap-2">
                        <svg class="w-5 h-5 text-purple-600 dark:text-purple-400" fill="none" stroke="currentColor"
                            viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01">
                            </path>
                        </svg>
                        å†…å®¹å¯¼èˆª
                    </h3>
                    <div id="toc-content" class="toc text-sm space-y-1">
                        <nav id="TableOfContents">
  <ul>
    <li><a href="#table-of-contents">Table of Contents</a></li>
    <li><a href="#security-architecture-overview">Security Architecture Overview</a>
      <ul>
        <li><a href="#1-multi-layer-security-model">1. Multi-Layer Security Model</a></li>
        <li><a href="#2-security-configuration-framework">2. Security Configuration Framework</a></li>
      </ul>
    </li>
    <li><a href="#authentication-and-authorization">Authentication and Authorization</a>
      <ul>
        <li><a href="#1-multi-factor-authentication-system">1. Multi-Factor Authentication System</a></li>
        <li><a href="#2-role-based-access-control-rbac-system">2. Role-Based Access Control (RBAC) System</a></li>
      </ul>
    </li>
    <li><a href="#data-encryption">Data Encryption</a>
      <ul>
        <li><a href="#1-comprehensive-encryption-manager">1. Comprehensive Encryption Manager</a></li>
      </ul>
    </li>
    <li><a href="#access-control-implementation">Access Control Implementation</a>
      <ul>
        <li><a href="#1-database-level-access-control">1. Database-Level Access Control</a></li>
      </ul>
    </li>
    <li><a href="#compliance-and-governance">Compliance and Governance</a>
      <ul>
        <li><a href="#1-compliance-framework-implementation">1. Compliance Framework Implementation</a></li>
      </ul>
    </li>
    <li><a href="#summary">Summary</a>
      <ul>
        <li><a href="#core-security-elements">Core Security Elements</a></li>
        <li><a href="#best-practices">Best Practices</a></li>
      </ul>
    </li>
  </ul>
</nav>
                    </div>
                    <div class="mt-4 pt-4 border-t border-gray-200 dark:border-gray-700">
                        <div class="flex items-center justify-between text-xs text-gray-500 dark:text-gray-400 mb-2">
                            <span>é˜…è¯»è¿›åº¦</span>
                            <span id="reading-progress-text">0%</span>
                        </div>
                        <div class="w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2">
                            <div id="reading-progress-bar"
                                class="bg-gradient-to-r from-purple-500 to-pink-500 h-2 rounded-full transition-all duration-300 progress-bar-width-0">
                            </div>
                        </div>
                    </div>
                </div>
                

                
                
                
                <div class="bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6">
                    <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">
                        ç›¸å…³æ¨è
                    </h3>
                    <div class="space-y-4">
                        
                        <article class="group">
                            <a href="/posts/database-performance-optimization/" class="block">
                                
                                <h4
                                    class="font-semibold text-gray-900 dark:text-white group-hover:text-purple-600 dark:group-hover:text-purple-400 transition-colors line-clamp-2 mb-2">
                                    Database Performance Optimization Strategies: From Query Tuning to System Architecture
                                </h4>
                                <div class="flex items-center text-xs text-gray-500 dark:text-gray-400">
                                    <svg class="w-3 h-3 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z">
                                        </path>
                                    </svg>
                                    <time datetime="2025-12-31">
                                        2025-12-31
                                    </time>
                                </div>
                            </a>
                        </article>
                        
                    </div>
                </div>
                

                
                
            </div>
        </aside>
    </div>
</div>


<script>
    
    function copyToClipboard(text) {
        navigator.clipboard.writeText(text).then(function () {
            const button = event.target.closest('button');
            const originalText = button.innerHTML;
            button.innerHTML = `
            <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
            </svg>
            å·²å¤åˆ¶
        `;
            setTimeout(() => {
                button.innerHTML = originalText;
            }, 2000);
        });
    }

    
    document.addEventListener('DOMContentLoaded', function () {
        const progressBar = document.getElementById('reading-progress-bar');
        const progressText = document.getElementById('reading-progress-text');
        const tocLinks = document.querySelectorAll('#toc-content a');
        const headings = Array.from(document.querySelectorAll('article h1, article h2, article h3, article h4, article h5, article h6'));

        
        function updateReadingProgress() {
            const windowHeight = window.innerHeight;
            const documentHeight = document.documentElement.scrollHeight - windowHeight;
            const scrolled = window.scrollY;
            const progress = documentHeight > 0 ? (scrolled / documentHeight) * 100 : 0;

            if (progressBar) {
                progressBar.style.width = progress + '%';
            }
            if (progressText) {
                progressText.textContent = Math.round(progress) + '%';
            }

            
            
            let activeHeading = null;
            const readingLine = 150; 

            for (let i = 0; i < headings.length; i++) {
                const heading = headings[i];
                const rect = heading.getBoundingClientRect();

                
                if (rect.top <= readingLine) {
                    activeHeading = heading;
                } else {
                    
                    break;
                }
            }

            
            const activeId = activeHeading ? activeHeading.id : null;
            const currentActiveLink = document.querySelector('#toc-content a.active-toc-item');
            const currentActiveId = currentActiveLink ? currentActiveLink.getAttribute('href').substring(1) : null;

            if (activeId !== currentActiveId) {
                
                tocLinks.forEach(link => {
                    link.classList.remove('active-toc-item');

                    const href = link.getAttribute('href');
                    if (activeId && href === '#' + activeId) {
                        link.classList.add('active-toc-item');

                        
                        const tocContainer = document.getElementById('toc-content');
                        if (tocContainer) {
                            const linkRect = link.getBoundingClientRect();
                            const containerRect = tocContainer.getBoundingClientRect();

                            
                            if (linkRect.top < containerRect.top + 20 || linkRect.bottom > containerRect.bottom - 20) {
                                
                                link.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
                            }
                        }
                    }
                });
            }
        }

        let isScrolling = false;
        window.addEventListener('scroll', () => {
            if (!isScrolling) {
                window.requestAnimationFrame(() => {
                    updateReadingProgress();
                    isScrolling = false;
                });
                isScrolling = true;
            }
        });
        updateReadingProgress();

        

        
        const viewCount = document.getElementById('view-count');
        if (viewCount) {
            const count = Math.floor(Math.random() * 1000) + 100;
            viewCount.textContent = count;
        }
    });
</script>


<style>
    .code-block-wrapper {
        position: relative;
        margin: 1.5rem 0;
    }

    .code-block-wrapper pre {
        margin: 0;
        background: #f6f8fa !important;
        border: 1px solid #d0d7de;
        border-radius: 6px;
        padding: 16px;
        overflow-x: auto;
        font-size: 14px;
        line-height: 1.45;
    }

    .dark .code-block-wrapper pre {
        background: #0d1117 !important;
        border-color: #30363d;
    }

    .code-block-wrapper pre code {
        background: transparent !important;
        padding: 0 !important;
        border: none !important;
        font-family: ui-monospace, SFMono-Regular, 'SF Mono', Menlo, Consolas, 'Liberation Mono', monospace;
        color: #24292f;
    }

    .dark .code-block-wrapper pre code {
        color: #c9d1d9;
    }

     
    :not(pre)>code {
        background: #f6f8fa;
        border: 1px solid #d0d7de;
        border-radius: 3px;
        padding: 0.2em 0.4em;
        font-size: 85%;
        font-family: ui-monospace, SFMono-Regular, 'SF Mono', Menlo, Consolas, 'Liberation Mono', monospace;
        color: #24292f;
    }

    .dark :not(pre)>code {
        background: #161b22;
        border-color: #30363d;
        color: #c9d1d9;
    }

     
    #toc-content {
        max-height: calc(100vh - 250px);
        overflow-y: auto;
        padding-right: 0.5rem;
    }

    #toc-content::-webkit-scrollbar {
        width: 4px;
    }

    #toc-content::-webkit-scrollbar-track {
        background: transparent;
    }

    #toc-content::-webkit-scrollbar-thumb {
        background: rgba(139, 92, 246, 0.3);
        border-radius: 2px;
    }

    #toc-content::-webkit-scrollbar-thumb:hover {
        background: rgba(139, 92, 246, 0.5);
    }

    #toc-content ul {
        list-style: none;
        padding-left: 0;
        margin: 0;
    }

    #toc-content ul ul {
        padding-left: 0.75rem;
        margin-top: 0;
    }

    #toc-content li {
        margin: 0;
    }

    #toc-content a {
        display: block;
        padding: 0.35rem 0.5rem;
         
        border-radius: 0.375rem;
        transition: all 0.2s ease;
        text-decoration: none;
        border-left: 3px solid transparent;
        color: #4b5563;
        font-size: 0.9rem;
        line-height: 1.4;
    }

    .dark #toc-content a {
        color: #9ca3af;
    }

    #toc-content a:hover {
        background: rgba(139, 92, 246, 0.05);
        color: #7c3aed;
    }

    .dark #toc-content a:hover {
        background: rgba(139, 92, 246, 0.1);
        color: #a78bfa;
    }

     
    #toc-content a.active-toc-item {
        background: rgba(139, 92, 246, 0.1);
        border-left-color: #7c3aed;
         
        color: #7c3aed;
         
        font-weight: 600;
    }

    .dark #toc-content a.active-toc-item {
        background: rgba(139, 92, 246, 0.15);
        border-left-color: #a78bfa;
        color: #a78bfa;
    }

     
    aside .sticky {
        position: sticky;
        top: 6rem;
    }

     
    .article-content>h1:first-child {
        display: none;
    }
</style>

    </main>

    
    <div class="relative z-20">
        <section role="contentinfo" aria-label="Site Footer" class="bg-gray-900 text-gray-300">
    <footer class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-10">
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 lg:gap-8">
            
            <div>
                <div class="flex items-center space-x-3 mb-4">
                    <img src="/images/logo.png" alt="æ»´æ°´æ’å¿ƒ Logo"
                        class="w-10 h-10 object-contain">
                    <span class="text-xl font-bold text-white">æ»´æ°´æ’å¿ƒ</span>
                </div>
                <p class="text-gray-400 text-sm leading-relaxed mb-6">
                    
                    ä¸“æ³¨äºæŠ€æœ¯åˆ†äº«ä¸äº¤æµï¼Œè‡´åŠ›äºå¸®åŠ©å¼€å‘è€…æˆé•¿ã€‚åˆ†äº«æœ€æ–°æŠ€æœ¯è¶‹åŠ¿ã€å®æˆ˜ç»éªŒå’Œå¼€å‘æŠ€å·§ã€‚
                    
                </p>

                
                <div class="flex flex-wrap gap-3">
                    <a href="https://github.com/dishuihengxin" target="_blank"
                        rel="noopener noreferrer"
                        class="w-9 h-9 flex items-center justify-center rounded-lg bg-gray-800 text-gray-400 hover:bg-gray-700 hover:text-white transition-all duration-200"
                        aria-label="GitHub">
                        <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
                            <path
                                d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z" />
                        </svg>
                    </a>
                    <a href="https://x.com/dishuihengxin" target="_blank"
                        rel="noopener noreferrer"
                        class="w-9 h-9 flex items-center justify-center rounded-lg bg-gray-800 text-gray-400 hover:bg-gray-700 hover:text-white transition-all duration-200"
                        aria-label="X">
                        <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
                            <path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/>
                        </svg>
                    </a>
                    <a href="https://linkedin.com/in/dishuihengxin" target="_blank"
                        rel="noopener noreferrer"
                        class="w-9 h-9 flex items-center justify-center rounded-lg bg-gray-800 text-gray-400 hover:bg-gray-700 hover:text-white transition-all duration-200"
                        aria-label="LinkedIn">
                        <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
                            <path
                                d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z" />
                        </svg>
                    </a>
                    <a href="mailto:dishuihengxin@gmail.com"
                        class="w-9 h-9 flex items-center justify-center rounded-lg bg-gray-800 text-gray-400 hover:bg-gray-700 hover:text-white transition-all duration-200"
                        aria-label="Email">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M3 8l7.89 4.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" />
                        </svg>
                    </a>
                </div>
            </div>

            
            <div>
                <h3 class="text-white font-semibold mb-4 flex items-center">
                    <svg class="w-5 h-5 mr-2 text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M13 10V3L4 14h7v7l9-11h-7z"></path>
                    </svg>
                    å¿«é€Ÿé“¾æ¥
                </h3>
                <ul class="space-y-3">
                    <li>
                        <a href="/categories/"
                            class="text-gray-400 hover:text-white transition-colors duration-200 text-sm flex items-center group">
                            <svg class="w-4 h-4 mr-2 text-gray-500 group-hover:text-blue-400 transition-colors"
                                fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zM14 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zM14 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z">
                                </path>
                            </svg>
                            åˆ†ç±»
                        </a>
                    </li>
                    <li>
                        <a href="/tags/"
                            class="text-gray-400 hover:text-white transition-colors duration-200 text-sm flex items-center group">
                            <svg class="w-4 h-4 mr-2 text-gray-500 group-hover:text-blue-400 transition-colors"
                                fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z">
                                </path>
                            </svg>
                            æ ‡ç­¾
                        </a>
                    </li>
                    <li>
                        <a href="/archive/"
                            class="text-gray-400 hover:text-white transition-colors duration-200 text-sm flex items-center group">
                            <svg class="w-4 h-4 mr-2 text-gray-500 group-hover:text-blue-400 transition-colors"
                                fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M5 8h14M5 8a2 2 0 110-4h14a2 2 0 110 4M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8m-9 4h4">
                                </path>
                            </svg>
                            å½’æ¡£
                        </a>
                    </li>
                    <li>
                        <a href="/about/"
                            class="text-gray-400 hover:text-white transition-colors duration-200 text-sm flex items-center group">
                            <svg class="w-4 h-4 mr-2 text-gray-500 group-hover:text-blue-400 transition-colors"
                                fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                            å…³äº
                        </a>
                    </li>
                    <li>
                        <a href="/changelog/"
                            class="text-gray-400 hover:text-white transition-colors duration-200 text-sm flex items-center group">
                            <svg class="w-4 h-4 mr-2 text-gray-500 group-hover:text-blue-400 transition-colors"
                                fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z">
                                </path>
                            </svg>
                            æ›´æ–°æ—¥å¿—
                        </a>
                    </li>
                </ul>
            </div>

            
            <div>
                <h3 class="text-white font-semibold mb-4 flex items-center">
                    <svg class="w-5 h-5 mr-2 text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M5 3v4M3 5h4M6 17v4m-2-2h4m5-16l2.286 6.857L21 12l-5.714 2.143L13 21l-2.286-6.857L5 12l5.714-2.143L13 3z">
                        </path>
                    </svg>
                    æ¨èé˜…è¯»
                </h3>
                <ul class="space-y-3">
                    
                    <li>
                        <a href="https://www.dishuihengxin.com/posts/database-performance-optimization/"
                            class="text-gray-400 hover:text-white transition-colors duration-200 text-sm block group">
                            <div class="flex items-start">
                                <svg class="w-4 h-4 mr-2 mt-0.5 text-gray-600 group-hover:text-green-400 transition-colors flex-shrink-0"
                                    fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M9 5l7 7-7 7"></path>
                                </svg>
                                <span class="truncate">Database Performance Optimization Strategies: From Query Tuning to System Architecture</span>
                            </div>
                        </a>
                    </li>
                    
                    <li>
                        <a href="https://www.dishuihengxin.com/posts/database-security-access-control/"
                            class="text-gray-400 hover:text-white transition-colors duration-200 text-sm block group">
                            <div class="flex items-start">
                                <svg class="w-4 h-4 mr-2 mt-0.5 text-gray-600 group-hover:text-green-400 transition-colors flex-shrink-0"
                                    fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M9 5l7 7-7 7"></path>
                                </svg>
                                <span class="truncate">Database Security and Access Control: A Comprehensive Guide to Protecting Your Data</span>
                            </div>
                        </a>
                    </li>
                    
                    <li>
                        <a href="https://www.dishuihengxin.com/posts/database-elasticsearch-optimization/"
                            class="text-gray-400 hover:text-white transition-colors duration-200 text-sm block group">
                            <div class="flex items-start">
                                <svg class="w-4 h-4 mr-2 mt-0.5 text-gray-600 group-hover:text-green-400 transition-colors flex-shrink-0"
                                    fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M9 5l7 7-7 7"></path>
                                </svg>
                                <span class="truncate">Elasticsearchæœç´¢å¼•æ“ä¼˜åŒ–ï¼šä»ç´¢å¼•è®¾è®¡åˆ°æŸ¥è¯¢æ€§èƒ½è°ƒä¼˜çš„å®Œæ•´æŒ‡å—</span>
                            </div>
                        </a>
                    </li>
                    
                    <li>
                        <a href="https://www.dishuihengxin.com/posts/database-influxdb-timeseries/"
                            class="text-gray-400 hover:text-white transition-colors duration-200 text-sm block group">
                            <div class="flex items-start">
                                <svg class="w-4 h-4 mr-2 mt-0.5 text-gray-600 group-hover:text-green-400 transition-colors flex-shrink-0"
                                    fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M9 5l7 7-7 7"></path>
                                </svg>
                                <span class="truncate">InfluxDBæ—¶åºæ•°æ®åº“è®¾è®¡ä¸å®è·µï¼šä»æ•°æ®å»ºæ¨¡åˆ°é«˜æ€§èƒ½æŸ¥è¯¢ä¼˜åŒ–</span>
                            </div>
                        </a>
                    </li>
                    
                    <li>
                        <a href="https://www.dishuihengxin.com/posts/kubernetes-container-orchestration-guide/"
                            class="text-gray-400 hover:text-white transition-colors duration-200 text-sm block group">
                            <div class="flex items-start">
                                <svg class="w-4 h-4 mr-2 mt-0.5 text-gray-600 group-hover:text-green-400 transition-colors flex-shrink-0"
                                    fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M9 5l7 7-7 7"></path>
                                </svg>
                                <span class="truncate">Kubernetes Container Orchestration: A Comprehensive Guide to Cloud-Native Deployment</span>
                            </div>
                        </a>
                    </li>
                    
                </ul>
            </div>

            
            <div>
                <h3 class="text-white font-semibold mb-4 flex items-center">
                    <svg class="w-5 h-5 mr-2 text-purple-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z">
                        </path>
                    </svg>
                    å…³æ³¨æˆ‘ä»¬
                </h3>

                
                <img src="/images/qrcode.jpg" alt="å…¬ä¼—å·äºŒç»´ç " class="w-24 h-24 rounded-lg shadow-lg mb-4">

                <p class="text-xs text-gray-400">
                    æ‰«ç å…³æ³¨å…¬ä¼—å·
                </p>
            </div>
        </div>

        
        <div class="border-t border-gray-800 mt-10 pt-6">
            <div class="flex flex-col md:flex-row items-center justify-between gap-3">
                
                <div class="text-gray-400 text-sm text-center md:text-left">
                    Â© 2026 æ»´æ°´æ’å¿ƒ.
                    
                    ä¿ç•™æ‰€æœ‰æƒåˆ©ã€‚
                    
                </div>

                
                <div class="flex flex-wrap items-center justify-center gap-3 text-sm">
                    <a href="/privacy/"
                        class="text-gray-400 hover:text-white transition-colors duration-200">
                        éšç§æ”¿ç­–
                    </a>
                    <span class="text-gray-700">|</span>
                    <a href="/terms/"
                        class="text-gray-400 hover:text-white transition-colors duration-200">
                        ä½¿ç”¨æ¡æ¬¾
                    </a>
                    <span class="text-gray-700">|</span>
                    <a href="/index.xml"
                        class="text-gray-400 hover:text-white transition-colors duration-200 inline-flex items-center gap-1">
                        <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24">
                            <path
                                d="M6.503 20.752c0 1.794-1.456 3.248-3.251 3.248-1.796 0-3.252-1.454-3.252-3.248 0-1.794 1.456-3.248 3.252-3.248 1.795.001 3.251 1.454 3.251 3.248zm-6.503-12.572v4.811c6.05.062 10.96 4.966 11.022 11.009h4.817c-.062-8.71-7.118-15.758-15.839-15.82zm0-3.368c10.58.046 19.152 8.594 19.183 19.188h4.817c-.03-13.231-10.755-23.954-24-24v4.812z" />
                        </svg>
                        RSS
                    </a>
                    <span class="text-gray-700">|</span>
                    <a href="/sitemap.xml"
                        class="text-gray-400 hover:text-white transition-colors duration-200 inline-flex items-center gap-1">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M9 20l-5.447-2.724A1 1 0 013 16.382V5.618a1 1 0 011.447-.894L9 7m0 13l6-3m-6 3V7m6 10l4.553 2.276A1 1 0 0021 18.382V7.618a1 1 0 00-.553-.894L15 4m0 13V4m0 0L9 7">
                            </path>
                        </svg>
                        ç½‘ç«™åœ°å›¾
                    </a>
                </div>
            </div>
        </div>
    </footer>
</section>
    </div>

    

    
    <script src="https://cdn.jsdelivr.net/npm/fuse.js@7.0.0/dist/fuse.min.js" defer></script>

    
    
    
    
    
    
    <script src="/js/config.min.4e32dae1da8cb8e073e384e9bf17d0c048ae80f1ab72ece6507a3171fbfe62ea.js"></script>
    

    
    
    
    
    
    <script src="/js/theme-manager.min.80c7c5887d95e238a4626d07a137b2255878adff8f66394c2edb9a179f779739.js"></script>
    

    
    
    
    
    
    
    <script src="/js/security.min.97da30d986f7469868b11716a3fe9ba5b6516c39d958e471c0634d3a3f842ab4.js" defer></script>
    

    
    

    
    

    
    

    
    

    
    
    
    
    
    
    <script src="/js/analytics.min.e9c247ba215787d5828ba98cca7bb28ca42f0527f6054bc2f640f59a99a94aa7.js?v=1767334550" defer></script>
    

    
    
    
    
    
    
    <script src="/js/search.min.b0ead121c4ae8a19b5689d834fd825a1214aaa1d9979e170f900bb2879a23819.js" defer></script>
    

    
    

    
    

    
    
    
    
    
    
    <script src="/js/interactions.min.ac95880fe48f06ba1594fc48c95de264f14b703f6e94ccafe53eaaefefa32682.js" defer></script>
    



    
    
    
    
    
    
    <script src="/js/main.min.1db3c2db630282d627f674c53069de74db16f4265e72ab68e0a15e1477917e8c.js?v=1767334550" defer></script>
    

    
    

    
    




  
<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?cdb9c487f6c71421e1844a7cc0fd40e9";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>
  




  
    
<script 
  defer 
  src="https://cloud.umami.is/script.js"
  data-website-id="9b11a70f-0a77-48ae-b986-03144bf118b8" data-domains="dishuihengxin.com"
></script>
    
  



    
    
    
    
    
    
    <script src="/js/fallback-theme.min.ad9490b67677d21ebf98c40c1cf51743318b6bc5d5e2c9f0e25f5ba57a1aecb1.js" defer></script>
    

    
    
    
    
    
    
    <script src="/js/hero-slider.min.1d6c0e80fe2af86085c169ed34bf8dd76f4bfc3cb37d92c063812c65a3ede326.js" defer></script>
    

    
    
    
    
    
    
    <script src="/js/hero-particle-system.min.0bbe8a66b536f8652ac2006fb0a65ff3ca52367f952f7fe7c18082b1303bf9b6.js" defer></script>
    
</body>

</html>