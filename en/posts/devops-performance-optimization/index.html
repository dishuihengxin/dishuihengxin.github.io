<!DOCTYPE html>
<html lang="en" class="scroll-smooth">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    
    <title>Performance Optimization for Cloud-Native Applications: From Profiling to Production Tuning | dishuihengxin</title>
    


<meta name="description" content="Comprehensive guide to performance optimization for cloud-native applications, covering profiling techniques, resource optimization, caching strategies, and production tuning best practices.">
<meta name="keywords" content="Performance, Optimization, Profiling, Caching, Kubernetes, Monitoring, Tuning, technology, programming, web development, hugo, ÊäÄÊúØ, ÁºñÁ®ã, ÁΩëÁ´ôÂºÄÂèë">
<meta name="author" content="Performance Engineering Team">


<meta property="og:title" content="Performance Optimization for Cloud-Native Applications: From Profiling to Production Tuning">
<meta property="og:description" content="Comprehensive guide to performance optimization for cloud-native applications, covering profiling techniques, resource optimization, caching strategies, and production tuning best practices.">
<meta property="og:type" content="article">
<meta property="og:url" content="https://www.dishuihengxin.com/en/posts/devops-performance-optimization/">
<meta property="og:site_name" content="dishuihengxin">
<meta property="og:locale" content="en">




    



<meta property="og:image" content="https://www.dishuihengxin.com/images/logo.png">
<meta property="og:image:alt" content="Performance Optimization for Cloud-Native Applications: From Profiling to Production Tuning">



<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:title" content="Performance Optimization for Cloud-Native Applications: From Profiling to Production Tuning">
<meta name="twitter:description" content="Comprehensive guide to performance optimization for cloud-native applications, covering profiling techniques, resource optimization, caching strategies, and production tuning best practices.">

<meta name="twitter:site" content="@dishuihengxin">
<meta name="twitter:creator" content="@dishuihengxin">


<meta name="twitter:image" content="https://www.dishuihengxin.com/images/logo.png">




<meta property="article:published_time" content="2025-12-31T22:00:00&#43;08:00">

<meta property="article:modified_time" content="2025-12-31T22:00:00&#43;08:00">


<meta property="article:author" content="Performance Engineering Team">


<meta property="article:section" content="DevOps">


<meta property="article:tag" content="Performance">

<meta property="article:tag" content="Optimization">

<meta property="article:tag" content="Profiling">

<meta property="article:tag" content="Caching">

<meta property="article:tag" content="Kubernetes">

<meta property="article:tag" content="Monitoring">

<meta property="article:tag" content="Tuning">




<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "Article",
  "name": "Performance Optimization for Cloud-Native Applications: From Profiling to Production Tuning",
  "headline": "Performance Optimization for Cloud-Native Applications: From Profiling to Production Tuning",
  "description": "Comprehensive guide to performance optimization for cloud-native applications, covering profiling techniques, resource optimization, caching strategies, and production tuning best practices.",
  "url": "https:\/\/www.dishuihengxin.com\/en\/posts\/devops-performance-optimization\/",
  
  "datePublished": "2025-12-31T22:00:00\u002b08:00",
  
  "dateModified": "2025-12-31T22:00:00\u002b08:00",
  
  "author": {
    "@type": "Person",
    "name": "Performance Engineering Team"
  },
  "publisher": {
    "@type": "Organization",
    "name": "dishuihengxin",
    "logo": {
      "@type": "ImageObject",
      "url": "https:\/\/www.dishuihengxin.com\/images\/logo.png"
    }
  },
  
  "image": {
    "@type": "ImageObject",
    "url": "https:\/\/www.dishuihengxin.com\/images\/logo.png"
  },
  
  
  "articleSection": ["DevOps"],
  
  
  "keywords": ["Performance", "Optimization", "Profiling", "Caching", "Kubernetes", "Monitoring", "Tuning"],
  
  "wordCount":  4199 ,
  "timeRequired": "PT20M",
  
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https:\/\/www.dishuihengxin.com\/en\/posts\/devops-performance-optimization\/"
  }
}
</script>






<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position": 1,
      "name": "Home",
      "item": "https:\/\/www.dishuihengxin.com\/"
    }
    
    ,{
      "@type": "ListItem",
      "position": 2,
      "name": "Posts",
      "item": "https:\/\/www.dishuihengxin.com\//posts/"
    }
    
    
    ,{
      "@type": "ListItem",
      "position": 3,
      "name": "Performance Optimization for Cloud-Native Applications: From Profiling to Production Tuning",
      "item": "https:\/\/www.dishuihengxin.com\/en\/posts\/devops-performance-optimization\/"
    }
    
  ]
}
</script>



<link rel="canonical" href="https://www.dishuihengxin.com/en/posts/devops-performance-optimization/">






<meta name="robots" content="index, follow">



<meta name="theme-color" content="#3B82F6">
<meta name="msapplication-TileColor" content="#3B82F6">











<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>



<meta http-equiv="X-Content-Type-Options" content="nosniff">
<meta http-equiv="X-Frame-Options" content="DENY">
<meta http-equiv="X-XSS-Protection" content="1; mode=block">
<meta http-equiv="Referrer-Policy" content="strict-origin-when-cross-origin">


<link rel="dns-prefetch" href="//fonts.googleapis.com">
<link rel="dns-prefetch" href="//cdnjs.cloudflare.com">


    
    
    <link rel="alternate" hreflang="en" href="https://www.dishuihengxin.com/en/posts/devops-performance-optimization/">
    
    <link rel="alternate" hreflang="x-default" href="https://www.dishuihengxin.com/en/posts/devops-performance-optimization/">

    
    <link rel="icon" type="image/x-icon" href="/favicon.ico">

    
    <link rel="manifest" href="/manifest.json">
    <meta name="theme-color" content="#667eea">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="dishuihengxin">
    <link rel="apple-touch-icon" href="/icons/icon-192x192.png">

    
    

    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&amp;display=swap"
        rel="stylesheet">

    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
        integrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw=="
        crossorigin="anonymous" referrerpolicy="no-referrer">

    
    <script>
        (function () {
            const savedTheme = localStorage.getItem('theme');
            const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;

            if (savedTheme === 'dark' || (!savedTheme && prefersDark)) {
                document.documentElement.classList.add('dark');
            } else {
                document.documentElement.classList.remove('dark');
            }
        })();
    </script>

    
    <script src="https://cdn.tailwindcss.com?plugins=typography,forms,aspect-ratio"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'system-ui', 'sans-serif']
                    },
                    colors: {
                        primary: {
                            50: '#f0f4ff',
                            500: '#667eea',
                            600: '#5a67d8',
                            700: '#4c51bf'
                        }
                    },
                    animation: {
                        'gradient-shift': 'gradient-shift 3s ease infinite',
                        'float': 'float 6s ease-in-out infinite',
                        'circuit-flow': 'circuit-flow 3s ease-in-out infinite'
                    },
                    keyframes: {
                        'gradient-shift': {
                            '0%, 100%': { 'background-position': '0% 50%' },
                            '50%': { 'background-position': '100% 50%' }
                        },
                        'float': {
                            '0%, 100%': { transform: 'translateY(0px)' },
                            '33%': { transform: 'translateY(-10px)' },
                            '66%': { transform: 'translateY(-5px)' }
                        },
                        'circuit-flow': {
                            '0%': { opacity: '0.3' },
                            '50%': { opacity: '0.8' },
                            '100%': { opacity: '0.3' }
                        }
                    }
                }
            }
        }
    </script>

    
    <style>
         
        [x-cloak] {
            display: none !important;
        }

         
        .tech-hero-title {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            background-size: 200% 200%;
            animation: gradient-shift 3s ease infinite;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-shadow: 0 4px 8px rgba(102, 126, 234, 0.3);
        }

        .tech-expertise-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 1.5rem;
        }

         
        .bg-gradient-to-r.bg-clip-text.text-transparent {
            background-size: 200% 200% !important;
            animation: gradient-shift 3s ease infinite !important;
            -webkit-background-clip: text !important;
            -webkit-text-fill-color: transparent !important;
            background-clip: text !important;
        }

         
        @keyframes gradientShift {

            0%,
            100% {
                background-position: 0% 50%;
            }

            50% {
                background-position: 100% 50%;
            }
        }

         
        @keyframes gradient-shift {

            0%,
            100% {
                background-position: 0% 50%;
            }

            50% {
                background-position: 100% 50%;
            }
        }

         
        .gradient-text-primary {
            background: linear-gradient(135deg, #3b82f6 0%, #8b5cf6 50%, #ec4899 100%) !important;
            background-size: 200% 200% !important;
            -webkit-background-clip: text !important;
            -webkit-text-fill-color: transparent !important;
            background-clip: text !important;
            animation: gradientShift 4s ease infinite !important;
        }

         
        @supports not ((-webkit-background-clip: text) or (background-clip: text)) {
            .gradient-text-primary {
                color: #3b82f6 !important;
                -webkit-text-fill-color: initial !important;
            }
        }

        .expertise-card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 1rem;
            padding: 1.5rem;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .expertise-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 40px rgba(102, 126, 234, 0.3);
            border-color: rgba(102, 126, 234, 0.5);
        }

        .hero-container {
            min-height: 100vh;
            display: flex;
            align-items: center;
            position: relative;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            overflow: hidden;
        }

        .dark .hero-container {
            background: linear-gradient(135deg, #1f2937 0%, #111827 100%);
        }

        .hero-content {
            position: relative;
            z-index: 10;
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 2rem;
        }

        .hero-background {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            opacity: 0.1;
            background-image:
                radial-gradient(circle at 20% 50%, #667eea 2px, transparent 2px),
                radial-gradient(circle at 80% 50%, #764ba2 2px, transparent 2px);
            background-size: 50px 50px;
            animation: circuit-flow 3s ease-in-out infinite;
        }

        .floating-element {
            animation: float 6s ease-in-out infinite;
        }

        .floating-element:nth-child(2) {
            animation-delay: -2s;
        }

        .floating-element:nth-child(3) {
            animation-delay: -4s;
        }

        .scroll-reveal {
            opacity: 0;
            transform: translateY(30px);
            transition: all 0.6s ease;
        }

        .scroll-reveal.revealed {
            opacity: 1;
            transform: translateY(0);
        }

        .heading-hero {
            font-size: clamp(2.5rem, 8vw, 4.5rem);
            font-weight: 900;
            line-height: 1.1;
            letter-spacing: -0.02em;
        }

        .text-gradient {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 0.75rem;
            padding: 1rem 2rem;
            font-weight: 600;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            cursor: pointer;
            text-decoration: none;
            display: inline-block;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary {
            background: transparent;
            color: #667eea;
            border: 2px solid #667eea;
            border-radius: 0.75rem;
            padding: 1rem 2rem;
            font-weight: 600;
            transition: all 0.3s ease;
            cursor: pointer;
            text-decoration: none;
            display: inline-block;
        }

        .btn-secondary:hover {
            background: #667eea;
            color: white;
            transform: translateY(-2px);
        }

        .dark .expertise-card {
            background: rgba(17, 24, 39, 0.8);
            border-color: rgba(75, 85, 99, 0.3);
        }

         
        .theme-toggle {
            width: 3rem;
            height: 3rem;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .theme-toggle:hover {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
    </style>

    
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>

    
    <script>
        
        setTimeout(function () {
            if (typeof Alpine === 'undefined') {
                console.warn('Alpine.js failed to load, removing x-cloak attributes');
                document.querySelectorAll('[x-cloak]').forEach(function (el) {
                    el.removeAttribute('x-cloak');
                });
            }
        }, 3000);

        
        document.addEventListener('DOMContentLoaded', function () {
            setTimeout(function () {
                if (typeof Alpine !== 'undefined' && Alpine.version) {
                    console.log('Alpine.js loaded successfully:', Alpine.version);
                } else {
                    console.warn('Alpine.js not detected, removing x-cloak attributes');
                    document.querySelectorAll('[x-cloak]').forEach(function (el) {
                        el.removeAttribute('x-cloak');
                    });
                }
            }, 1000);
        });
    </script>

    
    
    
    
    
    
    <link rel="stylesheet" href="/css/main.min.e4e930a9694f1bef5d88b9cb8df7448d557069bd1b883f9752972f749f3b7817.css" 
        integrity="sha256-5OkwqWlPG&#43;9diLnLjfdEjVVwab0biD&#43;XUpcvdJ87eBc=" crossorigin="anonymous" >
    

    
    
    
    
    
    
    <link rel="stylesheet" href="/css/code.min.d8113910e55a8bf3c2b00bff6664d767b1326c723f610ffdbb17db29b550c869.css" 
        integrity="sha256-2BE5EOVai/PCsAv/ZmTXZ7EybHI/YQ/9uxfbKbVQyGk=" crossorigin="anonymous" >
    



    
    
    
    
    
    
    <link rel="stylesheet" href="/css/article-content.min.1e7243d4c68581aed5ac49dbf65270186efd57f979274513bfe8e9b07aca9106.css" 
        integrity="sha256-HnJD1MaFga7VrEnb9lJwGG79V/l5J0UTv&#43;jpsHrKkQY=" crossorigin="anonymous" >
    

    
    
    
    
    
    
    <script src="/js/code.min.e908b2b60c4f45e49eac078432e3caeb2f68cd90bacf6655e1e2daeb7c033a61.js"  integrity="sha256-6QiytgxPReSerAeEMuPK6y9ozZC6z2ZV4eLa63wDOmE="
        crossorigin="anonymous"  defer></script>
    

    
    
    
    
    
    
    <link rel="stylesheet" href="/css/theme.min.dd2785de1340fb42994644dc99d93edb890756750d7144ab9b7aadaacbb01150.css" 
        integrity="sha256-3SeF3hNA&#43;0KZRkTcmdk&#43;24kHVnUNcUSrm3qtqsuwEVA=" crossorigin="anonymous" >
    

    
    
    
    
    
    <link rel="stylesheet" href="/css/responsive.min.f144a503e14c68cbc38822196c7658af9ab370ed84cae94de772479879f32f16.css" 
        integrity="sha256-8USlA&#43;FMaMvDiCIZbHZYr5qzcO2EyulN53JHmHnzLxY=" crossorigin="anonymous" >
    

    
    
    
    
    
    
    <link rel="stylesheet" href="/css/view-toggle.min.1a3ade9d6e3626af96631334fe0e34633672c976cdac345380fe83b1cf365d03.css" 
        integrity="sha256-GjrenW42Jq&#43;WYxM0/g40YzZyyXbNrDRTgP6Dsc82XQM=" crossorigin="anonymous" >
    

    
    
    
    
    
    
    <link rel="stylesheet" href="/css/hero-effects.min.cae12dabb387339d39793c685980b23d5568e5a2bad8336dcfacc86a4c84147b.css" 
        integrity="sha256-yuEtq7OHM505eTxoWYCyPVVo5aK62DNtz6zIakyEFHs=" crossorigin="anonymous" >
    

</head>

<body class="font-sans antialiased transition-all duration-500 overflow-x-hidden body-gradient-light">

    
    <div class="fixed inset-0 pointer-events-none z-0">
        <div
            class="absolute inset-0 bg-gradient-to-br from-blue-50/50 via-purple-50/30 to-pink-50/50 dark:from-gray-900/90 dark:via-blue-900/50 dark:to-purple-900/30">
        </div>
        <div
            class="absolute top-1/4 left-1/4 w-96 h-96 bg-gradient-to-r from-blue-400/20 to-purple-500/20 rounded-full blur-3xl animate-float">
        </div>
        <div
            class="absolute bottom-1/4 right-1/4 w-80 h-80 bg-gradient-to-r from-purple-400/20 to-pink-500/20 rounded-full blur-3xl animate-pulse">
        </div>
        <div
            class="absolute top-3/4 left-1/2 w-64 h-64 bg-gradient-to-r from-cyan-400/15 to-blue-500/15 rounded-full blur-2xl animate-float animation-delay-2000">
        </div>
    </div>

    
    <div class="relative z-50">
        
<section x-data="{ 
            showNotification: false,
            notificationVersion: '2024-01-20', // Update this when notification content changes
            dismissDuration: 24 * 60 * 60 * 1000, // 24 hours in milliseconds
            
            init() {
                this.checkNotificationStatus();
            },
            
            checkNotificationStatus() {
                const dismissedData = localStorage.getItem('notification-dismissed');
                
                if (!dismissedData) {
                    // Never dismissed, show notification
                    this.showNotification = true;
                    return;
                }
                
                try {
                    const data = JSON.parse(dismissedData);
                    const currentTime = Date.now();
                    
                    // Check if notification version has changed (new content)
                    if (data.version !== this.notificationVersion) {
                        this.showNotification = true;
                        return;
                    }
                    
                    // Check if enough time has passed since dismissal
                    if (currentTime - data.timestamp > this.dismissDuration) {
                        this.showNotification = true;
                        return;
                    }
                    
                    // Still within dismiss period
                    this.showNotification = false;
                } catch (e) {
                    // Invalid data format, show notification
                    this.showNotification = true;
                }
            },
            
            dismissNotification() {
                this.showNotification = false;
                const dismissData = {
                    timestamp: Date.now(),
                    version: this.notificationVersion
                };
                localStorage.setItem('notification-dismissed', JSON.stringify(dismissData));
            }
         }" 
         x-show="showNotification" 
         x-transition:enter="transition ease-out duration-300"
         x-transition:enter-start="opacity-0 transform -translate-y-full"
         x-transition:enter-end="opacity-100 transform translate-y-0"
         x-transition:leave="transition ease-in duration-200"
         x-transition:leave-start="opacity-100 transform translate-y-0"
         x-transition:leave-end="opacity-0 transform -translate-y-full"
         x-cloak
         class="fixed top-0 left-0 right-0 z-60 bg-gradient-to-r from-blue-600 to-purple-600 text-white shadow-lg"
         id="notification-section"
         role="banner"
         aria-label="Notification bar">
    
    <div class="w-full max-w-7xl mx-auto px-3 sm:px-4 lg:px-8 py-2 overflow-hidden">
        <div class="flex items-center justify-between gap-2">
            
            <div class="flex items-center gap-2 flex-1 min-w-0 overflow-hidden">
                
                <div class="flex-shrink-0">
                    <svg class="w-4 h-4 sm:w-5 sm:h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5.882V19.24a1.76 1.76 0 01-3.417.592l-2.147-6.15M18 13a3 3 0 100-6M5.436 13.683A4.001 4.001 0 017 6h1.832c4.1 0 7.625-1.234 9.168-3v14c-1.543-1.766-5.067-3-9.168-3H7a3.988 3.988 0 01-1.564-.317z"></path>
                    </svg>
                </div>
                
                
                <div class="flex-1 min-w-0 overflow-hidden">
                    <p class="text-xs sm:text-sm font-medium text-white truncate">
                        
                            üéâ Welcome to our Tech Blog! Get the latest tech articles and development resources
                        
                    </p>
                </div>
                
                
                <div class="hidden sm:block flex-shrink-0">
                    <a href="/about" 
                       class="inline-flex items-center px-2 sm:px-3 py-1 bg-white bg-opacity-20 hover:bg-opacity-30 rounded-md text-xs sm:text-sm font-medium text-white transition-all duration-200 hover:scale-105 whitespace-nowrap">
                        
                            Learn More
                        
                        <svg class="ml-1 w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                        </svg>
                    </a>
                </div>
            </div>
            
            
            <div class="flex-shrink-0">
                <button @click="dismissNotification()" 
                        class="inline-flex items-center justify-center w-6 h-6 bg-white bg-opacity-20 hover:bg-opacity-30 rounded-md transition-all duration-200 hover:scale-105"
                        aria-label="Close notification"
                        title="Close notification (will reappear after 24 hours)">
                    <svg class="w-3 h-3 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>
</section>


<script>
    
    
</script>
    </div>

    
    <a href="#main-content"
        class="sr-only focus:not-sr-only focus:absolute focus:top-4 focus:left-4 glass-card px-4 py-2 rounded-xl z-50 text-primary-600 dark:text-primary-400 font-medium">
        Skip to main content
    </a>

    

    
    <div class="relative z-40">
        <section class="fixed left-0 right-0 z-55 transition-all duration-500" 
         x-data="{ 
             mobileMenuOpen: false, 
             searchOpen: false,
             scrolled: false,
             themeMenuOpen: false,
             notificationVisible: false,
             notificationVersion: '2024-01-20', // Must match notification-bar.html
             dismissDuration: 24 * 60 * 60 * 1000, // 24 hours in milliseconds
             
             checkNotificationStatus() {
                 const dismissedData = localStorage.getItem('notification-dismissed');
                 
                 if (!dismissedData) {
                     this.notificationVisible = true;
                     return;
                 }
                 
                 try {
                     const data = JSON.parse(dismissedData);
                     const currentTime = Date.now();
                     
                     // Check if notification version has changed
                     if (data.version !== this.notificationVersion) {
                         this.notificationVisible = true;
                         return;
                     }
                     
                     // Check if enough time has passed since dismissal
                     if (currentTime - data.timestamp > this.dismissDuration) {
                         this.notificationVisible = true;
                         return;
                     }
                     
                     this.notificationVisible = false;
                 } catch (e) {
                     this.notificationVisible = true;
                 }
             }
         }"
         x-init="
             // Force search to be closed immediately
             $nextTick(() => {
                 searchOpen = false;
             });
             
             // Check notification status on init
             checkNotificationStatus();
             
             window.addEventListener('scroll', () => {
                 scrolled = window.pageYOffset > 50;
             });
             
             // Watch for notification bar changes
             window.addEventListener('storage', () => {
                 checkNotificationStatus();
             });
         "
         :class="{
             'glass-nav shadow-2xl shadow-primary-500/20 border-b border-white/20 dark:border-gray-700/30': scrolled,
             'bg-transparent': !scrolled,
             'top-11': notificationVisible,
             'top-0': !notificationVisible
         }"
         role="navigation"
         aria-label="Main navigation">
    <nav>
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="flex justify-between items-center h-16">
            
            <div class="flex items-center">
                <a href="/en/" class="site-logo-container group flex items-center space-x-3">
                    
                    <div class="relative">
                        <div class="w-12 h-12 flex items-center justify-center transform group-hover:scale-110 transition-all duration-300">
                            <img src="/images/logo.png" 
                                 alt="dishuihengxin Logo" 
                                 class="w-10 h-10 object-contain"
                                 loading="eager">
                        </div>
                    </div>
                    <div class="hidden sm:block">
                        <span class="site-title">
                            dishuihengxin
                        </span>
                        <div class="site-subtitle">
                            Tech Sharing
                        </div>
                    </div>
                </a>
            </div>
            
            
            <div class="hidden md:flex items-center space-x-1 flex-1 justify-end mr-4">
                
                    
                        
                        <a href="/en/" 
                           class="nav-menu-item  text-gray-700 dark:text-gray-300 text-base">
                            <span class="relative z-10">Home</span>
                        </a>
                    
                
                    
                        
                        <a href="/en/posts/" 
                           class="nav-menu-item  text-gray-700 dark:text-gray-300 text-base">
                            <span class="relative z-10">Blog</span>
                        </a>
                    
                
                    
                        
                        <div class="relative group" x-data="{ open: false }" @mouseenter="open = true" @mouseleave="open = false">
                            <button class="nav-menu-item dropdown-trigger  text-gray-700 dark:text-gray-300 text-base flex items-center gap-1"
                                    @click="open = !open">
                                <span class="relative z-10">DBA</span>
                                <svg class="w-4 h-4 transition-transform duration-200" :class="{ 'rotate-180': open }" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                                </svg>
                            </button>
                            
                            
                            <div x-show="open"
                                 x-transition:enter="transition ease-out duration-200"
                                 x-transition:enter-start="opacity-0 scale-95 translate-y-2"
                                 x-transition:enter-end="opacity-100 scale-100 translate-y-0"
                                 x-transition:leave="transition ease-in duration-150"
                                 x-transition:leave-start="opacity-100 scale-100 translate-y-0"
                                 x-transition:leave-end="opacity-0 scale-95 translate-y-2"
                                 class="absolute left-0 mt-2 w-56 rounded-xl shadow-2xl backdrop-blur-xl bg-white/95 dark:bg-gray-800/95 border border-gray-200/50 dark:border-gray-700/50 overflow-hidden z-50"
                                 style="display: none;">
                                <div class="py-2">
                                    
                                        <a href="/en/tags/mysql/" 
                                           class="dropdown-item block px-4 py-3 text-sm text-gray-700 dark:text-gray-300 hover:bg-gradient-to-r hover:from-indigo-50 hover:to-purple-50 dark:hover:from-indigo-900/30 dark:hover:to-purple-900/30 transition-all duration-200 ">
                                            <div class="flex items-center gap-3">
                                                
                                                    <span class="text-lg">üê¨</span>
                                                
                                                <div>
                                                    <div class="font-medium">MySQL</div>
                                                    
                                                        <div class="text-xs text-gray-500 dark:text-gray-400 mt-0.5">HA ¬∑ Replication ¬∑ Tuning</div>
                                                    
                                                </div>
                                            </div>
                                        </a>
                                    
                                        <a href="/en/tags/postgresql/" 
                                           class="dropdown-item block px-4 py-3 text-sm text-gray-700 dark:text-gray-300 hover:bg-gradient-to-r hover:from-indigo-50 hover:to-purple-50 dark:hover:from-indigo-900/30 dark:hover:to-purple-900/30 transition-all duration-200 ">
                                            <div class="flex items-center gap-3">
                                                
                                                    <span class="text-lg">üêò</span>
                                                
                                                <div>
                                                    <div class="font-medium">PostgreSQL</div>
                                                    
                                                        <div class="text-xs text-gray-500 dark:text-gray-400 mt-0.5">Streaming ¬∑ Logical Replication</div>
                                                    
                                                </div>
                                            </div>
                                        </a>
                                    
                                        <a href="/en/tags/oracle/" 
                                           class="dropdown-item block px-4 py-3 text-sm text-gray-700 dark:text-gray-300 hover:bg-gradient-to-r hover:from-indigo-50 hover:to-purple-50 dark:hover:from-indigo-900/30 dark:hover:to-purple-900/30 transition-all duration-200 ">
                                            <div class="flex items-center gap-3">
                                                
                                                    <span class="text-lg">üî¥</span>
                                                
                                                <div>
                                                    <div class="font-medium">Oracle</div>
                                                    
                                                        <div class="text-xs text-gray-500 dark:text-gray-400 mt-0.5">RAC ¬∑ DataGuard ¬∑ RMAN</div>
                                                    
                                                </div>
                                            </div>
                                        </a>
                                    
                                        <a href="/en/tags/tuning/" 
                                           class="dropdown-item block px-4 py-3 text-sm text-gray-700 dark:text-gray-300 hover:bg-gradient-to-r hover:from-indigo-50 hover:to-purple-50 dark:hover:from-indigo-900/30 dark:hover:to-purple-900/30 transition-all duration-200 ">
                                            <div class="flex items-center gap-3">
                                                
                                                    <span class="text-lg">‚ö°</span>
                                                
                                                <div>
                                                    <div class="font-medium">Performance</div>
                                                    
                                                        <div class="text-xs text-gray-500 dark:text-gray-400 mt-0.5">SQL Tuning ¬∑ Index ¬∑ Execution Plan</div>
                                                    
                                                </div>
                                            </div>
                                        </a>
                                    
                                        <a href="/en/tags/backup/" 
                                           class="dropdown-item block px-4 py-3 text-sm text-gray-700 dark:text-gray-300 hover:bg-gradient-to-r hover:from-indigo-50 hover:to-purple-50 dark:hover:from-indigo-900/30 dark:hover:to-purple-900/30 transition-all duration-200 ">
                                            <div class="flex items-center gap-3">
                                                
                                                    <span class="text-lg">üíæ</span>
                                                
                                                <div>
                                                    <div class="font-medium">Backup &amp; Recovery</div>
                                                    
                                                        <div class="text-xs text-gray-500 dark:text-gray-400 mt-0.5">Backup Strategy ¬∑ PITR ¬∑ DR</div>
                                                    
                                                </div>
                                            </div>
                                        </a>
                                    
                                </div>
                            </div>
                        </div>
                    
                
                    
                        
                        <div class="relative group" x-data="{ open: false }" @mouseenter="open = true" @mouseleave="open = false">
                            <button class="nav-menu-item dropdown-trigger  text-gray-700 dark:text-gray-300 text-base flex items-center gap-1"
                                    @click="open = !open">
                                <span class="relative z-10">Operations</span>
                                <svg class="w-4 h-4 transition-transform duration-200" :class="{ 'rotate-180': open }" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                                </svg>
                            </button>
                            
                            
                            <div x-show="open"
                                 x-transition:enter="transition ease-out duration-200"
                                 x-transition:enter-start="opacity-0 scale-95 translate-y-2"
                                 x-transition:enter-end="opacity-100 scale-100 translate-y-0"
                                 x-transition:leave="transition ease-in duration-150"
                                 x-transition:leave-start="opacity-100 scale-100 translate-y-0"
                                 x-transition:leave-end="opacity-0 scale-95 translate-y-2"
                                 class="absolute left-0 mt-2 w-56 rounded-xl shadow-2xl backdrop-blur-xl bg-white/95 dark:bg-gray-800/95 border border-gray-200/50 dark:border-gray-700/50 overflow-hidden z-50"
                                 style="display: none;">
                                <div class="py-2">
                                    
                                        <a href="/en/tags/linux/" 
                                           class="dropdown-item block px-4 py-3 text-sm text-gray-700 dark:text-gray-300 hover:bg-gradient-to-r hover:from-indigo-50 hover:to-purple-50 dark:hover:from-indigo-900/30 dark:hover:to-purple-900/30 transition-all duration-200 ">
                                            <div class="flex items-center gap-3">
                                                
                                                    <span class="text-lg">üêß</span>
                                                
                                                <div>
                                                    <div class="font-medium">Linux Ops</div>
                                                    
                                                        <div class="text-xs text-gray-500 dark:text-gray-400 mt-0.5">Kernel Tuning ¬∑ SysAdmin ¬∑ Shell</div>
                                                    
                                                </div>
                                            </div>
                                        </a>
                                    
                                        <a href="/en/tags/monitoring/" 
                                           class="dropdown-item block px-4 py-3 text-sm text-gray-700 dark:text-gray-300 hover:bg-gradient-to-r hover:from-indigo-50 hover:to-purple-50 dark:hover:from-indigo-900/30 dark:hover:to-purple-900/30 transition-all duration-200 ">
                                            <div class="flex items-center gap-3">
                                                
                                                    <span class="text-lg">üìä</span>
                                                
                                                <div>
                                                    <div class="font-medium">Monitoring</div>
                                                    
                                                        <div class="text-xs text-gray-500 dark:text-gray-400 mt-0.5">Prometheus ¬∑ Grafana ¬∑ Alerting</div>
                                                    
                                                </div>
                                            </div>
                                        </a>
                                    
                                        <a href="/en/tags/automation/" 
                                           class="dropdown-item block px-4 py-3 text-sm text-gray-700 dark:text-gray-300 hover:bg-gradient-to-r hover:from-indigo-50 hover:to-purple-50 dark:hover:from-indigo-900/30 dark:hover:to-purple-900/30 transition-all duration-200 ">
                                            <div class="flex items-center gap-3">
                                                
                                                    <span class="text-lg">ü§ñ</span>
                                                
                                                <div>
                                                    <div class="font-medium">Automation</div>
                                                    
                                                        <div class="text-xs text-gray-500 dark:text-gray-400 mt-0.5">Ansible ¬∑ Terraform ¬∑ IaC</div>
                                                    
                                                </div>
                                            </div>
                                        </a>
                                    
                                        <a href="/en/tags/network/" 
                                           class="dropdown-item block px-4 py-3 text-sm text-gray-700 dark:text-gray-300 hover:bg-gradient-to-r hover:from-indigo-50 hover:to-purple-50 dark:hover:from-indigo-900/30 dark:hover:to-purple-900/30 transition-all duration-200 ">
                                            <div class="flex items-center gap-3">
                                                
                                                    <span class="text-lg">üåê</span>
                                                
                                                <div>
                                                    <div class="font-medium">Network Ops</div>
                                                    
                                                        <div class="text-xs text-gray-500 dark:text-gray-400 mt-0.5">TCP/IP ¬∑ Load Balancer ¬∑ Troubleshooting</div>
                                                    
                                                </div>
                                            </div>
                                        </a>
                                    
                                        <a href="/en/tags/security/" 
                                           class="dropdown-item block px-4 py-3 text-sm text-gray-700 dark:text-gray-300 hover:bg-gradient-to-r hover:from-indigo-50 hover:to-purple-50 dark:hover:from-indigo-900/30 dark:hover:to-purple-900/30 transition-all duration-200 ">
                                            <div class="flex items-center gap-3">
                                                
                                                    <span class="text-lg">üîí</span>
                                                
                                                <div>
                                                    <div class="font-medium">Security</div>
                                                    
                                                        <div class="text-xs text-gray-500 dark:text-gray-400 mt-0.5">Access Control ¬∑ Firewall ¬∑ Audit</div>
                                                    
                                                </div>
                                            </div>
                                        </a>
                                    
                                </div>
                            </div>
                        </div>
                    
                
                    
                        
                        <div class="relative group" x-data="{ open: false }" @mouseenter="open = true" @mouseleave="open = false">
                            <button class="nav-menu-item dropdown-trigger  text-gray-700 dark:text-gray-300 text-base flex items-center gap-1"
                                    @click="open = !open">
                                <span class="relative z-10">Cloud</span>
                                <svg class="w-4 h-4 transition-transform duration-200" :class="{ 'rotate-180': open }" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                                </svg>
                            </button>
                            
                            
                            <div x-show="open"
                                 x-transition:enter="transition ease-out duration-200"
                                 x-transition:enter-start="opacity-0 scale-95 translate-y-2"
                                 x-transition:enter-end="opacity-100 scale-100 translate-y-0"
                                 x-transition:leave="transition ease-in duration-150"
                                 x-transition:leave-start="opacity-100 scale-100 translate-y-0"
                                 x-transition:leave-end="opacity-0 scale-95 translate-y-2"
                                 class="absolute left-0 mt-2 w-56 rounded-xl shadow-2xl backdrop-blur-xl bg-white/95 dark:bg-gray-800/95 border border-gray-200/50 dark:border-gray-700/50 overflow-hidden z-50"
                                 style="display: none;">
                                <div class="py-2">
                                    
                                        <a href="/en/tags/aws/" 
                                           class="dropdown-item block px-4 py-3 text-sm text-gray-700 dark:text-gray-300 hover:bg-gradient-to-r hover:from-indigo-50 hover:to-purple-50 dark:hover:from-indigo-900/30 dark:hover:to-purple-900/30 transition-all duration-200 ">
                                            <div class="flex items-center gap-3">
                                                
                                                    <span class="text-lg">‚òÅÔ∏è</span>
                                                
                                                <div>
                                                    <div class="font-medium">AWS</div>
                                                    
                                                        <div class="text-xs text-gray-500 dark:text-gray-400 mt-0.5">EC2 ¬∑ RDS ¬∑ S3 ¬∑ Lambda</div>
                                                    
                                                </div>
                                            </div>
                                        </a>
                                    
                                        <a href="/en/tags/azure/" 
                                           class="dropdown-item block px-4 py-3 text-sm text-gray-700 dark:text-gray-300 hover:bg-gradient-to-r hover:from-indigo-50 hover:to-purple-50 dark:hover:from-indigo-900/30 dark:hover:to-purple-900/30 transition-all duration-200 ">
                                            <div class="flex items-center gap-3">
                                                
                                                    <span class="text-lg">üåê</span>
                                                
                                                <div>
                                                    <div class="font-medium">Azure</div>
                                                    
                                                        <div class="text-xs text-gray-500 dark:text-gray-400 mt-0.5">VM ¬∑ SQL Database ¬∑ Blob Storage</div>
                                                    
                                                </div>
                                            </div>
                                        </a>
                                    
                                        <a href="/en/tags/aliyun/" 
                                           class="dropdown-item block px-4 py-3 text-sm text-gray-700 dark:text-gray-300 hover:bg-gradient-to-r hover:from-indigo-50 hover:to-purple-50 dark:hover:from-indigo-900/30 dark:hover:to-purple-900/30 transition-all duration-200 ">
                                            <div class="flex items-center gap-3">
                                                
                                                    <span class="text-lg">‚òÅÔ∏è</span>
                                                
                                                <div>
                                                    <div class="font-medium">Aliyun</div>
                                                    
                                                        <div class="text-xs text-gray-500 dark:text-gray-400 mt-0.5">ECS ¬∑ RDS ¬∑ OSS ¬∑ Function Compute</div>
                                                    
                                                </div>
                                            </div>
                                        </a>
                                    
                                        <a href="/en/tags/architecture/" 
                                           class="dropdown-item block px-4 py-3 text-sm text-gray-700 dark:text-gray-300 hover:bg-gradient-to-r hover:from-indigo-50 hover:to-purple-50 dark:hover:from-indigo-900/30 dark:hover:to-purple-900/30 transition-all duration-200 ">
                                            <div class="flex items-center gap-3">
                                                
                                                    <span class="text-lg">üèóÔ∏è</span>
                                                
                                                <div>
                                                    <div class="font-medium">Architecture</div>
                                                    
                                                        <div class="text-xs text-gray-500 dark:text-gray-400 mt-0.5">Microservices ¬∑ HA ¬∑ Auto Scaling</div>
                                                    
                                                </div>
                                            </div>
                                        </a>
                                    
                                        <a href="/en/tags/cloud-native/" 
                                           class="dropdown-item block px-4 py-3 text-sm text-gray-700 dark:text-gray-300 hover:bg-gradient-to-r hover:from-indigo-50 hover:to-purple-50 dark:hover:from-indigo-900/30 dark:hover:to-purple-900/30 transition-all duration-200 ">
                                            <div class="flex items-center gap-3">
                                                
                                                    <span class="text-lg">üöÄ</span>
                                                
                                                <div>
                                                    <div class="font-medium">Cloud Native</div>
                                                    
                                                        <div class="text-xs text-gray-500 dark:text-gray-400 mt-0.5">Serverless ¬∑ Service Mesh ¬∑ CNCF</div>
                                                    
                                                </div>
                                            </div>
                                        </a>
                                    
                                </div>
                            </div>
                        </div>
                    
                
                    
                        
                        <div class="relative group" x-data="{ open: false }" @mouseenter="open = true" @mouseleave="open = false">
                            <button class="nav-menu-item dropdown-trigger  text-gray-700 dark:text-gray-300 text-base flex items-center gap-1"
                                    @click="open = !open">
                                <span class="relative z-10">DevOps</span>
                                <svg class="w-4 h-4 transition-transform duration-200" :class="{ 'rotate-180': open }" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                                </svg>
                            </button>
                            
                            
                            <div x-show="open"
                                 x-transition:enter="transition ease-out duration-200"
                                 x-transition:enter-start="opacity-0 scale-95 translate-y-2"
                                 x-transition:enter-end="opacity-100 scale-100 translate-y-0"
                                 x-transition:leave="transition ease-in duration-150"
                                 x-transition:leave-start="opacity-100 scale-100 translate-y-0"
                                 x-transition:leave-end="opacity-0 scale-95 translate-y-2"
                                 class="absolute left-0 mt-2 w-56 rounded-xl shadow-2xl backdrop-blur-xl bg-white/95 dark:bg-gray-800/95 border border-gray-200/50 dark:border-gray-700/50 overflow-hidden z-50"
                                 style="display: none;">
                                <div class="py-2">
                                    
                                        <a href="/en/tags/cicd/" 
                                           class="dropdown-item block px-4 py-3 text-sm text-gray-700 dark:text-gray-300 hover:bg-gradient-to-r hover:from-indigo-50 hover:to-purple-50 dark:hover:from-indigo-900/30 dark:hover:to-purple-900/30 transition-all duration-200 ">
                                            <div class="flex items-center gap-3">
                                                
                                                    <span class="text-lg">üîÑ</span>
                                                
                                                <div>
                                                    <div class="font-medium">CI/CD</div>
                                                    
                                                        <div class="text-xs text-gray-500 dark:text-gray-400 mt-0.5">Jenkins ¬∑ GitLab CI ¬∑ GitHub Actions</div>
                                                    
                                                </div>
                                            </div>
                                        </a>
                                    
                                        <a href="/en/tags/docker/" 
                                           class="dropdown-item block px-4 py-3 text-sm text-gray-700 dark:text-gray-300 hover:bg-gradient-to-r hover:from-indigo-50 hover:to-purple-50 dark:hover:from-indigo-900/30 dark:hover:to-purple-900/30 transition-all duration-200 ">
                                            <div class="flex items-center gap-3">
                                                
                                                    <span class="text-lg">üê≥</span>
                                                
                                                <div>
                                                    <div class="font-medium">Docker</div>
                                                    
                                                        <div class="text-xs text-gray-500 dark:text-gray-400 mt-0.5">Image Build ¬∑ Orchestration ¬∑ Best Practices</div>
                                                    
                                                </div>
                                            </div>
                                        </a>
                                    
                                        <a href="/en/tags/kubernetes/" 
                                           class="dropdown-item block px-4 py-3 text-sm text-gray-700 dark:text-gray-300 hover:bg-gradient-to-r hover:from-indigo-50 hover:to-purple-50 dark:hover:from-indigo-900/30 dark:hover:to-purple-900/30 transition-all duration-200 ">
                                            <div class="flex items-center gap-3">
                                                
                                                    <span class="text-lg">‚ò∏Ô∏è</span>
                                                
                                                <div>
                                                    <div class="font-medium">Kubernetes</div>
                                                    
                                                        <div class="text-xs text-gray-500 dark:text-gray-400 mt-0.5">Pod ¬∑ Service ¬∑ Ingress ¬∑ Helm</div>
                                                    
                                                </div>
                                            </div>
                                        </a>
                                    
                                        <a href="/en/tags/gitops/" 
                                           class="dropdown-item block px-4 py-3 text-sm text-gray-700 dark:text-gray-300 hover:bg-gradient-to-r hover:from-indigo-50 hover:to-purple-50 dark:hover:from-indigo-900/30 dark:hover:to-purple-900/30 transition-all duration-200 ">
                                            <div class="flex items-center gap-3">
                                                
                                                    <span class="text-lg">üîÄ</span>
                                                
                                                <div>
                                                    <div class="font-medium">GitOps</div>
                                                    
                                                        <div class="text-xs text-gray-500 dark:text-gray-400 mt-0.5">ArgoCD ¬∑ Flux ¬∑ Declarative Deployment</div>
                                                    
                                                </div>
                                            </div>
                                        </a>
                                    
                                        <a href="/en/tags/observability/" 
                                           class="dropdown-item block px-4 py-3 text-sm text-gray-700 dark:text-gray-300 hover:bg-gradient-to-r hover:from-indigo-50 hover:to-purple-50 dark:hover:from-indigo-900/30 dark:hover:to-purple-900/30 transition-all duration-200 ">
                                            <div class="flex items-center gap-3">
                                                
                                                    <span class="text-lg">üëÅÔ∏è</span>
                                                
                                                <div>
                                                    <div class="font-medium">Observability</div>
                                                    
                                                        <div class="text-xs text-gray-500 dark:text-gray-400 mt-0.5">Logging ¬∑ Metrics ¬∑ Tracing</div>
                                                    
                                                </div>
                                            </div>
                                        </a>
                                    
                                </div>
                            </div>
                        </div>
                    
                
                    
                        
                        <a href="/en/about/" 
                           class="nav-menu-item  text-gray-700 dark:text-gray-300 text-base">
                            <span class="relative z-10">About</span>
                        </a>
                    
                
            </div>
            
            
            <div class="flex items-center space-x-3">
                
                <button @click="toggleTheme()" 
                         @keydown.enter="toggleTheme()"
                         @keydown.space.prevent="toggleTheme()"
                         class="nav-action-btn group focus:outline-none"
                         data-toggle="dark-mode"
                         type="button"
                         role="switch"
                         :aria-checked="document.documentElement.classList.contains('dark') ? 'true' : 'false'"
                         aria-label="Toggle theme"
                         :aria-describedby="document.documentElement.classList.contains('dark') ? 'theme-dark' : 'theme-light'">
                    <svg class="text-gray-600 dark:text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true" focusable="false">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"></path>
                    </svg>
                </button>
                
                
                <a href="/en/search/" 
                   class="nav-action-btn group focus:outline-none"
                   aria-label="Search">
                    <svg class="text-gray-600 dark:text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                    </svg>
                </a>
                
                
                
                
                    
                    
                    
                    
                    
                        
                        
                            
                        
                    
                    
                    <a href="/posts/devops-performance-optimization/" 
                       hreflang="zh"
                       class="lang-switcher flex items-center space-x-2 text-gray-600 dark:text-gray-400 group"
                       aria-label="ÂàáÊç¢Âà∞‰∏≠Êñá">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5h12M9 3v2m1.048 9.5A18.022 18.022 0 016.412 9m6.088 9h7M11 21l5-10 5 10M12.751 5C11.783 10.77 8.07 15.61 3 18.129"></path>
                        </svg>
                        <span>‰∏≠</span>
                    </a>
                    
                
                    
                
                
                
                
                <button @click="mobileMenuOpen = !mobileMenuOpen" 
                         @keydown.enter="mobileMenuOpen = !mobileMenuOpen"
                         @keydown.space.prevent="mobileMenuOpen = !mobileMenuOpen"
                         class="mobile-menu-toggle md:hidden p-2 rounded-md transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:ring-offset-2"
                         type="button"
                         :aria-label="mobileMenuOpen ? 'Close menu' : 'Open menu'"
                         :aria-expanded="mobileMenuOpen ? 'true' : 'false'"
                         aria-controls="mobile-menu">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" focusable="false">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
                    </svg>
                </button>
            </div>
        </div>
        
        
        <div x-show="mobileMenuOpen" 
             x-transition:enter="transition ease-out duration-300"
             x-transition:enter-start="transform opacity-0 scale-95 translate-y-2"
             x-transition:enter-end="transform opacity-100 scale-100 translate-y-0"
             x-transition:leave="transition ease-in duration-200"
             x-transition:leave-start="transform opacity-100 scale-100 translate-y-0"
             x-transition:leave-end="transform opacity-0 scale-95 translate-y-2"
             id="mobile-menu"
             class="mobile-menu-container md:hidden"
             role="menu"
             aria-label="Mobile navigation menu">
            <div class="px-4 pt-4 pb-6 space-y-2">
                
                    
                        
                        <a href="/en/" 
                           class="mobile-nav-item block text-gray-700 dark:text-gray-300 ">
                            Home
                        </a>
                    
                
                    
                        
                        <a href="/en/posts/" 
                           class="mobile-nav-item block text-gray-700 dark:text-gray-300 ">
                            Blog
                        </a>
                    
                
                    
                        
                        <div x-data="{ mobileSubOpen: false }" class="space-y-1">
                            <button @click="mobileSubOpen = !mobileSubOpen"
                                    class="mobile-nav-item w-full flex items-center justify-between text-gray-700 dark:text-gray-300 ">
                                <span>DBA</span>
                                <svg class="w-4 h-4 transition-transform duration-200" :class="{ 'rotate-180': mobileSubOpen }" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                                </svg>
                            </button>
                            <div x-show="mobileSubOpen" 
                                 x-transition:enter="transition ease-out duration-200"
                                 x-transition:enter-start="opacity-0 -translate-y-1"
                                 x-transition:enter-end="opacity-100 translate-y-0"
                                 class="pl-4 space-y-1"
                                 style="display: none;">
                                
                                    <a href="/en/tags/mysql/" 
                                       class="mobile-nav-subitem block py-2 px-3 text-sm text-gray-600 dark:text-gray-400 hover:text-indigo-600 dark:hover:text-indigo-400 rounded-lg hover:bg-indigo-50 dark:hover:bg-indigo-900/20 transition-colors ">
                                        <span class="mr-2">üê¨</span>MySQL
                                    </a>
                                
                                    <a href="/en/tags/postgresql/" 
                                       class="mobile-nav-subitem block py-2 px-3 text-sm text-gray-600 dark:text-gray-400 hover:text-indigo-600 dark:hover:text-indigo-400 rounded-lg hover:bg-indigo-50 dark:hover:bg-indigo-900/20 transition-colors ">
                                        <span class="mr-2">üêò</span>PostgreSQL
                                    </a>
                                
                                    <a href="/en/tags/oracle/" 
                                       class="mobile-nav-subitem block py-2 px-3 text-sm text-gray-600 dark:text-gray-400 hover:text-indigo-600 dark:hover:text-indigo-400 rounded-lg hover:bg-indigo-50 dark:hover:bg-indigo-900/20 transition-colors ">
                                        <span class="mr-2">üî¥</span>Oracle
                                    </a>
                                
                                    <a href="/en/tags/tuning/" 
                                       class="mobile-nav-subitem block py-2 px-3 text-sm text-gray-600 dark:text-gray-400 hover:text-indigo-600 dark:hover:text-indigo-400 rounded-lg hover:bg-indigo-50 dark:hover:bg-indigo-900/20 transition-colors ">
                                        <span class="mr-2">‚ö°</span>Performance
                                    </a>
                                
                                    <a href="/en/tags/backup/" 
                                       class="mobile-nav-subitem block py-2 px-3 text-sm text-gray-600 dark:text-gray-400 hover:text-indigo-600 dark:hover:text-indigo-400 rounded-lg hover:bg-indigo-50 dark:hover:bg-indigo-900/20 transition-colors ">
                                        <span class="mr-2">üíæ</span>Backup &amp; Recovery
                                    </a>
                                
                            </div>
                        </div>
                    
                
                    
                        
                        <div x-data="{ mobileSubOpen: false }" class="space-y-1">
                            <button @click="mobileSubOpen = !mobileSubOpen"
                                    class="mobile-nav-item w-full flex items-center justify-between text-gray-700 dark:text-gray-300 ">
                                <span>Operations</span>
                                <svg class="w-4 h-4 transition-transform duration-200" :class="{ 'rotate-180': mobileSubOpen }" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                                </svg>
                            </button>
                            <div x-show="mobileSubOpen" 
                                 x-transition:enter="transition ease-out duration-200"
                                 x-transition:enter-start="opacity-0 -translate-y-1"
                                 x-transition:enter-end="opacity-100 translate-y-0"
                                 class="pl-4 space-y-1"
                                 style="display: none;">
                                
                                    <a href="/en/tags/linux/" 
                                       class="mobile-nav-subitem block py-2 px-3 text-sm text-gray-600 dark:text-gray-400 hover:text-indigo-600 dark:hover:text-indigo-400 rounded-lg hover:bg-indigo-50 dark:hover:bg-indigo-900/20 transition-colors ">
                                        <span class="mr-2">üêß</span>Linux Ops
                                    </a>
                                
                                    <a href="/en/tags/monitoring/" 
                                       class="mobile-nav-subitem block py-2 px-3 text-sm text-gray-600 dark:text-gray-400 hover:text-indigo-600 dark:hover:text-indigo-400 rounded-lg hover:bg-indigo-50 dark:hover:bg-indigo-900/20 transition-colors ">
                                        <span class="mr-2">üìä</span>Monitoring
                                    </a>
                                
                                    <a href="/en/tags/automation/" 
                                       class="mobile-nav-subitem block py-2 px-3 text-sm text-gray-600 dark:text-gray-400 hover:text-indigo-600 dark:hover:text-indigo-400 rounded-lg hover:bg-indigo-50 dark:hover:bg-indigo-900/20 transition-colors ">
                                        <span class="mr-2">ü§ñ</span>Automation
                                    </a>
                                
                                    <a href="/en/tags/network/" 
                                       class="mobile-nav-subitem block py-2 px-3 text-sm text-gray-600 dark:text-gray-400 hover:text-indigo-600 dark:hover:text-indigo-400 rounded-lg hover:bg-indigo-50 dark:hover:bg-indigo-900/20 transition-colors ">
                                        <span class="mr-2">üåê</span>Network Ops
                                    </a>
                                
                                    <a href="/en/tags/security/" 
                                       class="mobile-nav-subitem block py-2 px-3 text-sm text-gray-600 dark:text-gray-400 hover:text-indigo-600 dark:hover:text-indigo-400 rounded-lg hover:bg-indigo-50 dark:hover:bg-indigo-900/20 transition-colors ">
                                        <span class="mr-2">üîí</span>Security
                                    </a>
                                
                            </div>
                        </div>
                    
                
                    
                        
                        <div x-data="{ mobileSubOpen: false }" class="space-y-1">
                            <button @click="mobileSubOpen = !mobileSubOpen"
                                    class="mobile-nav-item w-full flex items-center justify-between text-gray-700 dark:text-gray-300 ">
                                <span>Cloud</span>
                                <svg class="w-4 h-4 transition-transform duration-200" :class="{ 'rotate-180': mobileSubOpen }" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                                </svg>
                            </button>
                            <div x-show="mobileSubOpen" 
                                 x-transition:enter="transition ease-out duration-200"
                                 x-transition:enter-start="opacity-0 -translate-y-1"
                                 x-transition:enter-end="opacity-100 translate-y-0"
                                 class="pl-4 space-y-1"
                                 style="display: none;">
                                
                                    <a href="/en/tags/aws/" 
                                       class="mobile-nav-subitem block py-2 px-3 text-sm text-gray-600 dark:text-gray-400 hover:text-indigo-600 dark:hover:text-indigo-400 rounded-lg hover:bg-indigo-50 dark:hover:bg-indigo-900/20 transition-colors ">
                                        <span class="mr-2">‚òÅÔ∏è</span>AWS
                                    </a>
                                
                                    <a href="/en/tags/azure/" 
                                       class="mobile-nav-subitem block py-2 px-3 text-sm text-gray-600 dark:text-gray-400 hover:text-indigo-600 dark:hover:text-indigo-400 rounded-lg hover:bg-indigo-50 dark:hover:bg-indigo-900/20 transition-colors ">
                                        <span class="mr-2">üåê</span>Azure
                                    </a>
                                
                                    <a href="/en/tags/aliyun/" 
                                       class="mobile-nav-subitem block py-2 px-3 text-sm text-gray-600 dark:text-gray-400 hover:text-indigo-600 dark:hover:text-indigo-400 rounded-lg hover:bg-indigo-50 dark:hover:bg-indigo-900/20 transition-colors ">
                                        <span class="mr-2">‚òÅÔ∏è</span>Aliyun
                                    </a>
                                
                                    <a href="/en/tags/architecture/" 
                                       class="mobile-nav-subitem block py-2 px-3 text-sm text-gray-600 dark:text-gray-400 hover:text-indigo-600 dark:hover:text-indigo-400 rounded-lg hover:bg-indigo-50 dark:hover:bg-indigo-900/20 transition-colors ">
                                        <span class="mr-2">üèóÔ∏è</span>Architecture
                                    </a>
                                
                                    <a href="/en/tags/cloud-native/" 
                                       class="mobile-nav-subitem block py-2 px-3 text-sm text-gray-600 dark:text-gray-400 hover:text-indigo-600 dark:hover:text-indigo-400 rounded-lg hover:bg-indigo-50 dark:hover:bg-indigo-900/20 transition-colors ">
                                        <span class="mr-2">üöÄ</span>Cloud Native
                                    </a>
                                
                            </div>
                        </div>
                    
                
                    
                        
                        <div x-data="{ mobileSubOpen: false }" class="space-y-1">
                            <button @click="mobileSubOpen = !mobileSubOpen"
                                    class="mobile-nav-item w-full flex items-center justify-between text-gray-700 dark:text-gray-300 ">
                                <span>DevOps</span>
                                <svg class="w-4 h-4 transition-transform duration-200" :class="{ 'rotate-180': mobileSubOpen }" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                                </svg>
                            </button>
                            <div x-show="mobileSubOpen" 
                                 x-transition:enter="transition ease-out duration-200"
                                 x-transition:enter-start="opacity-0 -translate-y-1"
                                 x-transition:enter-end="opacity-100 translate-y-0"
                                 class="pl-4 space-y-1"
                                 style="display: none;">
                                
                                    <a href="/en/tags/cicd/" 
                                       class="mobile-nav-subitem block py-2 px-3 text-sm text-gray-600 dark:text-gray-400 hover:text-indigo-600 dark:hover:text-indigo-400 rounded-lg hover:bg-indigo-50 dark:hover:bg-indigo-900/20 transition-colors ">
                                        <span class="mr-2">üîÑ</span>CI/CD
                                    </a>
                                
                                    <a href="/en/tags/docker/" 
                                       class="mobile-nav-subitem block py-2 px-3 text-sm text-gray-600 dark:text-gray-400 hover:text-indigo-600 dark:hover:text-indigo-400 rounded-lg hover:bg-indigo-50 dark:hover:bg-indigo-900/20 transition-colors ">
                                        <span class="mr-2">üê≥</span>Docker
                                    </a>
                                
                                    <a href="/en/tags/kubernetes/" 
                                       class="mobile-nav-subitem block py-2 px-3 text-sm text-gray-600 dark:text-gray-400 hover:text-indigo-600 dark:hover:text-indigo-400 rounded-lg hover:bg-indigo-50 dark:hover:bg-indigo-900/20 transition-colors ">
                                        <span class="mr-2">‚ò∏Ô∏è</span>Kubernetes
                                    </a>
                                
                                    <a href="/en/tags/gitops/" 
                                       class="mobile-nav-subitem block py-2 px-3 text-sm text-gray-600 dark:text-gray-400 hover:text-indigo-600 dark:hover:text-indigo-400 rounded-lg hover:bg-indigo-50 dark:hover:bg-indigo-900/20 transition-colors ">
                                        <span class="mr-2">üîÄ</span>GitOps
                                    </a>
                                
                                    <a href="/en/tags/observability/" 
                                       class="mobile-nav-subitem block py-2 px-3 text-sm text-gray-600 dark:text-gray-400 hover:text-indigo-600 dark:hover:text-indigo-400 rounded-lg hover:bg-indigo-50 dark:hover:bg-indigo-900/20 transition-colors ">
                                        <span class="mr-2">üëÅÔ∏è</span>Observability
                                    </a>
                                
                            </div>
                        </div>
                    
                
                    
                        
                        <a href="/en/about/" 
                           class="mobile-nav-item block text-gray-700 dark:text-gray-300 ">
                            About
                        </a>
                    
                
            </div>
        </div>
    </div>
    

    </nav>
</section>


<script>

function toggleTheme() {
    if (window.themeManager) {
        window.themeManager.toggleTheme();
    } else {
        
        const html = document.documentElement;
        const currentTheme = html.classList.contains('dark') ? 'dark' : 'light';
        const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
        
        if (newTheme === 'dark') {
            html.classList.add('dark');
        } else {
            html.classList.remove('dark');
        }
        
        localStorage.setItem('theme', newTheme);
        updateThemeIcon(newTheme);
    }
}


function updateThemeIcon(theme) {
    const button = document.querySelector('[data-toggle="dark-mode"]');
    if (button) {
        const svg = button.querySelector('svg path');
        if (svg) {
            if (theme === 'dark') {
                
                svg.setAttribute('d', 'M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z');
            } else {
                
                svg.setAttribute('d', 'M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z');
            }
        }
    }
}


document.addEventListener('alpine:init', () => {
    Alpine.data('nav', () => ({
        init() {
            
            const savedTheme = localStorage.getItem('theme');
            const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
            const theme = savedTheme || (prefersDark ? 'dark' : 'light');
            
            if (theme === 'dark') {
                document.documentElement.classList.add('dark');
            }

            
            if (window.location.pathname.includes('/search')) {
                window['searchManager'] = new SearchManager();
            }
        }
    }));
});


document.addEventListener('DOMContentLoaded', function() {
    
    setTimeout(() => {
        if (!window.themeManager) {
            const savedTheme = localStorage.getItem('theme');
            const systemPrefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
            const theme = savedTheme || (systemPrefersDark ? 'dark' : 'light');
            
            const html = document.documentElement;
            if (theme === 'dark') {
                html.classList.add('dark');
            } else {
                html.classList.remove('dark');
            }
            
            updateThemeIcon(theme);
        }
    }, 100);
    
    
    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener('click', function (e) {
            e.preventDefault();
            const target = document.querySelector(this.getAttribute('href'));
            if (target) {
                target.scrollIntoView({
                    behavior: 'smooth',
                    block: 'start'
                });
            }
        });
    });
});
</script>
    </div>

    
    <main id="main-content" class="relative z-10 min-h-screen transition-all duration-500"
        x-data="{ notificationVisible: !localStorage.getItem('notification-dismissed') }" x-init="
              window.addEventListener('storage', () => {
                  notificationVisible = !localStorage.getItem('notification-dismissed');
              });
          " :class="{
              'pt-28': notificationVisible,
              'pt-16': !notificationVisible
          }">
        

<div
    class="relative bg-gradient-to-br from-indigo-50 via-purple-50 to-pink-50 dark:from-gray-900 dark:via-indigo-900 dark:to-purple-900 py-12 mb-8">
    <div class="absolute inset-0 opacity-10">
        <div class="absolute inset-0 bg-pattern-dots">
        </div>
    </div>
    <div class="relative max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="max-w-4xl">
            
            <nav class="flex items-center space-x-2 text-sm text-gray-600 dark:text-gray-400 mb-4">
                <a href="/en/"
                    class="hover:text-purple-600 dark:hover:text-purple-400 transition-colors duration-200">
                    Home
                </a>
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                </svg>
                
                
                <a href="/en/categories/devops"
                    class="hover:text-purple-600 dark:hover:text-purple-400 transition-colors duration-200">
                    DevOps
                </a>
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                </svg>
                
                
                <span class="text-gray-500 dark:text-gray-500">Performance Optimization for Cloud-Native Applications: From Profiling to Production Tuning</span>
            </nav>

            
            
            <div class="flex flex-wrap gap-2 mb-4">
                
                <a href="/en/categories/devops"
                    class="inline-block px-3 py-1 text-sm font-medium text-purple-600 dark:text-purple-400 bg-purple-100 dark:bg-purple-900/30 rounded-full hover:bg-purple-200 dark:hover:bg-purple-900/50 transition-colors duration-200">
                    DevOps
                </a>
                
            </div>
            

            
            <h1 class="text-3xl md:text-4xl lg:text-5xl font-bold text-gray-900 dark:text-white mb-6 leading-tight">
                Performance Optimization for Cloud-Native Applications: From Profiling to Production Tuning
            </h1>

            
            <div class="flex flex-wrap items-center gap-6 text-sm text-gray-600 dark:text-gray-400">
                
                <div class="flex items-center">
                    <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                    </svg>
                    <span>Author</span>
                </div>

                
                <div class="flex items-center">
                    <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z">
                        </path>
                    </svg>
                    <time datetime="2025-12-31">
                        2025-12-31
                    </time>
                </div>

                
                <div class="flex items-center">
                    <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                    </svg>
                    <span>20 min</span>
                </div>

                
                <div class="flex items-center">
                    <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z">
                        </path>
                    </svg>
                    <span>4199 words</span>
                </div>

                
                <div class="flex items-center">
                    <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z">
                        </path>
                    </svg>
                    <span id="view-count">--</span>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="relative max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 pb-12">
    <div class="grid grid-cols-1 lg:grid-cols-[1fr_320px] gap-8">
        
        <article class="min-w-0 overflow-hidden">
            
            

            
            
            
            
            
            

            <div
                class="ai-summary bg-gradient-to-r from-blue-50 to-indigo-50 dark:from-blue-900/20 dark:to-indigo-900/20 rounded-xl p-6 mb-8 border border-blue-200 dark:border-blue-700/50 shadow-sm">
                
                <div class="flex items-center mb-4">
                    <div
                        class="flex-shrink-0 w-8 h-8 bg-gradient-to-r from-blue-500 to-indigo-600 rounded-lg flex items-center justify-center mr-3">
                        <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"
                            aria-hidden="true">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z">
                            </path>
                        </svg>
                    </div>
                    <h3 class="text-lg font-semibold text-gray-900 dark:text-gray-100">
                        AI Summary
                    </h3>
                </div>

                
                <div class="prose prose-blue max-w-none dark:prose-invert">
                    
                    <p class="text-gray-600 dark:text-gray-300">
                        
                        This article provides comprehensive insights into "Performance Optimization for Cloud-Native Applications: From Profiling to Production Tuning", exploring key
                        concepts, practical applications, and future developments to offer readers a thorough
                        understanding of the subject matter.
                        
                    </p>
                    
                </div>

                
                <div class="mt-4 pt-3 border-t border-blue-200 dark:border-blue-700/50">
                    <p class="text-xs text-gray-500 dark:text-gray-400 flex items-center">
                        <svg class="w-3 h-3 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24"
                            aria-hidden="true">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                        </svg>
                        Content generated by AI
                    </p>
                </div>
            </div>
            

            
            <div class="article-content prose prose-lg max-w-none overflow-hidden">
                <h1 id="performance-optimization-for-cloud-native-applications-from-profiling-to-production-tuning">Performance Optimization for Cloud-Native Applications: From Profiling to Production Tuning</h1>
<p>Performance optimization is a critical aspect of running successful cloud-native applications at scale. This comprehensive guide covers systematic approaches to identifying performance bottlenecks, implementing optimization strategies, and maintaining optimal performance in production environments.</p>
<h2 id="performance-optimization-methodology">Performance Optimization Methodology</h2>
<h3 id="performance-engineering-lifecycle">Performance Engineering Lifecycle</h3>
<pre tabindex="0"><code class="language-mermaid" data-lang="mermaid">graph TB
    subgraph &#34;Performance Engineering Lifecycle&#34;
        A[Requirements Analysis] --&gt; B[Baseline Measurement]
        B --&gt; C[Profiling &amp; Analysis]
        C --&gt; D[Optimization Implementation]
        D --&gt; E[Testing &amp; Validation]
        E --&gt; F[Production Deployment]
        F --&gt; G[Continuous Monitoring]
        G --&gt; C
    end
    
    subgraph &#34;Key Metrics&#34;
        H[Response Time]
        I[Throughput]
        J[Resource Utilization]
        K[Error Rate]
        L[Scalability]
    end
    
    subgraph &#34;Optimization Areas&#34;
        M[Application Code]
        N[Database Queries]
        O[Caching Layer]
        P[Network I/O]
        Q[Resource Allocation]
    end
    
    C --&gt; H
    C --&gt; I
    C --&gt; J
    C --&gt; K
    C --&gt; L
    
    D --&gt; M
    D --&gt; N
    D --&gt; O
    D --&gt; P
    D --&gt; Q
</code></pre><h3 id="performance-metrics-framework">Performance Metrics Framework</h3>
<table>
  <thead>
      <tr>
          <th>Category</th>
          <th>Metric</th>
          <th>Target</th>
          <th>Measurement Method</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td><strong>Latency</strong></td>
          <td>P50 Response Time</td>
          <td>&lt; 100ms</td>
          <td>Application metrics</td>
      </tr>
      <tr>
          <td></td>
          <td>P95 Response Time</td>
          <td>&lt; 500ms</td>
          <td>Application metrics</td>
      </tr>
      <tr>
          <td></td>
          <td>P99 Response Time</td>
          <td>&lt; 1000ms</td>
          <td>Application metrics</td>
      </tr>
      <tr>
          <td><strong>Throughput</strong></td>
          <td>Requests per Second</td>
          <td>&gt; 1000 RPS</td>
          <td>Load testing</td>
      </tr>
      <tr>
          <td></td>
          <td>Transactions per Second</td>
          <td>&gt; 500 TPS</td>
          <td>Database metrics</td>
      </tr>
      <tr>
          <td><strong>Resource</strong></td>
          <td>CPU Utilization</td>
          <td>&lt; 70%</td>
          <td>System metrics</td>
      </tr>
      <tr>
          <td></td>
          <td>Memory Utilization</td>
          <td>&lt; 80%</td>
          <td>System metrics</td>
      </tr>
      <tr>
          <td></td>
          <td>Disk I/O</td>
          <td>&lt; 80%</td>
          <td>System metrics</td>
      </tr>
      <tr>
          <td><strong>Availability</strong></td>
          <td>Uptime</td>
          <td>&gt; 99.9%</td>
          <td>Health checks</td>
      </tr>
      <tr>
          <td></td>
          <td>Error Rate</td>
          <td>&lt; 0.1%</td>
          <td>Application logs</td>
      </tr>
  </tbody>
</table>
<h2 id="application-profiling-and-analysis">Application Profiling and Analysis</h2>
<h3 id="go-application-profiling">Go Application Profiling</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="c1">// profiling/profiler.go</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kn">package</span><span class="w"> </span><span class="nx">main</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kn">import</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s">&#34;context&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s">&#34;fmt&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s">&#34;log&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s">&#34;net/http&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nx">_</span><span class="w"> </span><span class="s">&#34;net/http/pprof&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s">&#34;os&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s">&#34;runtime&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s">&#34;runtime/pprof&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s">&#34;time&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s">&#34;github.com/prometheus/client_golang/prometheus&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s">&#34;github.com/prometheus/client_golang/prometheus/promauto&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s">&#34;github.com/prometheus/client_golang/prometheus/promhttp&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">// Custom metrics for performance monitoring</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">var</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nx">requestDuration</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">promauto</span><span class="p">.</span><span class="nf">NewHistogramVec</span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nx">prometheus</span><span class="p">.</span><span class="nx">HistogramOpts</span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nx">Name</span><span class="p">:</span><span class="w"> </span><span class="s">&#34;http_request_duration_seconds&#34;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nx">Help</span><span class="p">:</span><span class="w"> </span><span class="s">&#34;Duration of HTTP requests in seconds&#34;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nx">Buckets</span><span class="p">:</span><span class="w"> </span><span class="nx">prometheus</span><span class="p">.</span><span class="nx">DefBuckets</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">},</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">[]</span><span class="kt">string</span><span class="p">{</span><span class="s">&#34;method&#34;</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;endpoint&#34;</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;status_code&#34;</span><span class="p">},</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nx">memoryUsage</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">promauto</span><span class="p">.</span><span class="nf">NewGaugeVec</span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nx">prometheus</span><span class="p">.</span><span class="nx">GaugeOpts</span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nx">Name</span><span class="p">:</span><span class="w"> </span><span class="s">&#34;memory_usage_bytes&#34;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nx">Help</span><span class="p">:</span><span class="w"> </span><span class="s">&#34;Current memory usage in bytes&#34;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">},</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">[]</span><span class="kt">string</span><span class="p">{</span><span class="s">&#34;type&#34;</span><span class="p">},</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nx">goroutineCount</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">promauto</span><span class="p">.</span><span class="nf">NewGauge</span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nx">prometheus</span><span class="p">.</span><span class="nx">GaugeOpts</span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nx">Name</span><span class="p">:</span><span class="w"> </span><span class="s">&#34;goroutines_total&#34;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nx">Help</span><span class="p">:</span><span class="w"> </span><span class="s">&#34;Current number of goroutines&#34;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">},</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nx">gcDuration</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">promauto</span><span class="p">.</span><span class="nf">NewHistogram</span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nx">prometheus</span><span class="p">.</span><span class="nx">HistogramOpts</span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nx">Name</span><span class="p">:</span><span class="w"> </span><span class="s">&#34;gc_duration_seconds&#34;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nx">Help</span><span class="p">:</span><span class="w"> </span><span class="s">&#34;Duration of garbage collection cycles&#34;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nx">Buckets</span><span class="p">:</span><span class="w"> </span><span class="p">[]</span><span class="kt">float64</span><span class="p">{</span><span class="mf">0.001</span><span class="p">,</span><span class="w"> </span><span class="mf">0.005</span><span class="p">,</span><span class="w"> </span><span class="mf">0.01</span><span class="p">,</span><span class="w"> </span><span class="mf">0.05</span><span class="p">,</span><span class="w"> </span><span class="mf">0.1</span><span class="p">,</span><span class="w"> </span><span class="mf">0.5</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0</span><span class="p">},</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">},</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">type</span><span class="w"> </span><span class="nx">PerformanceProfiler</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nx">cpuProfileFile</span><span class="w">    </span><span class="kt">string</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nx">memProfileFile</span><span class="w">    </span><span class="kt">string</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nx">blockProfileFile</span><span class="w">  </span><span class="kt">string</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nx">mutexProfileFile</span><span class="w">  </span><span class="kt">string</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nx">traceFile</span><span class="w">         </span><span class="kt">string</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nx">profilingEnabled</span><span class="w">  </span><span class="kt">bool</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">func</span><span class="w"> </span><span class="nf">NewPerformanceProfiler</span><span class="p">()</span><span class="w"> </span><span class="o">*</span><span class="nx">PerformanceProfiler</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">PerformanceProfiler</span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nx">cpuProfileFile</span><span class="p">:</span><span class="w">   </span><span class="s">&#34;cpu.prof&#34;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nx">memProfileFile</span><span class="p">:</span><span class="w">   </span><span class="s">&#34;mem.prof&#34;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nx">blockProfileFile</span><span class="p">:</span><span class="w"> </span><span class="s">&#34;block.prof&#34;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nx">mutexProfileFile</span><span class="p">:</span><span class="w"> </span><span class="s">&#34;mutex.prof&#34;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nx">traceFile</span><span class="p">:</span><span class="w">        </span><span class="s">&#34;trace.out&#34;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nx">profilingEnabled</span><span class="p">:</span><span class="w"> </span><span class="nx">os</span><span class="p">.</span><span class="nf">Getenv</span><span class="p">(</span><span class="s">&#34;ENABLE_PROFILING&#34;</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&#34;true&#34;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">pp</span><span class="w"> </span><span class="o">*</span><span class="nx">PerformanceProfiler</span><span class="p">)</span><span class="w"> </span><span class="nf">StartCPUProfiling</span><span class="p">()</span><span class="w"> </span><span class="kt">error</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">!</span><span class="nx">pp</span><span class="p">.</span><span class="nx">profilingEnabled</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nx">f</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">os</span><span class="p">.</span><span class="nf">Create</span><span class="p">(</span><span class="nx">pp</span><span class="p">.</span><span class="nx">cpuProfileFile</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nf">Errorf</span><span class="p">(</span><span class="s">&#34;could not create CPU profile: %w&#34;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">pprof</span><span class="p">.</span><span class="nf">StartCPUProfile</span><span class="p">(</span><span class="nx">f</span><span class="p">);</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nx">f</span><span class="p">.</span><span class="nf">Close</span><span class="p">()</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nf">Errorf</span><span class="p">(</span><span class="s">&#34;could not start CPU profile: %w&#34;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nx">log</span><span class="p">.</span><span class="nf">Printf</span><span class="p">(</span><span class="s">&#34;CPU profiling started, writing to %s&#34;</span><span class="p">,</span><span class="w"> </span><span class="nx">pp</span><span class="p">.</span><span class="nx">cpuProfileFile</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">pp</span><span class="w"> </span><span class="o">*</span><span class="nx">PerformanceProfiler</span><span class="p">)</span><span class="w"> </span><span class="nf">StopCPUProfiling</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">!</span><span class="nx">pp</span><span class="p">.</span><span class="nx">profilingEnabled</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nx">pprof</span><span class="p">.</span><span class="nf">StopCPUProfile</span><span class="p">()</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nx">log</span><span class="p">.</span><span class="nf">Printf</span><span class="p">(</span><span class="s">&#34;CPU profiling stopped&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">pp</span><span class="w"> </span><span class="o">*</span><span class="nx">PerformanceProfiler</span><span class="p">)</span><span class="w"> </span><span class="nf">WriteMemoryProfile</span><span class="p">()</span><span class="w"> </span><span class="kt">error</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">!</span><span class="nx">pp</span><span class="p">.</span><span class="nx">profilingEnabled</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nx">f</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">os</span><span class="p">.</span><span class="nf">Create</span><span class="p">(</span><span class="nx">pp</span><span class="p">.</span><span class="nx">memProfileFile</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nf">Errorf</span><span class="p">(</span><span class="s">&#34;could not create memory profile: %w&#34;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">defer</span><span class="w"> </span><span class="nx">f</span><span class="p">.</span><span class="nf">Close</span><span class="p">()</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nx">runtime</span><span class="p">.</span><span class="nf">GC</span><span class="p">()</span><span class="w"> </span><span class="c1">// Force GC before memory profile</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">pprof</span><span class="p">.</span><span class="nf">WriteHeapProfile</span><span class="p">(</span><span class="nx">f</span><span class="p">);</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nf">Errorf</span><span class="p">(</span><span class="s">&#34;could not write memory profile: %w&#34;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nx">log</span><span class="p">.</span><span class="nf">Printf</span><span class="p">(</span><span class="s">&#34;Memory profile written to %s&#34;</span><span class="p">,</span><span class="w"> </span><span class="nx">pp</span><span class="p">.</span><span class="nx">memProfileFile</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">pp</span><span class="w"> </span><span class="o">*</span><span class="nx">PerformanceProfiler</span><span class="p">)</span><span class="w"> </span><span class="nf">WriteBlockProfile</span><span class="p">()</span><span class="w"> </span><span class="kt">error</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">!</span><span class="nx">pp</span><span class="p">.</span><span class="nx">profilingEnabled</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nx">f</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">os</span><span class="p">.</span><span class="nf">Create</span><span class="p">(</span><span class="nx">pp</span><span class="p">.</span><span class="nx">blockProfileFile</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nf">Errorf</span><span class="p">(</span><span class="s">&#34;could not create block profile: %w&#34;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">defer</span><span class="w"> </span><span class="nx">f</span><span class="p">.</span><span class="nf">Close</span><span class="p">()</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">pprof</span><span class="p">.</span><span class="nf">Lookup</span><span class="p">(</span><span class="s">&#34;block&#34;</span><span class="p">).</span><span class="nf">WriteTo</span><span class="p">(</span><span class="nx">f</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nf">Errorf</span><span class="p">(</span><span class="s">&#34;could not write block profile: %w&#34;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nx">log</span><span class="p">.</span><span class="nf">Printf</span><span class="p">(</span><span class="s">&#34;Block profile written to %s&#34;</span><span class="p">,</span><span class="w"> </span><span class="nx">pp</span><span class="p">.</span><span class="nx">blockProfileFile</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">pp</span><span class="w"> </span><span class="o">*</span><span class="nx">PerformanceProfiler</span><span class="p">)</span><span class="w"> </span><span class="nf">WriteMutexProfile</span><span class="p">()</span><span class="w"> </span><span class="kt">error</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">!</span><span class="nx">pp</span><span class="p">.</span><span class="nx">profilingEnabled</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nx">f</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">os</span><span class="p">.</span><span class="nf">Create</span><span class="p">(</span><span class="nx">pp</span><span class="p">.</span><span class="nx">mutexProfileFile</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nf">Errorf</span><span class="p">(</span><span class="s">&#34;could not create mutex profile: %w&#34;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">defer</span><span class="w"> </span><span class="nx">f</span><span class="p">.</span><span class="nf">Close</span><span class="p">()</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">pprof</span><span class="p">.</span><span class="nf">Lookup</span><span class="p">(</span><span class="s">&#34;mutex&#34;</span><span class="p">).</span><span class="nf">WriteTo</span><span class="p">(</span><span class="nx">f</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nf">Errorf</span><span class="p">(</span><span class="s">&#34;could not write mutex profile: %w&#34;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nx">log</span><span class="p">.</span><span class="nf">Printf</span><span class="p">(</span><span class="s">&#34;Mutex profile written to %s&#34;</span><span class="p">,</span><span class="w"> </span><span class="nx">pp</span><span class="p">.</span><span class="nx">mutexProfileFile</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">// Performance monitoring middleware</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">pp</span><span class="w"> </span><span class="o">*</span><span class="nx">PerformanceProfiler</span><span class="p">)</span><span class="w"> </span><span class="nf">PerformanceMiddleware</span><span class="p">(</span><span class="nx">next</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">Handler</span><span class="p">)</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">Handler</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nf">HandlerFunc</span><span class="p">(</span><span class="kd">func</span><span class="p">(</span><span class="nx">w</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">ResponseWriter</span><span class="p">,</span><span class="w"> </span><span class="nx">r</span><span class="w"> </span><span class="o">*</span><span class="nx">http</span><span class="p">.</span><span class="nx">Request</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nx">start</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">time</span><span class="p">.</span><span class="nf">Now</span><span class="p">()</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">// Wrap response writer to capture status code</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nx">wrapped</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">responseWriter</span><span class="p">{</span><span class="nx">ResponseWriter</span><span class="p">:</span><span class="w"> </span><span class="nx">w</span><span class="p">,</span><span class="w"> </span><span class="nx">statusCode</span><span class="p">:</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusOK</span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">// Process request</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nx">next</span><span class="p">.</span><span class="nf">ServeHTTP</span><span class="p">(</span><span class="nx">wrapped</span><span class="p">,</span><span class="w"> </span><span class="nx">r</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">// Record metrics</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nx">duration</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">time</span><span class="p">.</span><span class="nf">Since</span><span class="p">(</span><span class="nx">start</span><span class="p">).</span><span class="nf">Seconds</span><span class="p">()</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nx">requestDuration</span><span class="p">.</span><span class="nf">WithLabelValues</span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nx">r</span><span class="p">.</span><span class="nx">Method</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nx">r</span><span class="p">.</span><span class="nx">URL</span><span class="p">.</span><span class="nx">Path</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nx">fmt</span><span class="p">.</span><span class="nf">Sprintf</span><span class="p">(</span><span class="s">&#34;%d&#34;</span><span class="p">,</span><span class="w"> </span><span class="nx">wrapped</span><span class="p">.</span><span class="nx">statusCode</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">).</span><span class="nf">Observe</span><span class="p">(</span><span class="nx">duration</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">})</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">type</span><span class="w"> </span><span class="nx">responseWriter</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nx">http</span><span class="p">.</span><span class="nx">ResponseWriter</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nx">statusCode</span><span class="w"> </span><span class="kt">int</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">rw</span><span class="w"> </span><span class="o">*</span><span class="nx">responseWriter</span><span class="p">)</span><span class="w"> </span><span class="nf">WriteHeader</span><span class="p">(</span><span class="nx">code</span><span class="w"> </span><span class="kt">int</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nx">rw</span><span class="p">.</span><span class="nx">statusCode</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">code</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nx">rw</span><span class="p">.</span><span class="nx">ResponseWriter</span><span class="p">.</span><span class="nf">WriteHeader</span><span class="p">(</span><span class="nx">code</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">// Runtime metrics collector</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">pp</span><span class="w"> </span><span class="o">*</span><span class="nx">PerformanceProfiler</span><span class="p">)</span><span class="w"> </span><span class="nf">StartMetricsCollection</span><span class="p">(</span><span class="nx">ctx</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nx">ticker</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">time</span><span class="p">.</span><span class="nf">NewTicker</span><span class="p">(</span><span class="mi">10</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">time</span><span class="p">.</span><span class="nx">Second</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">defer</span><span class="w"> </span><span class="nx">ticker</span><span class="p">.</span><span class="nf">Stop</span><span class="p">()</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">select</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="o">&lt;-</span><span class="nx">ctx</span><span class="p">.</span><span class="nf">Done</span><span class="p">():</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">return</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="o">&lt;-</span><span class="nx">ticker</span><span class="p">.</span><span class="nx">C</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nx">pp</span><span class="p">.</span><span class="nf">collectRuntimeMetrics</span><span class="p">()</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">pp</span><span class="w"> </span><span class="o">*</span><span class="nx">PerformanceProfiler</span><span class="p">)</span><span class="w"> </span><span class="nf">collectRuntimeMetrics</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">m</span><span class="w"> </span><span class="nx">runtime</span><span class="p">.</span><span class="nx">MemStats</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nx">runtime</span><span class="p">.</span><span class="nf">ReadMemStats</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">m</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// Memory metrics</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nx">memoryUsage</span><span class="p">.</span><span class="nf">WithLabelValues</span><span class="p">(</span><span class="s">&#34;heap_alloc&#34;</span><span class="p">).</span><span class="nf">Set</span><span class="p">(</span><span class="nb">float64</span><span class="p">(</span><span class="nx">m</span><span class="p">.</span><span class="nx">HeapAlloc</span><span class="p">))</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nx">memoryUsage</span><span class="p">.</span><span class="nf">WithLabelValues</span><span class="p">(</span><span class="s">&#34;heap_sys&#34;</span><span class="p">).</span><span class="nf">Set</span><span class="p">(</span><span class="nb">float64</span><span class="p">(</span><span class="nx">m</span><span class="p">.</span><span class="nx">HeapSys</span><span class="p">))</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nx">memoryUsage</span><span class="p">.</span><span class="nf">WithLabelValues</span><span class="p">(</span><span class="s">&#34;heap_idle&#34;</span><span class="p">).</span><span class="nf">Set</span><span class="p">(</span><span class="nb">float64</span><span class="p">(</span><span class="nx">m</span><span class="p">.</span><span class="nx">HeapIdle</span><span class="p">))</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nx">memoryUsage</span><span class="p">.</span><span class="nf">WithLabelValues</span><span class="p">(</span><span class="s">&#34;heap_inuse&#34;</span><span class="p">).</span><span class="nf">Set</span><span class="p">(</span><span class="nb">float64</span><span class="p">(</span><span class="nx">m</span><span class="p">.</span><span class="nx">HeapInuse</span><span class="p">))</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nx">memoryUsage</span><span class="p">.</span><span class="nf">WithLabelValues</span><span class="p">(</span><span class="s">&#34;stack_inuse&#34;</span><span class="p">).</span><span class="nf">Set</span><span class="p">(</span><span class="nb">float64</span><span class="p">(</span><span class="nx">m</span><span class="p">.</span><span class="nx">StackInuse</span><span class="p">))</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nx">memoryUsage</span><span class="p">.</span><span class="nf">WithLabelValues</span><span class="p">(</span><span class="s">&#34;stack_sys&#34;</span><span class="p">).</span><span class="nf">Set</span><span class="p">(</span><span class="nb">float64</span><span class="p">(</span><span class="nx">m</span><span class="p">.</span><span class="nx">StackSys</span><span class="p">))</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// Goroutine count</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nx">goroutineCount</span><span class="p">.</span><span class="nf">Set</span><span class="p">(</span><span class="nb">float64</span><span class="p">(</span><span class="nx">runtime</span><span class="p">.</span><span class="nf">NumGoroutine</span><span class="p">()))</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// GC metrics</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nx">gcDuration</span><span class="p">.</span><span class="nf">Observe</span><span class="p">(</span><span class="nb">float64</span><span class="p">(</span><span class="nx">m</span><span class="p">.</span><span class="nx">PauseTotalNs</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mf">1e9</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">// Benchmark helper functions</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">func</span><span class="w"> </span><span class="nf">BenchmarkCriticalPath</span><span class="p">(</span><span class="nx">b</span><span class="w"> </span><span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">B</span><span class="p">,</span><span class="w"> </span><span class="nx">fn</span><span class="w"> </span><span class="kd">func</span><span class="p">())</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nx">b</span><span class="p">.</span><span class="nf">ResetTimer</span><span class="p">()</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nx">b</span><span class="p">.</span><span class="nf">ReportAllocs</span><span class="p">()</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="p">&lt;</span><span class="w"> </span><span class="nx">b</span><span class="p">.</span><span class="nx">N</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="o">++</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nf">fn</span><span class="p">()</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">func</span><span class="w"> </span><span class="nf">ProfileFunction</span><span class="p">(</span><span class="nx">name</span><span class="w"> </span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="nx">fn</span><span class="w"> </span><span class="kd">func</span><span class="p">())</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nx">start</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">time</span><span class="p">.</span><span class="nf">Now</span><span class="p">()</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nf">fn</span><span class="p">()</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nx">duration</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">time</span><span class="p">.</span><span class="nf">Since</span><span class="p">(</span><span class="nx">start</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nx">log</span><span class="p">.</span><span class="nf">Printf</span><span class="p">(</span><span class="s">&#34;Function %s took %v&#34;</span><span class="p">,</span><span class="w"> </span><span class="nx">name</span><span class="p">,</span><span class="w"> </span><span class="nx">duration</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">// Example usage in main application</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">func</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nx">profiler</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nf">NewPerformanceProfiler</span><span class="p">()</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// Enable block and mutex profiling</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nx">runtime</span><span class="p">.</span><span class="nf">SetBlockProfileRate</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nx">runtime</span><span class="p">.</span><span class="nf">SetMutexProfileFraction</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// Start CPU profiling</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">profiler</span><span class="p">.</span><span class="nf">StartCPUProfiling</span><span class="p">();</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nx">log</span><span class="p">.</span><span class="nf">Printf</span><span class="p">(</span><span class="s">&#34;Failed to start CPU profiling: %v&#34;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">defer</span><span class="w"> </span><span class="nx">profiler</span><span class="p">.</span><span class="nf">StopCPUProfiling</span><span class="p">()</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// Start metrics collection</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">cancel</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nf">WithCancel</span><span class="p">(</span><span class="nx">context</span><span class="p">.</span><span class="nf">Background</span><span class="p">())</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">defer</span><span class="w"> </span><span class="nf">cancel</span><span class="p">()</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">go</span><span class="w"> </span><span class="nx">profiler</span><span class="p">.</span><span class="nf">StartMetricsCollection</span><span class="p">(</span><span class="nx">ctx</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// Set up HTTP server with profiling endpoints</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nx">mux</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nf">NewServeMux</span><span class="p">()</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// Application endpoints</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nx">mux</span><span class="p">.</span><span class="nf">HandleFunc</span><span class="p">(</span><span class="s">&#34;/api/users&#34;</span><span class="p">,</span><span class="w"> </span><span class="nx">handleUsers</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nx">mux</span><span class="p">.</span><span class="nf">HandleFunc</span><span class="p">(</span><span class="s">&#34;/api/orders&#34;</span><span class="p">,</span><span class="w"> </span><span class="nx">handleOrders</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// Profiling endpoints (only in development)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">os</span><span class="p">.</span><span class="nf">Getenv</span><span class="p">(</span><span class="s">&#34;ENVIRONMENT&#34;</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&#34;development&#34;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nx">mux</span><span class="p">.</span><span class="nf">HandleFunc</span><span class="p">(</span><span class="s">&#34;/debug/pprof/&#34;</span><span class="p">,</span><span class="w"> </span><span class="nx">pprof</span><span class="p">.</span><span class="nx">Index</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nx">mux</span><span class="p">.</span><span class="nf">HandleFunc</span><span class="p">(</span><span class="s">&#34;/debug/pprof/cmdline&#34;</span><span class="p">,</span><span class="w"> </span><span class="nx">pprof</span><span class="p">.</span><span class="nx">Cmdline</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nx">mux</span><span class="p">.</span><span class="nf">HandleFunc</span><span class="p">(</span><span class="s">&#34;/debug/pprof/profile&#34;</span><span class="p">,</span><span class="w"> </span><span class="nx">pprof</span><span class="p">.</span><span class="nx">Profile</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nx">mux</span><span class="p">.</span><span class="nf">HandleFunc</span><span class="p">(</span><span class="s">&#34;/debug/pprof/symbol&#34;</span><span class="p">,</span><span class="w"> </span><span class="nx">pprof</span><span class="p">.</span><span class="nx">Symbol</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nx">mux</span><span class="p">.</span><span class="nf">HandleFunc</span><span class="p">(</span><span class="s">&#34;/debug/pprof/trace&#34;</span><span class="p">,</span><span class="w"> </span><span class="nx">pprof</span><span class="p">.</span><span class="nx">Trace</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// Metrics endpoint</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nx">mux</span><span class="p">.</span><span class="nf">Handle</span><span class="p">(</span><span class="s">&#34;/metrics&#34;</span><span class="p">,</span><span class="w"> </span><span class="nx">promhttp</span><span class="p">.</span><span class="nf">Handler</span><span class="p">())</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// Apply performance middleware</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nx">handler</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">profiler</span><span class="p">.</span><span class="nf">PerformanceMiddleware</span><span class="p">(</span><span class="nx">mux</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nx">log</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;Server starting on :8080&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nx">log</span><span class="p">.</span><span class="nf">Fatal</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nf">ListenAndServe</span><span class="p">(</span><span class="s">&#34;:8080&#34;</span><span class="p">,</span><span class="w"> </span><span class="nx">handler</span><span class="p">))</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">func</span><span class="w"> </span><span class="nf">handleUsers</span><span class="p">(</span><span class="nx">w</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">ResponseWriter</span><span class="p">,</span><span class="w"> </span><span class="nx">r</span><span class="w"> </span><span class="o">*</span><span class="nx">http</span><span class="p">.</span><span class="nx">Request</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// Simulate some work</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nx">time</span><span class="p">.</span><span class="nf">Sleep</span><span class="p">(</span><span class="mi">50</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">time</span><span class="p">.</span><span class="nx">Millisecond</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nx">w</span><span class="p">.</span><span class="nf">WriteHeader</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusOK</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nx">w</span><span class="p">.</span><span class="nf">Write</span><span class="p">([]</span><span class="nb">byte</span><span class="p">(</span><span class="s">`{&#34;users&#34;: []}`</span><span class="p">))</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">func</span><span class="w"> </span><span class="nf">handleOrders</span><span class="p">(</span><span class="nx">w</span><span class="w"> </span><span class="nx">http</span><span class="p">.</span><span class="nx">ResponseWriter</span><span class="p">,</span><span class="w"> </span><span class="nx">r</span><span class="w"> </span><span class="o">*</span><span class="nx">http</span><span class="p">.</span><span class="nx">Request</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// Simulate database query</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nx">time</span><span class="p">.</span><span class="nf">Sleep</span><span class="p">(</span><span class="mi">100</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">time</span><span class="p">.</span><span class="nx">Millisecond</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nx">w</span><span class="p">.</span><span class="nf">WriteHeader</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">StatusOK</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nx">w</span><span class="p">.</span><span class="nf">Write</span><span class="p">([]</span><span class="nb">byte</span><span class="p">(</span><span class="s">`{&#34;orders&#34;: []}`</span><span class="p">))</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><h3 id="database-query-optimization">Database Query Optimization</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="c1">-- database/optimization.sql
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">-- Index optimization for common query patterns
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">CREATE</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="n">CONCURRENTLY</span><span class="w"> </span><span class="n">idx_users_email_active</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">ON</span><span class="w"> </span><span class="n">users</span><span class="w"> </span><span class="p">(</span><span class="n">email</span><span class="p">)</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WHERE</span><span class="w"> </span><span class="n">active</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">true</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">CREATE</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="n">CONCURRENTLY</span><span class="w"> </span><span class="n">idx_orders_user_created</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">ON</span><span class="w"> </span><span class="n">orders</span><span class="w"> </span><span class="p">(</span><span class="n">user_id</span><span class="p">,</span><span class="w"> </span><span class="n">created_at</span><span class="w"> </span><span class="k">DESC</span><span class="p">)</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">INCLUDE</span><span class="w"> </span><span class="p">(</span><span class="n">total_amount</span><span class="p">,</span><span class="w"> </span><span class="n">status</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">CREATE</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="n">CONCURRENTLY</span><span class="w"> </span><span class="n">idx_products_category_price</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">ON</span><span class="w"> </span><span class="n">products</span><span class="w"> </span><span class="p">(</span><span class="n">category_id</span><span class="p">,</span><span class="w"> </span><span class="n">price</span><span class="p">)</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WHERE</span><span class="w"> </span><span class="n">available</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">true</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">-- Partial index for recent data
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">CREATE</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="n">CONCURRENTLY</span><span class="w"> </span><span class="n">idx_logs_recent</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">ON</span><span class="w"> </span><span class="n">application_logs</span><span class="w"> </span><span class="p">(</span><span class="n">created_at</span><span class="p">,</span><span class="w"> </span><span class="k">level</span><span class="p">)</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WHERE</span><span class="w"> </span><span class="n">created_at</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">NOW</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nb">INTERVAL</span><span class="w"> </span><span class="s1">&#39;7 days&#39;</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">-- Query optimization examples
</span></span></span><span class="line"><span class="cl"><span class="c1">-- Before: Inefficient query
</span></span></span><span class="line"><span class="cl"><span class="c1">-- SELECT * FROM orders o 
</span></span></span><span class="line"><span class="cl"><span class="c1">-- JOIN users u ON o.user_id = u.id 
</span></span></span><span class="line"><span class="cl"><span class="c1">-- WHERE o.created_at &gt; &#39;2024-01-01&#39; 
</span></span></span><span class="line"><span class="cl"><span class="c1">-- ORDER BY o.created_at DESC;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">-- After: Optimized query with specific columns and better indexing
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">SELECT</span><span class="w"> </span><span class="n">o</span><span class="p">.</span><span class="n">id</span><span class="p">,</span><span class="w"> </span><span class="n">o</span><span class="p">.</span><span class="n">total_amount</span><span class="p">,</span><span class="w"> </span><span class="n">o</span><span class="p">.</span><span class="n">status</span><span class="p">,</span><span class="w"> </span><span class="n">o</span><span class="p">.</span><span class="n">created_at</span><span class="p">,</span><span class="w"> </span><span class="n">u</span><span class="p">.</span><span class="n">email</span><span class="p">,</span><span class="w"> </span><span class="n">u</span><span class="p">.</span><span class="n">name</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">orders</span><span class="w"> </span><span class="n">o</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">JOIN</span><span class="w"> </span><span class="n">users</span><span class="w"> </span><span class="n">u</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">o</span><span class="p">.</span><span class="n">user_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">u</span><span class="p">.</span><span class="n">id</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WHERE</span><span class="w"> </span><span class="n">o</span><span class="p">.</span><span class="n">created_at</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="s1">&#39;2024-01-01&#39;</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="k">AND</span><span class="w"> </span><span class="n">o</span><span class="p">.</span><span class="n">status</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="p">(</span><span class="s1">&#39;pending&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;processing&#39;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">o</span><span class="p">.</span><span class="n">created_at</span><span class="w"> </span><span class="k">DESC</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">LIMIT</span><span class="w"> </span><span class="mi">100</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">-- Materialized view for complex aggregations
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">CREATE</span><span class="w"> </span><span class="n">MATERIALIZED</span><span class="w"> </span><span class="k">VIEW</span><span class="w"> </span><span class="n">daily_sales_summary</span><span class="w"> </span><span class="k">AS</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">SELECT</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nb">DATE</span><span class="p">(</span><span class="n">created_at</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">sale_date</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">COUNT</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">order_count</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">SUM</span><span class="p">(</span><span class="n">total_amount</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">total_revenue</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">AVG</span><span class="p">(</span><span class="n">total_amount</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">avg_order_value</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">COUNT</span><span class="p">(</span><span class="k">DISTINCT</span><span class="w"> </span><span class="n">user_id</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">unique_customers</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">FROM</span><span class="w"> </span><span class="n">orders</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">WHERE</span><span class="w"> </span><span class="n">status</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;completed&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">GROUP</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="nb">DATE</span><span class="p">(</span><span class="n">created_at</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">sale_date</span><span class="w"> </span><span class="k">DESC</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">-- Refresh materialized view (can be automated)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">REFRESH</span><span class="w"> </span><span class="n">MATERIALIZED</span><span class="w"> </span><span class="k">VIEW</span><span class="w"> </span><span class="n">CONCURRENTLY</span><span class="w"> </span><span class="n">daily_sales_summary</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">-- Query performance monitoring
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">CREATE</span><span class="w"> </span><span class="k">OR</span><span class="w"> </span><span class="k">REPLACE</span><span class="w"> </span><span class="k">FUNCTION</span><span class="w"> </span><span class="n">log_slow_queries</span><span class="p">()</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">RETURNS</span><span class="w"> </span><span class="n">event_trigger</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="err">$$</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">BEGIN</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">-- Log queries taking longer than 1 second
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">    </span><span class="k">IF</span><span class="w"> </span><span class="n">current_setting</span><span class="p">(</span><span class="s1">&#39;log_min_duration_statement&#39;</span><span class="p">)::</span><span class="nb">int</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">1000</span><span class="w"> </span><span class="k">THEN</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="n">RAISE</span><span class="w"> </span><span class="n">LOG</span><span class="w"> </span><span class="s1">&#39;Slow query detected: %&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">current_query</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">END</span><span class="w"> </span><span class="k">IF</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">END</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="err">$$</span><span class="w"> </span><span class="k">LANGUAGE</span><span class="w"> </span><span class="n">plpgsql</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">-- Connection pooling configuration
</span></span></span><span class="line"><span class="cl"><span class="c1">-- postgresql.conf optimizations
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="cm">/*
</span></span></span><span class="line"><span class="cl"><span class="cm"># Connection settings
</span></span></span><span class="line"><span class="cl"><span class="cm">max_connections = 200
</span></span></span><span class="line"><span class="cl"><span class="cm">shared_buffers = 256MB
</span></span></span><span class="line"><span class="cl"><span class="cm">effective_cache_size = 1GB
</span></span></span><span class="line"><span class="cl"><span class="cm">work_mem = 4MB
</span></span></span><span class="line"><span class="cl"><span class="cm">maintenance_work_mem = 64MB
</span></span></span><span class="line"><span class="cl"><span class="cm">
</span></span></span><span class="line"><span class="cl"><span class="cm"># Checkpoint settings
</span></span></span><span class="line"><span class="cl"><span class="cm">checkpoint_completion_target = 0.9
</span></span></span><span class="line"><span class="cl"><span class="cm">wal_buffers = 16MB
</span></span></span><span class="line"><span class="cl"><span class="cm">default_statistics_target = 100
</span></span></span><span class="line"><span class="cl"><span class="cm">
</span></span></span><span class="line"><span class="cl"><span class="cm"># Query planner settings
</span></span></span><span class="line"><span class="cl"><span class="cm">random_page_cost = 1.1
</span></span></span><span class="line"><span class="cl"><span class="cm">effective_io_concurrency = 200
</span></span></span><span class="line"><span class="cl"><span class="cm">
</span></span></span><span class="line"><span class="cl"><span class="cm"># Logging settings
</span></span></span><span class="line"><span class="cl"><span class="cm">log_min_duration_statement = 1000
</span></span></span><span class="line"><span class="cl"><span class="cm">log_checkpoints = on
</span></span></span><span class="line"><span class="cl"><span class="cm">log_connections = on
</span></span></span><span class="line"><span class="cl"><span class="cm">log_disconnections = on
</span></span></span><span class="line"><span class="cl"><span class="cm">log_lock_waits = on
</span></span></span><span class="line"><span class="cl"><span class="cm">*/</span><span class="w">
</span></span></span></code></pre></div><h3 id="caching-strategy-implementation">Caching Strategy Implementation</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="line"><span class="cl"><span class="c1">// cache/redis_cache.go</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kn">package</span><span class="w"> </span><span class="nx">cache</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kn">import</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s">&#34;context&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s">&#34;encoding/json&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s">&#34;fmt&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s">&#34;time&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s">&#34;github.com/go-redis/redis/v8&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s">&#34;github.com/prometheus/client_golang/prometheus&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="s">&#34;github.com/prometheus/client_golang/prometheus/promauto&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">var</span><span class="w"> </span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nx">cacheHits</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">promauto</span><span class="p">.</span><span class="nf">NewCounterVec</span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nx">prometheus</span><span class="p">.</span><span class="nx">CounterOpts</span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nx">Name</span><span class="p">:</span><span class="w"> </span><span class="s">&#34;cache_hits_total&#34;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nx">Help</span><span class="p">:</span><span class="w"> </span><span class="s">&#34;Total number of cache hits&#34;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">},</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">[]</span><span class="kt">string</span><span class="p">{</span><span class="s">&#34;cache_type&#34;</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;key_pattern&#34;</span><span class="p">},</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nx">cacheMisses</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">promauto</span><span class="p">.</span><span class="nf">NewCounterVec</span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nx">prometheus</span><span class="p">.</span><span class="nx">CounterOpts</span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nx">Name</span><span class="p">:</span><span class="w"> </span><span class="s">&#34;cache_misses_total&#34;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nx">Help</span><span class="p">:</span><span class="w"> </span><span class="s">&#34;Total number of cache misses&#34;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">},</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">[]</span><span class="kt">string</span><span class="p">{</span><span class="s">&#34;cache_type&#34;</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;key_pattern&#34;</span><span class="p">},</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nx">cacheOperationDuration</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">promauto</span><span class="p">.</span><span class="nf">NewHistogramVec</span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nx">prometheus</span><span class="p">.</span><span class="nx">HistogramOpts</span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nx">Name</span><span class="p">:</span><span class="w"> </span><span class="s">&#34;cache_operation_duration_seconds&#34;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nx">Help</span><span class="p">:</span><span class="w"> </span><span class="s">&#34;Duration of cache operations&#34;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nx">Buckets</span><span class="p">:</span><span class="w"> </span><span class="p">[]</span><span class="kt">float64</span><span class="p">{</span><span class="mf">0.001</span><span class="p">,</span><span class="w"> </span><span class="mf">0.005</span><span class="p">,</span><span class="w"> </span><span class="mf">0.01</span><span class="p">,</span><span class="w"> </span><span class="mf">0.05</span><span class="p">,</span><span class="w"> </span><span class="mf">0.1</span><span class="p">,</span><span class="w"> </span><span class="mf">0.5</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0</span><span class="p">},</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">},</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">[]</span><span class="kt">string</span><span class="p">{</span><span class="s">&#34;operation&#34;</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;cache_type&#34;</span><span class="p">},</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">type</span><span class="w"> </span><span class="nx">CacheConfig</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nx">RedisAddr</span><span class="w">     </span><span class="kt">string</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nx">RedisPassword</span><span class="w"> </span><span class="kt">string</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nx">RedisDB</span><span class="w">       </span><span class="kt">int</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nx">DefaultTTL</span><span class="w">    </span><span class="nx">time</span><span class="p">.</span><span class="nx">Duration</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nx">MaxRetries</span><span class="w">    </span><span class="kt">int</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">type</span><span class="w"> </span><span class="nx">Cache</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nx">client</span><span class="w">     </span><span class="o">*</span><span class="nx">redis</span><span class="p">.</span><span class="nx">Client</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nx">defaultTTL</span><span class="w"> </span><span class="nx">time</span><span class="p">.</span><span class="nx">Duration</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">func</span><span class="w"> </span><span class="nf">NewCache</span><span class="p">(</span><span class="nx">config</span><span class="w"> </span><span class="nx">CacheConfig</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="nx">Cache</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nx">rdb</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">redis</span><span class="p">.</span><span class="nf">NewClient</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">redis</span><span class="p">.</span><span class="nx">Options</span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nx">Addr</span><span class="p">:</span><span class="w">       </span><span class="nx">config</span><span class="p">.</span><span class="nx">RedisAddr</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nx">Password</span><span class="p">:</span><span class="w">   </span><span class="nx">config</span><span class="p">.</span><span class="nx">RedisPassword</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nx">DB</span><span class="p">:</span><span class="w">         </span><span class="nx">config</span><span class="p">.</span><span class="nx">RedisDB</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nx">MaxRetries</span><span class="p">:</span><span class="w"> </span><span class="nx">config</span><span class="p">.</span><span class="nx">MaxRetries</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nx">PoolSize</span><span class="p">:</span><span class="w">   </span><span class="mi">20</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nx">MinIdleConns</span><span class="p">:</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">})</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">Cache</span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nx">client</span><span class="p">:</span><span class="w">     </span><span class="nx">rdb</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nx">defaultTTL</span><span class="p">:</span><span class="w"> </span><span class="nx">config</span><span class="p">.</span><span class="nx">DefaultTTL</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">c</span><span class="w"> </span><span class="o">*</span><span class="nx">Cache</span><span class="p">)</span><span class="w"> </span><span class="nf">Get</span><span class="p">(</span><span class="nx">ctx</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span><span class="w"> </span><span class="nx">key</span><span class="w"> </span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="nx">dest</span><span class="w"> </span><span class="kd">interface</span><span class="p">{})</span><span class="w"> </span><span class="kt">error</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nx">start</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">time</span><span class="p">.</span><span class="nf">Now</span><span class="p">()</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">defer</span><span class="w"> </span><span class="kd">func</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nx">cacheOperationDuration</span><span class="p">.</span><span class="nf">WithLabelValues</span><span class="p">(</span><span class="s">&#34;get&#34;</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;redis&#34;</span><span class="p">).</span><span class="nf">Observe</span><span class="p">(</span><span class="nx">time</span><span class="p">.</span><span class="nf">Since</span><span class="p">(</span><span class="nx">start</span><span class="p">).</span><span class="nf">Seconds</span><span class="p">())</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}()</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nx">val</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">c</span><span class="p">.</span><span class="nx">client</span><span class="p">.</span><span class="nf">Get</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">key</span><span class="p">).</span><span class="nf">Result</span><span class="p">()</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nx">redis</span><span class="p">.</span><span class="nx">Nil</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nx">cacheMisses</span><span class="p">.</span><span class="nf">WithLabelValues</span><span class="p">(</span><span class="s">&#34;redis&#34;</span><span class="p">,</span><span class="w"> </span><span class="nx">c</span><span class="p">.</span><span class="nf">getKeyPattern</span><span class="p">(</span><span class="nx">key</span><span class="p">)).</span><span class="nf">Inc</span><span class="p">()</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="nx">ErrCacheMiss</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nf">Errorf</span><span class="p">(</span><span class="s">&#34;cache get error: %w&#34;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nx">cacheHits</span><span class="p">.</span><span class="nf">WithLabelValues</span><span class="p">(</span><span class="s">&#34;redis&#34;</span><span class="p">,</span><span class="w"> </span><span class="nx">c</span><span class="p">.</span><span class="nf">getKeyPattern</span><span class="p">(</span><span class="nx">key</span><span class="p">)).</span><span class="nf">Inc</span><span class="p">()</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">json</span><span class="p">.</span><span class="nf">Unmarshal</span><span class="p">([]</span><span class="nb">byte</span><span class="p">(</span><span class="nx">val</span><span class="p">),</span><span class="w"> </span><span class="nx">dest</span><span class="p">);</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nf">Errorf</span><span class="p">(</span><span class="s">&#34;cache unmarshal error: %w&#34;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">c</span><span class="w"> </span><span class="o">*</span><span class="nx">Cache</span><span class="p">)</span><span class="w"> </span><span class="nf">Set</span><span class="p">(</span><span class="nx">ctx</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span><span class="w"> </span><span class="nx">key</span><span class="w"> </span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="nx">value</span><span class="w"> </span><span class="kd">interface</span><span class="p">{},</span><span class="w"> </span><span class="nx">ttl</span><span class="w"> </span><span class="nx">time</span><span class="p">.</span><span class="nx">Duration</span><span class="p">)</span><span class="w"> </span><span class="kt">error</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nx">start</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">time</span><span class="p">.</span><span class="nf">Now</span><span class="p">()</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">defer</span><span class="w"> </span><span class="kd">func</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nx">cacheOperationDuration</span><span class="p">.</span><span class="nf">WithLabelValues</span><span class="p">(</span><span class="s">&#34;set&#34;</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;redis&#34;</span><span class="p">).</span><span class="nf">Observe</span><span class="p">(</span><span class="nx">time</span><span class="p">.</span><span class="nf">Since</span><span class="p">(</span><span class="nx">start</span><span class="p">).</span><span class="nf">Seconds</span><span class="p">())</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}()</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">ttl</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nx">ttl</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">c</span><span class="p">.</span><span class="nx">defaultTTL</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nx">data</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">json</span><span class="p">.</span><span class="nf">Marshal</span><span class="p">(</span><span class="nx">value</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nf">Errorf</span><span class="p">(</span><span class="s">&#34;cache marshal error: %w&#34;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">c</span><span class="p">.</span><span class="nx">client</span><span class="p">.</span><span class="nf">Set</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">key</span><span class="p">,</span><span class="w"> </span><span class="nx">data</span><span class="p">,</span><span class="w"> </span><span class="nx">ttl</span><span class="p">).</span><span class="nf">Err</span><span class="p">();</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nf">Errorf</span><span class="p">(</span><span class="s">&#34;cache set error: %w&#34;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">c</span><span class="w"> </span><span class="o">*</span><span class="nx">Cache</span><span class="p">)</span><span class="w"> </span><span class="nf">Delete</span><span class="p">(</span><span class="nx">ctx</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span><span class="w"> </span><span class="nx">key</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="kt">error</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nx">start</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">time</span><span class="p">.</span><span class="nf">Now</span><span class="p">()</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">defer</span><span class="w"> </span><span class="kd">func</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nx">cacheOperationDuration</span><span class="p">.</span><span class="nf">WithLabelValues</span><span class="p">(</span><span class="s">&#34;delete&#34;</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;redis&#34;</span><span class="p">).</span><span class="nf">Observe</span><span class="p">(</span><span class="nx">time</span><span class="p">.</span><span class="nf">Since</span><span class="p">(</span><span class="nx">start</span><span class="p">).</span><span class="nf">Seconds</span><span class="p">())</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}()</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">c</span><span class="p">.</span><span class="nx">client</span><span class="p">.</span><span class="nf">Del</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">key</span><span class="p">).</span><span class="nf">Err</span><span class="p">();</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nf">Errorf</span><span class="p">(</span><span class="s">&#34;cache delete error: %w&#34;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">c</span><span class="w"> </span><span class="o">*</span><span class="nx">Cache</span><span class="p">)</span><span class="w"> </span><span class="nf">GetOrSet</span><span class="p">(</span><span class="nx">ctx</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span><span class="w"> </span><span class="nx">key</span><span class="w"> </span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="nx">dest</span><span class="w"> </span><span class="kd">interface</span><span class="p">{},</span><span class="w"> </span><span class="nx">ttl</span><span class="w"> </span><span class="nx">time</span><span class="p">.</span><span class="nx">Duration</span><span class="p">,</span><span class="w"> </span><span class="nx">fetchFn</span><span class="w"> </span><span class="kd">func</span><span class="p">()</span><span class="w"> </span><span class="p">(</span><span class="kd">interface</span><span class="p">{},</span><span class="w"> </span><span class="kt">error</span><span class="p">))</span><span class="w"> </span><span class="kt">error</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// Try to get from cache first</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">c</span><span class="p">.</span><span class="nf">Get</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">key</span><span class="p">,</span><span class="w"> </span><span class="nx">dest</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="c1">// Cache hit</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="nx">ErrCacheMiss</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="c1">// Actual error</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// Cache miss, fetch data</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nx">data</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nf">fetchFn</span><span class="p">()</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nf">Errorf</span><span class="p">(</span><span class="s">&#34;fetch function error: %w&#34;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// Set in cache</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">c</span><span class="p">.</span><span class="nf">Set</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">key</span><span class="p">,</span><span class="w"> </span><span class="nx">data</span><span class="p">,</span><span class="w"> </span><span class="nx">ttl</span><span class="p">);</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">// Log error but don&#39;t fail the request</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nx">log</span><span class="p">.</span><span class="nf">Printf</span><span class="p">(</span><span class="s">&#34;Failed to set cache: %v&#34;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// Copy data to destination</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nx">dataBytes</span><span class="p">,</span><span class="w"> </span><span class="nx">_</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">json</span><span class="p">.</span><span class="nf">Marshal</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">json</span><span class="p">.</span><span class="nf">Unmarshal</span><span class="p">(</span><span class="nx">dataBytes</span><span class="p">,</span><span class="w"> </span><span class="nx">dest</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">c</span><span class="w"> </span><span class="o">*</span><span class="nx">Cache</span><span class="p">)</span><span class="w"> </span><span class="nf">getKeyPattern</span><span class="p">(</span><span class="nx">key</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// Extract pattern from key for metrics</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nx">parts</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">strings</span><span class="p">.</span><span class="nf">Split</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;:&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="nx">parts</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">parts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&#34;:&#34;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">parts</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="s">&#34;unknown&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">var</span><span class="w"> </span><span class="nx">ErrCacheMiss</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">fmt</span><span class="p">.</span><span class="nf">Errorf</span><span class="p">(</span><span class="s">&#34;cache miss&#34;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">// Multi-level cache implementation</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">type</span><span class="w"> </span><span class="nx">MultiLevelCache</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nx">l1Cache</span><span class="w"> </span><span class="o">*</span><span class="nx">sync</span><span class="p">.</span><span class="nx">Map</span><span class="w"> </span><span class="c1">// In-memory cache</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nx">l2Cache</span><span class="w"> </span><span class="o">*</span><span class="nx">Cache</span><span class="w">    </span><span class="c1">// Redis cache</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nx">l1TTL</span><span class="w">   </span><span class="nx">time</span><span class="p">.</span><span class="nx">Duration</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nx">l2TTL</span><span class="w">   </span><span class="nx">time</span><span class="p">.</span><span class="nx">Duration</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">func</span><span class="w"> </span><span class="nf">NewMultiLevelCache</span><span class="p">(</span><span class="nx">redisCache</span><span class="w"> </span><span class="o">*</span><span class="nx">Cache</span><span class="p">,</span><span class="w"> </span><span class="nx">l1TTL</span><span class="p">,</span><span class="w"> </span><span class="nx">l2TTL</span><span class="w"> </span><span class="nx">time</span><span class="p">.</span><span class="nx">Duration</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="nx">MultiLevelCache</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">MultiLevelCache</span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nx">l1Cache</span><span class="p">:</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">sync</span><span class="p">.</span><span class="nx">Map</span><span class="p">{},</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nx">l2Cache</span><span class="p">:</span><span class="w"> </span><span class="nx">redisCache</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nx">l1TTL</span><span class="p">:</span><span class="w">   </span><span class="nx">l1TTL</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nx">l2TTL</span><span class="p">:</span><span class="w">   </span><span class="nx">l2TTL</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">type</span><span class="w"> </span><span class="nx">cacheItem</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nx">data</span><span class="w">      </span><span class="kd">interface</span><span class="p">{}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nx">expiresAt</span><span class="w"> </span><span class="nx">time</span><span class="p">.</span><span class="nx">Time</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">mlc</span><span class="w"> </span><span class="o">*</span><span class="nx">MultiLevelCache</span><span class="p">)</span><span class="w"> </span><span class="nf">Get</span><span class="p">(</span><span class="nx">ctx</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span><span class="w"> </span><span class="nx">key</span><span class="w"> </span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="nx">dest</span><span class="w"> </span><span class="kd">interface</span><span class="p">{})</span><span class="w"> </span><span class="kt">error</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// Try L1 cache first</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">item</span><span class="p">,</span><span class="w"> </span><span class="nx">ok</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">mlc</span><span class="p">.</span><span class="nx">l1Cache</span><span class="p">.</span><span class="nf">Load</span><span class="p">(</span><span class="nx">key</span><span class="p">);</span><span class="w"> </span><span class="nx">ok</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nx">cacheItem</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">item</span><span class="p">.(</span><span class="o">*</span><span class="nx">cacheItem</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="nx">time</span><span class="p">.</span><span class="nf">Now</span><span class="p">().</span><span class="nf">Before</span><span class="p">(</span><span class="nx">cacheItem</span><span class="p">.</span><span class="nx">expiresAt</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nx">cacheHits</span><span class="p">.</span><span class="nf">WithLabelValues</span><span class="p">(</span><span class="s">&#34;memory&#34;</span><span class="p">,</span><span class="w"> </span><span class="s">&#34;l1&#34;</span><span class="p">).</span><span class="nf">Inc</span><span class="p">()</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="nx">mlc</span><span class="p">.</span><span class="nf">copyData</span><span class="p">(</span><span class="nx">cacheItem</span><span class="p">.</span><span class="nx">data</span><span class="p">,</span><span class="w"> </span><span class="nx">dest</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">// Expired, remove from L1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nx">mlc</span><span class="p">.</span><span class="nx">l1Cache</span><span class="p">.</span><span class="nf">Delete</span><span class="p">(</span><span class="nx">key</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// Try L2 cache</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">mlc</span><span class="p">.</span><span class="nx">l2Cache</span><span class="p">.</span><span class="nf">Get</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">key</span><span class="p">,</span><span class="w"> </span><span class="nx">dest</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="c1">// Store in L1 cache</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nx">mlc</span><span class="p">.</span><span class="nx">l1Cache</span><span class="p">.</span><span class="nf">Store</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">cacheItem</span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nx">data</span><span class="p">:</span><span class="w">      </span><span class="nx">dest</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nx">expiresAt</span><span class="p">:</span><span class="w"> </span><span class="nx">time</span><span class="p">.</span><span class="nf">Now</span><span class="p">().</span><span class="nf">Add</span><span class="p">(</span><span class="nx">mlc</span><span class="p">.</span><span class="nx">l1TTL</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">})</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">err</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">mlc</span><span class="w"> </span><span class="o">*</span><span class="nx">MultiLevelCache</span><span class="p">)</span><span class="w"> </span><span class="nf">Set</span><span class="p">(</span><span class="nx">ctx</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span><span class="w"> </span><span class="nx">key</span><span class="w"> </span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="nx">value</span><span class="w"> </span><span class="kd">interface</span><span class="p">{},</span><span class="w"> </span><span class="nx">ttl</span><span class="w"> </span><span class="nx">time</span><span class="p">.</span><span class="nx">Duration</span><span class="p">)</span><span class="w"> </span><span class="kt">error</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// Set in L2 cache</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">mlc</span><span class="p">.</span><span class="nx">l2Cache</span><span class="p">.</span><span class="nf">Set</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">key</span><span class="p">,</span><span class="w"> </span><span class="nx">value</span><span class="p">,</span><span class="w"> </span><span class="nx">ttl</span><span class="p">);</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">err</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// Set in L1 cache</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nx">mlc</span><span class="p">.</span><span class="nx">l1Cache</span><span class="p">.</span><span class="nf">Store</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">cacheItem</span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nx">data</span><span class="p">:</span><span class="w">      </span><span class="nx">value</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nx">expiresAt</span><span class="p">:</span><span class="w"> </span><span class="nx">time</span><span class="p">.</span><span class="nf">Now</span><span class="p">().</span><span class="nf">Add</span><span class="p">(</span><span class="nx">mlc</span><span class="p">.</span><span class="nx">l1TTL</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">})</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="kc">nil</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">mlc</span><span class="w"> </span><span class="o">*</span><span class="nx">MultiLevelCache</span><span class="p">)</span><span class="w"> </span><span class="nf">copyData</span><span class="p">(</span><span class="nx">src</span><span class="p">,</span><span class="w"> </span><span class="nx">dest</span><span class="w"> </span><span class="kd">interface</span><span class="p">{})</span><span class="w"> </span><span class="kt">error</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nx">data</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">json</span><span class="p">.</span><span class="nf">Marshal</span><span class="p">(</span><span class="nx">src</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">err</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">json</span><span class="p">.</span><span class="nf">Unmarshal</span><span class="p">(</span><span class="nx">data</span><span class="p">,</span><span class="w"> </span><span class="nx">dest</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">// Cache warming strategy</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">type</span><span class="w"> </span><span class="nx">CacheWarmer</span><span class="w"> </span><span class="kd">struct</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nx">cache</span><span class="w">    </span><span class="o">*</span><span class="nx">Cache</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nx">warmers</span><span class="w">  </span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="nx">WarmupFunction</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nx">interval</span><span class="w"> </span><span class="nx">time</span><span class="p">.</span><span class="nx">Duration</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">type</span><span class="w"> </span><span class="nx">WarmupFunction</span><span class="w"> </span><span class="kd">func</span><span class="p">(</span><span class="nx">ctx</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">)</span><span class="w"> </span><span class="p">(</span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{},</span><span class="w"> </span><span class="kt">error</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">func</span><span class="w"> </span><span class="nf">NewCacheWarmer</span><span class="p">(</span><span class="nx">cache</span><span class="w"> </span><span class="o">*</span><span class="nx">Cache</span><span class="p">,</span><span class="w"> </span><span class="nx">interval</span><span class="w"> </span><span class="nx">time</span><span class="p">.</span><span class="nx">Duration</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="nx">CacheWarmer</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="o">&amp;</span><span class="nx">CacheWarmer</span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nx">cache</span><span class="p">:</span><span class="w">    </span><span class="nx">cache</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nx">warmers</span><span class="p">:</span><span class="w">  </span><span class="nb">make</span><span class="p">(</span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="nx">WarmupFunction</span><span class="p">),</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nx">interval</span><span class="p">:</span><span class="w"> </span><span class="nx">interval</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">cw</span><span class="w"> </span><span class="o">*</span><span class="nx">CacheWarmer</span><span class="p">)</span><span class="w"> </span><span class="nf">RegisterWarmer</span><span class="p">(</span><span class="nx">name</span><span class="w"> </span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="nx">fn</span><span class="w"> </span><span class="nx">WarmupFunction</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nx">cw</span><span class="p">.</span><span class="nx">warmers</span><span class="p">[</span><span class="nx">name</span><span class="p">]</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nx">fn</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">cw</span><span class="w"> </span><span class="o">*</span><span class="nx">CacheWarmer</span><span class="p">)</span><span class="w"> </span><span class="nf">Start</span><span class="p">(</span><span class="nx">ctx</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nx">ticker</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">time</span><span class="p">.</span><span class="nf">NewTicker</span><span class="p">(</span><span class="nx">cw</span><span class="p">.</span><span class="nx">interval</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">defer</span><span class="w"> </span><span class="nx">ticker</span><span class="p">.</span><span class="nf">Stop</span><span class="p">()</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">// Initial warmup</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nx">cw</span><span class="p">.</span><span class="nf">warmup</span><span class="p">(</span><span class="nx">ctx</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">select</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="o">&lt;-</span><span class="nx">ctx</span><span class="p">.</span><span class="nf">Done</span><span class="p">():</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">return</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="o">&lt;-</span><span class="nx">ticker</span><span class="p">.</span><span class="nx">C</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nx">cw</span><span class="p">.</span><span class="nf">warmup</span><span class="p">(</span><span class="nx">ctx</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="kd">func</span><span class="w"> </span><span class="p">(</span><span class="nx">cw</span><span class="w"> </span><span class="o">*</span><span class="nx">CacheWarmer</span><span class="p">)</span><span class="w"> </span><span class="nf">warmup</span><span class="p">(</span><span class="nx">ctx</span><span class="w"> </span><span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="nx">name</span><span class="p">,</span><span class="w"> </span><span class="nx">warmer</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="nx">cw</span><span class="p">.</span><span class="nx">warmers</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="k">go</span><span class="w"> </span><span class="kd">func</span><span class="p">(</span><span class="nx">name</span><span class="w"> </span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="nx">warmer</span><span class="w"> </span><span class="nx">WarmupFunction</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nx">data</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nf">warmer</span><span class="p">(</span><span class="nx">ctx</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="nx">log</span><span class="p">.</span><span class="nf">Printf</span><span class="p">(</span><span class="s">&#34;Cache warmer %s failed: %v&#34;</span><span class="p">,</span><span class="w"> </span><span class="nx">name</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="k">return</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="k">for</span><span class="w"> </span><span class="nx">key</span><span class="p">,</span><span class="w"> </span><span class="nx">value</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="k">range</span><span class="w"> </span><span class="nx">data</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nx">cw</span><span class="p">.</span><span class="nx">cache</span><span class="p">.</span><span class="nf">Set</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span><span class="w"> </span><span class="nx">key</span><span class="p">,</span><span class="w"> </span><span class="nx">value</span><span class="p">,</span><span class="w"> </span><span class="mi">30</span><span class="o">*</span><span class="nx">time</span><span class="p">.</span><span class="nx">Minute</span><span class="p">);</span><span class="w"> </span><span class="nx">err</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">nil</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                    </span><span class="nx">log</span><span class="p">.</span><span class="nf">Printf</span><span class="p">(</span><span class="s">&#34;Failed to warm cache key %s: %v&#34;</span><span class="p">,</span><span class="w"> </span><span class="nx">key</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nx">log</span><span class="p">.</span><span class="nf">Printf</span><span class="p">(</span><span class="s">&#34;Cache warmer %s completed, warmed %d keys&#34;</span><span class="p">,</span><span class="w"> </span><span class="nx">name</span><span class="p">,</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="nx">data</span><span class="p">))</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}(</span><span class="nx">name</span><span class="p">,</span><span class="w"> </span><span class="nx">warmer</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><h2 id="kubernetes-resource-optimization">Kubernetes Resource Optimization</h2>
<h3 id="resource-requests-and-limits-optimization">Resource Requests and Limits Optimization</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="c"># k8s/resource-optimization.yaml</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">v1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">ConfigMap</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">resource-optimization-config</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l">production</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">data</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="c"># Resource optimization guidelines</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">guidelines.yaml</span><span class="p">:</span><span class="w"> </span><span class="p">|</span><span class="sd">
</span></span></span><span class="line"><span class="cl"><span class="sd">    resource_guidelines:
</span></span></span><span class="line"><span class="cl"><span class="sd">      cpu:
</span></span></span><span class="line"><span class="cl"><span class="sd">        request_ratio: 0.1  # 10% of limit
</span></span></span><span class="line"><span class="cl"><span class="sd">        limit_ratio: 1.0    # 100% of allocated
</span></span></span><span class="line"><span class="cl"><span class="sd">        burst_allowance: 2.0 # 200% burst capacity
</span></span></span><span class="line"><span class="cl"><span class="sd">      memory:
</span></span></span><span class="line"><span class="cl"><span class="sd">        request_ratio: 0.8  # 80% of limit
</span></span></span><span class="line"><span class="cl"><span class="sd">        limit_ratio: 1.0    # 100% of allocated
</span></span></span><span class="line"><span class="cl"><span class="sd">        oom_kill_threshold: 0.95 # 95% before OOM
</span></span></span><span class="line"><span class="cl"><span class="sd">      
</span></span></span><span class="line"><span class="cl"><span class="sd">      application_profiles:
</span></span></span><span class="line"><span class="cl"><span class="sd">        web_frontend:
</span></span></span><span class="line"><span class="cl"><span class="sd">          cpu_request: &#34;100m&#34;
</span></span></span><span class="line"><span class="cl"><span class="sd">          cpu_limit: &#34;500m&#34;
</span></span></span><span class="line"><span class="cl"><span class="sd">          memory_request: &#34;128Mi&#34;
</span></span></span><span class="line"><span class="cl"><span class="sd">          memory_limit: &#34;256Mi&#34;
</span></span></span><span class="line"><span class="cl"><span class="sd">        api_backend:
</span></span></span><span class="line"><span class="cl"><span class="sd">          cpu_request: &#34;200m&#34;
</span></span></span><span class="line"><span class="cl"><span class="sd">          cpu_limit: &#34;1000m&#34;
</span></span></span><span class="line"><span class="cl"><span class="sd">          memory_request: &#34;256Mi&#34;
</span></span></span><span class="line"><span class="cl"><span class="sd">          memory_limit: &#34;512Mi&#34;
</span></span></span><span class="line"><span class="cl"><span class="sd">        database:
</span></span></span><span class="line"><span class="cl"><span class="sd">          cpu_request: &#34;500m&#34;
</span></span></span><span class="line"><span class="cl"><span class="sd">          cpu_limit: &#34;2000m&#34;
</span></span></span><span class="line"><span class="cl"><span class="sd">          memory_request: &#34;1Gi&#34;
</span></span></span><span class="line"><span class="cl"><span class="sd">          memory_limit: &#34;2Gi&#34;
</span></span></span><span class="line"><span class="cl"><span class="sd">        cache:
</span></span></span><span class="line"><span class="cl"><span class="sd">          cpu_request: &#34;100m&#34;
</span></span></span><span class="line"><span class="cl"><span class="sd">          cpu_limit: &#34;500m&#34;
</span></span></span><span class="line"><span class="cl"><span class="sd">          memory_request: &#34;512Mi&#34;
</span></span></span><span class="line"><span class="cl"><span class="sd">          memory_limit: &#34;1Gi&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nn">---</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">apps/v1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Deployment</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">optimized-application</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l">production</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">replicas</span><span class="p">:</span><span class="w"> </span><span class="m">3</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">selector</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">matchLabels</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l">optimized-application</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">template</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">labels</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l">optimized-application</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">annotations</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">prometheus.io/scrape</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;true&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">prometheus.io/port</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;8080&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">prometheus.io/path</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;/metrics&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">containers</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">app</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l">myapp:optimized</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">ports</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="nt">containerPort</span><span class="p">:</span><span class="w"> </span><span class="m">8080</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">http</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">resources</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">requests</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">memory</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;256Mi&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">cpu</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;200m&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">ephemeral-storage</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;1Gi&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">limits</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">memory</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;512Mi&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">cpu</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;1000m&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">ephemeral-storage</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;2Gi&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">env</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">GOMAXPROCS</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">valueFrom</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">resourceFieldRef</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span><span class="nt">resource</span><span class="p">:</span><span class="w"> </span><span class="l">limits.cpu</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">GOMEMLIMIT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">valueFrom</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">resourceFieldRef</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span><span class="nt">resource</span><span class="p">:</span><span class="w"> </span><span class="l">limits.memory</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">livenessProbe</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">httpGet</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l">/health</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="m">8080</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">initialDelaySeconds</span><span class="p">:</span><span class="w"> </span><span class="m">30</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">periodSeconds</span><span class="p">:</span><span class="w"> </span><span class="m">10</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">timeoutSeconds</span><span class="p">:</span><span class="w"> </span><span class="m">5</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">failureThreshold</span><span class="p">:</span><span class="w"> </span><span class="m">3</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">readinessProbe</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">httpGet</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l">/ready</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="m">8080</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">initialDelaySeconds</span><span class="p">:</span><span class="w"> </span><span class="m">5</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">periodSeconds</span><span class="p">:</span><span class="w"> </span><span class="m">5</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">timeoutSeconds</span><span class="p">:</span><span class="w"> </span><span class="m">3</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">failureThreshold</span><span class="p">:</span><span class="w"> </span><span class="m">3</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">startupProbe</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">httpGet</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l">/startup</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="m">8080</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">initialDelaySeconds</span><span class="p">:</span><span class="w"> </span><span class="m">10</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">periodSeconds</span><span class="p">:</span><span class="w"> </span><span class="m">5</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">timeoutSeconds</span><span class="p">:</span><span class="w"> </span><span class="m">3</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">failureThreshold</span><span class="p">:</span><span class="w"> </span><span class="m">30</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">securityContext</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">allowPrivilegeEscalation</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">runAsNonRoot</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">runAsUser</span><span class="p">:</span><span class="w"> </span><span class="m">1000</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">capabilities</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">drop</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span>- <span class="l">ALL</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">readOnlyRootFilesystem</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">volumeMounts</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">tmp</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">mountPath</span><span class="p">:</span><span class="w"> </span><span class="l">/tmp</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">cache</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">mountPath</span><span class="p">:</span><span class="w"> </span><span class="l">/app/cache</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">volumes</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">tmp</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">emptyDir</span><span class="p">:</span><span class="w"> </span>{}<span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">cache</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">emptyDir</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">sizeLimit</span><span class="p">:</span><span class="w"> </span><span class="l">1Gi</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">nodeSelector</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">node-type</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;compute-optimized&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">tolerations</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="nt">key</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;high-performance&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">operator</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;Equal&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;true&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">effect</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;NoSchedule&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">affinity</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">podAntiAffinity</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">preferredDuringSchedulingIgnoredDuringExecution</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span>- <span class="nt">weight</span><span class="p">:</span><span class="w"> </span><span class="m">100</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">podAffinityTerm</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span><span class="nt">labelSelector</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="nt">matchExpressions</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span>- <span class="nt">key</span><span class="p">:</span><span class="w"> </span><span class="l">app</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                  </span><span class="nt">operator</span><span class="p">:</span><span class="w"> </span><span class="l">In</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                  </span><span class="nt">values</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                  </span>- <span class="l">optimized-application</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span><span class="nt">topologyKey</span><span class="p">:</span><span class="w"> </span><span class="l">kubernetes.io/hostname</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nn">---</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">autoscaling/v2</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">HorizontalPodAutoscaler</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">optimized-application-hpa</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l">production</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">scaleTargetRef</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">apps/v1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Deployment</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">optimized-application</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">minReplicas</span><span class="p">:</span><span class="w"> </span><span class="m">3</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">maxReplicas</span><span class="p">:</span><span class="w"> </span><span class="m">20</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">metrics</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">Resource</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">resource</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">cpu</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">target</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">Utilization</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">averageUtilization</span><span class="p">:</span><span class="w"> </span><span class="m">70</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">Resource</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">resource</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">memory</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">target</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">Utilization</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">averageUtilization</span><span class="p">:</span><span class="w"> </span><span class="m">80</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">Pods</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">pods</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">metric</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">http_requests_per_second</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">target</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">AverageValue</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">averageValue</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;100&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">behavior</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">scaleDown</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">stabilizationWindowSeconds</span><span class="p">:</span><span class="w"> </span><span class="m">300</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">policies</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">Percent</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="m">10</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">periodSeconds</span><span class="p">:</span><span class="w"> </span><span class="m">60</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">scaleUp</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">stabilizationWindowSeconds</span><span class="p">:</span><span class="w"> </span><span class="m">60</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">policies</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">Percent</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="m">50</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">periodSeconds</span><span class="p">:</span><span class="w"> </span><span class="m">60</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">Pods</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="m">2</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">periodSeconds</span><span class="p">:</span><span class="w"> </span><span class="m">60</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">selectPolicy</span><span class="p">:</span><span class="w"> </span><span class="l">Max</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nn">---</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">autoscaling/v1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">VerticalPodAutoscaler</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">optimized-application-vpa</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l">production</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">targetRef</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">apps/v1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Deployment</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">optimized-application</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">updatePolicy</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">updateMode</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;Auto&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">resourcePolicy</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">containerPolicies</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="nt">containerName</span><span class="p">:</span><span class="w"> </span><span class="l">app</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">minAllowed</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">cpu</span><span class="p">:</span><span class="w"> </span><span class="l">100m</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">memory</span><span class="p">:</span><span class="w"> </span><span class="l">128Mi</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">maxAllowed</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">cpu</span><span class="p">:</span><span class="w"> </span><span class="l">2000m</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">memory</span><span class="p">:</span><span class="w"> </span><span class="l">1Gi</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">controlledResources</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&#34;cpu&#34;</span><span class="p">,</span><span class="w"> </span><span class="s2">&#34;memory&#34;</span><span class="p">]</span><span class="w">
</span></span></span></code></pre></div><h3 id="performance-monitoring-and-alerting">Performance Monitoring and Alerting</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="c"># monitoring/performance-alerts.yaml</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">monitoring.coreos.com/v1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">PrometheusRule</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">performance-alerts</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l">monitoring</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">groups</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">performance.rules</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">rules</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c"># High latency alerts</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="nt">alert</span><span class="p">:</span><span class="w"> </span><span class="l">HighResponseTime</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">expr</span><span class="p">:</span><span class="w"> </span><span class="l">histogram_quantile(0.95, rate(http_request_duration_seconds_bucket[5m])) &gt; 0.5</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">for</span><span class="p">:</span><span class="w"> </span><span class="l">2m</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">labels</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">severity</span><span class="p">:</span><span class="w"> </span><span class="l">warning</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">category</span><span class="p">:</span><span class="w"> </span><span class="l">performance</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">annotations</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">summary</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;High response time detected&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;95th percentile response time is {{ $value }}s for {{ $labels.endpoint }}&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="nt">alert</span><span class="p">:</span><span class="w"> </span><span class="l">VeryHighResponseTime</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">expr</span><span class="p">:</span><span class="w"> </span><span class="l">histogram_quantile(0.95, rate(http_request_duration_seconds_bucket[5m])) &gt; 1.0</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">for</span><span class="p">:</span><span class="w"> </span><span class="l">1m</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">labels</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">severity</span><span class="p">:</span><span class="w"> </span><span class="l">critical</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">category</span><span class="p">:</span><span class="w"> </span><span class="l">performance</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">annotations</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">summary</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;Very high response time detected&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;95th percentile response time is {{ $value }}s for {{ $labels.endpoint }}&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c"># Throughput alerts</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="nt">alert</span><span class="p">:</span><span class="w"> </span><span class="l">LowThroughput</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">expr</span><span class="p">:</span><span class="w"> </span><span class="l">rate(http_requests_total[5m]) &lt; 10</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">for</span><span class="p">:</span><span class="w"> </span><span class="l">5m</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">labels</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">severity</span><span class="p">:</span><span class="w"> </span><span class="l">warning</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">category</span><span class="p">:</span><span class="w"> </span><span class="l">performance</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">annotations</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">summary</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;Low throughput detected&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;Request rate is {{ $value }} requests/second&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c"># Resource utilization alerts</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="nt">alert</span><span class="p">:</span><span class="w"> </span><span class="l">HighCPUUtilization</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">expr</span><span class="p">:</span><span class="w"> </span><span class="l">rate(container_cpu_usage_seconds_total[5m]) / container_spec_cpu_quota * container_spec_cpu_period &gt; 0.8</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">for</span><span class="p">:</span><span class="w"> </span><span class="l">5m</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">labels</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">severity</span><span class="p">:</span><span class="w"> </span><span class="l">warning</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">category</span><span class="p">:</span><span class="w"> </span><span class="l">performance</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">annotations</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">summary</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;High CPU utilization&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;CPU utilization is {{ $value | humanizePercentage }} for {{ $labels.pod }}&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="nt">alert</span><span class="p">:</span><span class="w"> </span><span class="l">HighMemoryUtilization</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">expr</span><span class="p">:</span><span class="w"> </span><span class="l">container_memory_usage_bytes / container_spec_memory_limit_bytes &gt; 0.9</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">for</span><span class="p">:</span><span class="w"> </span><span class="l">2m</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">labels</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">severity</span><span class="p">:</span><span class="w"> </span><span class="l">critical</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">category</span><span class="p">:</span><span class="w"> </span><span class="l">performance</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">annotations</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">summary</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;High memory utilization&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;Memory utilization is {{ $value | humanizePercentage }} for {{ $labels.pod }}&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c"># Cache performance alerts</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="nt">alert</span><span class="p">:</span><span class="w"> </span><span class="l">LowCacheHitRate</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">expr</span><span class="p">:</span><span class="w"> </span><span class="l">rate(cache_hits_total[5m]) / (rate(cache_hits_total[5m]) + rate(cache_misses_total[5m])) &lt; 0.8</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">for</span><span class="p">:</span><span class="w"> </span><span class="l">5m</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">labels</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">severity</span><span class="p">:</span><span class="w"> </span><span class="l">warning</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">category</span><span class="p">:</span><span class="w"> </span><span class="l">performance</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">annotations</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">summary</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;Low cache hit rate&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;Cache hit rate is {{ $value | humanizePercentage }} for {{ $labels.cache_type }}&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c"># Database performance alerts</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="nt">alert</span><span class="p">:</span><span class="w"> </span><span class="l">SlowDatabaseQueries</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">expr</span><span class="p">:</span><span class="w"> </span><span class="l">rate(postgresql_slow_queries_total[5m]) &gt; 1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">for</span><span class="p">:</span><span class="w"> </span><span class="l">2m</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">labels</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">severity</span><span class="p">:</span><span class="w"> </span><span class="l">warning</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">category</span><span class="p">:</span><span class="w"> </span><span class="l">performance</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">annotations</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">summary</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;Slow database queries detected&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;{{ $value }} slow queries per second detected&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c"># Garbage collection alerts</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="nt">alert</span><span class="p">:</span><span class="w"> </span><span class="l">HighGCPressure</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">expr</span><span class="p">:</span><span class="w"> </span><span class="l">rate(go_gc_duration_seconds_sum[5m]) / rate(go_gc_duration_seconds_count[5m]) &gt; 0.1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">for</span><span class="p">:</span><span class="w"> </span><span class="l">5m</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">labels</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">severity</span><span class="p">:</span><span class="w"> </span><span class="l">warning</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">category</span><span class="p">:</span><span class="w"> </span><span class="l">performance</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">annotations</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">summary</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;High garbage collection pressure&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;Average GC duration is {{ $value }}s&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nn">---</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">v1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">ConfigMap</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">grafana-performance-dashboard</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l">monitoring</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">data</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">performance-dashboard.json</span><span class="p">:</span><span class="w"> </span><span class="p">|</span><span class="sd">
</span></span></span><span class="line"><span class="cl"><span class="sd">    {
</span></span></span><span class="line"><span class="cl"><span class="sd">      &#34;dashboard&#34;: {
</span></span></span><span class="line"><span class="cl"><span class="sd">        &#34;id&#34;: null,
</span></span></span><span class="line"><span class="cl"><span class="sd">        &#34;title&#34;: &#34;Application Performance Dashboard&#34;,
</span></span></span><span class="line"><span class="cl"><span class="sd">        &#34;tags&#34;: [&#34;performance&#34;, &#34;monitoring&#34;],
</span></span></span><span class="line"><span class="cl"><span class="sd">        &#34;timezone&#34;: &#34;browser&#34;,
</span></span></span><span class="line"><span class="cl"><span class="sd">        &#34;panels&#34;: [
</span></span></span><span class="line"><span class="cl"><span class="sd">          {
</span></span></span><span class="line"><span class="cl"><span class="sd">            &#34;id&#34;: 1,
</span></span></span><span class="line"><span class="cl"><span class="sd">            &#34;title&#34;: &#34;Response Time Percentiles&#34;,
</span></span></span><span class="line"><span class="cl"><span class="sd">            &#34;type&#34;: &#34;graph&#34;,
</span></span></span><span class="line"><span class="cl"><span class="sd">            &#34;targets&#34;: [
</span></span></span><span class="line"><span class="cl"><span class="sd">              {
</span></span></span><span class="line"><span class="cl"><span class="sd">                &#34;expr&#34;: &#34;histogram_quantile(0.50, rate(http_request_duration_seconds_bucket[5m]))&#34;,
</span></span></span><span class="line"><span class="cl"><span class="sd">                &#34;legendFormat&#34;: &#34;50th percentile&#34;
</span></span></span><span class="line"><span class="cl"><span class="sd">              },
</span></span></span><span class="line"><span class="cl"><span class="sd">              {
</span></span></span><span class="line"><span class="cl"><span class="sd">                &#34;expr&#34;: &#34;histogram_quantile(0.95, rate(http_request_duration_seconds_bucket[5m]))&#34;,
</span></span></span><span class="line"><span class="cl"><span class="sd">                &#34;legendFormat&#34;: &#34;95th percentile&#34;
</span></span></span><span class="line"><span class="cl"><span class="sd">              },
</span></span></span><span class="line"><span class="cl"><span class="sd">              {
</span></span></span><span class="line"><span class="cl"><span class="sd">                &#34;expr&#34;: &#34;histogram_quantile(0.99, rate(http_request_duration_seconds_bucket[5m]))&#34;,
</span></span></span><span class="line"><span class="cl"><span class="sd">                &#34;legendFormat&#34;: &#34;99th percentile&#34;
</span></span></span><span class="line"><span class="cl"><span class="sd">              }
</span></span></span><span class="line"><span class="cl"><span class="sd">            ],
</span></span></span><span class="line"><span class="cl"><span class="sd">            &#34;yAxes&#34;: [
</span></span></span><span class="line"><span class="cl"><span class="sd">              {
</span></span></span><span class="line"><span class="cl"><span class="sd">                &#34;label&#34;: &#34;Response Time (seconds)&#34;,
</span></span></span><span class="line"><span class="cl"><span class="sd">                &#34;min&#34;: 0
</span></span></span><span class="line"><span class="cl"><span class="sd">              }
</span></span></span><span class="line"><span class="cl"><span class="sd">            ]
</span></span></span><span class="line"><span class="cl"><span class="sd">          },
</span></span></span><span class="line"><span class="cl"><span class="sd">          {
</span></span></span><span class="line"><span class="cl"><span class="sd">            &#34;id&#34;: 2,
</span></span></span><span class="line"><span class="cl"><span class="sd">            &#34;title&#34;: &#34;Request Rate&#34;,
</span></span></span><span class="line"><span class="cl"><span class="sd">            &#34;type&#34;: &#34;graph&#34;,
</span></span></span><span class="line"><span class="cl"><span class="sd">            &#34;targets&#34;: [
</span></span></span><span class="line"><span class="cl"><span class="sd">              {
</span></span></span><span class="line"><span class="cl"><span class="sd">                &#34;expr&#34;: &#34;rate(http_requests_total[5m])&#34;,
</span></span></span><span class="line"><span class="cl"><span class="sd">                &#34;legendFormat&#34;: &#34;{{ method }} {{ endpoint }}&#34;
</span></span></span><span class="line"><span class="cl"><span class="sd">              }
</span></span></span><span class="line"><span class="cl"><span class="sd">            ],
</span></span></span><span class="line"><span class="cl"><span class="sd">            &#34;yAxes&#34;: [
</span></span></span><span class="line"><span class="cl"><span class="sd">              {
</span></span></span><span class="line"><span class="cl"><span class="sd">                &#34;label&#34;: &#34;Requests per second&#34;,
</span></span></span><span class="line"><span class="cl"><span class="sd">                &#34;min&#34;: 0
</span></span></span><span class="line"><span class="cl"><span class="sd">              }
</span></span></span><span class="line"><span class="cl"><span class="sd">            ]
</span></span></span><span class="line"><span class="cl"><span class="sd">          },
</span></span></span><span class="line"><span class="cl"><span class="sd">          {
</span></span></span><span class="line"><span class="cl"><span class="sd">            &#34;id&#34;: 3,
</span></span></span><span class="line"><span class="cl"><span class="sd">            &#34;title&#34;: &#34;Error Rate&#34;,
</span></span></span><span class="line"><span class="cl"><span class="sd">            &#34;type&#34;: &#34;graph&#34;,
</span></span></span><span class="line"><span class="cl"><span class="sd">            &#34;targets&#34;: [
</span></span></span><span class="line"><span class="cl"><span class="sd">              {
</span></span></span><span class="line"><span class="cl"><span class="sd">                &#34;expr&#34;: &#34;rate(http_requests_total{status_code=~\&#34;5..\&#34;}[5m]) / rate(http_requests_total[5m])&#34;,
</span></span></span><span class="line"><span class="cl"><span class="sd">                &#34;legendFormat&#34;: &#34;Error rate&#34;
</span></span></span><span class="line"><span class="cl"><span class="sd">              }
</span></span></span><span class="line"><span class="cl"><span class="sd">            ],
</span></span></span><span class="line"><span class="cl"><span class="sd">            &#34;yAxes&#34;: [
</span></span></span><span class="line"><span class="cl"><span class="sd">              {
</span></span></span><span class="line"><span class="cl"><span class="sd">                &#34;label&#34;: &#34;Error rate&#34;,
</span></span></span><span class="line"><span class="cl"><span class="sd">                &#34;min&#34;: 0,
</span></span></span><span class="line"><span class="cl"><span class="sd">                &#34;max&#34;: 1
</span></span></span><span class="line"><span class="cl"><span class="sd">              }
</span></span></span><span class="line"><span class="cl"><span class="sd">            ]
</span></span></span><span class="line"><span class="cl"><span class="sd">          },
</span></span></span><span class="line"><span class="cl"><span class="sd">          {
</span></span></span><span class="line"><span class="cl"><span class="sd">            &#34;id&#34;: 4,
</span></span></span><span class="line"><span class="cl"><span class="sd">            &#34;title&#34;: &#34;Resource Utilization&#34;,
</span></span></span><span class="line"><span class="cl"><span class="sd">            &#34;type&#34;: &#34;graph&#34;,
</span></span></span><span class="line"><span class="cl"><span class="sd">            &#34;targets&#34;: [
</span></span></span><span class="line"><span class="cl"><span class="sd">              {
</span></span></span><span class="line"><span class="cl"><span class="sd">                &#34;expr&#34;: &#34;rate(container_cpu_usage_seconds_total[5m])&#34;,
</span></span></span><span class="line"><span class="cl"><span class="sd">                &#34;legendFormat&#34;: &#34;CPU usage - {{ pod }}&#34;
</span></span></span><span class="line"><span class="cl"><span class="sd">              },
</span></span></span><span class="line"><span class="cl"><span class="sd">              {
</span></span></span><span class="line"><span class="cl"><span class="sd">                &#34;expr&#34;: &#34;container_memory_usage_bytes / 1024 / 1024&#34;,
</span></span></span><span class="line"><span class="cl"><span class="sd">                &#34;legendFormat&#34;: &#34;Memory usage (MB) - {{ pod }}&#34;
</span></span></span><span class="line"><span class="cl"><span class="sd">              }
</span></span></span><span class="line"><span class="cl"><span class="sd">            ]
</span></span></span><span class="line"><span class="cl"><span class="sd">          },
</span></span></span><span class="line"><span class="cl"><span class="sd">          {
</span></span></span><span class="line"><span class="cl"><span class="sd">            &#34;id&#34;: 5,
</span></span></span><span class="line"><span class="cl"><span class="sd">            &#34;title&#34;: &#34;Cache Performance&#34;,
</span></span></span><span class="line"><span class="cl"><span class="sd">            &#34;type&#34;: &#34;graph&#34;,
</span></span></span><span class="line"><span class="cl"><span class="sd">            &#34;targets&#34;: [
</span></span></span><span class="line"><span class="cl"><span class="sd">              {
</span></span></span><span class="line"><span class="cl"><span class="sd">                &#34;expr&#34;: &#34;rate(cache_hits_total[5m])&#34;,
</span></span></span><span class="line"><span class="cl"><span class="sd">                &#34;legendFormat&#34;: &#34;Cache hits/sec - {{ cache_type }}&#34;
</span></span></span><span class="line"><span class="cl"><span class="sd">              },
</span></span></span><span class="line"><span class="cl"><span class="sd">              {
</span></span></span><span class="line"><span class="cl"><span class="sd">                &#34;expr&#34;: &#34;rate(cache_misses_total[5m])&#34;,
</span></span></span><span class="line"><span class="cl"><span class="sd">                &#34;legendFormat&#34;: &#34;Cache misses/sec - {{ cache_type }}&#34;
</span></span></span><span class="line"><span class="cl"><span class="sd">              }
</span></span></span><span class="line"><span class="cl"><span class="sd">            ]
</span></span></span><span class="line"><span class="cl"><span class="sd">          }
</span></span></span><span class="line"><span class="cl"><span class="sd">        ],
</span></span></span><span class="line"><span class="cl"><span class="sd">        &#34;time&#34;: {
</span></span></span><span class="line"><span class="cl"><span class="sd">          &#34;from&#34;: &#34;now-1h&#34;,
</span></span></span><span class="line"><span class="cl"><span class="sd">          &#34;to&#34;: &#34;now&#34;
</span></span></span><span class="line"><span class="cl"><span class="sd">        },
</span></span></span><span class="line"><span class="cl"><span class="sd">        &#34;refresh&#34;: &#34;30s&#34;
</span></span></span><span class="line"><span class="cl"><span class="sd">      }
</span></span></span><span class="line"><span class="cl"><span class="sd">    }</span><span class="w">
</span></span></span></code></pre></div><h2 id="load-testing-and-performance-validation">Load Testing and Performance Validation</h2>
<h3 id="comprehensive-load-testing-script">Comprehensive Load Testing Script</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="cp">#!/bin/bash
</span></span></span><span class="line"><span class="cl"><span class="cp"></span><span class="c1"># scripts/load-test.sh</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">set</span> -euo pipefail
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Configuration</span>
</span></span><span class="line"><span class="cl"><span class="nv">TARGET_URL</span><span class="o">=</span><span class="s2">&#34;</span><span class="si">${</span><span class="nv">1</span><span class="k">:-</span><span class="nv">http</span><span class="p">://localhost:</span><span class="nv">8080</span><span class="si">}</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nv">TEST_DURATION</span><span class="o">=</span><span class="s2">&#34;</span><span class="si">${</span><span class="nv">2</span><span class="k">:-</span><span class="nv">300</span><span class="si">}</span><span class="s2">&#34;</span>  <span class="c1"># 5 minutes</span>
</span></span><span class="line"><span class="cl"><span class="nv">MAX_VUS</span><span class="o">=</span><span class="s2">&#34;</span><span class="si">${</span><span class="nv">3</span><span class="k">:-</span><span class="nv">100</span><span class="si">}</span><span class="s2">&#34;</span>        <span class="c1"># Virtual users</span>
</span></span><span class="line"><span class="cl"><span class="nv">RAMP_UP_TIME</span><span class="o">=</span><span class="s2">&#34;</span><span class="si">${</span><span class="nv">4</span><span class="k">:-</span><span class="nv">60</span><span class="si">}</span><span class="s2">&#34;</span>    <span class="c1"># Ramp up time in seconds</span>
</span></span><span class="line"><span class="cl"><span class="nv">TEST_TYPE</span><span class="o">=</span><span class="s2">&#34;</span><span class="si">${</span><span class="nv">5</span><span class="k">:-</span><span class="nv">load</span><span class="si">}</span><span class="s2">&#34;</span>     <span class="c1"># load, stress, spike, volume</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Colors for output</span>
</span></span><span class="line"><span class="cl"><span class="nv">RED</span><span class="o">=</span><span class="s1">&#39;\033[0;31m&#39;</span>
</span></span><span class="line"><span class="cl"><span class="nv">GREEN</span><span class="o">=</span><span class="s1">&#39;\033[0;32m&#39;</span>
</span></span><span class="line"><span class="cl"><span class="nv">YELLOW</span><span class="o">=</span><span class="s1">&#39;\033[1;33m&#39;</span>
</span></span><span class="line"><span class="cl"><span class="nv">BLUE</span><span class="o">=</span><span class="s1">&#39;\033[0;34m&#39;</span>
</span></span><span class="line"><span class="cl"><span class="nv">NC</span><span class="o">=</span><span class="s1">&#39;\033[0m&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">log<span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="nb">echo</span> -e <span class="s2">&#34;[</span><span class="k">$(</span>date <span class="s1">&#39;+%Y-%m-%d %H:%M:%S&#39;</span><span class="k">)</span><span class="s2">] </span><span class="nv">$1</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">success<span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    log <span class="s2">&#34;</span><span class="si">${</span><span class="nv">GREEN</span><span class="si">}</span><span class="s2">‚úì </span><span class="nv">$1</span><span class="si">${</span><span class="nv">NC</span><span class="si">}</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">warning<span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    log <span class="s2">&#34;</span><span class="si">${</span><span class="nv">YELLOW</span><span class="si">}</span><span class="s2">‚ö† </span><span class="nv">$1</span><span class="si">${</span><span class="nv">NC</span><span class="si">}</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">error<span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    log <span class="s2">&#34;</span><span class="si">${</span><span class="nv">RED</span><span class="si">}</span><span class="s2">‚úó </span><span class="nv">$1</span><span class="si">${</span><span class="nv">NC</span><span class="si">}</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">info<span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    log <span class="s2">&#34;</span><span class="si">${</span><span class="nv">BLUE</span><span class="si">}</span><span class="s2">‚Ñπ </span><span class="nv">$1</span><span class="si">${</span><span class="nv">NC</span><span class="si">}</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Create k6 test script</span>
</span></span><span class="line"><span class="cl">create_k6_script<span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="nb">local</span> <span class="nv">test_type</span><span class="o">=</span><span class="s2">&#34;</span><span class="nv">$1</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="nb">local</span> <span class="nv">script_file</span><span class="o">=</span><span class="s2">&#34;load-test-</span><span class="si">${</span><span class="nv">test_type</span><span class="si">}</span><span class="s2">.js&#34;</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    cat &gt; <span class="s2">&#34;</span><span class="si">${</span><span class="nv">script_file</span><span class="si">}</span><span class="s2">&#34;</span> <span class="s">&lt;&lt; &#39;EOF&#39;
</span></span></span><span class="line"><span class="cl"><span class="s">import http from &#39;k6/http&#39;;
</span></span></span><span class="line"><span class="cl"><span class="s">import { check, sleep } from &#39;k6&#39;;
</span></span></span><span class="line"><span class="cl"><span class="s">import { Rate, Trend, Counter } from &#39;k6/metrics&#39;;
</span></span></span><span class="line"><span class="cl"><span class="s">
</span></span></span><span class="line"><span class="cl"><span class="s">// Custom metrics
</span></span></span><span class="line"><span class="cl"><span class="s">const errorRate = new Rate(&#39;error_rate&#39;);
</span></span></span><span class="line"><span class="cl"><span class="s">const responseTime = new Trend(&#39;response_time&#39;);
</span></span></span><span class="line"><span class="cl"><span class="s">const requestCount = new Counter(&#39;request_count&#39;);
</span></span></span><span class="line"><span class="cl"><span class="s">
</span></span></span><span class="line"><span class="cl"><span class="s">// Test configuration
</span></span></span><span class="line"><span class="cl"><span class="s">export let options = {
</span></span></span><span class="line"><span class="cl"><span class="s">    stages: [
</span></span></span><span class="line"><span class="cl"><span class="s">        { duration: &#39;${RAMP_UP_TIME}s&#39;, target: ${MAX_VUS} },
</span></span></span><span class="line"><span class="cl"><span class="s">        { duration: &#39;${TEST_DURATION}s&#39;, target: ${MAX_VUS} },
</span></span></span><span class="line"><span class="cl"><span class="s">        { duration: &#39;60s&#39;, target: 0 },
</span></span></span><span class="line"><span class="cl"><span class="s">    ],
</span></span></span><span class="line"><span class="cl"><span class="s">    thresholds: {
</span></span></span><span class="line"><span class="cl"><span class="s">        http_req_duration: [&#39;p(95)&lt;500&#39;, &#39;p(99)&lt;1000&#39;],
</span></span></span><span class="line"><span class="cl"><span class="s">        http_req_failed: [&#39;rate&lt;0.01&#39;],
</span></span></span><span class="line"><span class="cl"><span class="s">        error_rate: [&#39;rate&lt;0.01&#39;],
</span></span></span><span class="line"><span class="cl"><span class="s">    },
</span></span></span><span class="line"><span class="cl"><span class="s">};
</span></span></span><span class="line"><span class="cl"><span class="s">
</span></span></span><span class="line"><span class="cl"><span class="s">// Test scenarios
</span></span></span><span class="line"><span class="cl"><span class="s">const scenarios = {
</span></span></span><span class="line"><span class="cl"><span class="s">    load_test: {
</span></span></span><span class="line"><span class="cl"><span class="s">        executor: &#39;ramping-vus&#39;,
</span></span></span><span class="line"><span class="cl"><span class="s">        startVUs: 0,
</span></span></span><span class="line"><span class="cl"><span class="s">        stages: [
</span></span></span><span class="line"><span class="cl"><span class="s">            { duration: &#39;${RAMP_UP_TIME}s&#39;, target: ${MAX_VUS} },
</span></span></span><span class="line"><span class="cl"><span class="s">            { duration: &#39;${TEST_DURATION}s&#39;, target: ${MAX_VUS} },
</span></span></span><span class="line"><span class="cl"><span class="s">            { duration: &#39;60s&#39;, target: 0 },
</span></span></span><span class="line"><span class="cl"><span class="s">        ],
</span></span></span><span class="line"><span class="cl"><span class="s">    },
</span></span></span><span class="line"><span class="cl"><span class="s">    stress_test: {
</span></span></span><span class="line"><span class="cl"><span class="s">        executor: &#39;ramping-vus&#39;,
</span></span></span><span class="line"><span class="cl"><span class="s">        startVUs: 0,
</span></span></span><span class="line"><span class="cl"><span class="s">        stages: [
</span></span></span><span class="line"><span class="cl"><span class="s">            { duration: &#39;60s&#39;, target: ${MAX_VUS} },
</span></span></span><span class="line"><span class="cl"><span class="s">            { duration: &#39;120s&#39;, target: ${MAX_VUS} * 2 },
</span></span></span><span class="line"><span class="cl"><span class="s">            { duration: &#39;180s&#39;, target: ${MAX_VUS} * 3 },
</span></span></span><span class="line"><span class="cl"><span class="s">            { duration: &#39;60s&#39;, target: 0 },
</span></span></span><span class="line"><span class="cl"><span class="s">        ],
</span></span></span><span class="line"><span class="cl"><span class="s">    },
</span></span></span><span class="line"><span class="cl"><span class="s">    spike_test: {
</span></span></span><span class="line"><span class="cl"><span class="s">        executor: &#39;ramping-vus&#39;,
</span></span></span><span class="line"><span class="cl"><span class="s">        startVUs: 0,
</span></span></span><span class="line"><span class="cl"><span class="s">        stages: [
</span></span></span><span class="line"><span class="cl"><span class="s">            { duration: &#39;60s&#39;, target: ${MAX_VUS} },
</span></span></span><span class="line"><span class="cl"><span class="s">            { duration: &#39;10s&#39;, target: ${MAX_VUS} * 5 },
</span></span></span><span class="line"><span class="cl"><span class="s">            { duration: &#39;60s&#39;, target: ${MAX_VUS} },
</span></span></span><span class="line"><span class="cl"><span class="s">            { duration: &#39;60s&#39;, target: 0 },
</span></span></span><span class="line"><span class="cl"><span class="s">        ],
</span></span></span><span class="line"><span class="cl"><span class="s">    },
</span></span></span><span class="line"><span class="cl"><span class="s">};
</span></span></span><span class="line"><span class="cl"><span class="s">
</span></span></span><span class="line"><span class="cl"><span class="s">export default function() {
</span></span></span><span class="line"><span class="cl"><span class="s">    const baseUrl = &#39;${TARGET_URL}&#39;;
</span></span></span><span class="line"><span class="cl"><span class="s">    
</span></span></span><span class="line"><span class="cl"><span class="s">    // Test different endpoints with realistic load distribution
</span></span></span><span class="line"><span class="cl"><span class="s">    const endpoints = [
</span></span></span><span class="line"><span class="cl"><span class="s">        { url: `${baseUrl}/api/users`, weight: 30 },
</span></span></span><span class="line"><span class="cl"><span class="s">        { url: `${baseUrl}/api/orders`, weight: 25 },
</span></span></span><span class="line"><span class="cl"><span class="s">        { url: `${baseUrl}/api/products`, weight: 20 },
</span></span></span><span class="line"><span class="cl"><span class="s">        { url: `${baseUrl}/api/search`, weight: 15 },
</span></span></span><span class="line"><span class="cl"><span class="s">        { url: `${baseUrl}/api/analytics`, weight: 10 },
</span></span></span><span class="line"><span class="cl"><span class="s">    ];
</span></span></span><span class="line"><span class="cl"><span class="s">    
</span></span></span><span class="line"><span class="cl"><span class="s">    // Select endpoint based on weight
</span></span></span><span class="line"><span class="cl"><span class="s">    const random = Math.random() * 100;
</span></span></span><span class="line"><span class="cl"><span class="s">    let cumulative = 0;
</span></span></span><span class="line"><span class="cl"><span class="s">    let selectedEndpoint = endpoints[0].url;
</span></span></span><span class="line"><span class="cl"><span class="s">    
</span></span></span><span class="line"><span class="cl"><span class="s">    for (const endpoint of endpoints) {
</span></span></span><span class="line"><span class="cl"><span class="s">        cumulative += endpoint.weight;
</span></span></span><span class="line"><span class="cl"><span class="s">        if (random &lt;= cumulative) {
</span></span></span><span class="line"><span class="cl"><span class="s">            selectedEndpoint = endpoint.url;
</span></span></span><span class="line"><span class="cl"><span class="s">            break;
</span></span></span><span class="line"><span class="cl"><span class="s">        }
</span></span></span><span class="line"><span class="cl"><span class="s">    }
</span></span></span><span class="line"><span class="cl"><span class="s">    
</span></span></span><span class="line"><span class="cl"><span class="s">    // Make request
</span></span></span><span class="line"><span class="cl"><span class="s">    const response = http.get(selectedEndpoint, {
</span></span></span><span class="line"><span class="cl"><span class="s">        headers: {
</span></span></span><span class="line"><span class="cl"><span class="s">            &#39;User-Agent&#39;: &#39;k6-load-test&#39;,
</span></span></span><span class="line"><span class="cl"><span class="s">            &#39;Accept&#39;: &#39;application/json&#39;,
</span></span></span><span class="line"><span class="cl"><span class="s">        },
</span></span></span><span class="line"><span class="cl"><span class="s">        timeout: &#39;30s&#39;,
</span></span></span><span class="line"><span class="cl"><span class="s">    });
</span></span></span><span class="line"><span class="cl"><span class="s">    
</span></span></span><span class="line"><span class="cl"><span class="s">    // Record metrics
</span></span></span><span class="line"><span class="cl"><span class="s">    requestCount.add(1);
</span></span></span><span class="line"><span class="cl"><span class="s">    responseTime.add(response.timings.duration);
</span></span></span><span class="line"><span class="cl"><span class="s">    
</span></span></span><span class="line"><span class="cl"><span class="s">    // Validate response
</span></span></span><span class="line"><span class="cl"><span class="s">    const success = check(response, {
</span></span></span><span class="line"><span class="cl"><span class="s">        &#39;status is 200&#39;: (r) =&gt; r.status === 200,
</span></span></span><span class="line"><span class="cl"><span class="s">        &#39;response time &lt; 1000ms&#39;: (r) =&gt; r.timings.duration &lt; 1000,
</span></span></span><span class="line"><span class="cl"><span class="s">        &#39;response has body&#39;: (r) =&gt; r.body &amp;&amp; r.body.length &gt; 0,
</span></span></span><span class="line"><span class="cl"><span class="s">    });
</span></span></span><span class="line"><span class="cl"><span class="s">    
</span></span></span><span class="line"><span class="cl"><span class="s">    errorRate.add(!success);
</span></span></span><span class="line"><span class="cl"><span class="s">    
</span></span></span><span class="line"><span class="cl"><span class="s">    // Realistic user behavior - think time
</span></span></span><span class="line"><span class="cl"><span class="s">    sleep(Math.random() * 2 + 1); // 1-3 seconds
</span></span></span><span class="line"><span class="cl"><span class="s">}
</span></span></span><span class="line"><span class="cl"><span class="s">
</span></span></span><span class="line"><span class="cl"><span class="s">export function handleSummary(data) {
</span></span></span><span class="line"><span class="cl"><span class="s">    return {
</span></span></span><span class="line"><span class="cl"><span class="s">        &#39;load-test-results.json&#39;: JSON.stringify(data, null, 2),
</span></span></span><span class="line"><span class="cl"><span class="s">        &#39;load-test-summary.txt&#39;: textSummary(data, { indent: &#39; &#39;, enableColors: true }),
</span></span></span><span class="line"><span class="cl"><span class="s">    };
</span></span></span><span class="line"><span class="cl"><span class="s">}
</span></span></span><span class="line"><span class="cl"><span class="s">EOF</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Replace placeholders</span>
</span></span><span class="line"><span class="cl">    sed -i.bak <span class="s2">&#34;s/\${TARGET_URL}/</span><span class="si">${</span><span class="nv">TARGET_URL</span><span class="p">//</span><span class="se">\/</span><span class="p">/</span><span class="se">\\</span><span class="p">/</span><span class="si">}</span><span class="s2">/g&#34;</span> <span class="s2">&#34;</span><span class="si">${</span><span class="nv">script_file</span><span class="si">}</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl">    sed -i.bak <span class="s2">&#34;s/\${TEST_DURATION}/</span><span class="si">${</span><span class="nv">TEST_DURATION</span><span class="si">}</span><span class="s2">/g&#34;</span> <span class="s2">&#34;</span><span class="si">${</span><span class="nv">script_file</span><span class="si">}</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl">    sed -i.bak <span class="s2">&#34;s/\${MAX_VUS}/</span><span class="si">${</span><span class="nv">MAX_VUS</span><span class="si">}</span><span class="s2">/g&#34;</span> <span class="s2">&#34;</span><span class="si">${</span><span class="nv">script_file</span><span class="si">}</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl">    sed -i.bak <span class="s2">&#34;s/\${RAMP_UP_TIME}/</span><span class="si">${</span><span class="nv">RAMP_UP_TIME</span><span class="si">}</span><span class="s2">/g&#34;</span> <span class="s2">&#34;</span><span class="si">${</span><span class="nv">script_file</span><span class="si">}</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl">    rm <span class="s2">&#34;</span><span class="si">${</span><span class="nv">script_file</span><span class="si">}</span><span class="s2">.bak&#34;</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="nb">echo</span> <span class="s2">&#34;</span><span class="si">${</span><span class="nv">script_file</span><span class="si">}</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Performance baseline measurement</span>
</span></span><span class="line"><span class="cl">measure_baseline<span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    info <span class="s2">&#34;Measuring performance baseline...&#34;</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1"># Single user test</span>
</span></span><span class="line"><span class="cl">    k6 run --vus <span class="m">1</span> --duration 60s --quiet <span class="s2">&#34;</span><span class="k">$(</span>create_k6_script baseline<span class="k">)</span><span class="s2">&#34;</span> &gt; baseline-results.txt
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="nb">local</span> <span class="nv">baseline_p95</span><span class="o">=</span><span class="k">$(</span>grep <span class="s2">&#34;http_req_duration.*p(95)&#34;</span> baseline-results.txt <span class="p">|</span> awk <span class="s1">&#39;{print $3}&#39;</span> <span class="p">|</span> sed <span class="s1">&#39;s/ms//&#39;</span><span class="k">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">local</span> <span class="nv">baseline_rps</span><span class="o">=</span><span class="k">$(</span>grep <span class="s2">&#34;http_reqs&#34;</span> baseline-results.txt <span class="p">|</span> awk <span class="s1">&#39;{print $3}&#39;</span> <span class="p">|</span> sed <span class="s1">&#39;s/\/s//&#39;</span><span class="k">)</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    info <span class="s2">&#34;Baseline P95 response time: </span><span class="si">${</span><span class="nv">baseline_p95</span><span class="si">}</span><span class="s2">ms&#34;</span>
</span></span><span class="line"><span class="cl">    info <span class="s2">&#34;Baseline RPS: </span><span class="si">${</span><span class="nv">baseline_rps</span><span class="si">}</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="nb">echo</span> <span class="s2">&#34;</span><span class="si">${</span><span class="nv">baseline_p95</span><span class="si">}</span><span class="s2">&#34;</span> &gt; baseline-p95.txt
</span></span><span class="line"><span class="cl">    <span class="nb">echo</span> <span class="s2">&#34;</span><span class="si">${</span><span class="nv">baseline_rps</span><span class="si">}</span><span class="s2">&#34;</span> &gt; baseline-rps.txt
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Run load test</span>
</span></span><span class="line"><span class="cl">run_load_test<span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="nb">local</span> <span class="nv">test_type</span><span class="o">=</span><span class="s2">&#34;</span><span class="nv">$1</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    info <span class="s2">&#34;Running </span><span class="si">${</span><span class="nv">test_type</span><span class="si">}</span><span class="s2"> test...&#34;</span>
</span></span><span class="line"><span class="cl">    info <span class="s2">&#34;Target: </span><span class="si">${</span><span class="nv">TARGET_URL</span><span class="si">}</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl">    info <span class="s2">&#34;Duration: </span><span class="si">${</span><span class="nv">TEST_DURATION</span><span class="si">}</span><span class="s2">s&#34;</span>
</span></span><span class="line"><span class="cl">    info <span class="s2">&#34;Max VUs: </span><span class="si">${</span><span class="nv">MAX_VUS</span><span class="si">}</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl">    info <span class="s2">&#34;Ramp up: </span><span class="si">${</span><span class="nv">RAMP_UP_TIME</span><span class="si">}</span><span class="s2">s&#34;</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="nb">local</span> script_file
</span></span><span class="line"><span class="cl">    <span class="nv">script_file</span><span class="o">=</span><span class="k">$(</span>create_k6_script <span class="s2">&#34;</span><span class="si">${</span><span class="nv">test_type</span><span class="si">}</span><span class="s2">&#34;</span><span class="k">)</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1"># Run k6 test</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> k6 run <span class="s2">&#34;</span><span class="si">${</span><span class="nv">script_file</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">;</span> <span class="k">then</span>
</span></span><span class="line"><span class="cl">        success <span class="s2">&#34;</span><span class="si">${</span><span class="nv">test_type</span><span class="si">}</span><span class="s2"> test completed successfully&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="m">0</span>
</span></span><span class="line"><span class="cl">    <span class="k">else</span>
</span></span><span class="line"><span class="cl">        error <span class="s2">&#34;</span><span class="si">${</span><span class="nv">test_type</span><span class="si">}</span><span class="s2"> test failed&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="m">1</span>
</span></span><span class="line"><span class="cl">    <span class="k">fi</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Analyze results</span>
</span></span><span class="line"><span class="cl">analyze_results<span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="o">[[</span> ! -f <span class="s2">&#34;load-test-results.json&#34;</span> <span class="o">]]</span><span class="p">;</span> <span class="k">then</span>
</span></span><span class="line"><span class="cl">        error <span class="s2">&#34;Results file not found&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="m">1</span>
</span></span><span class="line"><span class="cl">    <span class="k">fi</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    info <span class="s2">&#34;Analyzing test results...&#34;</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1"># Extract key metrics</span>
</span></span><span class="line"><span class="cl">    <span class="nb">local</span> p95_response_time
</span></span><span class="line"><span class="cl">    <span class="nb">local</span> p99_response_time
</span></span><span class="line"><span class="cl">    <span class="nb">local</span> avg_rps
</span></span><span class="line"><span class="cl">    <span class="nb">local</span> error_rate
</span></span><span class="line"><span class="cl">    <span class="nb">local</span> max_vus
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="nv">p95_response_time</span><span class="o">=</span><span class="k">$(</span>jq -r <span class="s1">&#39;.metrics.http_req_duration.values.p95&#39;</span> load-test-results.json<span class="k">)</span>
</span></span><span class="line"><span class="cl">    <span class="nv">p99_response_time</span><span class="o">=</span><span class="k">$(</span>jq -r <span class="s1">&#39;.metrics.http_req_duration.values.p99&#39;</span> load-test-results.json<span class="k">)</span>
</span></span><span class="line"><span class="cl">    <span class="nv">avg_rps</span><span class="o">=</span><span class="k">$(</span>jq -r <span class="s1">&#39;.metrics.http_reqs.values.rate&#39;</span> load-test-results.json<span class="k">)</span>
</span></span><span class="line"><span class="cl">    <span class="nv">error_rate</span><span class="o">=</span><span class="k">$(</span>jq -r <span class="s1">&#39;.metrics.http_req_failed.values.rate&#39;</span> load-test-results.json<span class="k">)</span>
</span></span><span class="line"><span class="cl">    <span class="nv">max_vus</span><span class="o">=</span><span class="k">$(</span>jq -r <span class="s1">&#39;.metrics.vus_max.values.max&#39;</span> load-test-results.json<span class="k">)</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1"># Performance report</span>
</span></span><span class="line"><span class="cl">    cat <span class="s">&lt;&lt; EOF &gt; performance-report.txt
</span></span></span><span class="line"><span class="cl"><span class="s">Performance Test Report
</span></span></span><span class="line"><span class="cl"><span class="s">======================
</span></span></span><span class="line"><span class="cl"><span class="s">Test Type: ${TEST_TYPE}
</span></span></span><span class="line"><span class="cl"><span class="s">Target URL: ${TARGET_URL}
</span></span></span><span class="line"><span class="cl"><span class="s">Test Duration: ${TEST_DURATION}s
</span></span></span><span class="line"><span class="cl"><span class="s">Max Virtual Users: ${max_vus}
</span></span></span><span class="line"><span class="cl"><span class="s">
</span></span></span><span class="line"><span class="cl"><span class="s">Key Metrics:
</span></span></span><span class="line"><span class="cl"><span class="s">- P95 Response Time: ${p95_response_time}ms
</span></span></span><span class="line"><span class="cl"><span class="s">- P99 Response Time: ${p99_response_time}ms
</span></span></span><span class="line"><span class="cl"><span class="s">- Average RPS: ${avg_rps}
</span></span></span><span class="line"><span class="cl"><span class="s">- Error Rate: $(echo &#34;${error_rate} * 100&#34; | bc -l | cut -d. -f1)%
</span></span></span><span class="line"><span class="cl"><span class="s">
</span></span></span><span class="line"><span class="cl"><span class="s">Performance Thresholds:
</span></span></span><span class="line"><span class="cl"><span class="s">- P95 &lt; 500ms: $(if (( $(echo &#34;${p95_response_time} &lt; 500&#34; | bc -l) )); then echo &#34;‚úì PASS&#34;; else echo &#34;‚úó FAIL&#34;; fi)
</span></span></span><span class="line"><span class="cl"><span class="s">- P99 &lt; 1000ms: $(if (( $(echo &#34;${p99_response_time} &lt; 1000&#34; | bc -l) )); then echo &#34;‚úì PASS&#34;; else echo &#34;‚úó FAIL&#34;; fi)
</span></span></span><span class="line"><span class="cl"><span class="s">- Error Rate &lt; 1%: $(if (( $(echo &#34;${error_rate} &lt; 0.01&#34; | bc -l) )); then echo &#34;‚úì PASS&#34;; else echo &#34;‚úó FAIL&#34;; fi)
</span></span></span><span class="line"><span class="cl"><span class="s">
</span></span></span><span class="line"><span class="cl"><span class="s">EOF</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Compare with baseline if available</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="o">[[</span> -f <span class="s2">&#34;baseline-p95.txt&#34;</span> <span class="o">]]</span><span class="p">;</span> <span class="k">then</span>
</span></span><span class="line"><span class="cl">        <span class="nb">local</span> baseline_p95
</span></span><span class="line"><span class="cl">        <span class="nv">baseline_p95</span><span class="o">=</span><span class="k">$(</span>cat baseline-p95.txt<span class="k">)</span>
</span></span><span class="line"><span class="cl">        <span class="nb">local</span> degradation
</span></span><span class="line"><span class="cl">        <span class="nv">degradation</span><span class="o">=</span><span class="k">$(</span><span class="nb">echo</span> <span class="s2">&#34;scale=2; (</span><span class="si">${</span><span class="nv">p95_response_time</span><span class="si">}</span><span class="s2"> - </span><span class="si">${</span><span class="nv">baseline_p95</span><span class="si">}</span><span class="s2">) / </span><span class="si">${</span><span class="nv">baseline_p95</span><span class="si">}</span><span class="s2"> * 100&#34;</span> <span class="p">|</span> bc -l<span class="k">)</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="nb">echo</span> <span class="s2">&#34;Baseline Comparison:&#34;</span> &gt;&gt; performance-report.txt
</span></span><span class="line"><span class="cl">        <span class="nb">echo</span> <span class="s2">&#34;- P95 Degradation: </span><span class="si">${</span><span class="nv">degradation</span><span class="si">}</span><span class="s2">%&#34;</span> &gt;&gt; performance-report.txt
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="o">((</span> <span class="k">$(</span><span class="nb">echo</span> <span class="s2">&#34;</span><span class="si">${</span><span class="nv">degradation</span><span class="si">}</span><span class="s2"> &gt; 20&#34;</span> <span class="p">|</span> bc -l<span class="k">)</span> <span class="o">))</span><span class="p">;</span> <span class="k">then</span>
</span></span><span class="line"><span class="cl">            warning <span class="s2">&#34;Performance degradation detected: </span><span class="si">${</span><span class="nv">degradation</span><span class="si">}</span><span class="s2">%&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="k">fi</span>
</span></span><span class="line"><span class="cl">    <span class="k">fi</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    cat performance-report.txt
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Generate performance graphs</span>
</span></span><span class="line"><span class="cl">generate_graphs<span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="nb">command</span> -v gnuplot <span class="p">&amp;</span>&gt; /dev/null<span class="p">;</span> <span class="k">then</span>
</span></span><span class="line"><span class="cl">        info <span class="s2">&#34;Generating performance graphs...&#34;</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="c1"># Extract time series data</span>
</span></span><span class="line"><span class="cl">        jq -r <span class="s1">&#39;.metrics.http_req_duration.values | to_entries[] | &#34;\(.key) \(.value)&#34;&#39;</span> load-test-results.json &gt; response-time-data.txt
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="c1"># Create gnuplot script</span>
</span></span><span class="line"><span class="cl">        cat <span class="s">&lt;&lt; &#39;EOF&#39; &gt; plot-performance.gp
</span></span></span><span class="line"><span class="cl"><span class="s">set terminal png size 1200,800
</span></span></span><span class="line"><span class="cl"><span class="s">set output &#39;performance-graph.png&#39;
</span></span></span><span class="line"><span class="cl"><span class="s">set title &#39;Load Test Performance Results&#39;
</span></span></span><span class="line"><span class="cl"><span class="s">set xlabel &#39;Time&#39;
</span></span></span><span class="line"><span class="cl"><span class="s">set ylabel &#39;Response Time (ms)&#39;
</span></span></span><span class="line"><span class="cl"><span class="s">set grid
</span></span></span><span class="line"><span class="cl"><span class="s">plot &#39;response-time-data.txt&#39; using 1:2 with lines title &#39;Response Time&#39;
</span></span></span><span class="line"><span class="cl"><span class="s">EOF</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        gnuplot plot-performance.gp
</span></span><span class="line"><span class="cl">        success <span class="s2">&#34;Performance graph generated: performance-graph.png&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="k">fi</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Cleanup function</span>
</span></span><span class="line"><span class="cl">cleanup<span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    rm -f load-test-*.js
</span></span><span class="line"><span class="cl">    rm -f baseline-results.txt
</span></span><span class="line"><span class="cl">    rm -f response-time-data.txt
</span></span><span class="line"><span class="cl">    rm -f plot-performance.gp
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Main execution</span>
</span></span><span class="line"><span class="cl">main<span class="o">()</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    info <span class="s2">&#34;Starting performance testing suite&#34;</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1"># Check dependencies</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> ! <span class="nb">command</span> -v k6 <span class="p">&amp;</span>&gt; /dev/null<span class="p">;</span> <span class="k">then</span>
</span></span><span class="line"><span class="cl">        error <span class="s2">&#34;k6 is not installed. Please install k6 first.&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="nb">exit</span> <span class="m">1</span>
</span></span><span class="line"><span class="cl">    <span class="k">fi</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1"># Measure baseline if not exists</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="o">[[</span> ! -f <span class="s2">&#34;baseline-p95.txt&#34;</span> <span class="o">]]</span><span class="p">;</span> <span class="k">then</span>
</span></span><span class="line"><span class="cl">        measure_baseline
</span></span><span class="line"><span class="cl">    <span class="k">fi</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1"># Run the specified test</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> run_load_test <span class="s2">&#34;</span><span class="si">${</span><span class="nv">TEST_TYPE</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">;</span> <span class="k">then</span>
</span></span><span class="line"><span class="cl">        analyze_results
</span></span><span class="line"><span class="cl">        generate_graphs
</span></span><span class="line"><span class="cl">        success <span class="s2">&#34;Performance testing completed successfully&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="k">else</span>
</span></span><span class="line"><span class="cl">        error <span class="s2">&#34;Performance testing failed&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="nb">exit</span> <span class="m">1</span>
</span></span><span class="line"><span class="cl">    <span class="k">fi</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Set up signal handlers</span>
</span></span><span class="line"><span class="cl"><span class="nb">trap</span> cleanup EXIT
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Run main function</span>
</span></span><span class="line"><span class="cl">main <span class="s2">&#34;</span><span class="nv">$@</span><span class="s2">&#34;</span>
</span></span></code></pre></div><h2 id="conclusion">Conclusion</h2>
<p>Performance optimization for cloud-native applications requires a systematic approach that encompasses:</p>
<ol>
<li><strong>Comprehensive Profiling</strong>: Using tools like pprof, distributed tracing, and application metrics to identify bottlenecks</li>
<li><strong>Database Optimization</strong>: Query optimization, indexing strategies, and connection pooling</li>
<li><strong>Caching Strategies</strong>: Multi-level caching, cache warming, and intelligent cache invalidation</li>
<li><strong>Resource Optimization</strong>: Right-sizing containers, implementing auto-scaling, and optimizing resource allocation</li>
<li><strong>Continuous Monitoring</strong>: Real-time performance monitoring, alerting, and automated remediation</li>
<li><strong>Load Testing</strong>: Regular performance validation and capacity planning</li>
</ol>
<p>Key success factors for performance optimization:</p>
<ul>
<li><strong>Establish baselines</strong> and continuously monitor performance metrics</li>
<li><strong>Implement observability</strong> at all levels of the application stack</li>
<li><strong>Automate optimization</strong> where possible to reduce manual intervention</li>
<li><strong>Test regularly</strong> under realistic load conditions</li>
<li><strong>Optimize iteratively</strong> based on data-driven insights</li>
</ul>
<p>By following these practices and implementing the solutions outlined in this guide, organizations can achieve optimal performance for their cloud-native applications while maintaining scalability and reliability.</p>

            </div>

            
            

            
            






            
            
            <div class="mt-12 pt-8 border-t border-gray-200">
                <h3 class="text-lg font-semibold text-gray-900 mb-4">
                    Tags
                </h3>
                <div class="flex flex-wrap gap-2">
                    
                    <a href="/en/tags/performance"
                        class="inline-block px-3 py-1 text-sm text-gray-600 bg-gray-100 rounded-full hover:bg-primary-100 hover:text-primary-700 transition-colors duration-200">
                        #Performance
                    </a>
                    
                    <a href="/en/tags/optimization"
                        class="inline-block px-3 py-1 text-sm text-gray-600 bg-gray-100 rounded-full hover:bg-primary-100 hover:text-primary-700 transition-colors duration-200">
                        #Optimization
                    </a>
                    
                    <a href="/en/tags/profiling"
                        class="inline-block px-3 py-1 text-sm text-gray-600 bg-gray-100 rounded-full hover:bg-primary-100 hover:text-primary-700 transition-colors duration-200">
                        #Profiling
                    </a>
                    
                    <a href="/en/tags/caching"
                        class="inline-block px-3 py-1 text-sm text-gray-600 bg-gray-100 rounded-full hover:bg-primary-100 hover:text-primary-700 transition-colors duration-200">
                        #Caching
                    </a>
                    
                    <a href="/en/tags/kubernetes"
                        class="inline-block px-3 py-1 text-sm text-gray-600 bg-gray-100 rounded-full hover:bg-primary-100 hover:text-primary-700 transition-colors duration-200">
                        #Kubernetes
                    </a>
                    
                    <a href="/en/tags/monitoring"
                        class="inline-block px-3 py-1 text-sm text-gray-600 bg-gray-100 rounded-full hover:bg-primary-100 hover:text-primary-700 transition-colors duration-200">
                        #Monitoring
                    </a>
                    
                    <a href="/en/tags/tuning"
                        class="inline-block px-3 py-1 text-sm text-gray-600 bg-gray-100 rounded-full hover:bg-primary-100 hover:text-primary-700 transition-colors duration-200">
                        #Tuning
                    </a>
                    
                </div>
            </div>
            

            
            <div class="mt-8 pt-8 border-t border-gray-200">
                <h3 class="text-lg font-semibold text-gray-900 mb-4">
                    Share Article
                </h3>
                <div class="flex flex-wrap gap-4">
                    
                    <a href="https://x.com/intent/tweet?url=https%3a%2f%2fwww.dishuihengxin.com%2fen%2fposts%2fdevops-performance-optimization%2f&amp;text=Performance%20Optimization%20for%20Cloud-Native%20Applications%3a%20From%20Profiling%20to%20Production%20Tuning"
                        target="_blank" rel="noopener noreferrer"
                        class="inline-flex items-center px-4 py-2 bg-black text-white rounded-lg hover:bg-gray-800 transition-colors duration-200">
                        <svg class="w-4 h-4 mr-2" fill="currentColor" viewBox="0 0 24 24">
                            <path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/>
                        </svg>
                        X
                    </a>

                    
                    <a href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fwww.dishuihengxin.com%2fen%2fposts%2fdevops-performance-optimization%2f" target="_blank"
                        rel="noopener noreferrer"
                        class="inline-flex items-center px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors duration-200">
                        <svg class="w-4 h-4 mr-2" fill="currentColor" viewBox="0 0 24 24">
                            <path
                                d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z" />
                        </svg>
                        Facebook
                    </a>

                    
                    <a href="https://www.linkedin.com/sharing/share-offsite/?url=https%3a%2f%2fwww.dishuihengxin.com%2fen%2fposts%2fdevops-performance-optimization%2f" target="_blank"
                        rel="noopener noreferrer"
                        class="inline-flex items-center px-4 py-2 bg-blue-700 text-white rounded-lg hover:bg-blue-800 transition-colors duration-200">
                        <svg class="w-4 h-4 mr-2" fill="currentColor" viewBox="0 0 24 24">
                            <path
                                d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z" />
                        </svg>
                        LinkedIn
                    </a>

                    
                    <button onclick="copyToClipboard('https:\/\/www.dishuihengxin.com\/en\/posts\/devops-performance-optimization\/')"
                        class="inline-flex items-center px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-colors duration-200">
                        <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z">
                            </path>
                        </svg>
                        Copy Link
                    </button>
                </div>
            </div>

            
            <div class="mt-12 pt-8 border-t border-gray-200 dark:border-gray-700">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    

                    
                    <a href="/en/posts/devops-microservices-architecture/"
                        class="group flex items-center p-6 bg-gray-50 dark:bg-gray-800 rounded-xl hover:bg-gray-100 dark:hover:bg-gray-700 transition-all duration-200 md:col-start-2">
                        <div class="flex-1 min-w-0 text-right">
                            <div class="text-sm text-gray-500 dark:text-gray-400 mb-1">
                                Next
                            </div>
                            <div
                                class="font-semibold text-gray-900 dark:text-white truncate group-hover:text-purple-600 transition-colors">
                                Microservices Architecture Design and Implementation: From Monolith to Distributed Systems
                            </div>
                        </div>
                        <div class="flex-shrink-0 ml-4">
                            <svg class="w-6 h-6 text-gray-400 group-hover:text-purple-600 transition-colors" fill="none"
                                stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7">
                                </path>
                            </svg>
                        </div>
                    </a>
                    
                </div>
            </div>

        </article>

        
        <aside class="w-full lg:w-[320px]">
            <div class="sticky top-24 space-y-6">
                
                
                <div class="bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6">
                    <h3
                        class="text-lg font-semibold text-gray-900 dark:text-white mb-4 pb-4 border-b border-gray-200 dark:border-gray-700 flex items-center gap-2">
                        <svg class="w-5 h-5 text-purple-600 dark:text-purple-400" fill="none" stroke="currentColor"
                            viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01">
                            </path>
                        </svg>
                        Content Navigation
                    </h3>
                    <div id="toc-content" class="toc text-sm space-y-1">
                        <nav id="TableOfContents">
  <ul>
    <li><a href="#performance-optimization-methodology">Performance Optimization Methodology</a>
      <ul>
        <li><a href="#performance-engineering-lifecycle">Performance Engineering Lifecycle</a></li>
        <li><a href="#performance-metrics-framework">Performance Metrics Framework</a></li>
      </ul>
    </li>
    <li><a href="#application-profiling-and-analysis">Application Profiling and Analysis</a>
      <ul>
        <li><a href="#go-application-profiling">Go Application Profiling</a></li>
        <li><a href="#database-query-optimization">Database Query Optimization</a></li>
        <li><a href="#caching-strategy-implementation">Caching Strategy Implementation</a></li>
      </ul>
    </li>
    <li><a href="#kubernetes-resource-optimization">Kubernetes Resource Optimization</a>
      <ul>
        <li><a href="#resource-requests-and-limits-optimization">Resource Requests and Limits Optimization</a></li>
        <li><a href="#performance-monitoring-and-alerting">Performance Monitoring and Alerting</a></li>
      </ul>
    </li>
    <li><a href="#load-testing-and-performance-validation">Load Testing and Performance Validation</a>
      <ul>
        <li><a href="#comprehensive-load-testing-script">Comprehensive Load Testing Script</a></li>
      </ul>
    </li>
    <li><a href="#conclusion">Conclusion</a></li>
  </ul>
</nav>
                    </div>
                    <div class="mt-4 pt-4 border-t border-gray-200 dark:border-gray-700">
                        <div class="flex items-center justify-between text-xs text-gray-500 dark:text-gray-400 mb-2">
                            <span>Reading Progress</span>
                            <span id="reading-progress-text">0%</span>
                        </div>
                        <div class="w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2">
                            <div id="reading-progress-bar"
                                class="bg-gradient-to-r from-purple-500 to-pink-500 h-2 rounded-full transition-all duration-300 progress-bar-width-0">
                            </div>
                        </div>
                    </div>
                </div>
                

                
                
                
                <div class="bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-6">
                    <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">
                        Related Posts
                    </h3>
                    <div class="space-y-4">
                        
                        <article class="group">
                            <a href="/en/posts/devops-kubernetes-production/" class="block">
                                
                                <h4
                                    class="font-semibold text-gray-900 dark:text-white group-hover:text-purple-600 dark:group-hover:text-purple-400 transition-colors line-clamp-2 mb-2">
                                    Kubernetes Production Best Practices: Building Enterprise-Grade Container Orchestration
                                </h4>
                                <div class="flex items-center text-xs text-gray-500 dark:text-gray-400">
                                    <svg class="w-3 h-3 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z">
                                        </path>
                                    </svg>
                                    <time datetime="2025-12-31">
                                        2025-12-31
                                    </time>
                                </div>
                            </a>
                        </article>
                        
                        <article class="group">
                            <a href="/en/posts/devops-monitoring-observability/" class="block">
                                
                                <h4
                                    class="font-semibold text-gray-900 dark:text-white group-hover:text-purple-600 dark:group-hover:text-purple-400 transition-colors line-clamp-2 mb-2">
                                    Building Enterprise Observability Platform: Comprehensive Monitoring, Logging, and Tracing Solutions
                                </h4>
                                <div class="flex items-center text-xs text-gray-500 dark:text-gray-400">
                                    <svg class="w-3 h-3 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z">
                                        </path>
                                    </svg>
                                    <time datetime="2025-12-31">
                                        2025-12-31
                                    </time>
                                </div>
                            </a>
                        </article>
                        
                        <article class="group">
                            <a href="/en/posts/devops-disaster-recovery/" class="block">
                                
                                <h4
                                    class="font-semibold text-gray-900 dark:text-white group-hover:text-purple-600 dark:group-hover:text-purple-400 transition-colors line-clamp-2 mb-2">
                                    Disaster Recovery and Business Continuity for Cloud-Native Applications: A Comprehensive Strategy
                                </h4>
                                <div class="flex items-center text-xs text-gray-500 dark:text-gray-400">
                                    <svg class="w-3 h-3 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z">
                                        </path>
                                    </svg>
                                    <time datetime="2025-12-31">
                                        2025-12-31
                                    </time>
                                </div>
                            </a>
                        </article>
                        
                        <article class="group">
                            <a href="/en/posts/devops-gitops-workflow/" class="block">
                                
                                <h4
                                    class="font-semibold text-gray-900 dark:text-white group-hover:text-purple-600 dark:group-hover:text-purple-400 transition-colors line-clamp-2 mb-2">
                                    GitOps Workflow for Kubernetes: Implementing Continuous Delivery with Flux and ArgoCD
                                </h4>
                                <div class="flex items-center text-xs text-gray-500 dark:text-gray-400">
                                    <svg class="w-3 h-3 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z">
                                        </path>
                                    </svg>
                                    <time datetime="2025-12-31">
                                        2025-12-31
                                    </time>
                                </div>
                            </a>
                        </article>
                        
                        <article class="group">
                            <a href="/en/posts/devops-microservices-architecture/" class="block">
                                
                                <h4
                                    class="font-semibold text-gray-900 dark:text-white group-hover:text-purple-600 dark:group-hover:text-purple-400 transition-colors line-clamp-2 mb-2">
                                    Microservices Architecture Design and Implementation: From Monolith to Distributed Systems
                                </h4>
                                <div class="flex items-center text-xs text-gray-500 dark:text-gray-400">
                                    <svg class="w-3 h-3 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z">
                                        </path>
                                    </svg>
                                    <time datetime="2025-12-31">
                                        2025-12-31
                                    </time>
                                </div>
                            </a>
                        </article>
                        
                    </div>
                </div>
                

                
                
            </div>
        </aside>
    </div>
</div>


<script>
    
    function copyToClipboard(text) {
        navigator.clipboard.writeText(text).then(function () {
            const button = event.target.closest('button');
            const originalText = button.innerHTML;
            button.innerHTML = `
            <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
            </svg>
            Copied
        `;
            setTimeout(() => {
                button.innerHTML = originalText;
            }, 2000);
        });
    }

    
    document.addEventListener('DOMContentLoaded', function () {
        const progressBar = document.getElementById('reading-progress-bar');
        const progressText = document.getElementById('reading-progress-text');
        const tocLinks = document.querySelectorAll('#toc-content a');
        const headings = Array.from(document.querySelectorAll('article h1, article h2, article h3, article h4, article h5, article h6'));

        
        function updateReadingProgress() {
            const windowHeight = window.innerHeight;
            const documentHeight = document.documentElement.scrollHeight - windowHeight;
            const scrolled = window.scrollY;
            const progress = documentHeight > 0 ? (scrolled / documentHeight) * 100 : 0;

            if (progressBar) {
                progressBar.style.width = progress + '%';
            }
            if (progressText) {
                progressText.textContent = Math.round(progress) + '%';
            }

            
            
            let activeHeading = null;
            const readingLine = 150; 

            for (let i = 0; i < headings.length; i++) {
                const heading = headings[i];
                const rect = heading.getBoundingClientRect();

                
                if (rect.top <= readingLine) {
                    activeHeading = heading;
                } else {
                    
                    break;
                }
            }

            
            const activeId = activeHeading ? activeHeading.id : null;
            const currentActiveLink = document.querySelector('#toc-content a.active-toc-item');
            const currentActiveId = currentActiveLink ? currentActiveLink.getAttribute('href').substring(1) : null;

            if (activeId !== currentActiveId) {
                
                tocLinks.forEach(link => {
                    link.classList.remove('active-toc-item');

                    const href = link.getAttribute('href');
                    if (activeId && href === '#' + activeId) {
                        link.classList.add('active-toc-item');

                        
                        const tocContainer = document.getElementById('toc-content');
                        if (tocContainer) {
                            const linkRect = link.getBoundingClientRect();
                            const containerRect = tocContainer.getBoundingClientRect();

                            
                            if (linkRect.top < containerRect.top + 20 || linkRect.bottom > containerRect.bottom - 20) {
                                
                                link.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
                            }
                        }
                    }
                });
            }
        }

        let isScrolling = false;
        window.addEventListener('scroll', () => {
            if (!isScrolling) {
                window.requestAnimationFrame(() => {
                    updateReadingProgress();
                    isScrolling = false;
                });
                isScrolling = true;
            }
        });
        updateReadingProgress();

        

        
        const viewCount = document.getElementById('view-count');
        if (viewCount) {
            const count = Math.floor(Math.random() * 1000) + 100;
            viewCount.textContent = count;
        }
    });
</script>


<style>
    .code-block-wrapper {
        position: relative;
        margin: 1.5rem 0;
    }

    .code-block-wrapper pre {
        margin: 0;
        background: #f6f8fa !important;
        border: 1px solid #d0d7de;
        border-radius: 6px;
        padding: 16px;
        overflow-x: auto;
        font-size: 14px;
        line-height: 1.45;
    }

    .dark .code-block-wrapper pre {
        background: #0d1117 !important;
        border-color: #30363d;
    }

    .code-block-wrapper pre code {
        background: transparent !important;
        padding: 0 !important;
        border: none !important;
        font-family: ui-monospace, SFMono-Regular, 'SF Mono', Menlo, Consolas, 'Liberation Mono', monospace;
        color: #24292f;
    }

    .dark .code-block-wrapper pre code {
        color: #c9d1d9;
    }

     
    :not(pre)>code {
        background: #f6f8fa;
        border: 1px solid #d0d7de;
        border-radius: 3px;
        padding: 0.2em 0.4em;
        font-size: 85%;
        font-family: ui-monospace, SFMono-Regular, 'SF Mono', Menlo, Consolas, 'Liberation Mono', monospace;
        color: #24292f;
    }

    .dark :not(pre)>code {
        background: #161b22;
        border-color: #30363d;
        color: #c9d1d9;
    }

     
    #toc-content {
        max-height: calc(100vh - 250px);
        overflow-y: auto;
        padding-right: 0.5rem;
    }

    #toc-content::-webkit-scrollbar {
        width: 4px;
    }

    #toc-content::-webkit-scrollbar-track {
        background: transparent;
    }

    #toc-content::-webkit-scrollbar-thumb {
        background: rgba(139, 92, 246, 0.3);
        border-radius: 2px;
    }

    #toc-content::-webkit-scrollbar-thumb:hover {
        background: rgba(139, 92, 246, 0.5);
    }

    #toc-content ul {
        list-style: none;
        padding-left: 0;
        margin: 0;
    }

    #toc-content ul ul {
        padding-left: 0.75rem;
        margin-top: 0;
    }

    #toc-content li {
        margin: 0;
    }

    #toc-content a {
        display: block;
        padding: 0.35rem 0.5rem;
         
        border-radius: 0.375rem;
        transition: all 0.2s ease;
        text-decoration: none;
        border-left: 3px solid transparent;
        color: #4b5563;
        font-size: 0.9rem;
        line-height: 1.4;
    }

    .dark #toc-content a {
        color: #9ca3af;
    }

    #toc-content a:hover {
        background: rgba(139, 92, 246, 0.05);
        color: #7c3aed;
    }

    .dark #toc-content a:hover {
        background: rgba(139, 92, 246, 0.1);
        color: #a78bfa;
    }

     
    #toc-content a.active-toc-item {
        background: rgba(139, 92, 246, 0.1);
        border-left-color: #7c3aed;
         
        color: #7c3aed;
         
        font-weight: 600;
    }

    .dark #toc-content a.active-toc-item {
        background: rgba(139, 92, 246, 0.15);
        border-left-color: #a78bfa;
        color: #a78bfa;
    }

     
    aside .sticky {
        position: sticky;
        top: 6rem;
    }

     
    .article-content>h1:first-child {
        display: none;
    }
</style>

    </main>

    
    <div class="relative z-20">
        <section role="contentinfo" aria-label="Site Footer" class="bg-gray-900 text-gray-300">
    <footer class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-10">
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 lg:gap-8">
            
            <div>
                <div class="flex items-center space-x-3 mb-4">
                    <img src="/images/logo.png" alt="dishuihengxin Logo"
                        class="w-10 h-10 object-contain">
                    <span class="text-xl font-bold text-white">dishuihengxin</span>
                </div>
                <p class="text-gray-400 text-sm leading-relaxed mb-6">
                    
                    Focused on tech sharing and communication, dedicated to helping developers grow. Sharing latest tech
                    trends, practical experience and development tips.
                    
                </p>

                
                <div class="flex flex-wrap gap-3">
                    <a href="https://github.com/dishuihengxin" target="_blank"
                        rel="noopener noreferrer"
                        class="w-9 h-9 flex items-center justify-center rounded-lg bg-gray-800 text-gray-400 hover:bg-gray-700 hover:text-white transition-all duration-200"
                        aria-label="GitHub">
                        <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
                            <path
                                d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z" />
                        </svg>
                    </a>
                    <a href="https://x.com/dishuihengxin" target="_blank"
                        rel="noopener noreferrer"
                        class="w-9 h-9 flex items-center justify-center rounded-lg bg-gray-800 text-gray-400 hover:bg-gray-700 hover:text-white transition-all duration-200"
                        aria-label="X">
                        <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
                            <path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/>
                        </svg>
                    </a>
                    <a href="https://linkedin.com/in/dishuihengxin" target="_blank"
                        rel="noopener noreferrer"
                        class="w-9 h-9 flex items-center justify-center rounded-lg bg-gray-800 text-gray-400 hover:bg-gray-700 hover:text-white transition-all duration-200"
                        aria-label="LinkedIn">
                        <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
                            <path
                                d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z" />
                        </svg>
                    </a>
                    <a href="mailto:dishuihengxin@gmail.com"
                        class="w-9 h-9 flex items-center justify-center rounded-lg bg-gray-800 text-gray-400 hover:bg-gray-700 hover:text-white transition-all duration-200"
                        aria-label="Email">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M3 8l7.89 4.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" />
                        </svg>
                    </a>
                </div>
            </div>

            
            <div>
                <h3 class="text-white font-semibold mb-4 flex items-center">
                    <svg class="w-5 h-5 mr-2 text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M13 10V3L4 14h7v7l9-11h-7z"></path>
                    </svg>
                    Quick Links
                </h3>
                <ul class="space-y-3">
                    <li>
                        <a href="/en/categories/"
                            class="text-gray-400 hover:text-white transition-colors duration-200 text-sm flex items-center group">
                            <svg class="w-4 h-4 mr-2 text-gray-500 group-hover:text-blue-400 transition-colors"
                                fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zM14 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zM14 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z">
                                </path>
                            </svg>
                            Categories
                        </a>
                    </li>
                    <li>
                        <a href="/en/tags/"
                            class="text-gray-400 hover:text-white transition-colors duration-200 text-sm flex items-center group">
                            <svg class="w-4 h-4 mr-2 text-gray-500 group-hover:text-blue-400 transition-colors"
                                fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z">
                                </path>
                            </svg>
                            Tags
                        </a>
                    </li>
                    <li>
                        <a href="/en/archive/"
                            class="text-gray-400 hover:text-white transition-colors duration-200 text-sm flex items-center group">
                            <svg class="w-4 h-4 mr-2 text-gray-500 group-hover:text-blue-400 transition-colors"
                                fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M5 8h14M5 8a2 2 0 110-4h14a2 2 0 110 4M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8m-9 4h4">
                                </path>
                            </svg>
                            Archive
                        </a>
                    </li>
                    <li>
                        <a href="/en/about/"
                            class="text-gray-400 hover:text-white transition-colors duration-200 text-sm flex items-center group">
                            <svg class="w-4 h-4 mr-2 text-gray-500 group-hover:text-blue-400 transition-colors"
                                fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                            About
                        </a>
                    </li>
                    <li>
                        <a href="/en/changelog/"
                            class="text-gray-400 hover:text-white transition-colors duration-200 text-sm flex items-center group">
                            <svg class="w-4 h-4 mr-2 text-gray-500 group-hover:text-blue-400 transition-colors"
                                fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z">
                                </path>
                            </svg>
                            Changelog
                        </a>
                    </li>
                </ul>
            </div>

            
            <div>
                <h3 class="text-white font-semibold mb-4 flex items-center">
                    <svg class="w-5 h-5 mr-2 text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M5 3v4M3 5h4M6 17v4m-2-2h4m5-16l2.286 6.857L21 12l-5.714 2.143L13 21l-2.286-6.857L5 12l5.714-2.143L13 3z">
                        </path>
                    </svg>
                    Recommended
                </h3>
                <ul class="space-y-3">
                    
                    <li>
                        <a href="https://www.dishuihengxin.com/en/posts/devops-monitoring-observability/"
                            class="text-gray-400 hover:text-white transition-colors duration-200 text-sm block group">
                            <div class="flex items-start">
                                <svg class="w-4 h-4 mr-2 mt-0.5 text-gray-600 group-hover:text-green-400 transition-colors flex-shrink-0"
                                    fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M9 5l7 7-7 7"></path>
                                </svg>
                                <span class="truncate">Building Enterprise Observability Platform: Comprehensive Monitoring, Logging, and Tracing Solutions</span>
                            </div>
                        </a>
                    </li>
                    
                    <li>
                        <a href="https://www.dishuihengxin.com/en/posts/devops-disaster-recovery/"
                            class="text-gray-400 hover:text-white transition-colors duration-200 text-sm block group">
                            <div class="flex items-start">
                                <svg class="w-4 h-4 mr-2 mt-0.5 text-gray-600 group-hover:text-green-400 transition-colors flex-shrink-0"
                                    fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M9 5l7 7-7 7"></path>
                                </svg>
                                <span class="truncate">Disaster Recovery and Business Continuity for Cloud-Native Applications: A Comprehensive Strategy</span>
                            </div>
                        </a>
                    </li>
                    
                    <li>
                        <a href="https://www.dishuihengxin.com/en/posts/devops-gitops-workflow/"
                            class="text-gray-400 hover:text-white transition-colors duration-200 text-sm block group">
                            <div class="flex items-start">
                                <svg class="w-4 h-4 mr-2 mt-0.5 text-gray-600 group-hover:text-green-400 transition-colors flex-shrink-0"
                                    fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M9 5l7 7-7 7"></path>
                                </svg>
                                <span class="truncate">GitOps Workflow for Kubernetes: Implementing Continuous Delivery with Flux and ArgoCD</span>
                            </div>
                        </a>
                    </li>
                    
                    <li>
                        <a href="https://www.dishuihengxin.com/en/posts/devops-automation-terraform/"
                            class="text-gray-400 hover:text-white transition-colors duration-200 text-sm block group">
                            <div class="flex items-start">
                                <svg class="w-4 h-4 mr-2 mt-0.5 text-gray-600 group-hover:text-green-400 transition-colors flex-shrink-0"
                                    fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M9 5l7 7-7 7"></path>
                                </svg>
                                <span class="truncate">Infrastructure Automation with Terraform: Enterprise-Scale Cloud Resource Management</span>
                            </div>
                        </a>
                    </li>
                    
                    <li>
                        <a href="https://www.dishuihengxin.com/en/posts/devops-kubernetes-production/"
                            class="text-gray-400 hover:text-white transition-colors duration-200 text-sm block group">
                            <div class="flex items-start">
                                <svg class="w-4 h-4 mr-2 mt-0.5 text-gray-600 group-hover:text-green-400 transition-colors flex-shrink-0"
                                    fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M9 5l7 7-7 7"></path>
                                </svg>
                                <span class="truncate">Kubernetes Production Best Practices: Building Enterprise-Grade Container Orchestration</span>
                            </div>
                        </a>
                    </li>
                    
                </ul>
            </div>

            
            <div>
                <h3 class="text-white font-semibold mb-4 flex items-center">
                    <svg class="w-5 h-5 mr-2 text-purple-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z">
                        </path>
                    </svg>
                    Follow Us
                </h3>

                
                <img src="/images/qrcode.jpg" alt="Blog QR Code" class="w-24 h-24 rounded-lg shadow-lg mb-4">

                <p class="text-xs text-gray-400">
                    Scan to Follow
                </p>
            </div>
        </div>

        
        <div class="border-t border-gray-800 mt-10 pt-6">
            <div class="flex flex-col md:flex-row items-center justify-between gap-3">
                
                <div class="text-gray-400 text-sm text-center md:text-left">
                    ¬© 2026 dishuihengxin.
                    
                    All rights reserved.
                    
                </div>

                
                <div class="flex flex-wrap items-center justify-center gap-3 text-sm">
                    <a href="/en/privacy/"
                        class="text-gray-400 hover:text-white transition-colors duration-200">
                        Privacy
                    </a>
                    <span class="text-gray-700">|</span>
                    <a href="/en/terms/"
                        class="text-gray-400 hover:text-white transition-colors duration-200">
                        Terms
                    </a>
                    <span class="text-gray-700">|</span>
                    <a href="/index.xml"
                        class="text-gray-400 hover:text-white transition-colors duration-200 inline-flex items-center gap-1">
                        <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24">
                            <path
                                d="M6.503 20.752c0 1.794-1.456 3.248-3.251 3.248-1.796 0-3.252-1.454-3.252-3.248 0-1.794 1.456-3.248 3.252-3.248 1.795.001 3.251 1.454 3.251 3.248zm-6.503-12.572v4.811c6.05.062 10.96 4.966 11.022 11.009h4.817c-.062-8.71-7.118-15.758-15.839-15.82zm0-3.368c10.58.046 19.152 8.594 19.183 19.188h4.817c-.03-13.231-10.755-23.954-24-24v4.812z" />
                        </svg>
                        RSS
                    </a>
                    <span class="text-gray-700">|</span>
                    <a href="/sitemap.xml"
                        class="text-gray-400 hover:text-white transition-colors duration-200 inline-flex items-center gap-1">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M9 20l-5.447-2.724A1 1 0 013 16.382V5.618a1 1 0 011.447-.894L9 7m0 13l6-3m-6 3V7m6 10l4.553 2.276A1 1 0 0021 18.382V7.618a1 1 0 00-.553-.894L15 4m0 13V4m0 0L9 7">
                            </path>
                        </svg>
                        Sitemap
                    </a>
                </div>
            </div>
        </div>
    </footer>
</section>
    </div>

    

    
    <script src="https://cdn.jsdelivr.net/npm/fuse.js@7.0.0/dist/fuse.min.js" defer></script>

    
    
    
    
    
    
    <script src="/js/config.min.4e32dae1da8cb8e073e384e9bf17d0c048ae80f1ab72ece6507a3171fbfe62ea.js"></script>
    

    
    
    
    
    
    <script src="/js/theme-manager.min.80c7c5887d95e238a4626d07a137b2255878adff8f66394c2edb9a179f779739.js"></script>
    

    
    
    
    
    
    
    <script src="/js/security.min.7f0814c0037b61a39b8044f7a6d1357d4b794598eb75a62ee716f1f5621ad5f1.js" defer></script>
    

    
    

    
    

    
    

    
    

    
    
    
    
    
    
    <script src="/js/analytics.min.e9c247ba215787d5828ba98cca7bb28ca42f0527f6054bc2f640f59a99a94aa7.js?v=1767251074" defer></script>
    

    
    
    
    
    
    
    <script src="/js/search.min.b0ead121c4ae8a19b5689d834fd825a1214aaa1d9979e170f900bb2879a23819.js" defer></script>
    

    
    

    
    

    
    
    
    
    
    
    <script src="/js/interactions.min.ac95880fe48f06ba1594fc48c95de264f14b703f6e94ccafe53eaaefefa32682.js" defer></script>
    



    
    
    
    
    
    
    <script src="/js/main.min.1db3c2db630282d627f674c53069de74db16f4265e72ab68e0a15e1477917e8c.js?v=1767251074" defer></script>
    

    
    

    
    




  
<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?cdb9c487f6c71421e1844a7cc0fd40e9";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>
  




  
    
<script 
  defer 
  src="https://cloud.umami.is/script.js"
  data-website-id="9b11a70f-0a77-48ae-b986-03144bf118b8" data-do-not-track="true" data-domains="dishuihengxin.com"
></script>
    
  



    
    
    
    
    
    
    <script src="/js/fallback-theme.min.ad9490b67677d21ebf98c40c1cf51743318b6bc5d5e2c9f0e25f5ba57a1aecb1.js" defer></script>
    

    
    
    
    
    
    
    <script src="/js/hero-slider.min.1d6c0e80fe2af86085c169ed34bf8dd76f4bfc3cb37d92c063812c65a3ede326.js" defer></script>
    

    
    
    
    
    
    
    <script src="/js/hero-particle-system.min.0bbe8a66b536f8652ac2006fb0a65ff3ca52367f952f7fe7c18082b1303bf9b6.js" defer></script>
    
</body>

</html>