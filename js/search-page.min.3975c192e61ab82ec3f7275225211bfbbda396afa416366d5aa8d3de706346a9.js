console.log("=== 搜索页面脚本开始加载 ==="),document.addEventListener("DOMContentLoaded",function(){const e=document.getElementById("search-input-main");console.log("输入框元素:",e),e&&(e.focus(),console.log("已尝试聚焦输入框"))}),function(){let e=[],s,t=!1;async function c(){console.log("开始加载搜索索引...");try{const n=await fetch("/index.json");if(n.ok){e=await n.json(),t=!0,console.log("✅ 搜索索引加载成功，共",e.length,"篇文章"),h(),f();const s=document.getElementById("search-input-main");s&&!s.value.trim()&&i()}}catch(e){console.error("❌ 加载搜索索引失败:",e)}}function f(){const n=document.getElementById("total-posts");n&&t&&(n.textContent=e.length)}function h(){if(!t||e.length===0)return;const n={keys:[{name:"title",weight:.4},{name:"content",weight:.3},{name:"summary",weight:.2},{name:"tags",weight:.1}],includeScore:!0,threshold:.4,distance:100,minMatchCharLength:2,includeMatches:!1,shouldSort:!0};typeof Fuse!="undefined"&&(s=new Fuse(e,n),console.log("✅ Fuse.js 已初始化"))}function u(n,o,i){if(!t)return[];let a=[];if(s){const e=s.search(n);a=e.map(e=>{const t=e.item;return{title:t.title,url:t.url,summary:t.summary,content:t.content,date:t.date,tags:t.tags,categories:t.categories,readingTime:t.readingTime,score:e.score}})}else{const t=n.toLowerCase().split(/\s+/);e.forEach(e=>{let n=0;const s=e.title.toLowerCase(),o=e.content.toLowerCase(),i=e.summary.toLowerCase();t.forEach(e=>{s.includes(e)&&(n+=5),i.includes(e)&&(n+=3),o.includes(e)&&(n+=1)}),n>0&&a.push({title:e.title,url:e.url,summary:e.summary,content:e.content,date:e.date,tags:e.tags,categories:e.categories,readingTime:e.readingTime,score:n})}),a.sort((e,t)=>t.score-e.score)}if(o&&o!=="all"&&(a=a.filter(e=>e.categories&&e.categories.some(e=>e.toLowerCase()===o.toLowerCase()))),i&&i!=="all"){const e=new Date,t=e.getFullYear(),n=e.getMonth();a=a.filter(s=>{if(!s.date)return!1;const o=new Date(s.date);switch(i){case"this-month":return o.getFullYear()===t&&o.getMonth()===n;case"this-year":return o.getFullYear()===t;case"recent":return(e-o)/(1e3*60*60*24)<=180;default:return!0}})}return a=d(a),a}function d(e){const t=document.getElementById("search-sort")?.value||"relevance";switch(t){case"date-desc":return e.sort((e,t)=>new Date(t.date)-new Date(e.date));case"date-asc":return e.sort((e,t)=>new Date(e.date)-new Date(t.date));default:return e}}function l(e,t){if(!t||!e)return e;const s=t.toLowerCase().split(/\s+/);let n=e;return s.forEach(e=>{if(e.length<2)return;const t=e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),s=new RegExp(`(${t})`,"gi");n=n.replace(s,'<mark class="search-highlight">$1</mark>')}),n}function o(e,t){if(!e)return document.createTextNode("");const o=l(e,t),n=o.split(/(<mark class="search-highlight">.*?<\/mark>)/),s=document.createDocumentFragment();for(let e=0;e<n.length;e++)if(e%2===0)n[e]&&s.appendChild(document.createTextNode(n[e]));else if(n[e]){const t=document.createElement("mark");t.className="search-highlight",t.textContent=n[e].replace(/<\/?mark[^>]*>/g,""),s.appendChild(t)}return s}function r(e){const t=document.createElementNS("http://www.w3.org/2000/svg","svg");t.setAttribute("class","w-4 h-4"),t.setAttribute("fill","none"),t.setAttribute("stroke","currentColor"),t.setAttribute("viewBox","0 0 24 24");const n=document.createElementNS("http://www.w3.org/2000/svg","path");return n.setAttribute("stroke-linecap","round"),n.setAttribute("stroke-linejoin","round"),n.setAttribute("stroke-width","2"),n.setAttribute("d",e),t.appendChild(n),t}function a(e,t,n,s){const f=s==="zh"?"分钟阅读":"min read",a=document.createElement("article");a.className="group relative overflow-hidden rounded-xl bg-white/80 dark:bg-gray-800/80 backdrop-blur-xl border border-gray-200/50 dark:border-gray-700/50 shadow-lg hover:shadow-2xl transition-all duration-500 hover:-translate-y-1 mb-4",a.style.animationDelay=`${t*.05}s`;const m=document.createElement("div");m.className="absolute inset-0 bg-gradient-to-br from-blue-50/50 via-transparent to-purple-50/50 dark:from-blue-900/20 dark:via-transparent dark:to-purple-900/20 opacity-0 group-hover:opacity-100 transition-opacity duration-500",a.appendChild(m);const i=document.createElement("a");i.href=e.url||"#",i.className="relative block p-4";const d=document.createElement("div");d.className="flex items-start justify-between gap-3 mb-1";const u=document.createElement("h2");u.className="text-xl font-bold text-gray-900 dark:text-white flex-1 group-hover:text-blue-600 dark:group-hover:text-blue-400 transition-colors duration-300 leading-tight",u.appendChild(o(e.title||"",n)),d.appendChild(u);const h=document.createElement("p");h.className="text-gray-600 dark:text-gray-400 mb-3 line-clamp-2 text-sm leading-relaxed",h.appendChild(o(e.summary||"",n));const c=document.createElement("div");c.className="flex flex-wrap items-center gap-3";const l=document.createElement("div");if(l.className="flex flex-wrap items-center gap-2 text-xs text-gray-500 dark:text-gray-400",e.date){const t=document.createElement("span");t.className="flex items-center gap-1";const n=r("M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z");n.setAttribute("class","w-3.5 h-3.5"),t.appendChild(n),t.appendChild(document.createTextNode(new Date(e.date).toLocaleDateString(s))),l.appendChild(t)}if(e.readingTime){const t=document.createElement("span");t.className="flex items-center gap-1";const n=r("M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z");n.setAttribute("class","w-3.5 h-3.5"),t.appendChild(n),t.appendChild(document.createTextNode(`${e.readingTime} ${f}`)),l.appendChild(t)}if(c.appendChild(l),e.categories&&e.categories.length>0){const t=document.createElement("div");t.className="flex flex-wrap gap-1.5 ml-auto",e.categories.slice(0,2).forEach(e=>{const n=document.createElement("span");n.className="inline-flex items-center px-2 py-0.5 rounded-md text-xs font-medium bg-gradient-to-r from-blue-500/10 to-purple-500/10 dark:from-blue-500/20 dark:to-purple-500/20 text-blue-700 dark:text-blue-300 border border-blue-200/50 dark:border-blue-700/50",n.textContent=e,t.appendChild(n)}),c.appendChild(t)}return i.appendChild(d),i.appendChild(h),i.appendChild(c),a.appendChild(i),a}function i(){const n=document.getElementById("search-results-container"),s=document.getElementById("search-stats"),i=document.documentElement.lang||"zh";if(!n)return;if(n.innerHTML="",s&&s.classList.add("hidden"),!t||e.length===0){console.log("等待索引加载...");return}const o=e.filter(e=>e.section==="posts").sort((e,t)=>new Date(t.date)-new Date(e.date)).slice(0,8);console.log("推荐文章数量:",o.length),o.forEach((e,t)=>{const s=a(e,t,"",i);n.appendChild(s)})}function m(e,t){const o=document.getElementById("search-results-container"),s=document.getElementById("search-stats"),i=document.getElementById("results-count"),n=document.documentElement.lang||"zh";if(o.innerHTML="",e.length===0){s&&s.classList.add("hidden");const l=n==="zh"?"未找到相关内容":"No results found",d=n==="zh"?"试试不同的关键词或筛选条件":"Try different keywords or filters",t=document.createElement("div");t.className="text-center py-20";const a=document.createElement("div");a.className="inline-flex items-center justify-center w-20 h-20 rounded-full bg-gradient-to-br from-blue-100 to-purple-100 dark:from-blue-900/30 dark:to-purple-900/30 mb-6 backdrop-blur-xl";const e=document.createElementNS("http://www.w3.org/2000/svg","svg");e.setAttribute("class","w-10 h-10 text-blue-600 dark:text-blue-400"),e.setAttribute("fill","none"),e.setAttribute("stroke","currentColor"),e.setAttribute("viewBox","0 0 24 24");const i=document.createElementNS("http://www.w3.org/2000/svg","path");i.setAttribute("stroke-linecap","round"),i.setAttribute("stroke-linejoin","round"),i.setAttribute("stroke-width","2"),i.setAttribute("d","M9.172 16.172a4 4 0 015.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"),e.appendChild(i),a.appendChild(e);const r=document.createElement("h3");r.className="text-2xl font-bold text-gray-900 dark:text-white mb-3",r.textContent=l;const c=document.createElement("p");c.className="text-gray-600 dark:text-gray-400 text-lg",c.textContent=d,t.appendChild(a),t.appendChild(r),t.appendChild(c),o.appendChild(t);return}s&&s.classList.remove("hidden"),i&&(i.textContent=(n==="zh"?"找到 ":"Found ")+e.length+(n==="zh"?" 篇文章":" articles")),e.forEach((e,s)=>{const i=a(e,s,t,n);o.appendChild(i)})}function n(){const e=document.getElementById("search-input-main").value.trim(),n=document.getElementById("search-category").value,s=document.getElementById("search-scope").value,t=document.getElementById("clear-search");if(e?t.classList.remove("hidden"):t.classList.add("hidden"),e.length<2){i();return}const o=u(e,n,s);m(o,e)}document.addEventListener("DOMContentLoaded",()=>{console.log("DOM 加载完成，初始化搜索功能"),c();const e=document.getElementById("search-input-main"),o=document.getElementById("search-category"),i=document.getElementById("search-scope"),a=document.getElementById("search-sort"),s=document.getElementById("clear-search");if(!e){console.error("❌ 找不到搜索输入框");return}let r;e.addEventListener("input",()=>{clearTimeout(r),r=setTimeout(n,300)}),o&&o.addEventListener("change",n),i&&i.addEventListener("change",n),a&&a.addEventListener("change",n),s&&s.addEventListener("click",()=>{e.value="",s.classList.add("hidden"),n()});const d=new URLSearchParams(window.location.search),l=d.get("q");if(l){e.value=l;const s=setInterval(()=>{t&&(clearInterval(s),n())},100)}e.focus()}),document.addEventListener("keydown",e=>{if((e.ctrlKey||e.metaKey)&&e.key==="k"){e.preventDefault();const t=document.getElementById("search-input-main");t&&t.focus()}}),console.log("✅ 搜索功能初始化完成")}()