class ThemeManager{constructor(e={}){this.config={enableDarkMode:!0,enableCustomThemes:!0,enableSystemTheme:!0,enableThemeTransitions:!0,enableThemeCustomization:!0,enableThemePresets:!0,enableThemeSharing:!0,enableThemeScheduling:!0,enableAccessibilityThemes:!0,enableColorBlindSupport:!0,enableHighContrastMode:!0,enableReducedMotion:!0,enableThemeAnalytics:!0,enableThemeSync:!0,enableThemeBackup:!0,enableThemeImportExport:!0,enableThemeValidation:!0,enableThemeOptimization:!0,enableThemePreview:!0,enableThemeHistory:!0,enableThemeRecommendations:!0,enableThemePerformance:!0,enableThemeAccessibility:!0,enableThemeResponsive:!0,enableThemePrint:!0,themes:{light:{name:"Light",type:"light",colors:{primary:"#3b82f6",secondary:"#64748b",accent:"#f59e0b",background:"#ffffff",surface:"#f8fafc",text:"#1e293b",textSecondary:"#64748b",border:"#e2e8f0",success:"#10b981",warning:"#f59e0b",error:"#ef4444",info:"#3b82f6"},fonts:{primary:"Inter, system-ui, sans-serif",secondary:"Georgia, serif",mono:"JetBrains Mono, monospace"},spacing:{xs:"0.25rem",sm:"0.5rem",md:"1rem",lg:"1.5rem",xl:"2rem",xxl:"3rem"},borderRadius:{sm:"0.25rem",md:"0.5rem",lg:"0.75rem",xl:"1rem"},shadows:{sm:"0 1px 2px 0 rgba(0, 0, 0, 0.05)",md:"0 4px 6px -1px rgba(0, 0, 0, 0.1)",lg:"0 10px 15px -3px rgba(0, 0, 0, 0.1)",xl:"0 20px 25px -5px rgba(0, 0, 0, 0.1)"}},dark:{name:"Dark",type:"dark",colors:{primary:"#60a5fa",secondary:"#94a3b8",accent:"#fbbf24",background:"#0f172a",surface:"#1e293b",text:"#f1f5f9",textSecondary:"#94a3b8",border:"#334155",success:"#34d399",warning:"#fbbf24",error:"#f87171",info:"#60a5fa"},fonts:{primary:"Inter, system-ui, sans-serif",secondary:"Georgia, serif",mono:"JetBrains Mono, monospace"},spacing:{xs:"0.25rem",sm:"0.5rem",md:"1rem",lg:"1.5rem",xl:"2rem",xxl:"3rem"},borderRadius:{sm:"0.25rem",md:"0.5rem",lg:"0.75rem",xl:"1rem"},shadows:{sm:"0 1px 2px 0 rgba(0, 0, 0, 0.3)",md:"0 4px 6px -1px rgba(0, 0, 0, 0.4)",lg:"0 10px 15px -3px rgba(0, 0, 0, 0.4)",xl:"0 20px 25px -5px rgba(0, 0, 0, 0.4)"}},auto:{name:"Auto",type:"auto",description:"Follows system preference"}},presets:{ocean:{name:"Ocean",type:"light",colors:{primary:"#0ea5e9",secondary:"#0284c7",accent:"#06b6d4",background:"#f0f9ff",surface:"#e0f2fe",text:"#0c4a6e",textSecondary:"#0369a1"}},forest:{name:"Forest",type:"light",colors:{primary:"#059669",secondary:"#047857",accent:"#10b981",background:"#f0fdf4",surface:"#dcfce7",text:"#064e3b",textSecondary:"#065f46"}},sunset:{name:"Sunset",type:"light",colors:{primary:"#ea580c",secondary:"#dc2626",accent:"#f59e0b",background:"#fff7ed",surface:"#fed7aa",text:"#9a3412",textSecondary:"#c2410c"}},midnight:{name:"Midnight",type:"dark",colors:{primary:"#8b5cf6",secondary:"#7c3aed",accent:"#a855f7",background:"#0c0a09",surface:"#1c1917",text:"#fafaf9",textSecondary:"#d6d3d1"}}},accessibilityThemes:{highContrast:{name:"High Contrast",type:"accessibility",colors:{primary:"#000000",secondary:"#333333",accent:"#ffff00",background:"#ffffff",surface:"#f0f0f0",text:"#000000",textSecondary:"#333333",border:"#000000"}},lowVision:{name:"Low Vision",type:"accessibility",colors:{primary:"#0066cc",secondary:"#004499",accent:"#ff6600",background:"#ffffcc",surface:"#fff5b3",text:"#000000",textSecondary:"#333333",border:"#666666"}},deuteranopia:{name:"Deuteranopia Friendly",type:"accessibility",colors:{primary:"#0066ff",secondary:"#ff6600",accent:"#ffcc00",background:"#ffffff",surface:"#f5f5f5",text:"#000000",textSecondary:"#666666",border:"#cccccc"}}},animations:{duration:300,easing:"cubic-bezier(0.4, 0, 0.2, 1)",reducedMotion:!1},storage:{key:"tech-blog-theme",version:"1.0.0"},sync:{enabled:!1,endpoint:"/api/theme/sync",interval:3e5},...e},this.currentTheme=null,this.customThemes=new Map,this.themeHistory=[],this.preferences={autoSwitch:!1,schedules:[],accessibility:{reducedMotion:!1,highContrast:!1,colorBlindSupport:!1}},this.mediaQueries={dark:window.matchMedia("(prefers-color-scheme: dark)"),reducedMotion:window.matchMedia("(prefers-reduced-motion: reduce)"),highContrast:window.matchMedia("(prefers-contrast: high)")},this.observers=new Set,this.isInitialized=!1,this.init()}init(){if(this.isInitialized)return;this.loadPreferences(),this.setupMediaQueryListeners(),this.setupAccessibilityFeatures(),this.detectSystemPreferences(),this.loadSavedTheme(),this.setupThemeScheduling(),this.setupThemeSync(),this.setupThemeValidation(),this.setupThemeOptimization(),this.setupThemeAnalytics(),this.isInitialized=!0,this.emit("theme:initialized",{theme:this.currentTheme}),this.log("Theme manager initialized")}setupMediaQueryListeners(){this.mediaQueries.dark.addEventListener("change",e=>{this.currentTheme?.type==="auto"&&this.applySystemTheme(),this.emit("theme:systemChanged",{isDark:e.matches})}),this.mediaQueries.reducedMotion.addEventListener("change",e=>{this.preferences.accessibility.reducedMotion=e.matches,this.updateAnimationSettings(),this.emit("theme:reducedMotionChanged",{enabled:e.matches})}),this.mediaQueries.highContrast.addEventListener("change",e=>{this.preferences.accessibility.highContrast=e.matches,e.matches&&this.config.enableHighContrastMode&&this.setTheme("highContrast"),this.emit("theme:highContrastChanged",{enabled:e.matches})})}setupAccessibilityFeatures(){document.addEventListener("keydown",e=>{e.ctrlKey&&e.shiftKey&&e.key==="T"&&(this.toggleTheme(),e.preventDefault())}),this.setupFocusManagement(),this.setupScreenReaderSupport()}detectSystemPreferences(){this.preferences.accessibility.reducedMotion=this.mediaQueries.reducedMotion.matches,this.preferences.accessibility.highContrast=this.mediaQueries.highContrast.matches,this.detectColorBlindSupport()}loadSavedTheme(){const e=this.loadFromStorage();e&&e.theme?this.setTheme(e.theme,{skipSave:!0}):this.setTheme("auto",{skipSave:!1})}setTheme(e,t={}){const{skipSave:s=!1,skipTransition:o=!1,skipValidation:i=!1}=t;if(!i&&!this.validateTheme(e))return this.log(`Invalid theme: ${e}`),!1;const n=this.getTheme(e);if(!n)return this.log(`Theme not found: ${e}`),!1;const a=this.currentTheme;return this.currentTheme={...n,id:e},n.type==="auto"?this.applySystemTheme():this.applyTheme(n,{skipTransition:o}),s||this.saveToStorage(),this.addToHistory(e),this.emit("theme:changed",{theme:this.currentTheme,previous:a}),this.trackThemeUsage(e),this.log(`Theme changed to: ${n.name}`),!0}applyTheme(e,t={}){const{skipTransition:n=!1}=t;!n&&this.config.enableThemeTransitions&&!this.preferences.accessibility.reducedMotion&&document.documentElement.classList.add("theme-transitioning"),this.applyThemeVariables(e),this.applyThemeClasses(e),this.applyAccessibilitySettings(e),this.applyResponsiveSettings(e),this.applyPrintSettings(e),!n&&this.config.enableThemeTransitions&&setTimeout(()=>{document.documentElement.classList.remove("theme-transitioning")},this.config.animations.duration),this.updateMetaThemeColor(e),this.updateFavicon(e)}applySystemTheme(){const e=this.mediaQueries.dark.matches,t=e?this.config.themes.dark:this.config.themes.light;this.applyTheme(t)}applyThemeVariables(e){const t=document.documentElement;e.colors&&Object.entries(e.colors).forEach(([e,n])=>{t.style.setProperty(`--color-${e}`,n);const s=this.hexToRgb(n);s&&t.style.setProperty(`--color-${e}-rgb`,`${s.r}, ${s.g}, ${s.b}`)}),e.fonts&&Object.entries(e.fonts).forEach(([e,n])=>{t.style.setProperty(`--font-${e}`,n)}),e.spacing&&Object.entries(e.spacing).forEach(([e,n])=>{t.style.setProperty(`--spacing-${e}`,n)}),e.borderRadius&&Object.entries(e.borderRadius).forEach(([e,n])=>{t.style.setProperty(`--radius-${e}`,n)}),e.shadows&&Object.entries(e.shadows).forEach(([e,n])=>{t.style.setProperty(`--shadow-${e}`,n)}),t.style.setProperty("--animation-duration",`${this.config.animations.duration}ms`),t.style.setProperty("--animation-easing",this.config.animations.easing)}applyThemeClasses(e){const t=document.documentElement;t.classList.remove("theme-light","theme-dark","theme-auto","theme-accessibility"),t.classList.add(`theme-${e.type}`),e.id&&(t.classList.remove(...Array.from(t.classList).filter(e=>e.startsWith("theme-id-"))),t.classList.add(`theme-id-${e.id}`))}applyAccessibilitySettings(){const t=document.documentElement;this.preferences.accessibility.reducedMotion?t.classList.add("reduced-motion"):t.classList.remove("reduced-motion"),this.preferences.accessibility.highContrast?t.classList.add("high-contrast"):t.classList.remove("high-contrast"),this.preferences.accessibility.colorBlindSupport?t.classList.add("color-blind-support"):t.classList.remove("color-blind-support")}applyResponsiveSettings(){const t=document.documentElement;window.innerWidth<768?(t.style.setProperty("--font-size-base","14px"),t.style.setProperty("--spacing-scale","0.875")):(t.style.setProperty("--font-size-base","16px"),t.style.setProperty("--spacing-scale","1"))}applyPrintSettings(){if(!this.config.enableThemePrint)return;let t=document.getElementById("theme-print-styles");t||(t=document.createElement("style"),t.id="theme-print-styles",document.head.appendChild(t)),t.textContent=`
      @media print {
        :root {
          --color-background: #ffffff;
          --color-text: #000000;
          --color-border: #cccccc;
        }
        
        body {
          background: white !important;
          color: black !important;
        }
        
        .no-print {
          display: none !important;
        }
      }
    `}toggleTheme(){if(this.currentTheme?.type==="light")this.setTheme("dark");else if(this.currentTheme?.type==="dark")this.setTheme("light");else{const e=this.mediaQueries.dark.matches;this.setTheme(e?"light":"dark")}}getTheme(e){let t=null;return this.config.themes&&this.config.themes[e]?t=this.config.themes[e]:this.config.presets&&this.config.presets[e]?t=this.config.presets[e]:this.config.accessibilityThemes&&this.config.accessibilityThemes[e]?t=this.config.accessibilityThemes[e]:this.customThemes.has(e)&&(t=this.customThemes.get(e)),t?{name:t.name||e,type:t.type||"light",...t}:null}getAllThemes(){const e={...this.config.themes,...this.config.presets};return this.config.enableAccessibilityThemes&&Object.assign(e,this.config.accessibilityThemes),this.config.enableCustomThemes&&this.customThemes.forEach((t,n)=>{e[n]=t}),e}createCustomTheme(e,t){return this.config.enableCustomThemes?this.validateThemeStructure(t)?(t.id=e,t.custom=!0,t.created=Date.now(),this.customThemes.set(e,t),this.saveCustomThemes(),this.emit("theme:created",{id:e,theme:t}),this.log(`Custom theme created: ${e}`),!0):(this.log("Invalid theme structure"),!1):(this.log("Custom themes are disabled"),!1)}updateCustomTheme(e,t){if(!this.customThemes.has(e))return this.log(`Custom theme not found: ${e}`),!1;const n={...this.customThemes.get(e),...t};return n.updated=Date.now(),this.validateThemeStructure(n)?(this.customThemes.set(e,n),this.saveCustomThemes(),this.currentTheme?.id===e&&this.setTheme(e,{skipSave:!0}),this.emit("theme:updated",{id:e,theme:n}),!0):(this.log("Invalid theme structure"),!1)}deleteCustomTheme(e){return this.customThemes.has(e)?(this.customThemes.delete(e),this.saveCustomThemes(),this.currentTheme?.id===e&&this.setTheme("auto"),this.emit("theme:deleted",{id:e}),!0):(this.log(`Custom theme not found: ${e}`),!1)}setupThemeScheduling(){if(!this.config.enableThemeScheduling)return;setInterval(()=>{this.checkSchedules()},6e4),this.checkSchedules()}addSchedule(e){const{time:s,theme:o,days:i=[],enabled:a=!0}=e,t=`schedule_${Date.now()}`,n={id:t,time:s,theme:o,days:i,enabled:a,created:Date.now()};return this.preferences.schedules.push(n),this.saveToStorage(),this.emit("theme:scheduleAdded",{schedule:n}),t}checkSchedules(){if(!this.preferences.autoSwitch)return;const e=new Date,t=`${e.getHours().toString().padStart(2,"0")}:${e.getMinutes().toString().padStart(2,"0")}`,n=e.getDay();this.preferences.schedules.forEach(e=>{if(!e.enabled)return;const s=e.time===t,o=e.days.length===0||e.days.includes(n);s&&o&&(this.setTheme(e.theme),this.log(`Scheduled theme change: ${e.theme}`))})}setupThemeSync(){if(!this.config.sync.enabled)return;this.on("theme:changed",()=>{this.syncTheme()}),setInterval(()=>{this.syncTheme()},this.config.sync.interval)}async syncTheme(){try{const e={theme:this.currentTheme?.id,preferences:this.preferences,customThemes:Array.from(this.customThemes.entries())};await fetch(this.config.sync.endpoint,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}),this.log("Theme synced successfully")}catch(e){this.log(`Theme sync failed: ${e.message}`)}}setupThemeValidation(){Object.keys(this.config.themes).forEach(e=>{this.validateTheme(e)||this.log(`Invalid built-in theme: ${e}`)})}validateTheme(e){const t=this.getTheme(e);return t&&this.validateThemeStructure(t)}validateThemeStructure(e){if(!e||typeof e!="object")return!1;if(!e.name||!e.type)return!1;if(e.colors){const t=["primary","background","text"];if(!t.every(t=>e.colors[t]))return!1}return!0}setupThemeOptimization(){this.optimizeThemeLoading(),this.optimizeThemeSwitching()}optimizeThemeLoading(){this.preloadThemeAssets(),this.cacheThemeCalculations()}optimizeThemeSwitching(){this.switchThemeDebounced=this.debounce((e,t)=>{this.setTheme(e,t)},100),this.precomputeTransitions()}precomputeTransitions(){this.transitionCache=this.transitionCache||new Map}debounce(e,t){let n;return function(...s){const o=()=>{clearTimeout(n),e(...s)};clearTimeout(n),n=setTimeout(o,t)}}preloadThemeAssets(){const e=["light","dark"];e.forEach(e=>{const t=this.getTheme(e);t&&(this.themeCache=this.themeCache||new Map,this.themeCache.set(e,t))})}cacheThemeCalculations(){this.calculationCache=this.calculationCache||new Map}setupThemeAnalytics(){if(!this.config.enableThemeAnalytics)return;this.on("theme:changed",e=>{this.trackThemeUsage(e.theme.id)}),this.trackThemePerformance()}trackThemeUsage(e){window.TechBlogAnalytics&&window.TechBlogAnalytics.track("theme_changed",{theme:e,timestamp:Date.now()})}trackThemePerformance(){if(!this.config.enableThemeAnalytics)return;this.on("theme:changed",e=>{const t={theme:e.theme.id,switchTime:e.switchTime||0,timestamp:Date.now()};window.TechBlogAnalytics&&window.TechBlogAnalytics.track("theme_performance",t)})}updateMetaThemeColor(e){let t=document.querySelector('meta[name="theme-color"]');t||(t=document.createElement("meta"),t.name="theme-color",document.head.appendChild(t)),t.content=e.colors?.primary||"#3b82f6"}updateFavicon(e){const t=document.querySelector('link[rel="icon"]');t&&e.favicon&&(t.href=e.favicon)}setupFocusManagement(){document.addEventListener("focusin",e=>{e.target.matches("[data-theme-control]")&&e.target.setAttribute("aria-describedby","theme-description")})}setupScreenReaderSupport(){let e=document.getElementById("theme-live-region");e||(e=document.createElement("div"),e.id="theme-live-region",e.setAttribute("aria-live","polite"),e.setAttribute("aria-atomic","true"),e.style.cssText="position: absolute; left: -10000px; width: 1px; height: 1px; overflow: hidden;",document.body.appendChild(e)),this.on("theme:changed",t=>{t&&t.theme&&typeof t.theme=="object"&&t.theme&&t.theme.name?e.textContent=`Theme changed to ${t.theme.name}`:t&&typeof t=="string"?e.textContent=`Theme changed to ${t}`:t&&t.theme&&typeof t.theme=="string"?e.textContent=`Theme changed to ${t.theme}`:e.textContent="Theme changed"})}detectColorBlindSupport(){const e=this.loadFromStorage();e&&e.preferences&&e.preferences.accessibility&&(this.preferences.accessibility.colorBlindSupport=e.preferences.accessibility.colorBlindSupport||!1)}updateAnimationSettings(){this.config.animations.reducedMotion=this.preferences.accessibility.reducedMotion;const e=document.documentElement;this.preferences.accessibility.reducedMotion?e.style.setProperty("--animation-duration","0ms"):e.style.setProperty("--animation-duration",`${this.config.animations.duration}ms`)}addToHistory(e){this.themeHistory.unshift({id:e,timestamp:Date.now()}),this.themeHistory=this.themeHistory.slice(0,10)}hexToRgb(e){const t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return t?{r:parseInt(t[1],16),g:parseInt(t[2],16),b:parseInt(t[3],16)}:null}loadPreferences(){const e=this.loadFromStorage();e&&e.preferences&&(this.preferences={...this.preferences,...e.preferences}),this.loadCustomThemes()}loadCustomThemes(){const e=this.loadFromStorage();e&&e.customThemes&&e.customThemes.forEach(([e,t])=>{this.customThemes.set(e,t)})}saveCustomThemes(){const e=this.loadFromStorage()||{};e.customThemes=Array.from(this.customThemes.entries()),this.saveToStorage(e)}loadFromStorage(){try{const e=localStorage.getItem(this.config.storage.key);return e?JSON.parse(e):null}catch(e){return this.log(`Failed to load from storage: ${e.message}`),null}}saveToStorage(e=null){try{const t=e||{theme:this.currentTheme?.id,preferences:this.preferences,customThemes:Array.from(this.customThemes.entries()),version:this.config.storage.version,timestamp:Date.now()};localStorage.setItem(this.config.storage.key,JSON.stringify(t))}catch(e){this.log(`Failed to save to storage: ${e.message}`)}}exportThemes(){return{themes:Array.from(this.customThemes.entries()),preferences:this.preferences,version:this.config.storage.version,exported:Date.now()}}importThemes(e){try{return e.themes&&e.themes.forEach(([e,t])=>{this.customThemes.set(e,t)}),e.preferences&&(this.preferences={...this.preferences,...e.preferences}),this.saveToStorage(),this.emit("theme:imported",{count:e.themes?.length||0}),!0}catch(e){return this.log(`Failed to import themes: ${e.message}`),!1}}getThemeRecommendations(){const e=[],t=(new Date).getHours();return t>=18||t<=6?e.push({id:"dark",reason:"Dark theme is easier on the eyes during evening hours"}):e.push({id:"light",reason:"Light theme provides better readability during daytime"}),this.preferences.accessibility.highContrast&&e.push({id:"highContrast",reason:"High contrast theme for better visibility"}),e}getCurrentTheme(){return this.currentTheme}getThemeHistory(){return this.themeHistory}getPreferences(){return this.preferences}updatePreferences(e){this.preferences={...this.preferences,...e},this.saveToStorage(),this.emit("theme:preferencesUpdated",{preferences:this.preferences})}on(e,t){document.addEventListener(e,t),this.observers.add({event:e,callback:t})}off(e,t){document.removeEventListener(e,t),this.observers.delete({event:e,callback:t})}emit(e,t){const n=new CustomEvent(e,{detail:t});document.dispatchEvent(n)}destroy(){this.observers.forEach(({event:e,callback:t})=>{document.removeEventListener(e,t)}),this.observers.clear(),Object.values(this.mediaQueries).forEach(e=>{e.removeEventListener("change",()=>{})}),this.log("Theme manager destroyed")}log(e,t=null){t?console.log(`[ThemeManager] ${e}`,t):console.log(`[ThemeManager] ${e}`)}}window.TechBlogThemeManager=new ThemeManager,typeof module!="undefined"&&module.exports&&(module.exports=ThemeManager),window.ThemeManager=ThemeManager